





<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://assets-cdn.github.com">
  <link rel="dns-prefetch" href="https://avatars0.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars1.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars2.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  <link rel="dns-prefetch" href="https://github-cloud.s3.amazonaws.com">
  <link rel="dns-prefetch" href="https://user-images.githubusercontent.com/">



  <link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/frameworks-c9193575f18b28be82c0a963e144ff6fa7a809dd8ae003a1d1e5979bed3f7f00.css" integrity="sha256-yRk1dfGLKL6CwKlj4UT/b6eoCd2K4AOh0eWXm+0/fwA=" media="all" rel="stylesheet" />
  <link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/github-9ed815ea772b21ac723e5af484a801e4529591a0abda03969434dc16af6ecf16.css" integrity="sha256-ntgV6ncrIaxyPlr0hKgB5FKVkaCr2gOWlDTcFq9uzxY=" media="all" rel="stylesheet" />
  
  
  <link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/site-40d3ebebbd14d73c1a2f449e109a016ab13b3ba29987bc4f8eff487787682a7b.css" integrity="sha256-QNPr670U1zwaL0SeEJoBarE7O6KZh7xPjv9Id4doKns=" media="all" rel="stylesheet" />
  

  <meta name="viewport" content="width=device-width">
  
  <title>glowscript/glow.2.1.min.js at master · BruceSherwood/glowscript · GitHub</title>
  <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
  <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
  <meta property="fb:app_id" content="1401488693436528">

    
    <meta content="https://avatars3.githubusercontent.com/u/1127471?s=400&amp;v=4" property="og:image" /><meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="BruceSherwood/glowscript" property="og:title" /><meta content="https://github.com/BruceSherwood/glowscript" property="og:url" /><meta content="glowscript - Easy 3D animation programming in a browser, using VPython, RapydScript, CoffeeScript, or JavaScript" property="og:description" />

  <link rel="assets" href="https://assets-cdn.github.com/">
  
  <meta name="pjax-timeout" content="1000">
  
  <meta name="request-id" content="C974:5FB8:215622C:37BF0A3:5A217402" data-pjax-transient>
  

  <meta name="selected-link" value="repo_source" data-pjax-transient>

  <meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU">
<meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA">
<meta name="google-site-verification" content="GXs5KoUUkNCoaAZn7wPN-t01Pywp9M3sEjnt_3_ZWPc">
    <meta name="google-analytics" content="UA-3769691-2">

<meta content="collector.githubapp.com" name="octolytics-host" /><meta content="github" name="octolytics-app-id" /><meta content="https://collector.githubapp.com/github-external/browser_event" name="octolytics-event-url" /><meta content="C974:5FB8:215622C:37BF0A3:5A217402" name="octolytics-dimension-request_id" /><meta content="iad" name="octolytics-dimension-region_edge" /><meta content="iad" name="octolytics-dimension-region_render" />
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/blob/show" data-pjax-transient="true" name="analytics-location" />




  <meta class="js-ga-set" name="dimension1" content="Logged Out">


  

      <meta name="hostname" content="github.com">
  <meta name="user-login" content="">

      <meta name="expected-hostname" content="github.com">
    <meta name="js-proxy-site-detection-payload" content="ZWQ5ODdiZDVjNzlmOGNhYTBiNjI2NjNiOWE5YTZlNGUzMmY0MmI0OGE0ODM4YzRkY2RiZDQyYjcyMjliZjg2N3x7InJlbW90ZV9hZGRyZXNzIjoiMTQxLjcuMTMuMTQ2IiwicmVxdWVzdF9pZCI6IkM5NzQ6NUZCODoyMTU2MjJDOjM3QkYwQTM6NUEyMTc0MDIiLCJ0aW1lc3RhbXAiOjE1MTIxNDE4MzAsImhvc3QiOiJnaXRodWIuY29tIn0=">


  <meta name="html-safe-nonce" content="3fce3874c2f5b3bc5d897c032e28335234bcf6a9">

  <meta http-equiv="x-pjax-version" content="60558c2099e97248f156d9fa04571cd1">
  

      <link href="https://github.com/BruceSherwood/glowscript/commits/master.atom" rel="alternate" title="Recent Commits to glowscript:master" type="application/atom+xml">

  <meta name="description" content="glowscript - Easy 3D animation programming in a browser, using VPython, RapydScript, CoffeeScript, or JavaScript">
  <meta name="go-import" content="github.com/BruceSherwood/glowscript git https://github.com/BruceSherwood/glowscript.git">

  <meta content="1127471" name="octolytics-dimension-user_id" /><meta content="BruceSherwood" name="octolytics-dimension-user_login" /><meta content="28161160" name="octolytics-dimension-repository_id" /><meta content="BruceSherwood/glowscript" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="28161160" name="octolytics-dimension-repository_network_root_id" /><meta content="BruceSherwood/glowscript" name="octolytics-dimension-repository_network_root_nwo" /><meta content="false" name="octolytics-dimension-repository_explore_github_marketplace_ci_cta_shown" />


    <link rel="canonical" href="https://github.com/BruceSherwood/glowscript/blob/master/package/glow.2.1.min.js" data-pjax-transient>


  <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">

  <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">

  <link rel="mask-icon" href="https://assets-cdn.github.com/pinned-octocat.svg" color="#000000">
  <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://assets-cdn.github.com/favicon.ico">

<meta name="theme-color" content="#1e2327">



  </head>

  <body class="logged-out env-production page-blob">
    

  <div class="position-relative js-header-wrapper ">
    <a href="#start-of-content" tabindex="1" class="px-2 py-4 show-on-focus js-skip-to-content">Skip to content</a>
    <div id="js-pjax-loader-bar" class="pjax-loader-bar"><div class="progress"></div></div>

    
    
    



        <header class="Header header-logged-out  position-relative f4 py-3" role="banner">
  <div class="container-lg d-flex px-3">
    <div class="d-flex flex-justify-between flex-items-center">
      <a class="header-logo-invertocat my-0" href="https://github.com/" aria-label="Homepage" data-ga-click="(Logged out) Header, go to homepage, icon:logo-wordmark">
        <svg aria-hidden="true" class="octicon octicon-mark-github" height="32" version="1.1" viewBox="0 0 16 16" width="32"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
      </a>

    </div>

    <div class="HeaderMenu HeaderMenu--bright d-flex flex-justify-between flex-auto">
        <nav class="mt-0">
          <ul class="d-flex list-style-none">
              <li class="ml-2">
                <a href="/features" class="js-selected-navigation-item HeaderNavlink px-0 py-2 m-0" data-ga-click="Header, click, Nav menu - item:features" data-selected-links="/features /features/project-management /features/code-review /features/project-management /features/integrations /features">
                  Features
</a>              </li>
              <li class="ml-4">
                <a href="/business" class="js-selected-navigation-item HeaderNavlink px-0 py-2 m-0" data-ga-click="Header, click, Nav menu - item:business" data-selected-links="/business /business/security /business/customers /business">
                  Business
</a>              </li>

              <li class="ml-4">
                <a href="/explore" class="js-selected-navigation-item HeaderNavlink px-0 py-2 m-0" data-ga-click="Header, click, Nav menu - item:explore" data-selected-links="/explore /trending /trending/developers /integrations /integrations/feature/code /integrations/feature/collaborate /integrations/feature/ship showcases showcases_search showcases_landing /explore">
                  Explore
</a>              </li>

              <li class="ml-4">
                    <a href="/marketplace" class="js-selected-navigation-item HeaderNavlink px-0 py-2 m-0" data-ga-click="Header, click, Nav menu - item:marketplace" data-selected-links=" /marketplace">
                      Marketplace
</a>              </li>
              <li class="ml-4">
                <a href="/pricing" class="js-selected-navigation-item HeaderNavlink px-0 py-2 m-0" data-ga-click="Header, click, Nav menu - item:pricing" data-selected-links="/pricing /pricing/developer /pricing/team /pricing/business-hosted /pricing/business-enterprise /pricing">
                  Pricing
</a>              </li>
          </ul>
        </nav>

      <div class="d-flex">
          <div class="d-lg-flex flex-items-center mr-3">
            <div class="header-search scoped-search site-scoped-search js-site-search" role="search">
  <!-- '"` --><!-- </textarea></xmp> --></option></form><form accept-charset="UTF-8" action="/BruceSherwood/glowscript/search" class="js-site-search-form" data-scoped-search-url="/BruceSherwood/glowscript/search" data-unscoped-search-url="/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
    <label class="form-control header-search-wrapper js-chromeless-input-container">
        <a href="/BruceSherwood/glowscript/blob/master/package/glow.2.1.min.js" class="header-search-scope no-underline">This repository</a>
      <input type="text"
        class="form-control header-search-input js-site-search-focus js-site-search-field is-clearable"
        data-hotkey="s"
        name="q"
        value=""
        placeholder="Search"
        aria-label="Search this repository"
        data-unscoped-placeholder="Search GitHub"
        data-scoped-placeholder="Search"
        autocapitalize="off">
        <input type="hidden" class="js-site-search-type-field" name="type" >
    </label>
</form></div>

          </div>

        <span class="d-inline-block">
            <div class="HeaderNavlink px-0 py-2 m-0">
              <a class="text-bold text-white no-underline" href="/login?return_to=%2FBruceSherwood%2Fglowscript%2Fblob%2Fmaster%2Fpackage%2Fglow.2.1.min.js" data-ga-click="(Logged out) Header, clicked Sign in, text:sign-in">Sign in</a>
                <span class="text-gray">or</span>
                <a class="text-bold text-white no-underline" href="/join?source=header-repo" data-ga-click="(Logged out) Header, clicked Sign up, text:sign-up">Sign up</a>
            </div>
        </span>
      </div>
    </div>
  </div>
</header>


  </div>

  <div id="start-of-content" class="show-on-focus"></div>

    <div id="js-flash-container">
</div>



  <div role="main">
        <div itemscope itemtype="http://schema.org/SoftwareSourceCode">
    <div id="js-repo-pjax-container" data-pjax-container>
      





    <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav ">
      <div class="repohead-details-container clearfix container ">

        <ul class="pagehead-actions">
  <li>
      <a href="/login?return_to=%2FBruceSherwood%2Fglowscript"
    class="btn btn-sm btn-with-count tooltipped tooltipped-n"
    aria-label="You must be signed in to watch a repository" rel="nofollow">
    <svg aria-hidden="true" class="octicon octicon-eye" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M8.06 2C3 2 0 8 0 8s3 6 8.06 6C13 14 16 8 16 8s-3-6-7.94-6zM8 12c-2.2 0-4-1.78-4-4 0-2.2 1.8-4 4-4 2.22 0 4 1.8 4 4 0 2.22-1.78 4-4 4zm2-4c0 1.11-.89 2-2 2-1.11 0-2-.89-2-2 0-1.11.89-2 2-2 1.11 0 2 .89 2 2z"/></svg>
    Watch
  </a>
  <a class="social-count" href="/BruceSherwood/glowscript/watchers"
     aria-label="12 users are watching this repository">
    12
  </a>

  </li>

  <li>
      <a href="/login?return_to=%2FBruceSherwood%2Fglowscript"
    class="btn btn-sm btn-with-count tooltipped tooltipped-n"
    aria-label="You must be signed in to star a repository" rel="nofollow">
    <svg aria-hidden="true" class="octicon octicon-star" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74z"/></svg>
    Star
  </a>

    <a class="social-count js-social-count" href="/BruceSherwood/glowscript/stargazers"
      aria-label="28 users starred this repository">
      28
    </a>

  </li>

  <li>
      <a href="/login?return_to=%2FBruceSherwood%2Fglowscript"
        class="btn btn-sm btn-with-count tooltipped tooltipped-n"
        aria-label="You must be signed in to fork a repository" rel="nofollow">
        <svg aria-hidden="true" class="octicon octicon-repo-forked" height="16" version="1.1" viewBox="0 0 10 16" width="10"><path fill-rule="evenodd" d="M8 1a1.993 1.993 0 0 0-1 3.72V6L5 8 3 6V4.72A1.993 1.993 0 0 0 2 1a1.993 1.993 0 0 0-1 3.72V6.5l3 3v1.78A1.993 1.993 0 0 0 5 15a1.993 1.993 0 0 0 1-3.72V9.5l3-3V4.72A1.993 1.993 0 0 0 8 1zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3 10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3-10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"/></svg>
        Fork
      </a>

    <a href="/BruceSherwood/glowscript/network" class="social-count"
       aria-label="14 users forked this repository">
      14
    </a>
  </li>
</ul>

        <h1 class="public ">
  <svg aria-hidden="true" class="octicon octicon-repo" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"/></svg>
  <span class="author" itemprop="author"><a href="/BruceSherwood" class="url fn" rel="author">BruceSherwood</a></span><!--
--><span class="path-divider">/</span><!--
--><strong itemprop="name"><a href="/BruceSherwood/glowscript" data-pjax="#js-repo-pjax-container">glowscript</a></strong>

</h1>

      </div>
      
<nav class="reponav js-repo-nav js-sidenav-container-pjax container"
     itemscope
     itemtype="http://schema.org/BreadcrumbList"
     role="navigation"
     data-pjax="#js-repo-pjax-container">

  <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a href="/BruceSherwood/glowscript" class="js-selected-navigation-item selected reponav-item" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches repo_packages /BruceSherwood/glowscript" itemprop="url">
      <svg aria-hidden="true" class="octicon octicon-code" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"/></svg>
      <span itemprop="name">Code</span>
      <meta itemprop="position" content="1">
</a>  </span>

    <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
      <a href="/BruceSherwood/glowscript/issues" class="js-selected-navigation-item reponav-item" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /BruceSherwood/glowscript/issues" itemprop="url">
        <svg aria-hidden="true" class="octicon octicon-issue-opened" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg>
        <span itemprop="name">Issues</span>
        <span class="Counter">17</span>
        <meta itemprop="position" content="2">
</a>    </span>

  <span itemscope itemtype="http://schema.org/ListItem" itemprop="itemListElement">
    <a href="/BruceSherwood/glowscript/pulls" class="js-selected-navigation-item reponav-item" data-hotkey="g p" data-selected-links="repo_pulls /BruceSherwood/glowscript/pulls" itemprop="url">
      <svg aria-hidden="true" class="octicon octicon-git-pull-request" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"/></svg>
      <span itemprop="name">Pull requests</span>
      <span class="Counter">0</span>
      <meta itemprop="position" content="3">
</a>  </span>

    <a href="/BruceSherwood/glowscript/projects" class="js-selected-navigation-item reponav-item" data-hotkey="g b" data-selected-links="repo_projects new_repo_project repo_project /BruceSherwood/glowscript/projects">
      <svg aria-hidden="true" class="octicon octicon-project" height="16" version="1.1" viewBox="0 0 15 16" width="15"><path fill-rule="evenodd" d="M10 12h3V2h-3v10zm-4-2h3V2H6v8zm-4 4h3V2H2v12zm-1 1h13V1H1v14zM14 0H1a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1z"/></svg>
      Projects
      <span class="Counter" >0</span>
</a>


  <a href="/BruceSherwood/glowscript/pulse" class="js-selected-navigation-item reponav-item" data-selected-links="repo_graphs repo_contributors dependency_graph pulse /BruceSherwood/glowscript/pulse">
    <svg aria-hidden="true" class="octicon octicon-graph" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M16 14v1H0V0h1v14h15zM5 13H3V8h2v5zm4 0H7V3h2v10zm4 0h-2V6h2v7z"/></svg>
    Insights
</a>

</nav>


    </div>

<div class="container new-discussion-timeline experiment-repo-nav">
  <div class="repository-content">

    
  <a href="/BruceSherwood/glowscript/blob/0bce813f5293d664eaecf51e9db0ad861681471b/package/glow.2.1.min.js" class="d-none js-permalink-shortcut" data-hotkey="y">Permalink</a>

  <!-- blob contrib key: blob_contributors:v21:dac451f5b1fd0524e5964e9b6a3849af -->

  <div class="file-navigation js-zeroclipboard-container">
    
<div class="select-menu branch-select-menu js-menu-container js-select-menu float-left">
  <button class=" btn btn-sm select-menu-button js-menu-target css-truncate" data-hotkey="w"
    
    type="button" aria-label="Switch branches or tags" aria-expanded="false" aria-haspopup="true">
      <i>Branch:</i>
      <span class="js-select-button css-truncate-target">master</span>
  </button>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax>

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <svg aria-label="Close" class="octicon octicon-x js-menu-close" height="16" role="img" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"/></svg>
        <span class="select-menu-title">Switch branches/tags</span>
      </div>

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="form-control js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" data-filter-placeholder="Filter branches/tags" class="js-select-menu-tab" role="tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" data-filter-placeholder="Find a tag…" class="js-select-menu-tab" role="tab">Tags</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches" role="menu">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open "
               href="/BruceSherwood/glowscript/blob/New-IDE/package/glow.2.1.min.js"
               data-name="New-IDE"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"/></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text">
                New-IDE
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open selected"
               href="/BruceSherwood/glowscript/blob/master/package/glow.2.1.min.js"
               data-name="master"
               data-skip-pjax="true"
               rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"/></svg>
              <span class="select-menu-item-text css-truncate-target js-select-menu-filter-text">
                master
              </span>
            </a>
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/BruceSherwood/glowscript/tree/ExpectedFinal2.1/package/glow.2.1.min.js"
              data-name="ExpectedFinal2.1"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"/></svg>
              <span class="select-menu-item-text css-truncate-target" title="ExpectedFinal2.1">
                ExpectedFinal2.1
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/BruceSherwood/glowscript/tree/2.3/package/glow.2.1.min.js"
              data-name="2.3"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"/></svg>
              <span class="select-menu-item-text css-truncate-target" title="2.3">
                2.3
              </span>
            </a>
            <a class="select-menu-item js-navigation-item js-navigation-open "
              href="/BruceSherwood/glowscript/tree/2.2/package/glow.2.1.min.js"
              data-name="2.2"
              data-skip-pjax="true"
              rel="nofollow">
              <svg aria-hidden="true" class="octicon octicon-check select-menu-item-icon" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M12 5l-8 8-4-4 1.5-1.5L4 10l6.5-6.5z"/></svg>
              <span class="select-menu-item-text css-truncate-target" title="2.2">
                2.2
              </span>
            </a>
        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div>

    </div>
  </div>
</div>

    <div class="BtnGroup float-right">
      <a href="/BruceSherwood/glowscript/find/master"
            class="js-pjax-capture-input btn btn-sm BtnGroup-item"
            data-pjax
            data-hotkey="t">
        Find file
      </a>
      <button aria-label="Copy file path to clipboard" class="js-zeroclipboard btn btn-sm BtnGroup-item tooltipped tooltipped-s" data-copied-hint="Copied!" type="button">Copy path</button>
    </div>
    <div class="breadcrumb js-zeroclipboard-target">
      <span class="repo-root js-repo-root"><span class="js-path-segment"><a href="/BruceSherwood/glowscript"><span>glowscript</span></a></span></span><span class="separator">/</span><span class="js-path-segment"><a href="/BruceSherwood/glowscript/tree/master/package"><span>package</span></a></span><span class="separator">/</span><strong class="final-path">glow.2.1.min.js</strong>
    </div>
  </div>


  
  <div class="commit-tease">
      <span class="float-right">
        <a class="commit-tease-sha" href="/BruceSherwood/glowscript/commit/f2930f85869447aa1bb3a04d695fa20985a95732" data-pjax>
          f2930f8
        </a>
        <relative-time datetime="2016-11-04T21:21:24Z">Nov 4, 2016</relative-time>
      </span>
      <div>
        <img alt="@BruceSherwood" class="avatar" height="20" src="https://avatars2.githubusercontent.com/u/1127471?s=40&amp;v=4" width="20" />
        <a href="/BruceSherwood" class="user-mention" rel="author">BruceSherwood</a>
          <a href="/BruceSherwood/glowscript/commit/f2930f85869447aa1bb3a04d695fa20985a95732" class="message" data-pjax="true" title="Fix major errors in 3D text object attributes">Fix major errors in 3D text object attributes</a>
      </div>

    <div class="commit-tease-contributors">
      <button type="button" class="btn-link muted-link contributors-toggle" data-facebox="#blob_contributors_box">
        <strong>1</strong>
         contributor
      </button>
      
    </div>

    <div id="blob_contributors_box" style="display:none">
      <h2 class="facebox-header" data-facebox-id="facebox-header">Users who have contributed to this file</h2>
      <ul class="facebox-user-list" data-facebox-id="facebox-description">
          <li class="facebox-user-list-item">
            <img alt="@BruceSherwood" height="24" src="https://avatars3.githubusercontent.com/u/1127471?s=48&amp;v=4" width="24" />
            <a href="/BruceSherwood">BruceSherwood</a>
          </li>
      </ul>
    </div>
  </div>


  <div class="file">
    <div class="file-header">
  <div class="file-actions">

    <div class="BtnGroup">
      <a href="/BruceSherwood/glowscript/raw/master/package/glow.2.1.min.js" class="btn btn-sm BtnGroup-item" id="raw-url">Raw</a>
        <a href="/BruceSherwood/glowscript/blame/master/package/glow.2.1.min.js" class="btn btn-sm js-update-url-with-hash BtnGroup-item" data-hotkey="b">Blame</a>
      <a href="/BruceSherwood/glowscript/commits/master/package/glow.2.1.min.js" class="btn btn-sm BtnGroup-item" rel="nofollow">History</a>
    </div>


        <button type="button" class="btn-octicon disabled tooltipped tooltipped-nw"
          aria-label="You must be signed in to make or propose changes">
          <svg aria-hidden="true" class="octicon octicon-pencil" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996 0 0 1 1.41 0l1.59 1.59c.39.39.39 1.02 0 1.41z"/></svg>
        </button>
        <button type="button" class="btn-octicon btn-octicon-danger disabled tooltipped tooltipped-nw"
          aria-label="You must be signed in to make or propose changes">
          <svg aria-hidden="true" class="octicon octicon-trashcan" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M11 2H9c0-.55-.45-1-1-1H5c-.55 0-1 .45-1 1H2c-.55 0-1 .45-1 1v1c0 .55.45 1 1 1v9c0 .55.45 1 1 1h7c.55 0 1-.45 1-1V5c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm-1 12H3V5h1v8h1V5h1v8h1V5h1v8h1V5h1v9zm1-10H2V3h9v1z"/></svg>
        </button>
  </div>

  <div class="file-info">
      20 lines (20 sloc)
      <span class="file-info-divider"></span>
    611 KB
  </div>
</div>

    

  <div itemprop="text" class="blob-wrapper data type-javascript">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tr>
        <td id="L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="LC1" class="blob-code blob-code-inner js-file-line">(function(){})();(function(factory){if(typeof define===&quot;function&quot;&amp;&amp;define.amd){define([&quot;jquery&quot;],factory)}else if(typeof exports===&quot;object&quot;){module.exports=factory}else{factory(jQuery)}})(function($){var toFix=[&quot;wheel&quot;,&quot;mousewheel&quot;,&quot;DOMMouseScroll&quot;,&quot;MozMousePixelScroll&quot;],toBind=&quot;onwheel&quot;in document||document.documentMode&gt;=9?[&quot;wheel&quot;]:[&quot;mousewheel&quot;,&quot;DomMouseScroll&quot;,&quot;MozMousePixelScroll&quot;],slice=Array.prototype.slice,nullLowestDeltaTimeout,lowestDelta;if($.event.fixHooks){for(var i=toFix.length;i;){$.event.fixHooks[toFix[--i]]=$.event.mouseHooks}}var special=$.event.special.mousewheel={version:&quot;3.1.11&quot;,setup:function(){if(this.addEventListener){for(var i=toBind.length;i;){this.addEventListener(toBind[--i],handler,false)}}else{this.onmousewheel=handler}$.data(this,&quot;mousewheel-line-height&quot;,special.getLineHeight(this));$.data(this,&quot;mousewheel-page-height&quot;,special.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var i=toBind.length;i;){this.removeEventListener(toBind[--i],handler,false)}}else{this.onmousewheel=null}$.removeData(this,&quot;mousewheel-line-height&quot;);$.removeData(this,&quot;mousewheel-page-height&quot;)},getLineHeight:function(elem){var $parent=$(elem)[&quot;offsetParent&quot;in $.fn?&quot;offsetParent&quot;:&quot;parent&quot;]();if(!$parent.length){$parent=$(&quot;body&quot;)}return parseInt($parent.css(&quot;fontSize&quot;),10)},getPageHeight:function(elem){return $(elem).height()},settings:{adjustOldDeltas:true,normalizeOffset:true}};$.fn.extend({mousewheel:function(fn){return fn?this.bind(&quot;mousewheel&quot;,fn):this.trigger(&quot;mousewheel&quot;)},unmousewheel:function(fn){return this.unbind(&quot;mousewheel&quot;,fn)}});function handler(event){var orgEvent=event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,offsetX=0,offsetY=0;event=$.event.fix(orgEvent);event.type=&quot;mousewheel&quot;;if(&quot;detail&quot;in orgEvent){deltaY=orgEvent.detail*-1}if(&quot;wheelDelta&quot;in orgEvent){deltaY=orgEvent.wheelDelta}if(&quot;wheelDeltaY&quot;in orgEvent){deltaY=orgEvent.wheelDeltaY}if(&quot;wheelDeltaX&quot;in orgEvent){deltaX=orgEvent.wheelDeltaX*-1}if(&quot;axis&quot;in orgEvent&amp;&amp;orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaX=deltaY*-1;deltaY=0}delta=deltaY===0?deltaX:deltaY;if(&quot;deltaY&quot;in orgEvent){deltaY=orgEvent.deltaY*-1;delta=deltaY}if(&quot;deltaX&quot;in orgEvent){deltaX=orgEvent.deltaX;if(deltaY===0){delta=deltaX*-1}}if(deltaY===0&amp;&amp;deltaX===0){return}if(orgEvent.deltaMode===1){var lineHeight=$.data(this,&quot;mousewheel-line-height&quot;);delta*=lineHeight;deltaY*=lineHeight;deltaX*=lineHeight}else if(orgEvent.deltaMode===2){var pageHeight=$.data(this,&quot;mousewheel-page-height&quot;);delta*=pageHeight;deltaY*=pageHeight;deltaX*=pageHeight}absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX));if(!lowestDelta||absDelta&lt;lowestDelta){lowestDelta=absDelta;if(shouldAdjustOldDeltas(orgEvent,absDelta)){lowestDelta/=40}}if(shouldAdjustOldDeltas(orgEvent,absDelta)){delta/=40;deltaX/=40;deltaY/=40}delta=Math[delta&gt;=1?&quot;floor&quot;:&quot;ceil&quot;](delta/lowestDelta);deltaX=Math[deltaX&gt;=1?&quot;floor&quot;:&quot;ceil&quot;](deltaX/lowestDelta);deltaY=Math[deltaY&gt;=1?&quot;floor&quot;:&quot;ceil&quot;](deltaY/lowestDelta);if(special.settings.normalizeOffset&amp;&amp;this.getBoundingClientRect){var boundingRect=this.getBoundingClientRect();offsetX=event.clientX-boundingRect.left;offsetY=event.clientY-boundingRect.top}event.deltaX=deltaX;event.deltaY=deltaY;event.deltaFactor=lowestDelta;event.offsetX=offsetX;event.offsetY=offsetY;event.deltaMode=0;args.unshift(event,delta,deltaX,deltaY);if(nullLowestDeltaTimeout){clearTimeout(nullLowestDeltaTimeout)}nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200);return($.event.dispatch||$.event.handle).apply(this,args)}function nullLowestDelta(){lowestDelta=null}function shouldAdjustOldDeltas(orgEvent,absDelta){return special.settings.adjustOldDeltas&amp;&amp;orgEvent.type===&quot;mousewheel&quot;&amp;&amp;absDelta%120===0}});(function(b){b.color={};b.color.make=function(d,e,g,f){var c={};c.r=d||0;c.g=e||0;c.b=g||0;c.a=f!=null?f:1;c.add=function(h,j){for(var k=0;k&lt;h.length;++k){c[h.charAt(k)]+=j}return c.normalize()};c.scale=function(h,j){for(var k=0;k&lt;h.length;++k){c[h.charAt(k)]*=j}return c.normalize()};c.toString=function(){if(c.a&gt;=1){return&quot;rgb(&quot;+[c.r,c.g,c.b].join(&quot;,&quot;)+&quot;)&quot;}else{return&quot;rgba(&quot;+[c.r,c.g,c.b,c.a].join(&quot;,&quot;)+&quot;)&quot;}};c.normalize=function(){function h(k,j,l){return j&lt;k?k:j&gt;l?l:j}c.r=h(0,parseInt(c.r),255);c.g=h(0,parseInt(c.g),255);c.b=h(0,parseInt(c.b),255);c.a=h(0,c.a,1);return c};c.clone=function(){return b.color.make(c.r,c.b,c.g,c.a)};return c.normalize()};b.color.extract=function(d,e){var c;do{c=d.css(e).toLowerCase();if(c!=&quot;&quot;&amp;&amp;c!=&quot;transparent&quot;){break}d=d.parent()}while(!b.nodeName(d.get(0),&quot;body&quot;));if(c==&quot;rgba(0, 0, 0, 0)&quot;){c=&quot;transparent&quot;}return b.color.parse(c)};b.color.parse=function(c){var d,f=b.color.make;if(d=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(c)){return f(parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10))}if(d=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(c)){return f(parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10),parseFloat(d[4]))}if(d=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(c)){return f(parseFloat(d[1])*2.55,parseFloat(d[2])*2.55,parseFloat(d[3])*2.55)}if(d=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(c)){return f(parseFloat(d[1])*2.55,parseFloat(d[2])*2.55,parseFloat(d[3])*2.55,parseFloat(d[4]))}if(d=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(c)){return f(parseInt(d[1],16),parseInt(d[2],16),parseInt(d[3],16))}if(d=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(c)){return f(parseInt(d[1]+d[1],16),parseInt(d[2]+d[2],16),parseInt(d[3]+d[3],16))}var e=b.trim(c).toLowerCase();if(e==&quot;transparent&quot;){return f(255,255,255,0)}else{d=a[e]||[0,0,0];return f(d[0],d[1],d[2])}};var a={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}})(jQuery);(function(c){function b(av,ai,J,af){var Q=[],O={colors:[&quot;#edc240&quot;,&quot;#afd8f8&quot;,&quot;#cb4b4b&quot;,&quot;#4da74d&quot;,&quot;#9440ed&quot;],legend:{show:true,noColumns:1,labelFormatter:null,labelBoxBorderColor:&quot;#ccc&quot;,container:null,position:&quot;ne&quot;,margin:5,backgroundColor:null,backgroundOpacity:.85},xaxis:{show:null,position:&quot;bottom&quot;,mode:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null,monthNames:null,timeformat:null,twelveHourClock:false},yaxis:{autoscaleMargin:.02,position:&quot;left&quot;},xaxes:[],yaxes:[],series:{points:{show:false,radius:3,lineWidth:2,fill:true,fillColor:&quot;#ffffff&quot;,symbol:&quot;circle&quot;},lines:{lineWidth:2,fill:false,fillColor:null,steps:false},bars:{show:false,lineWidth:2,barWidth:1,fill:true,fillColor:null,align:&quot;left&quot;,horizontal:false},shadowSize:3},grid:{show:true,aboveData:false,color:&quot;#545454&quot;,backgroundColor:null,borderColor:null,tickColor:null,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:&quot;#f4f4f4&quot;,markingsLineWidth:2,clickable:false,hoverable:false,autoHighlight:true,mouseActiveRadius:10},hooks:{}},az=null,ad=null,y=null,H=null,A=null,p=[],aw=[],q={left:0,right:0,top:0,bottom:0},G=0,I=0,h=0,w=0,ak={processOptions:[],processRawData:[],processDatapoints:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},aq=this;aq.setData=aj;aq.setupGrid=t;aq.draw=W;aq.getPlaceholder=function(){return av};aq.getCanvas=function(){return az};aq.getPlotOffset=function(){return q};aq.width=function(){return h};aq.height=function(){return w};aq.offset=function(){var aB=y.offset();aB.left+=q.left;aB.top+=q.top;return aB};aq.getData=function(){return Q};aq.getAxes=function(){var aC={},aB;c.each(p.concat(aw),function(aD,aE){if(aE){aC[aE.direction+(aE.n!=1?aE.n:&quot;&quot;)+&quot;axis&quot;]=aE}});return aC};aq.getXAxes=function(){return p};aq.getYAxes=function(){return aw};aq.c2p=C;aq.p2c=ar;aq.getOptions=function(){return O};aq.highlight=x;aq.unhighlight=T;aq.triggerRedrawOverlay=f;aq.pointOffset=function(aB){return{left:parseInt(p[aA(aB,&quot;x&quot;)-1].p2c(+aB.x)+q.left),top:parseInt(aw[aA(aB,&quot;y&quot;)-1].p2c(+aB.y)+q.top)}};aq.shutdown=ag;aq.resize=function(){B();g(az);g(ad)};aq.hooks=ak;F(aq);Z(J);X();aj(ai);t();W();ah();function an(aD,aB){aB=[aq].concat(aB);for(var aC=0;aC&lt;aD.length;++aC){aD[aC].apply(this,aB)}}function F(){for(var aB=0;aB&lt;af.length;++aB){var aC=af[aB];aC.init(aq);if(aC.options){c.extend(true,O,aC.options)}}}function Z(aC){var aB;c.extend(true,O,aC);if(O.xaxis.color==null){O.xaxis.color=O.grid.color}if(O.yaxis.color==null){O.yaxis.color=O.grid.color}if(O.xaxis.tickColor==null){O.xaxis.tickColor=O.grid.tickColor}if(O.yaxis.tickColor==null){O.yaxis.tickColor=O.grid.tickColor}if(O.grid.borderColor==null){O.grid.borderColor=O.grid.color}if(O.grid.tickColor==null){O.grid.tickColor=c.color.parse(O.grid.color).scale(&quot;a&quot;,.22).toString()}for(aB=0;aB&lt;Math.max(1,O.xaxes.length);++aB){O.xaxes[aB]=c.extend(true,{},O.xaxis,O.xaxes[aB])}for(aB=0;aB&lt;Math.max(1,O.yaxes.length);++aB){O.yaxes[aB]=c.extend(true,{},O.yaxis,O.yaxes[aB])}if(O.xaxis.noTicks&amp;&amp;O.xaxis.ticks==null){O.xaxis.ticks=O.xaxis.noTicks}if(O.yaxis.noTicks&amp;&amp;O.yaxis.ticks==null){O.yaxis.ticks=O.yaxis.noTicks}if(O.x2axis){O.xaxes[1]=c.extend(true,{},O.xaxis,O.x2axis);O.xaxes[1].position=&quot;top&quot;}if(O.y2axis){O.yaxes[1]=c.extend(true,{},O.yaxis,O.y2axis);O.yaxes[1].position=&quot;right&quot;}if(O.grid.coloredAreas){O.grid.markings=O.grid.coloredAreas}if(O.grid.coloredAreasColor){O.grid.markingsColor=O.grid.coloredAreasColor}if(O.lines){c.extend(true,O.series.lines,O.lines)}if(O.points){c.extend(true,O.series.points,O.points)}if(O.bars){c.extend(true,O.series.bars,O.bars)}if(O.shadowSize!=null){O.series.shadowSize=O.shadowSize}for(aB=0;aB&lt;O.xaxes.length;++aB){V(p,aB+1).options=O.xaxes[aB]}for(aB=0;aB&lt;O.yaxes.length;++aB){V(aw,aB+1).options=O.yaxes[aB]}for(var aD in ak){if(O.hooks[aD]&amp;&amp;O.hooks[aD].length){ak[aD]=ak[aD].concat(O.hooks[aD])}}an(ak.processOptions,[O])}function aj(aB){Q=Y(aB);ax();z()}function Y(aE){var aC=[];for(var aB=0;aB&lt;aE.length;++aB){var aD=c.extend(true,{},O.series);if(aE[aB].data!=null){aD.data=aE[aB].data;delete aE[aB].data;c.extend(true,aD,aE[aB]);aE[aB].data=aD.data}else{aD.data=aE[aB]}aC.push(aD)}return aC}function aA(aC,aD){var aB=aC[aD+&quot;axis&quot;];if(typeof aB==&quot;object&quot;){aB=aB.n}if(typeof aB!=&quot;number&quot;){aB=1}return aB}function m(){return c.grep(p.concat(aw),function(aB){return aB})}function C(aE){var aC={},aB,aD;for(aB=0;aB&lt;p.length;++aB){aD=p[aB];if(aD&amp;&amp;aD.used){aC[&quot;x&quot;+aD.n]=aD.c2p(aE.left)}}for(aB=0;aB&lt;aw.length;++aB){aD=aw[aB];if(aD&amp;&amp;aD.used){aC[&quot;y&quot;+aD.n]=aD.c2p(aE.top)}}if(aC.x1!==undefined){aC.x=aC.x1}if(aC.y1!==undefined){aC.y=aC.y1}return aC}function ar(aF){var aD={},aC,aE,aB;for(aC=0;aC&lt;p.length;++aC){aE=p[aC];if(aE&amp;&amp;aE.used){aB=&quot;x&quot;+aE.n;if(aF[aB]==null&amp;&amp;aE.n==1){aB=&quot;x&quot;}if(aF[aB]!=null){aD.left=aE.p2c(aF[aB]);break}}}for(aC=0;aC&lt;aw.length;++aC){aE=aw[aC];if(aE&amp;&amp;aE.used){aB=&quot;y&quot;+aE.n;if(aF[aB]==null&amp;&amp;aE.n==1){aB=&quot;y&quot;}if(aF[aB]!=null){aD.top=aE.p2c(aF[aB]);break}}}return aD}function V(aC,aB){if(!aC[aB-1]){aC[aB-1]={n:aB,direction:aC==p?&quot;x&quot;:&quot;y&quot;,options:c.extend(true,{},aC==p?O.xaxis:O.yaxis)}}return aC[aB-1]}function ax(){var aG;var aM=Q.length,aB=[],aE=[];for(aG=0;aG&lt;Q.length;++aG){var aJ=Q[aG].color;if(aJ!=null){--aM;if(typeof aJ==&quot;number&quot;){aE.push(aJ)}else{aB.push(c.color.parse(Q[aG].color))}}}for(aG=0;aG&lt;aE.length;++aG){aM=Math.max(aM,aE[aG]+1)}var aC=[],aF=0;aG=0;while(aC.length&lt;aM){var aI;if(O.colors.length==aG){aI=c.color.make(100,100,100)}else{aI=c.color.parse(O.colors[aG])}var aD=aF%2==1?-1:1;aI.scale(&quot;rgb&quot;,1+aD*Math.ceil(aF/2)*.2);aC.push(aI);++aG;if(aG&gt;=O.colors.length){aG=0;++aF}}var aH=0,aN;for(aG=0;aG&lt;Q.length;++aG){aN=Q[aG];if(aN.color==null){aN.color=aC[aH].toString();++aH}else{if(typeof aN.color==&quot;number&quot;){aN.color=aC[aN.color].toString()}}if(aN.lines.show==null){var aL,aK=true;for(aL in aN){if(aN[aL]&amp;&amp;aN[aL].show){aK=false;break}}if(aK){aN.lines.show=true}}aN.xaxis=V(p,aA(aN,&quot;x&quot;));aN.yaxis=V(aw,aA(aN,&quot;y&quot;))}}function z(){var aO=Number.POSITIVE_INFINITY,aI=Number.NEGATIVE_INFINITY,aB=Number.MAX_VALUE,aU,aS,aR,aN,aD,aJ,aT,aP,aH,aG,aC,a0,aX,aL;function aF(a3,a2,a1){if(a2&lt;a3.datamin&amp;&amp;a2!=-aB){a3.datamin=a2}if(a1&gt;a3.datamax&amp;&amp;a1!=aB){a3.datamax=a1}}c.each(m(),function(a1,a2){a2.datamin=aO;a2.datamax=aI;a2.used=false});for(aU=0;aU&lt;Q.length;++aU){aJ=Q[aU];aJ.datapoints={points:[]};an(ak.processRawData,[aJ,aJ.data,aJ.datapoints])}for(aU=0;aU&lt;Q.length;++aU){aJ=Q[aU];var aZ=aJ.data,aW=aJ.datapoints.format;if(!aW){aW=[];aW.push({x:true,number:true,required:true});aW.push({y:true,number:true,required:true});if(aJ.bars.show||aJ.lines.show&amp;&amp;aJ.lines.fill){aW.push({y:true,number:true,required:false,defaultValue:0});if(aJ.bars.horizontal){delete aW[aW.length-1].y;aW[aW.length-1].x=true}}aJ.datapoints.format=aW}if(aJ.datapoints.pointsize!=null){continue}aJ.datapoints.pointsize=aW.length;aP=aJ.datapoints.pointsize;aT=aJ.datapoints.points;insertSteps=aJ.lines.show&amp;&amp;aJ.lines.steps;aJ.xaxis.used=aJ.yaxis.used=true;for(aS=aR=0;aS&lt;aZ.length;++aS,aR+=aP){aL=aZ[aS];var aE=aL==null;if(!aE){for(aN=0;aN&lt;aP;++aN){a0=aL[aN];aX=aW[aN];if(aX){if(aX.number&amp;&amp;a0!=null){a0=+a0;if(isNaN(a0)){a0=null}else{if(a0==Infinity){a0=aB}else{if(a0==-Infinity){a0=-aB}}}}if(a0==null){if(aX.required){aE=true}if(aX.defaultValue!=null){a0=aX.defaultValue}}}aT[aR+aN]=a0}}if(aE){for(aN=0;aN&lt;aP;++aN){a0=aT[aR+aN];if(a0!=null){aX=aW[aN];if(aX.x){aF(aJ.xaxis,a0,a0)}if(aX.y){aF(aJ.yaxis,a0,a0)}}aT[aR+aN]=null}}else{if(insertSteps&amp;&amp;aR&gt;0&amp;&amp;aT[aR-aP]!=null&amp;&amp;aT[aR-aP]!=aT[aR]&amp;&amp;aT[aR-aP+1]!=aT[aR+1]){for(aN=0;aN&lt;aP;++aN){aT[aR+aP+aN]=aT[aR+aN]}aT[aR+1]=aT[aR-aP+1];aR+=aP}}}}for(aU=0;aU&lt;Q.length;++aU){aJ=Q[aU];an(ak.processDatapoints,[aJ,aJ.datapoints])}for(aU=0;aU&lt;Q.length;++aU){aJ=Q[aU];aT=aJ.datapoints.points,aP=aJ.datapoints.pointsize;var aK=aO,aQ=aO,aM=aI,aV=aI;for(aS=0;aS&lt;aT.length;aS+=aP){if(aT[aS]==null){continue}for(aN=0;aN&lt;aP;++aN){a0=aT[aS+aN];aX=aW[aN];if(!aX||a0==aB||a0==-aB){continue}if(aX.x){if(a0&lt;aK){aK=a0}if(a0&gt;aM){aM=a0}}if(aX.y){if(a0&lt;aQ){aQ=a0}if(a0&gt;aV){aV=a0}}}}if(aJ.bars.show){var aY=aJ.bars.align==&quot;left&quot;?0:-aJ.bars.barWidth/2;if(aJ.bars.horizontal){aQ+=aY;aV+=aY+aJ.bars.barWidth}else{aK+=aY;aM+=aY+aJ.bars.barWidth}}aF(aJ.xaxis,aK,aM);aF(aJ.yaxis,aQ,aV)}c.each(m(),function(a1,a2){if(a2.datamin==aO){a2.datamin=null}if(a2.datamax==aI){a2.datamax=null}})}function j(aB,aC){var aD=document.createElement(&quot;canvas&quot;);aD.className=aC;aD.width=G;aD.height=I;if(!aB){c(aD).css({position:&quot;absolute&quot;,left:0,top:0})}c(aD).appendTo(av);if(!aD.getContext){aD=window.G_vmlCanvasManager.initElement(aD)}aD.getContext(&quot;2d&quot;).save();return aD}function B(){G=av.width();I=av.height();if(G&lt;=0||I&lt;=0){throw&quot;Invalid dimensions for plot, width = &quot;+G+&quot;, height = &quot;+I}}function g(aC){if(aC.width!=G){aC.width=G}if(aC.height!=I){aC.height=I}var aB=aC.getContext(&quot;2d&quot;);aB.restore();aB.save()}function X(){var aC,aB=av.children(&quot;canvas.base&quot;),aD=av.children(&quot;canvas.overlay&quot;);if(aB.length==0||aD==0){av.html(&quot;&quot;);av.css({padding:0});if(av.css(&quot;position&quot;)==&quot;static&quot;){av.css(&quot;position&quot;,&quot;relative&quot;)}B();az=j(true,&quot;base&quot;);ad=j(false,&quot;overlay&quot;);aC=false}else{az=aB.get(0);ad=aD.get(0);aC=true}H=az.getContext(&quot;2d&quot;);A=ad.getContext(&quot;2d&quot;);y=c([ad,az]);if(aC){av.data(&quot;plot&quot;).shutdown();aq.resize();A.clearRect(0,0,G,I);y.unbind();av.children().not([az,ad]).remove()}av.data(&quot;plot&quot;,aq)}function ah(){if(O.grid.hoverable){y.mousemove(aa);y.mouseleave(l)}if(O.grid.clickable){y.click(R)}an(ak.bindEvents,[y])}function ag(){if(M){clearTimeout(M)}y.unbind(&quot;mousemove&quot;,aa);y.unbind(&quot;mouseleave&quot;,l);y.unbind(&quot;click&quot;,R);an(ak.shutdown,[y])}function r(aG){function aC(aH){return aH}var aF,aB,aD=aG.options.transform||aC,aE=aG.options.inverseTransform;if(aG.direction==&quot;x&quot;){aF=aG.scale=h/Math.abs(aD(aG.max)-aD(aG.min));aB=Math.min(aD(aG.max),aD(aG.min))}else{aF=aG.scale=w/Math.abs(aD(aG.max)-aD(aG.min));aF=-aF;aB=Math.max(aD(aG.max),aD(aG.min))}if(aD==aC){aG.p2c=function(aH){return(aH-aB)*aF}}else{aG.p2c=function(aH){return(aD(aH)-aB)*aF}}if(!aE){aG.c2p=function(aH){return aB+aH/aF}}else{aG.c2p=function(aH){return aE(aB+aH/aF)}}}function L(aD){var aB=aD.options,aF,aJ=aD.ticks||[],aI=[],aE,aK=aB.labelWidth,aG=aB.labelHeight,aC;function aH(aM,aL){return c(&#39;&lt;div style=&quot;position:absolute;top:-10000px;&#39;+aL+&#39;font-size:smaller&quot;&gt;&lt;div class=&quot;&#39;+aD.direction+&quot;Axis &quot;+aD.direction+aD.n+&#39;Axis&quot;&gt;&#39;+aM.join(&quot;&quot;)+&quot;&lt;/div&gt;&lt;/div&gt;&quot;).appendTo(av)}if(aD.direction==&quot;x&quot;){if(aK==null){aK=Math.floor(G/(aJ.length&gt;0?aJ.length:1))}if(aG==null){aI=[];for(aF=0;aF&lt;aJ.length;++aF){aE=aJ[aF].label;if(aE){aI.push(&#39;&lt;div class=&quot;tickLabel&quot; style=&quot;float:left;width:&#39;+aK+&#39;px&quot;&gt;&#39;+aE+&quot;&lt;/div&gt;&quot;)}}if(aI.length&gt;0){aI.push(&#39;&lt;div style=&quot;clear:left&quot;&gt;&lt;/div&gt;&#39;);aC=aH(aI,&quot;width:10000px;&quot;);aG=aC.height();aC.remove()}}}else{if(aK==null||aG==null){for(aF=0;aF&lt;aJ.length;++aF){aE=aJ[aF].label;if(aE){aI.push(&#39;&lt;div class=&quot;tickLabel&quot;&gt;&#39;+aE+&quot;&lt;/div&gt;&quot;)}}if(aI.length&gt;0){aC=aH(aI,&quot;&quot;);if(aK==null){aK=aC.children().width()}if(aG==null){aG=aC.find(&quot;div.tickLabel&quot;).height()}aC.remove()}}}if(aK==null){aK=0}if(aG==null){aG=0}aD.labelWidth=aK;aD.labelHeight=aG}function au(aD){var aC=aD.labelWidth,aL=aD.labelHeight,aH=aD.options.position,aF=aD.options.tickLength,aG=O.grid.axisMargin,aJ=O.grid.labelMargin,aK=aD.direction==&quot;x&quot;?p:aw,aE;var aB=c.grep(aK,function(aN){return aN&amp;&amp;aN.options.position==aH&amp;&amp;aN.reserveSpace});if(c.inArray(aD,aB)==aB.length-1){aG=0}if(aF==null){aF=&quot;full&quot;}var aI=c.grep(aK,function(aN){return aN&amp;&amp;aN.reserveSpace});var aM=c.inArray(aD,aI)==0;if(!aM&amp;&amp;aF==&quot;full&quot;){aF=5}if(!isNaN(+aF)){aJ+=+aF}if(aD.direction==&quot;x&quot;){aL+=aJ;if(aH==&quot;bottom&quot;){q.bottom+=aL+aG;aD.box={top:I-q.bottom,height:aL}}else{aD.box={top:q.top+aG,height:aL};q.top+=aL+aG}}else{aC+=aJ;if(aH==&quot;left&quot;){aD.box={left:q.left+aG,width:aC};q.left+=aC+aG}else{q.right+=aC+aG;aD.box={left:G-q.right,width:aC}}}aD.position=aH;aD.tickLength=aF;aD.box.padding=aJ;aD.innermost=aM}function U(aB){if(aB.direction==&quot;x&quot;){aB.box.left=q.left;aB.box.width=h}else{aB.box.top=q.top;aB.box.height=w}}function t(){var aC,aE=m();c.each(aE,function(aF,aG){aG.show=aG.options.show;if(aG.show==null){aG.show=aG.used}aG.reserveSpace=aG.show||aG.options.reserveSpace;n(aG)});allocatedAxes=c.grep(aE,function(aF){return aF.reserveSpace});q.left=q.right=q.top=q.bottom=0;if(O.grid.show){c.each(allocatedAxes,function(aF,aG){S(aG);P(aG);ap(aG,aG.ticks);L(aG)});for(aC=allocatedAxes.length-1;aC&gt;=0;--aC){au(allocatedAxes[aC])}var aD=O.grid.minBorderMargin;if(aD==null){aD=0;for(aC=0;aC&lt;Q.length;++aC){aD=Math.max(aD,Q[aC].points.radius+Q[aC].points.lineWidth/2)}}for(var aB in q){q[aB]+=O.grid.borderWidth;q[aB]=Math.max(aD,q[aB])}}h=G-q.left-q.right;w=I-q.bottom-q.top;c.each(aE,function(aF,aG){r(aG)});if(O.grid.show){c.each(allocatedAxes,function(aF,aG){U(aG)});k()}o()}function n(aE){var aF=aE.options,aD=+(aF.min!=null?aF.min:aE.datamin),aB=+(aF.max!=null?aF.max:aE.datamax),aH=aB-aD;if(aH==0){var aC=aB==0?1:.01;if(aF.min==null){aD-=aC}if(aF.max==null||aF.min!=null){aB+=aC}}else{var aG=aF.autoscaleMargin;if(aG!=null){if(aF.min==null){aD-=aH*aG;if(aD&lt;0&amp;&amp;aE.datamin!=null&amp;&amp;aE.datamin&gt;=0){aD=0}}if(aF.max==null){aB+=aH*aG;if(aB&gt;0&amp;&amp;aE.datamax!=null&amp;&amp;aE.datamax&lt;=0){aB=0}}}}aE.min=aD;aE.max=aB}function S(aG){var aM=aG.options;var aH;if(typeof aM.ticks==&quot;number&quot;&amp;&amp;aM.ticks&gt;0){aH=aM.ticks}else{aH=.3*Math.sqrt(aG.direction==&quot;x&quot;?G:I)}var aT=(aG.max-aG.min)/aH,aO,aB,aN,aR,aS,aQ,aI;if(aM.mode==&quot;time&quot;){var aJ={second:1e3,minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3,month:30*24*60*60*1e3,year:365.2425*24*60*60*1e3};var aK=[[1,&quot;second&quot;],[2,&quot;second&quot;],[5,&quot;second&quot;],[10,&quot;second&quot;],[30,&quot;second&quot;],[1,&quot;minute&quot;],[2,&quot;minute&quot;],[5,&quot;minute&quot;],[10,&quot;minute&quot;],[30,&quot;minute&quot;],[1,&quot;hour&quot;],[2,&quot;hour&quot;],[4,&quot;hour&quot;],[8,&quot;hour&quot;],[12,&quot;hour&quot;],[1,&quot;day&quot;],[2,&quot;day&quot;],[3,&quot;day&quot;],[.25,&quot;month&quot;],[.5,&quot;month&quot;],[1,&quot;month&quot;],[2,&quot;month&quot;],[3,&quot;month&quot;],[6,&quot;month&quot;],[1,&quot;year&quot;]];var aC=0;if(aM.minTickSize!=null){if(typeof aM.tickSize==&quot;number&quot;){aC=aM.tickSize}else{aC=aM.minTickSize[0]*aJ[aM.minTickSize[1]]}}for(var aS=0;aS&lt;aK.length-1;++aS){if(aT&lt;(aK[aS][0]*aJ[aK[aS][1]]+aK[aS+1][0]*aJ[aK[aS+1][1]])/2&amp;&amp;aK[aS][0]*aJ[aK[aS][1]]&gt;=aC){break}}aO=aK[aS][0];aN=aK[aS][1];if(aN==&quot;year&quot;){aQ=Math.pow(10,Math.floor(Math.log(aT/aJ.year)/Math.LN10));aI=aT/aJ.year/aQ;if(aI&lt;1.5){aO=1}else{if(aI&lt;3){aO=2}else{if(aI&lt;7.5){aO=5}else{aO=10}}}aO*=aQ}aG.tickSize=aM.tickSize||[aO,aN];aB=function(aX){var a2=[],a0=aX.tickSize[0],a3=aX.tickSize[1],a1=new Date(aX.min);var aW=a0*aJ[a3];if(a3==&quot;second&quot;){a1.setUTCSeconds(a(a1.getUTCSeconds(),a0))}if(a3==&quot;minute&quot;){a1.setUTCMinutes(a(a1.getUTCMinutes(),a0))}if(a3==&quot;hour&quot;){a1.setUTCHours(a(a1.getUTCHours(),a0))}if(a3==&quot;month&quot;){a1.setUTCMonth(a(a1.getUTCMonth(),a0))}if(a3==&quot;year&quot;){a1.setUTCFullYear(a(a1.getUTCFullYear(),a0))}a1.setUTCMilliseconds(0);if(aW&gt;=aJ.minute){a1.setUTCSeconds(0)}if(aW&gt;=aJ.hour){a1.setUTCMinutes(0)}if(aW&gt;=aJ.day){a1.setUTCHours(0)}if(aW&gt;=aJ.day*4){a1.setUTCDate(1)}if(aW&gt;=aJ.year){a1.setUTCMonth(0)}var a5=0,a4=Number.NaN,aY;do{aY=a4;a4=a1.getTime();a2.push(a4);if(a3==&quot;month&quot;){if(a0&lt;1){a1.setUTCDate(1);var aV=a1.getTime();a1.setUTCMonth(a1.getUTCMonth()+1);var aZ=a1.getTime();a1.setTime(a4+a5*aJ.hour+(aZ-aV)*a0);a5=a1.getUTCHours();a1.setUTCHours(0)}else{a1.setUTCMonth(a1.getUTCMonth()+a0)}}else{if(a3==&quot;year&quot;){a1.setUTCFullYear(a1.getUTCFullYear()+a0)}else{a1.setTime(a4+aW)}}}while(a4&lt;aX.max&amp;&amp;a4!=aY);return a2};aR=function(aV,aY){var a0=new Date(aV);if(aM.timeformat!=null){return c.plot.formatDate(a0,aM.timeformat,aM.monthNames)}var aW=aY.tickSize[0]*aJ[aY.tickSize[1]];var aX=aY.max-aY.min;var aZ=aM.twelveHourClock?&quot; %p&quot;:&quot;&quot;;if(aW&lt;aJ.minute){fmt=&quot;%h:%M:%S&quot;+aZ}else{if(aW&lt;aJ.day){if(aX&lt;2*aJ.day){fmt=&quot;%h:%M&quot;+aZ}else{fmt=&quot;%b %d %h:%M&quot;+aZ}}else{if(aW&lt;aJ.month){fmt=&quot;%b %d&quot;}else{if(aW&lt;aJ.year){if(aX&lt;aJ.year){fmt=&quot;%b&quot;}else{fmt=&quot;%b %y&quot;}}else{fmt=&quot;%y&quot;}}}}return c.plot.formatDate(a0,fmt,aM.monthNames)}}else{var aU=aM.tickDecimals;var aP=-Math.floor(Math.log(aT)/Math.LN10);if(aU!=null&amp;&amp;aP&gt;aU){aP=aU}aQ=Math.pow(10,-aP);aI=aT/aQ;if(aI&lt;1.5){aO=1}else{if(aI&lt;3){aO=2;if(aI&gt;2.25&amp;&amp;(aU==null||aP+1&lt;=aU)){aO=2.5;++aP}}else{if(aI&lt;7.5){aO=5}else{aO=10}}}aO*=aQ;if(aM.minTickSize!=null&amp;&amp;aO&lt;aM.minTickSize){aO=aM.minTickSize}aG.tickDecimals=Math.max(0,aU!=null?aU:aP);aG.tickSize=aM.tickSize||aO;aB=function(aX){var aZ=[];var a0=a(aX.min,aX.tickSize),aW=0,aV=Number.NaN,aY;do{aY=aV;aV=a0+aW*aX.tickSize;aZ.push(aV);++aW}while(aV&lt;aX.max&amp;&amp;aV!=aY);return aZ};aR=function(aV,aW){return aV.toFixed(aW.tickDecimals)}}if(aM.alignTicksWithAxis!=null){var aF=(aG.direction==&quot;x&quot;?p:aw)[aM.alignTicksWithAxis-1];if(aF&amp;&amp;aF.used&amp;&amp;aF!=aG){var aL=aB(aG);if(aL.length&gt;0){if(aM.min==null){aG.min=Math.min(aG.min,aL[0])}if(aM.max==null&amp;&amp;aL.length&gt;1){aG.max=Math.max(aG.max,aL[aL.length-1])}}aB=function(aX){var aY=[],aV,aW;for(aW=0;aW&lt;aF.ticks.length;++aW){aV=(aF.ticks[aW].v-aF.min)/(aF.max-aF.min);aV=aX.min+aV*(aX.max-aX.min);aY.push(aV)}return aY};if(aG.mode!=&quot;time&quot;&amp;&amp;aM.tickDecimals==null){var aE=Math.max(0,-Math.floor(Math.log(aT)/Math.LN10)+1),aD=aB(aG);if(!(aD.length&gt;1&amp;&amp;/\..*0$/.test((aD[1]-aD[0]).toFixed(aE)))){aG.tickDecimals=aE}}}}aG.tickGenerator=aB;if(c.isFunction(aM.tickFormatter)){aG.tickFormatter=function(aV,aW){return&quot;&quot;+aM.tickFormatter(aV,aW)}}else{aG.tickFormatter=aR}}function P(aF){var aH=aF.options.ticks,aG=[];if(aH==null||typeof aH==&quot;number&quot;&amp;&amp;aH&gt;0){aG=aF.tickGenerator(aF)}else{if(aH){if(c.isFunction(aH)){aG=aH({min:aF.min,max:aF.max})}else{aG=aH}}}var aE,aB;aF.ticks=[];for(aE=0;aE&lt;aG.length;++aE){var aC=null;var aD=aG[aE];if(typeof aD==&quot;object&quot;){aB=+aD[0];if(aD.length&gt;1){aC=aD[1]}}else{aB=+aD}if(aC==null){aC=aF.tickFormatter(aB,aF)}if(!isNaN(aB)){aF.ticks.push({v:aB,label:aC})}}}function ap(aB,aC){if(aB.options.autoscaleMargin&amp;&amp;aC.length&gt;0){if(aB.options.min==null){aB.min=Math.min(aB.min,aC[0].v)}if(aB.options.max==null&amp;&amp;aC.length&gt;1){aB.max=Math.max(aB.max,aC[aC.length-1].v)}}}function W(){H.clearRect(0,0,G,I);var aC=O.grid;if(aC.show&amp;&amp;aC.backgroundColor){N()}if(aC.show&amp;&amp;!aC.aboveData){ac()}for(var aB=0;aB&lt;Q.length;++aB){an(ak.drawSeries,[H,Q[aB]]);d(Q[aB])}an(ak.draw,[H]);if(aC.show&amp;&amp;aC.aboveData){ac()}}function D(aB,aI){var aE,aH,aG,aD,aF=m();for(i=0;i&lt;aF.length;++i){aE=aF[i];if(aE.direction==aI){aD=aI+aE.n+&quot;axis&quot;;if(!aB[aD]&amp;&amp;aE.n==1){aD=aI+&quot;axis&quot;}if(aB[aD]){aH=aB[aD].from;aG=aB[aD].to;break}}}if(!aB[aD]){aE=aI==&quot;x&quot;?p[0]:aw[0];aH=aB[aI+&quot;1&quot;];aG=aB[aI+&quot;2&quot;]}if(aH!=null&amp;&amp;aG!=null&amp;&amp;aH&gt;aG){var aC=aH;aH=aG;aG=aC}return{from:aH,to:aG,axis:aE}}function N(){H.save();H.translate(q.left,q.top);H.fillStyle=am(O.grid.backgroundColor,w,0,&quot;rgba(255, 255, 255, 0)&quot;);H.fillRect(0,0,h,w);H.restore()}function ac(){var aF;H.save();H.translate(q.left,q.top);var aH=O.grid.markings;if(aH){if(c.isFunction(aH)){var aK=aq.getAxes();aK.xmin=aK.xaxis.min;aK.xmax=aK.xaxis.max;aK.ymin=aK.yaxis.min;aK.ymax=aK.yaxis.max;aH=aH(aK)}for(aF=0;aF&lt;aH.length;++aF){var aD=aH[aF],aC=D(aD,&quot;x&quot;),aI=D(aD,&quot;y&quot;);if(aC.from==null){aC.from=aC.axis.min}if(aC.to==null){aC.to=aC.axis.max}if(aI.from==null){aI.from=aI.axis.min}if(aI.to==null){aI.to=aI.axis.max}if(aC.to&lt;aC.axis.min||aC.from&gt;aC.axis.max||aI.to&lt;aI.axis.min||aI.from&gt;aI.axis.max){continue}aC.from=Math.max(aC.from,aC.axis.min);aC.to=Math.min(aC.to,aC.axis.max);aI.from=Math.max(aI.from,aI.axis.min);aI.to=Math.min(aI.to,aI.axis.max);if(aC.from==aC.to&amp;&amp;aI.from==aI.to){continue}aC.from=aC.axis.p2c(aC.from);aC.to=aC.axis.p2c(aC.to);aI.from=aI.axis.p2c(aI.from);aI.to=aI.axis.p2c(aI.to);if(aC.from==aC.to||aI.from==aI.to){H.beginPath();H.strokeStyle=aD.color||O.grid.markingsColor;H.lineWidth=aD.lineWidth||O.grid.markingsLineWidth;H.moveTo(aC.from,aI.from);H.lineTo(aC.to,aI.to);H.stroke()}else{H.fillStyle=aD.color||O.grid.markingsColor;H.fillRect(aC.from,aI.to,aC.to-aC.from,aI.from-aI.to)}}}var aK=m(),aM=O.grid.borderWidth;for(var aE=0;aE&lt;aK.length;++aE){var aB=aK[aE],aG=aB.box,aQ=aB.tickLength,aN,aL,aP,aJ;if(!aB.show||aB.ticks.length==0){continue}H.strokeStyle=aB.options.tickColor||c.color.parse(aB.options.color).scale(&quot;a&quot;,.22).toString();H.lineWidth=1;if(aB.direction==&quot;x&quot;){aN=0;if(aQ==&quot;full&quot;){aL=aB.position==&quot;top&quot;?0:w}else{aL=aG.top-q.top+(aB.position==&quot;top&quot;?aG.height:0)}}else{aL=0;if(aQ==&quot;full&quot;){aN=aB.position==&quot;left&quot;?0:h}else{aN=aG.left-q.left+(aB.position==&quot;left&quot;?aG.width:0)}}if(!aB.innermost){H.beginPath();aP=aJ=0;if(aB.direction==&quot;x&quot;){aP=h}else{aJ=w}if(H.lineWidth==1){aN=Math.floor(aN)+.5;aL=Math.floor(aL)+.5}H.moveTo(aN,aL);H.lineTo(aN+aP,aL+aJ);H.stroke()}H.beginPath();for(aF=0;aF&lt;aB.ticks.length;++aF){var aO=aB.ticks[aF].v;aP=aJ=0;if(aO&lt;aB.min||aO&gt;aB.max||aQ==&quot;full&quot;&amp;&amp;aM&gt;0&amp;&amp;(aO==aB.min||aO==aB.max)){continue}if(aB.direction==&quot;x&quot;){aN=aB.p2c(aO);aJ=aQ==&quot;full&quot;?-w:aQ;if(aB.position==&quot;top&quot;){aJ=-aJ}}else{aL=aB.p2c(aO);aP=aQ==&quot;full&quot;?-h:aQ;if(aB.position==&quot;left&quot;){aP=-aP}}if(H.lineWidth==1){if(aB.direction==&quot;x&quot;){aN=Math.floor(aN)+.5}else{aL=Math.floor(aL)+.5}}H.moveTo(aN,aL);H.lineTo(aN+aP,aL+aJ)}H.stroke()}if(aM){H.lineWidth=aM;H.strokeStyle=O.grid.borderColor;H.strokeRect(-aM/2,-aM/2,h+aM,w+aM)}H.restore()}function k(){av.find(&quot;.tickLabels&quot;).remove();var aG=[&#39;&lt;div class=&quot;tickLabels&quot; style=&quot;font-size:smaller&quot;&gt;&#39;];var aJ=m();for(var aD=0;aD&lt;aJ.length;++aD){var aC=aJ[aD],aF=aC.box;if(!aC.show){continue}aG.push(&#39;&lt;div class=&quot;&#39;+aC.direction+&quot;Axis &quot;+aC.direction+aC.n+&#39;Axis&quot; style=&quot;color:&#39;+aC.options.color+&#39;&quot;&gt;&#39;);for(var aE=0;aE&lt;aC.ticks.length;++aE){var aH=aC.ticks[aE];if(!aH.label||aH.v&lt;aC.min||aH.v&gt;aC.max){continue}var aK={},aI;if(aC.direction==&quot;x&quot;){aI=&quot;center&quot;;aK.left=Math.round(q.left+aC.p2c(aH.v)-aC.labelWidth/2);if(aC.position==&quot;bottom&quot;){aK.top=aF.top+aF.padding}else{aK.bottom=I-(aF.top+aF.height-aF.padding)}}else{aK.top=Math.round(q.top+aC.p2c(aH.v)-aC.labelHeight/2);if(aC.position==&quot;left&quot;){aK.right=G-(aF.left+aF.width-aF.padding);aI=&quot;right&quot;}else{aK.left=aF.left+aF.padding;aI=&quot;left&quot;}}aK.width=aC.labelWidth;var aB=[&quot;position:absolute&quot;,&quot;text-align:&quot;+aI];for(var aL in aK){aB.push(aL+&quot;:&quot;+aK[aL]+&quot;px&quot;)}aG.push(&#39;&lt;div class=&quot;tickLabel&quot; style=&quot;&#39;+aB.join(&quot;;&quot;)+&#39;&quot;&gt;&#39;+aH.label+&quot;&lt;/div&gt;&quot;)}aG.push(&quot;&lt;/div&gt;&quot;)}aG.push(&quot;&lt;/div&gt;&quot;);av.append(aG.join(&quot;&quot;))}function d(aB){if(aB.lines.show){at(aB)}if(aB.bars.show){e(aB)}if(aB.points.show){ao(aB)}}function at(aE){function aD(aP,aQ,aI,aU,aT){var aV=aP.points,aJ=aP.pointsize,aN=null,aM=null;H.beginPath();for(var aO=aJ;aO&lt;aV.length;aO+=aJ){var aL=aV[aO-aJ],aS=aV[aO-aJ+1],aK=aV[aO],aR=aV[aO+1];if(aL==null||aK==null){continue}if(aS&lt;=aR&amp;&amp;aS&lt;aT.min){if(aR&lt;aT.min){continue}aL=(aT.min-aS)/(aR-aS)*(aK-aL)+aL;aS=aT.min}else{if(aR&lt;=aS&amp;&amp;aR&lt;aT.min){if(aS&lt;aT.min){continue}aK=(aT.min-aS)/(aR-aS)*(aK-aL)+aL;aR=aT.min}}if(aS&gt;=aR&amp;&amp;aS&gt;aT.max){if(aR&gt;aT.max){continue}aL=(aT.max-aS)/(aR-aS)*(aK-aL)+aL;aS=aT.max}else{if(aR&gt;=aS&amp;&amp;aR&gt;aT.max){if(aS&gt;aT.max){continue}aK=(aT.max-aS)/(aR-aS)*(aK-aL)+aL;aR=aT.max}}if(aL&lt;=aK&amp;&amp;aL&lt;aU.min){if(aK&lt;aU.min){continue}aS=(aU.min-aL)/(aK-aL)*(aR-aS)+aS;aL=aU.min}else{if(aK&lt;=aL&amp;&amp;aK&lt;aU.min){if(aL&lt;aU.min){continue}aR=(aU.min-aL)/(aK-aL)*(aR-aS)+aS;aK=aU.min}}if(aL&gt;=aK&amp;&amp;aL&gt;aU.max){if(aK&gt;aU.max){continue}aS=(aU.max-aL)/(aK-aL)*(aR-aS)+aS;aL=aU.max}else{if(aK&gt;=aL&amp;&amp;aK&gt;aU.max){if(aL&gt;aU.max){continue}aR=(aU.max-aL)/(aK-aL)*(aR-aS)+aS;aK=aU.max}}if(aL!=aN||aS!=aM){H.moveTo(aU.p2c(aL)+aQ,aT.p2c(aS)+aI)}aN=aK;aM=aR;H.lineTo(aU.p2c(aK)+aQ,aT.p2c(aR)+aI)}H.stroke()}function aF(aI,aQ,aP){var aW=aI.points,aV=aI.pointsize,aN=Math.min(Math.max(0,aP.min),aP.max),aX=0,aU,aT=false,aM=1,aL=0,aR=0;while(true){if(aV&gt;0&amp;&amp;aX&gt;aW.length+aV){break}aX+=aV;var aZ=aW[aX-aV],aK=aW[aX-aV+aM],aY=aW[aX],aJ=aW[aX+aM];if(aT){if(aV&gt;0&amp;&amp;aZ!=null&amp;&amp;aY==null){aR=aX;aV=-aV;aM=2;continue}if(aV&lt;0&amp;&amp;aX==aL+aV){H.fill();aT=false;aV=-aV;aM=1;aX=aL=aR+aV;continue}}if(aZ==null||aY==null){continue}if(aZ&lt;=aY&amp;&amp;aZ&lt;aQ.min){if(aY&lt;aQ.min){continue}aK=(aQ.min-aZ)/(aY-aZ)*(aJ-aK)+aK;aZ=aQ.min}else{if(aY&lt;=aZ&amp;&amp;aY&lt;aQ.min){if(aZ&lt;aQ.min){continue}aJ=(aQ.min-aZ)/(aY-aZ)*(aJ-aK)+aK;aY=aQ.min}}if(aZ&gt;=aY&amp;&amp;aZ&gt;aQ.max){if(aY&gt;aQ.max){continue}aK=(aQ.max-aZ)/(aY-aZ)*(aJ-aK)+aK;aZ=aQ.max}else{if(aY&gt;=aZ&amp;&amp;aY&gt;aQ.max){if(aZ&gt;aQ.max){continue}aJ=(aQ.max-aZ)/(aY-aZ)*(aJ-aK)+aK;aY=aQ.max}}if(!aT){H.beginPath();H.moveTo(aQ.p2c(aZ),aP.p2c(aN));aT=true}if(aK&gt;=aP.max&amp;&amp;aJ&gt;=aP.max){H.lineTo(aQ.p2c(aZ),aP.p2c(aP.max));H.lineTo(aQ.p2c(aY),aP.p2c(aP.max));continue}else{if(aK&lt;=aP.min&amp;&amp;aJ&lt;=aP.min){H.lineTo(aQ.p2c(aZ),aP.p2c(aP.min));H.lineTo(aQ.p2c(aY),aP.p2c(aP.min));continue}}var aO=aZ,aS=aY;if(aK&lt;=aJ&amp;&amp;aK&lt;aP.min&amp;&amp;aJ&gt;=aP.min){aZ=(aP.min-aK)/(aJ-aK)*(aY-aZ)+aZ;aK=aP.min}else{if(aJ&lt;=aK&amp;&amp;aJ&lt;aP.min&amp;&amp;aK&gt;=aP.min){aY=(aP.min-aK)/(aJ-aK)*(aY-aZ)+aZ;aJ=aP.min}}if(aK&gt;=aJ&amp;&amp;aK&gt;aP.max&amp;&amp;aJ&lt;=aP.max){aZ=(aP.max-aK)/(aJ-aK)*(aY-aZ)+aZ;aK=aP.max}else{if(aJ&gt;=aK&amp;&amp;aJ&gt;aP.max&amp;&amp;aK&lt;=aP.max){aY=(aP.max-aK)/(aJ-aK)*(aY-aZ)+aZ;aJ=aP.max}}if(aZ!=aO){H.lineTo(aQ.p2c(aO),aP.p2c(aK))}H.lineTo(aQ.p2c(aZ),aP.p2c(aK));H.lineTo(aQ.p2c(aY),aP.p2c(aJ));if(aY!=aS){H.lineTo(aQ.p2c(aY),aP.p2c(aJ));H.lineTo(aQ.p2c(aS),aP.p2c(aJ))}}}H.save();H.translate(q.left,q.top);H.lineJoin=&quot;round&quot;;var aG=aE.lines.lineWidth,aB=aE.shadowSize;if(aG&gt;0&amp;&amp;aB&gt;0){H.lineWidth=aB;H.strokeStyle=&quot;rgba(0,0,0,0.1)&quot;;var aH=Math.PI/18;aD(aE.datapoints,Math.sin(aH)*(aG/2+aB/2),Math.cos(aH)*(aG/2+aB/2),aE.xaxis,aE.yaxis);H.lineWidth=aB/2;aD(aE.datapoints,Math.sin(aH)*(aG/2+aB/4),Math.cos(aH)*(aG/2+aB/4),aE.xaxis,aE.yaxis)}H.lineWidth=aG;H.strokeStyle=aE.color;var aC=ae(aE.lines,aE.color,0,w);if(aC){H.fillStyle=aC;aF(aE.datapoints,aE.xaxis,aE.yaxis)}if(aG&gt;0){aD(aE.datapoints,0,0,aE.xaxis,aE.yaxis)}H.restore()}function ao(aE){function aH(aN,aM,aU,aK,aS,aT,aQ,aJ){var aR=aN.points,aI=aN.pointsize;</td>
      </tr>
      <tr>
        <td id="L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="LC2" class="blob-code blob-code-inner js-file-line">for(var aL=0;aL&lt;aR.length;aL+=aI){var aP=aR[aL],aO=aR[aL+1];if(aP==null||aP&lt;aT.min||aP&gt;aT.max||aO&lt;aQ.min||aO&gt;aQ.max){continue}H.beginPath();aP=aT.p2c(aP);aO=aQ.p2c(aO)+aK;if(aJ==&quot;circle&quot;){H.arc(aP,aO,aM,0,aS?Math.PI:Math.PI*2,false)}else{aJ(H,aP,aO,aM,aS)}H.closePath();if(aU){H.fillStyle=aU;H.fill()}H.stroke()}}H.save();H.translate(q.left,q.top);var aG=aE.points.lineWidth,aC=aE.shadowSize,aB=aE.points.radius,aF=aE.points.symbol;if(aG&gt;0&amp;&amp;aC&gt;0){var aD=aC/2;H.lineWidth=aD;H.strokeStyle=&quot;rgba(0,0,0,0.1)&quot;;aH(aE.datapoints,aB,null,aD+aD/2,true,aE.xaxis,aE.yaxis,aF);H.strokeStyle=&quot;rgba(0,0,0,0.2)&quot;;aH(aE.datapoints,aB,null,aD/2,true,aE.xaxis,aE.yaxis,aF)}H.lineWidth=aG;H.strokeStyle=aE.color;aH(aE.datapoints,aB,ae(aE.points,aE.color),0,false,aE.xaxis,aE.yaxis,aF);H.restore()}function E(aN,aM,aV,aI,aQ,aF,aD,aL,aK,aU,aR,aC){var aE,aT,aJ,aP,aG,aB,aO,aH,aS;if(aR){aH=aB=aO=true;aG=false;aE=aV;aT=aN;aP=aM+aI;aJ=aM+aQ;if(aT&lt;aE){aS=aT;aT=aE;aE=aS;aG=true;aB=false}}else{aG=aB=aO=true;aH=false;aE=aN+aI;aT=aN+aQ;aJ=aV;aP=aM;if(aP&lt;aJ){aS=aP;aP=aJ;aJ=aS;aH=true;aO=false}}if(aT&lt;aL.min||aE&gt;aL.max||aP&lt;aK.min||aJ&gt;aK.max){return}if(aE&lt;aL.min){aE=aL.min;aG=false}if(aT&gt;aL.max){aT=aL.max;aB=false}if(aJ&lt;aK.min){aJ=aK.min;aH=false}if(aP&gt;aK.max){aP=aK.max;aO=false}aE=aL.p2c(aE);aJ=aK.p2c(aJ);aT=aL.p2c(aT);aP=aK.p2c(aP);if(aD){aU.beginPath();aU.moveTo(aE,aJ);aU.lineTo(aE,aP);aU.lineTo(aT,aP);aU.lineTo(aT,aJ);aU.fillStyle=aD(aJ,aP);aU.fill()}if(aC&gt;0&amp;&amp;(aG||aB||aO||aH)){aU.beginPath();aU.moveTo(aE,aJ+aF);if(aG){aU.lineTo(aE,aP+aF)}else{aU.moveTo(aE,aP+aF)}if(aO){aU.lineTo(aT,aP+aF)}else{aU.moveTo(aT,aP+aF)}if(aB){aU.lineTo(aT,aJ+aF)}else{aU.moveTo(aT,aJ+aF)}if(aH){aU.lineTo(aE,aJ+aF)}else{aU.moveTo(aE,aJ+aF)}aU.stroke()}}function e(aD){function aC(aJ,aI,aL,aG,aK,aN,aM){var aO=aJ.points,aF=aJ.pointsize;for(var aH=0;aH&lt;aO.length;aH+=aF){if(aO[aH]==null){continue}E(aO[aH],aO[aH+1],aO[aH+2],aI,aL,aG,aK,aN,aM,H,aD.bars.horizontal,aD.bars.lineWidth)}}H.save();H.translate(q.left,q.top);H.lineWidth=aD.bars.lineWidth;H.strokeStyle=aD.color;var aB=aD.bars.align==&quot;left&quot;?0:-aD.bars.barWidth/2;var aE=aD.bars.fill?function(aF,aG){return ae(aD.bars,aD.color,aF,aG)}:null;aC(aD.datapoints,aB,aB+aD.bars.barWidth,0,aE,aD.xaxis,aD.yaxis);H.restore()}function ae(aD,aB,aC,aF){var aE=aD.fill;if(!aE){return null}if(aD.fillColor){return am(aD.fillColor,aC,aF,aB)}var aG=c.color.parse(aB);aG.a=typeof aE==&quot;number&quot;?aE:.4;aG.normalize();return aG.toString()}function o(){av.find(&quot;.legend&quot;).remove();if(!O.legend.show){return}var aH=[],aF=false,aN=O.legend.labelFormatter,aM,aJ;for(var aE=0;aE&lt;Q.length;++aE){aM=Q[aE];aJ=aM.label;if(!aJ){continue}if(aE%O.legend.noColumns==0){if(aF){aH.push(&quot;&lt;/tr&gt;&quot;)}aH.push(&quot;&lt;tr&gt;&quot;);aF=true}if(aN){aJ=aN(aJ,aM)}aH.push(&#39;&lt;td class=&quot;legendColorBox&quot;&gt;&lt;div style=&quot;border:1px solid &#39;+O.legend.labelBoxBorderColor+&#39;;padding:1px&quot;&gt;&lt;div style=&quot;width:4px;height:0;border:5px solid &#39;+aM.color+&#39;;overflow:hidden&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class=&quot;legendLabel&quot;&gt;&#39;+aJ+&quot;&lt;/td&gt;&quot;)}if(aF){aH.push(&quot;&lt;/tr&gt;&quot;)}if(aH.length==0){return}var aL=&#39;&lt;table style=&quot;font-size:smaller;color:&#39;+O.grid.color+&#39;&quot;&gt;&#39;+aH.join(&quot;&quot;)+&quot;&lt;/table&gt;&quot;;if(O.legend.container!=null){c(O.legend.container).html(aL)}else{var aI=&quot;&quot;,aC=O.legend.position,aD=O.legend.margin;if(aD[0]==null){aD=[aD,aD]}if(aC.charAt(0)==&quot;n&quot;){aI+=&quot;top:&quot;+(aD[1]+q.top)+&quot;px;&quot;}else{if(aC.charAt(0)==&quot;s&quot;){aI+=&quot;bottom:&quot;+(aD[1]+q.bottom)+&quot;px;&quot;}}if(aC.charAt(1)==&quot;e&quot;){aI+=&quot;right:&quot;+(aD[0]+q.right)+&quot;px;&quot;}else{if(aC.charAt(1)==&quot;w&quot;){aI+=&quot;left:&quot;+(aD[0]+q.left)+&quot;px;&quot;}}var aK=c(&#39;&lt;div class=&quot;legend&quot;&gt;&#39;+aL.replace(&#39;style=&quot;&#39;,&#39;style=&quot;position:absolute;&#39;+aI+&quot;;&quot;)+&quot;&lt;/div&gt;&quot;).appendTo(av);if(O.legend.backgroundOpacity!=0){var aG=O.legend.backgroundColor;if(aG==null){aG=O.grid.backgroundColor;if(aG&amp;&amp;typeof aG==&quot;string&quot;){aG=c.color.parse(aG)}else{aG=c.color.extract(aK,&quot;background-color&quot;)}aG.a=1;aG=aG.toString()}var aB=aK.children();c(&#39;&lt;div style=&quot;position:absolute;width:&#39;+aB.width()+&quot;px;height:&quot;+aB.height()+&quot;px;&quot;+aI+&quot;background-color:&quot;+aG+&#39;;&quot;&gt; &lt;/div&gt;&#39;).prependTo(aK).css(&quot;opacity&quot;,O.legend.backgroundOpacity)}}}var ab=[],M=null;function K(aI,aG,aD){var aO=O.grid.mouseActiveRadius,a0=aO*aO+1,aY=null,aR=false,aW,aU;for(aW=Q.length-1;aW&gt;=0;--aW){if(!aD(Q[aW])){continue}var aP=Q[aW],aH=aP.xaxis,aF=aP.yaxis,aV=aP.datapoints.points,aT=aP.datapoints.pointsize,aQ=aH.c2p(aI),aN=aF.c2p(aG),aC=aO/aH.scale,aB=aO/aF.scale;if(aH.options.inverseTransform){aC=Number.MAX_VALUE}if(aF.options.inverseTransform){aB=Number.MAX_VALUE}if(aP.lines.show||aP.points.show){for(aU=0;aU&lt;aV.length;aU+=aT){var aK=aV[aU],aJ=aV[aU+1];if(aK==null){continue}if(aK-aQ&gt;aC||aK-aQ&lt;-aC||aJ-aN&gt;aB||aJ-aN&lt;-aB){continue}var aM=Math.abs(aH.p2c(aK)-aI),aL=Math.abs(aF.p2c(aJ)-aG),aS=aM*aM+aL*aL;if(aS&lt;a0){a0=aS;aY=[aW,aU/aT]}}}if(aP.bars.show&amp;&amp;!aY){var aE=aP.bars.align==&quot;left&quot;?0:-aP.bars.barWidth/2,aX=aE+aP.bars.barWidth;for(aU=0;aU&lt;aV.length;aU+=aT){var aK=aV[aU],aJ=aV[aU+1],aZ=aV[aU+2];if(aK==null){continue}if(Q[aW].bars.horizontal?aQ&lt;=Math.max(aZ,aK)&amp;&amp;aQ&gt;=Math.min(aZ,aK)&amp;&amp;aN&gt;=aJ+aE&amp;&amp;aN&lt;=aJ+aX:aQ&gt;=aK+aE&amp;&amp;aQ&lt;=aK+aX&amp;&amp;aN&gt;=Math.min(aZ,aJ)&amp;&amp;aN&lt;=Math.max(aZ,aJ)){aY=[aW,aU/aT]}}}}if(aY){aW=aY[0];aU=aY[1];aT=Q[aW].datapoints.pointsize;return{datapoint:Q[aW].datapoints.points.slice(aU*aT,(aU+1)*aT),dataIndex:aU,series:Q[aW],seriesIndex:aW}}return null}function aa(aB){if(O.grid.hoverable){u(&quot;plothover&quot;,aB,function(aC){return aC.hoverable!=false})}}function l(aB){if(O.grid.hoverable){u(&quot;plothover&quot;,aB,function(aC){return false})}}function R(aB){u(&quot;plotclick&quot;,aB,function(aC){return aC.clickable!=false})}function u(aC,aB,aD){var aE=y.offset(),aH=aB.pageX-aE.left-q.left,aF=aB.pageY-aE.top-q.top,aJ=C({left:aH,top:aF});aJ.pageX=aB.pageX;aJ.pageY=aB.pageY;var aK=K(aH,aF,aD);if(aK){aK.pageX=parseInt(aK.series.xaxis.p2c(aK.datapoint[0])+aE.left+q.left);aK.pageY=parseInt(aK.series.yaxis.p2c(aK.datapoint[1])+aE.top+q.top)}if(O.grid.autoHighlight){for(var aG=0;aG&lt;ab.length;++aG){var aI=ab[aG];if(aI.auto==aC&amp;&amp;!(aK&amp;&amp;aI.series==aK.series&amp;&amp;aI.point[0]==aK.datapoint[0]&amp;&amp;aI.point[1]==aK.datapoint[1])){T(aI.series,aI.point)}}if(aK){x(aK.series,aK.datapoint,aC)}}av.trigger(aC,[aJ,aK])}function f(){if(!M){M=setTimeout(s,30)}}function s(){M=null;A.save();A.clearRect(0,0,G,I);A.translate(q.left,q.top);var aC,aB;for(aC=0;aC&lt;ab.length;++aC){aB=ab[aC];if(aB.series.bars.show){v(aB.series,aB.point)}else{ay(aB.series,aB.point)}}A.restore();an(ak.drawOverlay,[A])}function x(aD,aB,aF){if(typeof aD==&quot;number&quot;){aD=Q[aD]}if(typeof aB==&quot;number&quot;){var aE=aD.datapoints.pointsize;aB=aD.datapoints.points.slice(aE*aB,aE*(aB+1))}var aC=al(aD,aB);if(aC==-1){ab.push({series:aD,point:aB,auto:aF});f()}else{if(!aF){ab[aC].auto=false}}}function T(aD,aB){if(aD==null&amp;&amp;aB==null){ab=[];f()}if(typeof aD==&quot;number&quot;){aD=Q[aD]}if(typeof aB==&quot;number&quot;){aB=aD.data[aB]}var aC=al(aD,aB);if(aC!=-1){ab.splice(aC,1);f()}}function al(aD,aE){for(var aB=0;aB&lt;ab.length;++aB){var aC=ab[aB];if(aC.series==aD&amp;&amp;aC.point[0]==aE[0]&amp;&amp;aC.point[1]==aE[1]){return aB}}return-1}function ay(aE,aD){var aC=aD[0],aI=aD[1],aH=aE.xaxis,aG=aE.yaxis;if(aC&lt;aH.min||aC&gt;aH.max||aI&lt;aG.min||aI&gt;aG.max){return}var aF=aE.points.radius+aE.points.lineWidth/2;A.lineWidth=aF;A.strokeStyle=c.color.parse(aE.color).scale(&quot;a&quot;,.5).toString();var aB=1.5*aF,aC=aH.p2c(aC),aI=aG.p2c(aI);A.beginPath();if(aE.points.symbol==&quot;circle&quot;){A.arc(aC,aI,aB,0,2*Math.PI,false)}else{aE.points.symbol(A,aC,aI,aB,false)}A.closePath();A.stroke()}function v(aE,aB){A.lineWidth=aE.bars.lineWidth;A.strokeStyle=c.color.parse(aE.color).scale(&quot;a&quot;,.5).toString();var aD=c.color.parse(aE.color).scale(&quot;a&quot;,.5).toString();var aC=aE.bars.align==&quot;left&quot;?0:-aE.bars.barWidth/2;E(aB[0],aB[1],aB[2]||0,aC,aC+aE.bars.barWidth,0,function(){return aD},aE.xaxis,aE.yaxis,A,aE.bars.horizontal,aE.bars.lineWidth)}function am(aJ,aB,aH,aC){if(typeof aJ==&quot;string&quot;){return aJ}else{var aI=H.createLinearGradient(0,aH,0,aB);for(var aE=0,aD=aJ.colors.length;aE&lt;aD;++aE){var aF=aJ.colors[aE];if(typeof aF!=&quot;string&quot;){var aG=c.color.parse(aC);if(aF.brightness!=null){aG=aG.scale(&quot;rgb&quot;,aF.brightness)}if(aF.opacity!=null){aG.a*=aF.opacity}aF=aG.toString()}aI.addColorStop(aE/(aD-1),aF)}return aI}}}c.plot=function(g,e,d){var f=new b(c(g),e,d,c.plot.plugins);return f};c.plot.version=&quot;0.7&quot;;c.plot.plugins=[];c.plot.formatDate=function(l,f,h){var o=function(d){d=&quot;&quot;+d;return d.length==1?&quot;0&quot;+d:d};var e=[];var p=false,j=false;var n=l.getUTCHours();var k=n&lt;12;if(h==null){h=[&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]}if(f.search(/%p|%P/)!=-1){if(n&gt;12){n=n-12}else{if(n==0){n=12}}}for(var g=0;g&lt;f.length;++g){var m=f.charAt(g);if(p){switch(m){case&quot;h&quot;:m=&quot;&quot;+n;break;case&quot;H&quot;:m=o(n);break;case&quot;M&quot;:m=o(l.getUTCMinutes());break;case&quot;S&quot;:m=o(l.getUTCSeconds());break;case&quot;d&quot;:m=&quot;&quot;+l.getUTCDate();break;case&quot;m&quot;:m=&quot;&quot;+(l.getUTCMonth()+1);break;case&quot;y&quot;:m=&quot;&quot;+l.getUTCFullYear();break;case&quot;b&quot;:m=&quot;&quot;+h[l.getUTCMonth()];break;case&quot;p&quot;:m=k?&quot;am&quot;:&quot;pm&quot;;break;case&quot;P&quot;:m=k?&quot;AM&quot;:&quot;PM&quot;;break;case&quot;0&quot;:m=&quot;&quot;;j=true;break}if(m&amp;&amp;j){m=o(m);j=false}e.push(m);if(!j){p=false}}else{if(m==&quot;%&quot;){p=true}else{e.push(m)}}}return e.join(&quot;&quot;)};function a(e,d){return d*Math.floor(e/d)}})(jQuery);(function($){var options={crosshair:{mode:null,color:&quot;rgba(0, 0, 0, 0.5)&quot;,lineWidth:1}};function log10(val){return Math.log(val)/Math.LN10}function format_number(val,n){if(n===undefined)n=3;if(val===0)return 0;if(n&lt;=0)throw new Error(&quot;Significant figures must be greater than zero.&quot;);n=Math.floor(n+.5);var sign=val&gt;=0?&quot;&quot;:&quot;-&quot;;val=Math.abs(val);var before=Math.floor(log10(val))+1;if(before&gt;n){val=val.toPrecision(n);return sign+val.replace(&quot;+&quot;,&quot;&quot;)}else if(before&lt;0){var mantissa=val*pow(10,abs(before)+1);before-=1;return sign+mantissa.toFixed(n-1)+&quot;e&quot;+before}else{return sign+val.toFixed(n-before)}}function init(plot){var crosshair={x:-1,y:-1,locked:false};plot.setCrosshair=function setCrosshair(pos){if(!pos)crosshair.x=-1;else{var o=plot.p2c(pos);crosshair.x=Math.max(0,Math.min(o.left,plot.width()));crosshair.y=Math.max(0,Math.min(o.top,plot.height()))}plot.triggerRedrawOverlay()};plot.clearCrosshair=plot.setCrosshair;plot.lockCrosshair=function lockCrosshair(pos){if(pos)plot.setCrosshair(pos);crosshair.locked=true};plot.unlockCrosshair=function unlockCrosshair(){crosshair.locked=false};function onMouseOut(e){if(crosshair.locked)return;if(crosshair.x!=-1){crosshair.x=-1;plot.triggerRedrawOverlay()}}function onMouseMove(e){if(crosshair.locked)return;if(plot.getSelection&amp;&amp;plot.getSelection()){crosshair.x=-1;return}var offset=plot.offset();crosshair.x=Math.max(0,Math.min(e.pageX-offset.left,plot.width()));crosshair.y=Math.max(0,Math.min(e.pageY-offset.top,plot.height()));plot.triggerRedrawOverlay()}plot.hooks.bindEvents.push(function(plot,eventHolder){if(!plot.getOptions().crosshair.mode)return;eventHolder.mouseout(onMouseOut);eventHolder.mousemove(onMouseMove)});plot.hooks.drawOverlay.push(function(plot,ctx){var c=plot.getOptions().crosshair;if(!c.mode)return;var plotOffset=plot.getPlotOffset();ctx.save();ctx.translate(plotOffset.left,plotOffset.top);if(crosshair.x!=-1){var pos=plot.c2p({left:crosshair.x,top:crosshair.y});text=format_number(pos.x,3)+&quot;,&quot;+format_number(pos.y,3);var fontheight=13;ctx.fillStyle=c.color;ctx.font=fontheight+&quot;px Verdana&quot;;var twidth=ctx.measureText(text).width;var dx=0,dy=0;if(crosshair.y&lt;fontheight+3){twidth+=14;dy=fontheight;if(crosshair.x&lt;=plot.width()-(twidth+5))dx+=14}else{dy=-5}if(crosshair.x&gt;plot.width()-(twidth+5)){ctx.textAlign=&quot;right&quot;;dx+=-3}else{ctx.textAlign=&quot;left&quot;;dx+=3}ctx.fillText(text,crosshair.x+dx,crosshair.y+dy);ctx.strokeStyle=c.color;ctx.lineWidth=c.lineWidth;ctx.lineJoin=&quot;round&quot;;ctx.beginPath();if(c.mode.indexOf(&quot;x&quot;)!=-1){ctx.moveTo(crosshair.x,0);ctx.lineTo(crosshair.x,plot.height())}if(c.mode.indexOf(&quot;y&quot;)!=-1){ctx.moveTo(0,crosshair.y);ctx.lineTo(plot.width(),crosshair.y)}ctx.stroke()}ctx.restore()});plot.hooks.shutdown.push(function(plot,eventHolder){eventHolder.unbind(&quot;mouseout&quot;,onMouseOut);eventHolder.unbind(&quot;mousemove&quot;,onMouseMove)})}$.plot.plugins.push({init:init,options:options,name:&quot;crosshair_GS&quot;,version:&quot;1.0&quot;})})(jQuery);var TINF_OK=0;var TINF_DATA_ERROR=-3;function Tree(){this.table=new Uint16Array(16);this.trans=new Uint16Array(288)}function Data(source,dest){this.source=source;this.sourceIndex=0;this.tag=0;this.bitcount=0;this.dest=dest;this.destLen=0;this.ltree=new Tree;this.dtree=new Tree}var sltree=new Tree;var sdtree=new Tree;var length_bits=new Uint8Array(30);var length_base=new Uint16Array(30);var dist_bits=new Uint8Array(30);var dist_base=new Uint16Array(30);var clcidx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);var code_tree=new Tree;var lengths=new Uint8Array(288+32);assert=function(predicate,message){if(!predicate){throw new Error(message)}};function tinf_build_bits_base(bits,base,delta,first){var i,sum;for(i=0;i&lt;delta;++i)bits[i]=0;for(i=0;i&lt;30-delta;++i)bits[i+delta]=i/delta|0;for(sum=first,i=0;i&lt;30;++i){base[i]=sum;sum+=1&lt;&lt;bits[i]}}function tinf_build_fixed_trees(lt,dt){var i;for(i=0;i&lt;7;++i)lt.table[i]=0;lt.table[7]=24;lt.table[8]=152;lt.table[9]=112;for(i=0;i&lt;24;++i)lt.trans[i]=256+i;for(i=0;i&lt;144;++i)lt.trans[24+i]=i;for(i=0;i&lt;8;++i)lt.trans[24+144+i]=280+i;for(i=0;i&lt;112;++i)lt.trans[24+144+8+i]=144+i;for(i=0;i&lt;5;++i)dt.table[i]=0;dt.table[5]=32;for(i=0;i&lt;32;++i)dt.trans[i]=i}var offs=new Uint16Array(16);function tinf_build_tree(t,lengths,off,num){var i,sum;for(i=0;i&lt;16;++i)t.table[i]=0;for(i=0;i&lt;num;++i)t.table[lengths[off+i]]++;t.table[0]=0;for(sum=0,i=0;i&lt;16;++i){offs[i]=sum;sum+=t.table[i]}for(i=0;i&lt;num;++i){if(lengths[off+i])t.trans[offs[lengths[off+i]]++]=i}}function tinf_getbit(d){if(!d.bitcount--){d.tag=d.source[d.sourceIndex++];d.bitcount=7}var bit=d.tag&amp;1;d.tag&gt;&gt;&gt;=1;return bit}function tinf_read_bits(d,num,base){if(!num)return base;while(d.bitcount&lt;24){d.tag|=d.source[d.sourceIndex++]&lt;&lt;d.bitcount;d.bitcount+=8}var val=d.tag&amp;65535&gt;&gt;&gt;16-num;d.tag&gt;&gt;&gt;=num;d.bitcount-=num;return val+base}function tinf_decode_symbol(d,t){while(d.bitcount&lt;24){d.tag|=d.source[d.sourceIndex++]&lt;&lt;d.bitcount;d.bitcount+=8}var sum=0,cur=0,len=0;var tag=d.tag;do{cur=2*cur+(tag&amp;1);tag&gt;&gt;&gt;=1;++len;sum+=t.table[len];cur-=t.table[len]}while(cur&gt;=0);d.tag=tag;d.bitcount-=len;return t.trans[sum+cur]}function tinf_decode_trees(d,lt,dt){var hlit,hdist,hclen;var i,num,length;hlit=tinf_read_bits(d,5,257);hdist=tinf_read_bits(d,5,1);hclen=tinf_read_bits(d,4,4);for(i=0;i&lt;19;++i)lengths[i]=0;for(i=0;i&lt;hclen;++i){var clen=tinf_read_bits(d,3,0);lengths[clcidx[i]]=clen}tinf_build_tree(code_tree,lengths,0,19);for(num=0;num&lt;hlit+hdist;){var sym=tinf_decode_symbol(d,code_tree);switch(sym){case 16:var prev=lengths[num-1];for(length=tinf_read_bits(d,2,3);length;--length){lengths[num++]=prev}break;case 17:for(length=tinf_read_bits(d,3,3);length;--length){lengths[num++]=0}break;case 18:for(length=tinf_read_bits(d,7,11);length;--length){lengths[num++]=0}break;default:lengths[num++]=sym;break}}tinf_build_tree(lt,lengths,0,hlit);tinf_build_tree(dt,lengths,hlit,hdist)}function tinf_inflate_block_data(d,lt,dt){while(1){var sym=tinf_decode_symbol(d,lt);if(sym===256){return TINF_OK}if(sym&lt;256){d.dest[d.destLen++]=sym}else{var length,dist,offs;var i;sym-=257;length=tinf_read_bits(d,length_bits[sym],length_base[sym]);dist=tinf_decode_symbol(d,dt);offs=d.destLen-tinf_read_bits(d,dist_bits[dist],dist_base[dist]);for(i=offs;i&lt;offs+length;++i){d.dest[d.destLen++]=d.dest[i]}}}}function tinf_inflate_uncompressed_block(d){var length,invlength;var i;while(d.bitcount&gt;8){d.sourceIndex--;d.bitcount-=8}length=d.source[d.sourceIndex+1];length=256*length+d.source[d.sourceIndex];invlength=d.source[d.sourceIndex+3];invlength=256*invlength+d.source[d.sourceIndex+2];if(length!==(~invlength&amp;65535))return TINF_DATA_ERROR;d.sourceIndex+=4;for(i=length;i;--i)d.dest[d.destLen++]=d.source[d.sourceIndex++];d.bitcount=0;return TINF_OK}function tinf_uncompress(source,dest){var d=new Data(source,dest);var bfinal,btype,res;do{bfinal=tinf_getbit(d);btype=tinf_read_bits(d,2,0);switch(btype){case 0:res=tinf_inflate_uncompressed_block(d);break;case 1:res=tinf_inflate_block_data(d,sltree,sdtree);break;case 2:tinf_decode_trees(d,d.ltree,d.dtree);res=tinf_inflate_block_data(d,d.ltree,d.dtree);break;default:res=TINF_DATA_ERROR}if(res!==TINF_OK)throw new Error(&quot;Data error&quot;)}while(!bfinal);if(d.destLen&lt;d.dest.length){if(typeof d.dest.slice===&quot;function&quot;)return d.dest.slice(0,d.destLen);else return d.dest.subarray(0,d.destLen)}return d.dest}tinf_build_fixed_trees(sltree,sdtree);tinf_build_bits_base(length_bits,length_base,4,3);tinf_build_bits_base(dist_bits,dist_base,2,1);length_bits[28]=0;length_base[28]=258;function line(ctx,x1,y1,x2,y2){ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke()}var cffStandardStrings=[&quot;.notdef&quot;,&quot;space&quot;,&quot;exclam&quot;,&quot;quotedbl&quot;,&quot;numbersign&quot;,&quot;dollar&quot;,&quot;percent&quot;,&quot;ampersand&quot;,&quot;quoteright&quot;,&quot;parenleft&quot;,&quot;parenright&quot;,&quot;asterisk&quot;,&quot;plus&quot;,&quot;comma&quot;,&quot;hyphen&quot;,&quot;period&quot;,&quot;slash&quot;,&quot;zero&quot;,&quot;one&quot;,&quot;two&quot;,&quot;three&quot;,&quot;four&quot;,&quot;five&quot;,&quot;six&quot;,&quot;seven&quot;,&quot;eight&quot;,&quot;nine&quot;,&quot;colon&quot;,&quot;semicolon&quot;,&quot;less&quot;,&quot;equal&quot;,&quot;greater&quot;,&quot;question&quot;,&quot;at&quot;,&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;E&quot;,&quot;F&quot;,&quot;G&quot;,&quot;H&quot;,&quot;I&quot;,&quot;J&quot;,&quot;K&quot;,&quot;L&quot;,&quot;M&quot;,&quot;N&quot;,&quot;O&quot;,&quot;P&quot;,&quot;Q&quot;,&quot;R&quot;,&quot;S&quot;,&quot;T&quot;,&quot;U&quot;,&quot;V&quot;,&quot;W&quot;,&quot;X&quot;,&quot;Y&quot;,&quot;Z&quot;,&quot;bracketleft&quot;,&quot;backslash&quot;,&quot;bracketright&quot;,&quot;asciicircum&quot;,&quot;underscore&quot;,&quot;quoteleft&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;i&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;o&quot;,&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;u&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;braceleft&quot;,&quot;bar&quot;,&quot;braceright&quot;,&quot;asciitilde&quot;,&quot;exclamdown&quot;,&quot;cent&quot;,&quot;sterling&quot;,&quot;fraction&quot;,&quot;yen&quot;,&quot;florin&quot;,&quot;section&quot;,&quot;currency&quot;,&quot;quotesingle&quot;,&quot;quotedblleft&quot;,&quot;guillemotleft&quot;,&quot;guilsinglleft&quot;,&quot;guilsinglright&quot;,&quot;fi&quot;,&quot;fl&quot;,&quot;endash&quot;,&quot;dagger&quot;,&quot;daggerdbl&quot;,&quot;periodcentered&quot;,&quot;paragraph&quot;,&quot;bullet&quot;,&quot;quotesinglbase&quot;,&quot;quotedblbase&quot;,&quot;quotedblright&quot;,&quot;guillemotright&quot;,&quot;ellipsis&quot;,&quot;perthousand&quot;,&quot;questiondown&quot;,&quot;grave&quot;,&quot;acute&quot;,&quot;circumflex&quot;,&quot;tilde&quot;,&quot;macron&quot;,&quot;breve&quot;,&quot;dotaccent&quot;,&quot;dieresis&quot;,&quot;ring&quot;,&quot;cedilla&quot;,&quot;hungarumlaut&quot;,&quot;ogonek&quot;,&quot;caron&quot;,&quot;emdash&quot;,&quot;AE&quot;,&quot;ordfeminine&quot;,&quot;Lslash&quot;,&quot;Oslash&quot;,&quot;OE&quot;,&quot;ordmasculine&quot;,&quot;ae&quot;,&quot;dotlessi&quot;,&quot;lslash&quot;,&quot;oslash&quot;,&quot;oe&quot;,&quot;germandbls&quot;,&quot;onesuperior&quot;,&quot;logicalnot&quot;,&quot;mu&quot;,&quot;trademark&quot;,&quot;Eth&quot;,&quot;onehalf&quot;,&quot;plusminus&quot;,&quot;Thorn&quot;,&quot;onequarter&quot;,&quot;divide&quot;,&quot;brokenbar&quot;,&quot;degree&quot;,&quot;thorn&quot;,&quot;threequarters&quot;,&quot;twosuperior&quot;,&quot;registered&quot;,&quot;minus&quot;,&quot;eth&quot;,&quot;multiply&quot;,&quot;threesuperior&quot;,&quot;copyright&quot;,&quot;Aacute&quot;,&quot;Acircumflex&quot;,&quot;Adieresis&quot;,&quot;Agrave&quot;,&quot;Aring&quot;,&quot;Atilde&quot;,&quot;Ccedilla&quot;,&quot;Eacute&quot;,&quot;Ecircumflex&quot;,&quot;Edieresis&quot;,&quot;Egrave&quot;,&quot;Iacute&quot;,&quot;Icircumflex&quot;,&quot;Idieresis&quot;,&quot;Igrave&quot;,&quot;Ntilde&quot;,&quot;Oacute&quot;,&quot;Ocircumflex&quot;,&quot;Odieresis&quot;,&quot;Ograve&quot;,&quot;Otilde&quot;,&quot;Scaron&quot;,&quot;Uacute&quot;,&quot;Ucircumflex&quot;,&quot;Udieresis&quot;,&quot;Ugrave&quot;,&quot;Yacute&quot;,&quot;Ydieresis&quot;,&quot;Zcaron&quot;,&quot;aacute&quot;,&quot;acircumflex&quot;,&quot;adieresis&quot;,&quot;agrave&quot;,&quot;aring&quot;,&quot;atilde&quot;,&quot;ccedilla&quot;,&quot;eacute&quot;,&quot;ecircumflex&quot;,&quot;edieresis&quot;,&quot;egrave&quot;,&quot;iacute&quot;,&quot;icircumflex&quot;,&quot;idieresis&quot;,&quot;igrave&quot;,&quot;ntilde&quot;,&quot;oacute&quot;,&quot;ocircumflex&quot;,&quot;odieresis&quot;,&quot;ograve&quot;,&quot;otilde&quot;,&quot;scaron&quot;,&quot;uacute&quot;,&quot;ucircumflex&quot;,&quot;udieresis&quot;,&quot;ugrave&quot;,&quot;yacute&quot;,&quot;ydieresis&quot;,&quot;zcaron&quot;,&quot;exclamsmall&quot;,&quot;Hungarumlautsmall&quot;,&quot;dollaroldstyle&quot;,&quot;dollarsuperior&quot;,&quot;ampersandsmall&quot;,&quot;Acutesmall&quot;,&quot;parenleftsuperior&quot;,&quot;parenrightsuperior&quot;,&quot;266 ff&quot;,&quot;onedotenleader&quot;,&quot;zerooldstyle&quot;,&quot;oneoldstyle&quot;,&quot;twooldstyle&quot;,&quot;threeoldstyle&quot;,&quot;fouroldstyle&quot;,&quot;fiveoldstyle&quot;,&quot;sixoldstyle&quot;,&quot;sevenoldstyle&quot;,&quot;eightoldstyle&quot;,&quot;nineoldstyle&quot;,&quot;commasuperior&quot;,&quot;threequartersemdash&quot;,&quot;periodsuperior&quot;,&quot;questionsmall&quot;,&quot;asuperior&quot;,&quot;bsuperior&quot;,&quot;centsuperior&quot;,&quot;dsuperior&quot;,&quot;esuperior&quot;,&quot;isuperior&quot;,&quot;lsuperior&quot;,&quot;msuperior&quot;,&quot;nsuperior&quot;,&quot;osuperior&quot;,&quot;rsuperior&quot;,&quot;ssuperior&quot;,&quot;tsuperior&quot;,&quot;ff&quot;,&quot;ffi&quot;,&quot;ffl&quot;,&quot;parenleftinferior&quot;,&quot;parenrightinferior&quot;,&quot;Circumflexsmall&quot;,&quot;hyphensuperior&quot;,&quot;Gravesmall&quot;,&quot;Asmall&quot;,&quot;Bsmall&quot;,&quot;Csmall&quot;,&quot;Dsmall&quot;,&quot;Esmall&quot;,&quot;Fsmall&quot;,&quot;Gsmall&quot;,&quot;Hsmall&quot;,&quot;Ismall&quot;,&quot;Jsmall&quot;,&quot;Ksmall&quot;,&quot;Lsmall&quot;,&quot;Msmall&quot;,&quot;Nsmall&quot;,&quot;Osmall&quot;,&quot;Psmall&quot;,&quot;Qsmall&quot;,&quot;Rsmall&quot;,&quot;Ssmall&quot;,&quot;Tsmall&quot;,&quot;Usmall&quot;,&quot;Vsmall&quot;,&quot;Wsmall&quot;,&quot;Xsmall&quot;,&quot;Ysmall&quot;,&quot;Zsmall&quot;,&quot;colonmonetary&quot;,&quot;onefitted&quot;,&quot;rupiah&quot;,&quot;Tildesmall&quot;,&quot;exclamdownsmall&quot;,&quot;centoldstyle&quot;,&quot;Lslashsmall&quot;,&quot;Scaronsmall&quot;,&quot;Zcaronsmall&quot;,&quot;Dieresissmall&quot;,&quot;Brevesmall&quot;,&quot;Caronsmall&quot;,&quot;Dotaccentsmall&quot;,&quot;Macronsmall&quot;,&quot;figuredash&quot;,&quot;hypheninferior&quot;,&quot;Ogoneksmall&quot;,&quot;Ringsmall&quot;,&quot;Cedillasmall&quot;,&quot;questiondownsmall&quot;,&quot;oneeighth&quot;,&quot;threeeighths&quot;,&quot;fiveeighths&quot;,&quot;seveneighths&quot;,&quot;onethird&quot;,&quot;twothirds&quot;,&quot;zerosuperior&quot;,&quot;foursuperior&quot;,&quot;fivesuperior&quot;,&quot;sixsuperior&quot;,&quot;sevensuperior&quot;,&quot;eightsuperior&quot;,&quot;ninesuperior&quot;,&quot;zeroinferior&quot;,&quot;oneinferior&quot;,&quot;twoinferior&quot;,&quot;threeinferior&quot;,&quot;fourinferior&quot;,&quot;fiveinferior&quot;,&quot;sixinferior&quot;,&quot;seveninferior&quot;,&quot;eightinferior&quot;,&quot;nineinferior&quot;,&quot;centinferior&quot;,&quot;dollarinferior&quot;,&quot;periodinferior&quot;,&quot;commainferior&quot;,&quot;Agravesmall&quot;,&quot;Aacutesmall&quot;,&quot;Acircumflexsmall&quot;,&quot;Atildesmall&quot;,&quot;Adieresissmall&quot;,&quot;Aringsmall&quot;,&quot;AEsmall&quot;,&quot;Ccedillasmall&quot;,&quot;Egravesmall&quot;,&quot;Eacutesmall&quot;,&quot;Ecircumflexsmall&quot;,&quot;Edieresissmall&quot;,&quot;Igravesmall&quot;,&quot;Iacutesmall&quot;,&quot;Icircumflexsmall&quot;,&quot;Idieresissmall&quot;,&quot;Ethsmall&quot;,&quot;Ntildesmall&quot;,&quot;Ogravesmall&quot;,&quot;Oacutesmall&quot;,&quot;Ocircumflexsmall&quot;,&quot;Otildesmall&quot;,&quot;Odieresissmall&quot;,&quot;OEsmall&quot;,&quot;Oslashsmall&quot;,&quot;Ugravesmall&quot;,&quot;Uacutesmall&quot;,&quot;Ucircumflexsmall&quot;,&quot;Udieresissmall&quot;,&quot;Yacutesmall&quot;,&quot;Thornsmall&quot;,&quot;Ydieresissmall&quot;,&quot;001.000&quot;,&quot;001.001&quot;,&quot;001.002&quot;,&quot;001.003&quot;,&quot;Black&quot;,&quot;Bold&quot;,&quot;Book&quot;,&quot;Light&quot;,&quot;Medium&quot;,&quot;Regular&quot;,&quot;Roman&quot;,&quot;Semibold&quot;];var cffStandardEncoding=[&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;space&quot;,&quot;exclam&quot;,&quot;quotedbl&quot;,&quot;numbersign&quot;,&quot;dollar&quot;,&quot;percent&quot;,&quot;ampersand&quot;,&quot;quoteright&quot;,&quot;parenleft&quot;,&quot;parenright&quot;,&quot;asterisk&quot;,&quot;plus&quot;,&quot;comma&quot;,&quot;hyphen&quot;,&quot;period&quot;,&quot;slash&quot;,&quot;zero&quot;,&quot;one&quot;,&quot;two&quot;,&quot;three&quot;,&quot;four&quot;,&quot;five&quot;,&quot;six&quot;,&quot;seven&quot;,&quot;eight&quot;,&quot;nine&quot;,&quot;colon&quot;,&quot;semicolon&quot;,&quot;less&quot;,&quot;equal&quot;,&quot;greater&quot;,&quot;question&quot;,&quot;at&quot;,&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;E&quot;,&quot;F&quot;,&quot;G&quot;,&quot;H&quot;,&quot;I&quot;,&quot;J&quot;,&quot;K&quot;,&quot;L&quot;,&quot;M&quot;,&quot;N&quot;,&quot;O&quot;,&quot;P&quot;,&quot;Q&quot;,&quot;R&quot;,&quot;S&quot;,&quot;T&quot;,&quot;U&quot;,&quot;V&quot;,&quot;W&quot;,&quot;X&quot;,&quot;Y&quot;,&quot;Z&quot;,&quot;bracketleft&quot;,&quot;backslash&quot;,&quot;bracketright&quot;,&quot;asciicircum&quot;,&quot;underscore&quot;,&quot;quoteleft&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;i&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;o&quot;,&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;u&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;braceleft&quot;,&quot;bar&quot;,&quot;braceright&quot;,&quot;asciitilde&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;exclamdown&quot;,&quot;cent&quot;,&quot;sterling&quot;,&quot;fraction&quot;,&quot;yen&quot;,&quot;florin&quot;,&quot;section&quot;,&quot;currency&quot;,&quot;quotesingle&quot;,&quot;quotedblleft&quot;,&quot;guillemotleft&quot;,&quot;guilsinglleft&quot;,&quot;guilsinglright&quot;,&quot;fi&quot;,&quot;fl&quot;,&quot;&quot;,&quot;endash&quot;,&quot;dagger&quot;,&quot;daggerdbl&quot;,&quot;periodcentered&quot;,&quot;&quot;,&quot;paragraph&quot;,&quot;bullet&quot;,&quot;quotesinglbase&quot;,&quot;quotedblbase&quot;,&quot;quotedblright&quot;,&quot;guillemotright&quot;,&quot;ellipsis&quot;,&quot;perthousand&quot;,&quot;&quot;,&quot;questiondown&quot;,&quot;&quot;,&quot;grave&quot;,&quot;acute&quot;,&quot;circumflex&quot;,&quot;tilde&quot;,&quot;macron&quot;,&quot;breve&quot;,&quot;dotaccent&quot;,&quot;dieresis&quot;,&quot;&quot;,&quot;ring&quot;,&quot;cedilla&quot;,&quot;&quot;,&quot;hungarumlaut&quot;,&quot;ogonek&quot;,&quot;caron&quot;,&quot;emdash&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;AE&quot;,&quot;&quot;,&quot;ordfeminine&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;Lslash&quot;,&quot;Oslash&quot;,&quot;OE&quot;,&quot;ordmasculine&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;ae&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;dotlessi&quot;,&quot;&quot;,&quot;&quot;,&quot;lslash&quot;,&quot;oslash&quot;,&quot;oe&quot;,&quot;germandbls&quot;];var cffExpertEncoding=[&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;space&quot;,&quot;exclamsmall&quot;,&quot;Hungarumlautsmall&quot;,&quot;&quot;,&quot;dollaroldstyle&quot;,&quot;dollarsuperior&quot;,&quot;ampersandsmall&quot;,&quot;Acutesmall&quot;,&quot;parenleftsuperior&quot;,&quot;parenrightsuperior&quot;,&quot;twodotenleader&quot;,&quot;onedotenleader&quot;,&quot;comma&quot;,&quot;hyphen&quot;,&quot;period&quot;,&quot;fraction&quot;,&quot;zerooldstyle&quot;,&quot;oneoldstyle&quot;,&quot;twooldstyle&quot;,&quot;threeoldstyle&quot;,&quot;fouroldstyle&quot;,&quot;fiveoldstyle&quot;,&quot;sixoldstyle&quot;,&quot;sevenoldstyle&quot;,&quot;eightoldstyle&quot;,&quot;nineoldstyle&quot;,&quot;colon&quot;,&quot;semicolon&quot;,&quot;commasuperior&quot;,&quot;threequartersemdash&quot;,&quot;periodsuperior&quot;,&quot;questionsmall&quot;,&quot;&quot;,&quot;asuperior&quot;,&quot;bsuperior&quot;,&quot;centsuperior&quot;,&quot;dsuperior&quot;,&quot;esuperior&quot;,&quot;&quot;,&quot;&quot;,&quot;isuperior&quot;,&quot;&quot;,&quot;&quot;,&quot;lsuperior&quot;,&quot;msuperior&quot;,&quot;nsuperior&quot;,&quot;osuperior&quot;,&quot;&quot;,&quot;&quot;,&quot;rsuperior&quot;,&quot;ssuperior&quot;,&quot;tsuperior&quot;,&quot;&quot;,&quot;ff&quot;,&quot;fi&quot;,&quot;fl&quot;,&quot;ffi&quot;,&quot;ffl&quot;,&quot;parenleftinferior&quot;,&quot;&quot;,&quot;parenrightinferior&quot;,&quot;Circumflexsmall&quot;,&quot;hyphensuperior&quot;,&quot;Gravesmall&quot;,&quot;Asmall&quot;,&quot;Bsmall&quot;,&quot;Csmall&quot;,&quot;Dsmall&quot;,&quot;Esmall&quot;,&quot;Fsmall&quot;,&quot;Gsmall&quot;,&quot;Hsmall&quot;,&quot;Ismall&quot;,&quot;Jsmall&quot;,&quot;Ksmall&quot;,&quot;Lsmall&quot;,&quot;Msmall&quot;,&quot;Nsmall&quot;,&quot;Osmall&quot;,&quot;Psmall&quot;,&quot;Qsmall&quot;,&quot;Rsmall&quot;,&quot;Ssmall&quot;,&quot;Tsmall&quot;,&quot;Usmall&quot;,&quot;Vsmall&quot;,&quot;Wsmall&quot;,&quot;Xsmall&quot;,&quot;Ysmall&quot;,&quot;Zsmall&quot;,&quot;colonmonetary&quot;,&quot;onefitted&quot;,&quot;rupiah&quot;,&quot;Tildesmall&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;exclamdownsmall&quot;,&quot;centoldstyle&quot;,&quot;Lslashsmall&quot;,&quot;&quot;,&quot;&quot;,&quot;Scaronsmall&quot;,&quot;Zcaronsmall&quot;,&quot;Dieresissmall&quot;,&quot;Brevesmall&quot;,&quot;Caronsmall&quot;,&quot;&quot;,&quot;Dotaccentsmall&quot;,&quot;&quot;,&quot;&quot;,&quot;Macronsmall&quot;,&quot;&quot;,&quot;&quot;,&quot;figuredash&quot;,&quot;hypheninferior&quot;,&quot;&quot;,&quot;&quot;,&quot;Ogoneksmall&quot;,&quot;Ringsmall&quot;,&quot;Cedillasmall&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;onequarter&quot;,&quot;onehalf&quot;,&quot;threequarters&quot;,&quot;questiondownsmall&quot;,&quot;oneeighth&quot;,&quot;threeeighths&quot;,&quot;fiveeighths&quot;,&quot;seveneighths&quot;,&quot;onethird&quot;,&quot;twothirds&quot;,&quot;&quot;,&quot;&quot;,&quot;zerosuperior&quot;,&quot;onesuperior&quot;,&quot;twosuperior&quot;,&quot;threesuperior&quot;,&quot;foursuperior&quot;,&quot;fivesuperior&quot;,&quot;sixsuperior&quot;,&quot;sevensuperior&quot;,&quot;eightsuperior&quot;,&quot;ninesuperior&quot;,&quot;zeroinferior&quot;,&quot;oneinferior&quot;,&quot;twoinferior&quot;,&quot;threeinferior&quot;,&quot;fourinferior&quot;,&quot;fiveinferior&quot;,&quot;sixinferior&quot;,&quot;seveninferior&quot;,&quot;eightinferior&quot;,&quot;nineinferior&quot;,&quot;centinferior&quot;,&quot;dollarinferior&quot;,&quot;periodinferior&quot;,&quot;commainferior&quot;,&quot;Agravesmall&quot;,&quot;Aacutesmall&quot;,&quot;Acircumflexsmall&quot;,&quot;Atildesmall&quot;,&quot;Adieresissmall&quot;,&quot;Aringsmall&quot;,&quot;AEsmall&quot;,&quot;Ccedillasmall&quot;,&quot;Egravesmall&quot;,&quot;Eacutesmall&quot;,&quot;Ecircumflexsmall&quot;,&quot;Edieresissmall&quot;,&quot;Igravesmall&quot;,&quot;Iacutesmall&quot;,&quot;Icircumflexsmall&quot;,&quot;Idieresissmall&quot;,&quot;Ethsmall&quot;,&quot;Ntildesmall&quot;,&quot;Ogravesmall&quot;,&quot;Oacutesmall&quot;,&quot;Ocircumflexsmall&quot;,&quot;Otildesmall&quot;,&quot;Odieresissmall&quot;,&quot;OEsmall&quot;,&quot;Oslashsmall&quot;,&quot;Ugravesmall&quot;,&quot;Uacutesmall&quot;,&quot;Ucircumflexsmall&quot;,&quot;Udieresissmall&quot;,&quot;Yacutesmall&quot;,&quot;Thornsmall&quot;,&quot;Ydieresissmall&quot;];var standardNames=[&quot;.notdef&quot;,&quot;.null&quot;,&quot;nonmarkingreturn&quot;,&quot;space&quot;,&quot;exclam&quot;,&quot;quotedbl&quot;,&quot;numbersign&quot;,&quot;dollar&quot;,&quot;percent&quot;,&quot;ampersand&quot;,&quot;quotesingle&quot;,&quot;parenleft&quot;,&quot;parenright&quot;,&quot;asterisk&quot;,&quot;plus&quot;,&quot;comma&quot;,&quot;hyphen&quot;,&quot;period&quot;,&quot;slash&quot;,&quot;zero&quot;,&quot;one&quot;,&quot;two&quot;,&quot;three&quot;,&quot;four&quot;,&quot;five&quot;,&quot;six&quot;,&quot;seven&quot;,&quot;eight&quot;,&quot;nine&quot;,&quot;colon&quot;,&quot;semicolon&quot;,&quot;less&quot;,&quot;equal&quot;,&quot;greater&quot;,&quot;question&quot;,&quot;at&quot;,&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;E&quot;,&quot;F&quot;,&quot;G&quot;,&quot;H&quot;,&quot;I&quot;,&quot;J&quot;,&quot;K&quot;,&quot;L&quot;,&quot;M&quot;,&quot;N&quot;,&quot;O&quot;,&quot;P&quot;,&quot;Q&quot;,&quot;R&quot;,&quot;S&quot;,&quot;T&quot;,&quot;U&quot;,&quot;V&quot;,&quot;W&quot;,&quot;X&quot;,&quot;Y&quot;,&quot;Z&quot;,&quot;bracketleft&quot;,&quot;backslash&quot;,&quot;bracketright&quot;,&quot;asciicircum&quot;,&quot;underscore&quot;,&quot;grave&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;i&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;o&quot;,&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;u&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;braceleft&quot;,&quot;bar&quot;,&quot;braceright&quot;,&quot;asciitilde&quot;,&quot;Adieresis&quot;,&quot;Aring&quot;,&quot;Ccedilla&quot;,&quot;Eacute&quot;,&quot;Ntilde&quot;,&quot;Odieresis&quot;,&quot;Udieresis&quot;,&quot;aacute&quot;,&quot;agrave&quot;,&quot;acircumflex&quot;,&quot;adieresis&quot;,&quot;atilde&quot;,&quot;aring&quot;,&quot;ccedilla&quot;,&quot;eacute&quot;,&quot;egrave&quot;,&quot;ecircumflex&quot;,&quot;edieresis&quot;,&quot;iacute&quot;,&quot;igrave&quot;,&quot;icircumflex&quot;,&quot;idieresis&quot;,&quot;ntilde&quot;,&quot;oacute&quot;,&quot;ograve&quot;,&quot;ocircumflex&quot;,&quot;odieresis&quot;,&quot;otilde&quot;,&quot;uacute&quot;,&quot;ugrave&quot;,&quot;ucircumflex&quot;,&quot;udieresis&quot;,&quot;dagger&quot;,&quot;degree&quot;,&quot;cent&quot;,&quot;sterling&quot;,&quot;section&quot;,&quot;bullet&quot;,&quot;paragraph&quot;,&quot;germandbls&quot;,&quot;registered&quot;,&quot;copyright&quot;,&quot;trademark&quot;,&quot;acute&quot;,&quot;dieresis&quot;,&quot;notequal&quot;,&quot;AE&quot;,&quot;Oslash&quot;,&quot;infinity&quot;,&quot;plusminus&quot;,&quot;lessequal&quot;,&quot;greaterequal&quot;,&quot;yen&quot;,&quot;mu&quot;,&quot;partialdiff&quot;,&quot;summation&quot;,&quot;product&quot;,&quot;pi&quot;,&quot;integral&quot;,&quot;ordfeminine&quot;,&quot;ordmasculine&quot;,&quot;Omega&quot;,&quot;ae&quot;,&quot;oslash&quot;,&quot;questiondown&quot;,&quot;exclamdown&quot;,&quot;logicalnot&quot;,&quot;radical&quot;,&quot;florin&quot;,&quot;approxequal&quot;,&quot;Delta&quot;,&quot;guillemotleft&quot;,&quot;guillemotright&quot;,&quot;ellipsis&quot;,&quot;nonbreakingspace&quot;,&quot;Agrave&quot;,&quot;Atilde&quot;,&quot;Otilde&quot;,&quot;OE&quot;,&quot;oe&quot;,&quot;endash&quot;,&quot;emdash&quot;,&quot;quotedblleft&quot;,&quot;quotedblright&quot;,&quot;quoteleft&quot;,&quot;quoteright&quot;,&quot;divide&quot;,&quot;lozenge&quot;,&quot;ydieresis&quot;,&quot;Ydieresis&quot;,&quot;fraction&quot;,&quot;currency&quot;,&quot;guilsinglleft&quot;,&quot;guilsinglright&quot;,&quot;fi&quot;,&quot;fl&quot;,&quot;daggerdbl&quot;,&quot;periodcentered&quot;,&quot;quotesinglbase&quot;,&quot;quotedblbase&quot;,&quot;perthousand&quot;,&quot;Acircumflex&quot;,&quot;Ecircumflex&quot;,&quot;Aacute&quot;,&quot;Edieresis&quot;,&quot;Egrave&quot;,&quot;Iacute&quot;,&quot;Icircumflex&quot;,&quot;Idieresis&quot;,&quot;Igrave&quot;,&quot;Oacute&quot;,&quot;Ocircumflex&quot;,&quot;apple&quot;,&quot;Ograve&quot;,&quot;Uacute&quot;,&quot;Ucircumflex&quot;,&quot;Ugrave&quot;,&quot;dotlessi&quot;,&quot;circumflex&quot;,&quot;tilde&quot;,&quot;macron&quot;,&quot;breve&quot;,&quot;dotaccent&quot;,&quot;ring&quot;,&quot;cedilla&quot;,&quot;hungarumlaut&quot;,&quot;ogonek&quot;,&quot;caron&quot;,&quot;Lslash&quot;,&quot;lslash&quot;,&quot;Scaron&quot;,&quot;scaron&quot;,&quot;Zcaron&quot;,&quot;zcaron&quot;,&quot;brokenbar&quot;,&quot;Eth&quot;,&quot;eth&quot;,&quot;Yacute&quot;,&quot;yacute&quot;,&quot;Thorn&quot;,&quot;thorn&quot;,&quot;minus&quot;,&quot;multiply&quot;,&quot;onesuperior&quot;,&quot;twosuperior&quot;,&quot;threesuperior&quot;,&quot;onehalf&quot;,&quot;onequarter&quot;,&quot;threequarters&quot;,&quot;franc&quot;,&quot;Gbreve&quot;,&quot;gbreve&quot;,&quot;Idotaccent&quot;,&quot;Scedilla&quot;,&quot;scedilla&quot;,&quot;Cacute&quot;,&quot;cacute&quot;,&quot;Ccaron&quot;,&quot;ccaron&quot;,&quot;dcroat&quot;];function DefaultEncoding(font){this.font=font}DefaultEncoding.prototype.charToGlyphIndex=function(c){var code=c.charCodeAt(0);var glyphs=this.font.glyphs;if(glyphs){for(var i=0;i&lt;glyphs.length;i+=1){var glyph=glyphs.get(i);for(var j=0;j&lt;glyph.unicodes.length;j+=1){if(glyph.unicodes[j]===code){return i}}}}else{return null}};function CmapEncoding(cmap){this.cmap=cmap}CmapEncoding.prototype.charToGlyphIndex=function(c){return this.cmap.glyphIndexMap[c.charCodeAt(0)]||0};function CffEncoding(encoding,charset){this.encoding=encoding;this.charset=charset}CffEncoding.prototype.charToGlyphIndex=function(s){var code=s.charCodeAt(0);var charName=this.encoding[code];return this.charset.indexOf(charName)};function GlyphNames(post){var i;switch(post.version){case 1:this.names=opentype_standardNames.slice();break;case 2:this.names=new Array(post.numberOfGlyphs);for(i=0;i&lt;post.numberOfGlyphs;i++){if(post.glyphNameIndex[i]&lt;opentype_standardNames.length){this.names[i]=opentype_standardNames[post.glyphNameIndex[i]]}else{this.names[i]=post.names[post.glyphNameIndex[i]-opentype_standardNames.length]}}break;case 2.5:this.names=new Array(post.numberOfGlyphs);for(i=0;i&lt;post.numberOfGlyphs;i++){this.names[i]=opentype_standardNames[i+post.glyphNameIndex[i]]}break;case 3:this.names=[];break}}GlyphNames.prototype.nameToGlyphIndex=function(name){return this.names.indexOf(name)};GlyphNames.prototype.glyphIndexToName=function(gid){return this.names[gid]};function addGlyphNames(font){var glyph;var glyphIndexMap=font.tables.cmap.glyphIndexMap;var charCodes=Object.keys(glyphIndexMap);for(var i=0;i&lt;charCodes.length;i+=1){var c=charCodes[i];var glyphIndex=glyphIndexMap[c];glyph=font.glyphs.get(glyphIndex);glyph.addUnicode(parseInt(c))}for(i=0;i&lt;font.glyphs.length;i+=1){glyph=font.glyphs.get(i);if(font.cffEncoding){glyph.name=font.cffEncoding.charset[i]}else{glyph.name=font.glyphNames.glyphIndexToName(i)}}}opentype_cffStandardStrings=cffStandardStrings;opentype_cffStandardEncoding=cffStandardEncoding;opentype_cffExpertEncoding=cffExpertEncoding;opentype_standardNames=standardNames;opentype_DefaultEncoding=DefaultEncoding;opentype_CmapEncoding=CmapEncoding;opentype_CffEncoding=CffEncoding;opentype_GlyphNames=GlyphNames;opentype_addGlyphNames=addGlyphNames;function Font(options){options=options||{};if(!options.empty){util.checkArgument(options.familyName,&quot;When creating a new Font object, familyName is required.&quot;);util.checkArgument(options.styleName,&quot;When creating a new Font object, styleName is required.&quot;);util.checkArgument(options.unitsPerEm,&quot;When creating a new Font object, unitsPerEm is required.&quot;);util.checkArgument(options.ascender,&quot;When creating a new Font object, ascender is required.&quot;);util.checkArgument(options.descender,&quot;When creating a new Font object, descender is required.&quot;);util.checkArgument(options.descender&lt;0,&quot;Descender should be negative (e.g. -512).&quot;);this.names={fontFamily:{en:options.familyName||&quot; &quot;},fontSubfamily:{en:options.styleName||&quot; &quot;},fullName:{en:options.fullName||options.familyName+&quot; &quot;+options.styleName},postScriptName:{en:options.postScriptName||options.familyName+options.styleName},designer:{en:options.designer||&quot; &quot;},designerURL:{en:options.designerURL||&quot; &quot;},manufacturer:{en:options.manufacturer||&quot; &quot;},manufacturerURL:{en:options.manufacturerURL||&quot; &quot;},license:{en:options.license||&quot; &quot;},licenseURL:{en:options.licenseURL||&quot; &quot;},version:{en:options.version||&quot;Version 0.1&quot;},description:{en:options.description||&quot; &quot;},copyright:{en:options.copyright||&quot; &quot;},trademark:{en:options.trademark||&quot; &quot;}};this.unitsPerEm=options.unitsPerEm||1e3;this.ascender=options.ascender;this.descender=options.descender}this.supported=true;this.glyphs=new GlyphSet(this,options.glyphs||[]);this.encoding=new DefaultEncoding(this);this.tables={}}Font.prototype.hasChar=function(c){return this.encoding.charToGlyphIndex(c)!==null};Font.prototype.charToGlyphIndex=function(s){return this.encoding.charToGlyphIndex(s)};Font.prototype.charToGlyph=function(c){var glyphIndex=this.charToGlyphIndex(c);var glyph=this.glyphs.get(glyphIndex);if(!glyph){glyph=this.glyphs.get(0)}return glyph};Font.prototype.stringToGlyphs=function(s){var glyphs=[];for(var i=0;i&lt;s.length;i+=1){var c=s[i];glyphs.push(this.charToGlyph(c))}return glyphs};Font.prototype.nameToGlyphIndex=function(name){return this.glyphNames.nameToGlyphIndex(name)};Font.prototype.nameToGlyph=function(name){var glyphIndex=this.nametoGlyphIndex(name);var glyph=this.glyphs.get(glyphIndex);if(!glyph){glyph=this.glyphs.get(0)}return glyph};Font.prototype.glyphIndexToName=function(gid){if(!this.glyphNames.glyphIndexToName){return&quot;&quot;}return this.glyphNames.glyphIndexToName(gid)};Font.prototype.getKerningValue=function(leftGlyph,rightGlyph){leftGlyph=leftGlyph.index||leftGlyph;</td>
      </tr>
      <tr>
        <td id="L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="LC3" class="blob-code blob-code-inner js-file-line">rightGlyph=rightGlyph.index||rightGlyph;var gposKerning=this.getGposKerningValue;return gposKerning?gposKerning(leftGlyph,rightGlyph):this.kerningPairs[leftGlyph+&quot;,&quot;+rightGlyph]||0};Font.prototype.forEachGlyph=function(text,x,y,fontSize,options,callback){x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:72;options=options||{};var kerning=options.kerning===undefined?true:options.kerning;var fontScale=1/this.unitsPerEm*fontSize;var glyphs=this.stringToGlyphs(text);for(var i=0;i&lt;glyphs.length;i+=1){var glyph=glyphs[i];callback(glyph,x,y,fontSize,options);if(glyph.advanceWidth){x+=glyph.advanceWidth*fontScale}if(kerning&amp;&amp;i&lt;glyphs.length-1){var kerningValue=this.getKerningValue(glyph,glyphs[i+1]);x+=kerningValue*fontScale}}};Font.prototype.getPath=function(text,x,y,fontSize,options){var fullPath=new Path;this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){var glyphPath=glyph.getPath(gX,gY,gFontSize);fullPath.extend(glyphPath)});return fullPath};Font.prototype.getPaths=function(text,x,y,fontSize,options){var glyphPaths=[];this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){var glyphPath=glyph.getPath(gX,gY,gFontSize);glyphPaths.push(glyphPath)});return glyphPaths};Font.prototype.draw=function(ctx,text,x,y,fontSize,options){this.getPath(text,x,y,fontSize,options).draw(ctx)};Font.prototype.drawPoints=function(ctx,text,x,y,fontSize,options){this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){glyph.drawPoints(ctx,gX,gY,gFontSize)})};Font.prototype.drawMetrics=function(ctx,text,x,y,fontSize,options){this.forEachGlyph(text,x,y,fontSize,options,function(glyph,gX,gY,gFontSize){glyph.drawMetrics(ctx,gX,gY,gFontSize)})};Font.prototype.getEnglishName=function(name){var translations=this.names[name];if(translations){return translations.en}};Font.prototype.validate=function(){var warnings=[];var _this=this;function assert(predicate,message){if(!predicate){warnings.push(message)}}function assertNamePresent(name){var englishName=_this.getEnglishName(name);assert(englishName&amp;&amp;englishName.trim().length&gt;0,&quot;No English &quot;+name+&quot; specified.&quot;)}assertNamePresent(&quot;fontFamily&quot;);assertNamePresent(&quot;weightName&quot;);assertNamePresent(&quot;manufacturer&quot;);assertNamePresent(&quot;copyright&quot;);assertNamePresent(&quot;version&quot;);assert(this.unitsPerEm&gt;0,&quot;No unitsPerEm specified.&quot;)};Font.prototype.toTables=function(){return sfnt.fontToTable(this)};Font.prototype.toBuffer=function(){console.warn(&quot;Font.toBuffer is deprecated. Use Font.toArrayBuffer instead.&quot;);return this.toArrayBuffer()};Font.prototype.toArrayBuffer=function(){var sfntTable=this.toTables();var bytes=sfntTable.encode();var buffer=new ArrayBuffer(bytes.length);var intArray=new Uint8Array(buffer);for(var i=0;i&lt;bytes.length;i++){intArray[i]=bytes[i]}return buffer};Font.prototype.download=function(){var familyName=this.getEnglishName(&quot;fontFamily&quot;);var styleName=this.getEnglishName(&quot;fontSubfamily&quot;);var fileName=familyName.replace(/\s/g,&quot;&quot;)+&quot;-&quot;+styleName+&quot;.otf&quot;;var arrayBuffer=this.toArrayBuffer();if(util.isBrowser()){window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;window.requestFileSystem(window.TEMPORARY,arrayBuffer.byteLength,function(fs){fs.root.getFile(fileName,{create:true},function(fileEntry){fileEntry.createWriter(function(writer){var dataView=new DataView(arrayBuffer);var blob=new Blob([dataView],{type:&quot;font/opentype&quot;});writer.write(blob);writer.addEventListener(&quot;writeend&quot;,function(){location.href=fileEntry.toURL()},false)})})},function(err){throw err})}else{var fs=require(&quot;fs&quot;);var buffer=util.arrayBufferToNodeBuffer(arrayBuffer);fs.writeFileSync(fileName,buffer)}};function getPathDefinition(glyph,path){var _path=path||{commands:[]};return{configurable:true,get:function(){if(typeof _path===&quot;function&quot;){_path=_path()}return _path},set:function(p){_path=p}}}function Glyph(options){this.bindConstructorValues(options)}Glyph.prototype.bindConstructorValues=function(options){this.index=options.index||0;this.name=options.name||null;this.unicode=options.unicode||undefined;this.unicodes=options.unicodes||options.unicode!==undefined?[options.unicode]:[];if(options.xMin){this.xMin=options.xMin}if(options.yMin){this.yMin=options.yMin}if(options.xMax){this.xMax=options.xMax}if(options.yMax){this.yMax=options.yMax}if(options.advanceWidth){this.advanceWidth=options.advanceWidth}Object.defineProperty(this,&quot;path&quot;,getPathDefinition(this,options.path))};Glyph.prototype.addUnicode=function(unicode){if(this.unicodes.length===0){this.unicode=unicode}this.unicodes.push(unicode)};Glyph.prototype.getPath=function(x,y,fontSize,options){x=x!==undefined?x:0;y=y!==undefined?y:0;options=options!==undefined?options:{xScale:1,yScale:1};fontSize=fontSize!==undefined?fontSize:72;var scale=1/this.path.unitsPerEm*fontSize;var xScale=options.xScale*scale;var yScale=options.yScale*scale;var p=new Path;var commands=this.path.commands;for(var i=0;i&lt;commands.length;i+=1){var cmd=commands[i];if(cmd.type===&quot;M&quot;){p.moveTo(x+cmd.x*xScale,y+-cmd.y*yScale)}else if(cmd.type===&quot;L&quot;){p.lineTo(x+cmd.x*xScale,y+-cmd.y*yScale)}else if(cmd.type===&quot;Q&quot;){p.quadraticCurveTo(x+cmd.x1*xScale,y+-cmd.y1*yScale,x+cmd.x*xScale,y+-cmd.y*yScale)}else if(cmd.type===&quot;C&quot;){p.curveTo(x+cmd.x1*xScale,y+-cmd.y1*yScale,x+cmd.x2*xScale,y+-cmd.y2*yScale,x+cmd.x*xScale,y+-cmd.y*yScale)}else if(cmd.type===&quot;Z&quot;){p.closePath()}}return p};Glyph.prototype.getContours=function(){if(this.points===undefined){return[]}var contours=[];var currentContour=[];for(var i=0;i&lt;this.points.length;i+=1){var pt=this.points[i];currentContour.push(pt);if(pt.lastPointOfContour){contours.push(currentContour);currentContour=[]}}assert(currentContour.length===0,&quot;There are still points left in the current contour.&quot;);return contours};Glyph.prototype.getMetrics=function(){var commands=this.path.commands;var xCoords=[];var yCoords=[];for(var i=0;i&lt;commands.length;i+=1){var cmd=commands[i];if(cmd.type!==&quot;Z&quot;){xCoords.push(cmd.x);yCoords.push(cmd.y)}if(cmd.type===&quot;Q&quot;||cmd.type===&quot;C&quot;){xCoords.push(cmd.x1);yCoords.push(cmd.y1)}if(cmd.type===&quot;C&quot;){xCoords.push(cmd.x2);yCoords.push(cmd.y2)}}var metrics={xMin:Math.min.apply(null,xCoords),yMin:Math.min.apply(null,yCoords),xMax:Math.max.apply(null,xCoords),yMax:Math.max.apply(null,yCoords),leftSideBearing:this.leftSideBearing};if(!isFinite(metrics.xMin)){metrics.xMin=0}if(!isFinite(metrics.xMax)){metrics.xMax=this.advanceWidth}if(!isFinite(metrics.yMin)){metrics.yMin=0}if(!isFinite(metrics.yMax)){metrics.yMax=0}metrics.rightSideBearing=this.advanceWidth-metrics.leftSideBearing-(metrics.xMax-metrics.xMin);return metrics};Glyph.prototype.draw=function(ctx,x,y,fontSize,options){this.getPath(x,y,fontSize,options).draw(ctx)};Glyph.prototype.drawPoints=function(ctx,x,y,fontSize){function drawCircles(l,x,y,scale){var PI_SQ=Math.PI*2;ctx.beginPath();for(var j=0;j&lt;l.length;j+=1){ctx.moveTo(x+l[j].x*scale,y+l[j].y*scale);ctx.arc(x+l[j].x*scale,y+l[j].y*scale,2,0,PI_SQ,false)}ctx.closePath();ctx.fill()}x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:24;var scale=1/this.path.unitsPerEm*fontSize;var blueCircles=[];var redCircles=[];var path=this.path;for(var i=0;i&lt;path.commands.length;i+=1){var cmd=path.commands[i];if(cmd.x!==undefined){blueCircles.push({x:cmd.x,y:-cmd.y})}if(cmd.x1!==undefined){redCircles.push({x:cmd.x1,y:-cmd.y1})}if(cmd.x2!==undefined){redCircles.push({x:cmd.x2,y:-cmd.y2})}}ctx.fillStyle=&quot;blue&quot;;drawCircles(blueCircles,x,y,scale);ctx.fillStyle=&quot;red&quot;;drawCircles(redCircles,x,y,scale)};Glyph.prototype.drawMetrics=function(ctx,x,y,fontSize){var scale;x=x!==undefined?x:0;y=y!==undefined?y:0;fontSize=fontSize!==undefined?fontSize:24;scale=1/this.path.unitsPerEm*fontSize;ctx.lineWidth=1;ctx.strokeStyle=&quot;black&quot;;draw.line(ctx,x,-1e4,x,1e4);draw.line(ctx,-1e4,y,1e4,y);var xMin=this.xMin||0;var yMin=this.yMin||0;var xMax=this.xMax||0;var yMax=this.yMax||0;var advanceWidth=this.advanceWidth||0;ctx.strokeStyle=&quot;blue&quot;;draw.line(ctx,x+xMin*scale,-1e4,x+xMin*scale,1e4);draw.line(ctx,x+xMax*scale,-1e4,x+xMax*scale,1e4);draw.line(ctx,-1e4,y+-yMin*scale,1e4,y+-yMin*scale);draw.line(ctx,-1e4,y+-yMax*scale,1e4,y+-yMax*scale);ctx.strokeStyle=&quot;green&quot;;draw.line(ctx,x+advanceWidth*scale,-1e4,x+advanceWidth*scale,1e4)};function GlyphSet(font,glyphs){this.font=font;this.glyphs={};if(Array.isArray(glyphs)){for(var i=0;i&lt;glyphs.length;i++){this.glyphs[i]=glyphs[i]}}this.length=glyphs&amp;&amp;glyphs.length||0}GlyphSet.prototype.get=function(index){if(typeof this.glyphs[index]===&quot;function&quot;){this.glyphs[index]=this.glyphs[index]()}return this.glyphs[index]};GlyphSet.prototype.push=function(index,loader){this.glyphs[index]=loader;this.length++};function glyphLoader(font,index){return new Glyph({index:index,font:font})}function ttfGlyphLoader(font,index,parseGlyph,data,position,buildPath){return function(){var glyph=new Glyph({index:index,font:font});glyph.path=function(){parseGlyph(glyph,data,position);var path=buildPath(font.glyphs,glyph);path.unitsPerEm=font.unitsPerEm;return path};return glyph}}function cffGlyphLoader(font,index,parseCFFCharstring,charstring){return function(){var glyph=new Glyph({index:index,font:font});glyph.path=function(){var path=parseCFFCharstring(font,glyph,charstring);path.unitsPerEm=font.unitsPerEm;return path};return glyph}}function loadFromFile(path,callback){var fs=require(&quot;fs&quot;);fs.readFile(path,function(err,buffer){if(err){return callback(err.message)}callback(null,util.nodeBufferToArrayBuffer(buffer))})}function loadFromUrl(url,callback){var request=new XMLHttpRequest;request.open(&quot;get&quot;,url,true);request.responseType=&quot;arraybuffer&quot;;request.onload=function(){if(request.status!==200){return callback(&quot;Font could not be loaded: &quot;+request.statusText)}return callback(null,request.response)};request.send()}function parseOpenTypeTableEntries(data,numTables){var tableEntries=[];var p=12;for(var i=0;i&lt;numTables;i+=1){var tag=getTag(data,p);var checksum=getULong(data,p+4);var offset=getULong(data,p+8);var length=getULong(data,p+12);tableEntries.push({tag:tag,checksum:checksum,offset:offset,length:length,compression:false});p+=16}return tableEntries}function parseWOFFTableEntries(data,numTables){var tableEntries=[];var p=44;for(var i=0;i&lt;numTables;i+=1){var tag=getTag(data,p);var offset=getULong(data,p+4);var compLength=getULong(data,p+8);var origLength=getULong(data,p+12);var compression;if(compLength&lt;origLength){compression=&quot;WOFF&quot;}else{compression=false}tableEntries.push({tag:tag,offset:offset,compression:compression,compressedLength:compLength,originalLength:origLength});p+=20}return tableEntries}function uncompressTable(data,tableEntry){if(tableEntry.compression===&quot;WOFF&quot;){var inBuffer=new Uint8Array(data.buffer,tableEntry.offset+2,tableEntry.compressedLength-2);var outBuffer=new Uint8Array(tableEntry.originalLength);inflate(inBuffer,outBuffer);if(outBuffer.byteLength!==tableEntry.originalLength){throw new Error(&quot;Decompression error: &quot;+tableEntry.tag+&quot; decompressed length doesn&#39;t match recorded length&quot;)}var view=new DataView(outBuffer.buffer,0);return{data:view,offset:0}}else{return{data:data,offset:tableEntry.offset}}}function parseBuffer(buffer){var indexToLocFormat;var ltagTable;var font=new Font({empty:true});var data=new DataView(buffer,0);var numTables;var tableEntries=[];var signature=getTag(data,0);if(signature===String.fromCharCode(0,1,0,0)){font.outlinesFormat=&quot;truetype&quot;;numTables=getUShort(data,4);tableEntries=parseOpenTypeTableEntries(data,numTables)}else if(signature===&quot;OTTO&quot;){font.outlinesFormat=&quot;cff&quot;;numTables=getUShort(data,4);tableEntries=parseOpenTypeTableEntries(data,numTables)}else if(signature===&quot;wOFF&quot;){var flavor=getTag(data,4);if(flavor===String.fromCharCode(0,1,0,0)){font.outlinesFormat=&quot;truetype&quot;}else if(flavor===&quot;OTTO&quot;){font.outlinesFormat=&quot;cff&quot;}else{throw new Error(&quot;Unsupported OpenType flavor &quot;+signature)}numTables=getUShort(data,12);tableEntries=parseWOFFTableEntries(data,numTables)}else{throw new Error(&quot;Unsupported OpenType signature &quot;+signature)}var cffTableEntry;var fvarTableEntry;var glyfTableEntry;var gposTableEntry;var hmtxTableEntry;var kernTableEntry;var locaTableEntry;var nameTableEntry;for(var i=0;i&lt;numTables;i+=1){var tableEntry=tableEntries[i];var table;switch(tableEntry.tag){case&quot;cmap&quot;:table=uncompressTable(data,tableEntry);font.tables.cmap=parseCmapTable(table.data,table.offset);font.encoding=new CmapEncoding(font.tables.cmap);break;case&quot;fvar&quot;:fvarTableEntry=tableEntry;break;case&quot;head&quot;:table=uncompressTable(data,tableEntry);font.tables.head=parseHeadTable(table.data,table.offset);font.unitsPerEm=font.tables.head.unitsPerEm;indexToLocFormat=font.tables.head.indexToLocFormat;break;case&quot;hhea&quot;:table=uncompressTable(data,tableEntry);font.tables.hhea=parseHheaTable(table.data,table.offset);font.ascender=font.tables.hhea.ascender;font.descender=font.tables.hhea.descender;font.numberOfHMetrics=font.tables.hhea.numberOfHMetrics;break;case&quot;hmtx&quot;:hmtxTableEntry=tableEntry;break;case&quot;ltag&quot;:table=uncompressTable(data,tableEntry);ltagTable=ltag.parse(table.data,table.offset);break;case&quot;maxp&quot;:table=uncompressTable(data,tableEntry);font.tables.maxp=parseMaxpTable(table.data,table.offset);font.numGlyphs=font.tables.maxp.numGlyphs;break;case&quot;name&quot;:nameTableEntry=tableEntry;break;case&quot;OS/2&quot;:table=uncompressTable(data,tableEntry);font.tables.os2=parseOS2Table(table.data,table.offset);break;case&quot;post&quot;:table=uncompressTable(data,tableEntry);font.tables.post=parsePostTable(table.data,table.offset);font.glyphNames=new GlyphNames(font.tables.post);break;case&quot;glyf&quot;:glyfTableEntry=tableEntry;break;case&quot;loca&quot;:locaTableEntry=tableEntry;break;case&quot;CFF &quot;:cffTableEntry=tableEntry;break;case&quot;kern&quot;:kernTableEntry=tableEntry;break;case&quot;GPOS&quot;:gposTableEntry=tableEntry;break}}var nameTable=uncompressTable(data,nameTableEntry);font.tables.name=parseNameTable(nameTable.data,nameTable.offset,ltagTable);font.names=font.tables.name;if(glyfTableEntry&amp;&amp;locaTableEntry){var shortVersion=indexToLocFormat===0;var locaTable=uncompressTable(data,locaTableEntry);var locaOffsets=parseLocaTable(locaTable.data,locaTable.offset,font.numGlyphs,shortVersion);var glyfTable=uncompressTable(data,glyfTableEntry);font.glyphs=parseGlyfTable(glyfTable.data,glyfTable.offset,locaOffsets,font)}else if(cffTableEntry){var cffTable=uncompressTable(data,cffTableEntry);parseCFFTable(cffTable.data,cffTable.offset,font)}else{throw new Error(&quot;Font doesn&#39;t contain TrueType or CFF outlines.&quot;)}var hmtxTable=uncompressTable(data,hmtxTableEntry);parseHmtxTable(hmtxTable.data,hmtxTable.offset,font.numberOfHMetrics,font.numGlyphs,font.glyphs);addGlyphNames(font);if(kernTableEntry){var kernTable=uncompressTable(data,kernTableEntry);font.kerningPairs=kern.parse(kernTable.data,kernTable.offset)}else{font.kerningPairs={}}if(gposTableEntry){var gposTable=uncompressTable(data,gposTableEntry);parseGposTable(gposTable.data,gposTable.offset,font)}if(fvarTableEntry){var fvarTable=uncompressTable(data,fvarTableEntry);font.tables.fvar=fvar.parse(fvarTable.data,fvarTable.offset,font.names)}return font}function opentype_load(url,callback){var isNode=typeof window===&quot;undefined&quot;;var loadFn=isNode?loadFromFile:loadFromUrl;loadFn(url,function(err,arrayBuffer){if(err){return callback(err)}var font;try{font=parseBuffer(arrayBuffer)}catch(e){return callback(e,null)}return callback(null,font)})}function loadSync(url){console.log(&quot;loadSync&quot;);var fs=require(&quot;fs&quot;);console.log(&quot;after fs=require(&#39;fs&#39;)&quot;);var buffer=fs.readFileSync(url);console.log(&quot;after s.readFileSync(url)&quot;);return parseBuffer(util.nodeBufferToArrayBuffer(buffer))}getByte=function getByte(dataView,offset){return dataView.getUint8(offset)};getCard8=getByte;getUShort=function(dataView,offset){return dataView.getUint16(offset,false)};getCard16=getUShort;getShort=function(dataView,offset){return dataView.getInt16(offset,false)};getULong=function(dataView,offset){return dataView.getUint32(offset,false)};getFixed=function(dataView,offset){var decimal=dataView.getInt16(offset,false);var fraction=dataView.getUint16(offset+2,false);return decimal+fraction/65535};getTag=function(dataView,offset){var tag=&quot;&quot;;for(var i=offset;i&lt;offset+4;i+=1){tag+=String.fromCharCode(dataView.getInt8(i))}return tag};getOffset=function(dataView,offset,offSize){var v=0;for(var i=0;i&lt;offSize;i+=1){v&lt;&lt;=8;v+=dataView.getUint8(offset+i)}return v};getBytes=function(dataView,startOffset,endOffset){var bytes=[];for(var i=startOffset;i&lt;endOffset;i+=1){bytes.push(dataView.getUint8(i))}return bytes};bytesToString=function(bytes){var s=&quot;&quot;;for(var i=0;i&lt;bytes.length;i+=1){s+=String.fromCharCode(bytes[i])}return s};var typeOffsets={&quot;byte&quot;:1,uShort:2,&quot;short&quot;:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(data,offset){this.data=data;this.offset=offset;this.relativeOffset=0}Parser.prototype.parseByte=function(){var v=this.data.getUint8(this.offset+this.relativeOffset);this.relativeOffset+=1;return v};Parser.prototype.parseChar=function(){var v=this.data.getInt8(this.offset+this.relativeOffset);this.relativeOffset+=1;return v};Parser.prototype.parseCard8=Parser.prototype.parseByte;Parser.prototype.parseUShort=function(){var v=this.data.getUint16(this.offset+this.relativeOffset);this.relativeOffset+=2;return v};Parser.prototype.parseCard16=Parser.prototype.parseUShort;Parser.prototype.parseSID=Parser.prototype.parseUShort;Parser.prototype.parseOffset16=Parser.prototype.parseUShort;Parser.prototype.parseShort=function(){var v=this.data.getInt16(this.offset+this.relativeOffset);this.relativeOffset+=2;return v};Parser.prototype.parseF2Dot14=function(){var v=this.data.getInt16(this.offset+this.relativeOffset)/16384;this.relativeOffset+=2;return v};Parser.prototype.parseULong=function(){var v=getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v};Parser.prototype.parseFixed=function(){var v=getFixed(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v};Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(count){var offsets=new Array(count);var dataView=this.data;var offset=this.offset+this.relativeOffset;for(var i=0;i&lt;count;i++){offsets[i]=getUShort(dataView,offset);offset+=2}this.relativeOffset+=count*2;return offsets};Parser.prototype.parseString=function(length){var dataView=this.data;var offset=this.offset+this.relativeOffset;var string=&quot;&quot;;this.relativeOffset+=length;for(var i=0;i&lt;length;i++){string+=String.fromCharCode(dataView.getUint8(offset+i))}return string};Parser.prototype.parseTag=function(){return this.parseString(4)};Parser.prototype.parseLongDateTime=function(){var v=getULong(this.data,this.offset+this.relativeOffset+4);this.relativeOffset+=8;return v};Parser.prototype.parseFixed=function(){var v=getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return v/65536};Parser.prototype.parseVersion=function(){var major=getUShort(this.data,this.offset+this.relativeOffset);var minor=getUShort(this.data,this.offset+this.relativeOffset+2);this.relativeOffset+=4;return major+minor/4096/10};Parser.prototype.skip=function(type,amount){if(amount===undefined){amount=1}this.relativeOffset+=typeOffsets[type]*amount};&quot;use strict&quot;;function Path(){this.commands=[];this.fill=&quot;black&quot;;this.stroke=null;this.strokeWidth=1}Path.prototype.moveTo=function(x,y){this.commands.push({type:&quot;M&quot;,x:x,y:y})};Path.prototype.lineTo=function(x,y){this.commands.push({type:&quot;L&quot;,x:x,y:y})};Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(x1,y1,x2,y2,x,y){this.commands.push({type:&quot;C&quot;,x1:x1,y1:y1,x2:x2,y2:y2,x:x,y:y})};Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(x1,y1,x,y){this.commands.push({type:&quot;Q&quot;,x1:x1,y1:y1,x:x,y:y})};Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:&quot;Z&quot;})};Path.prototype.extend=function(pathOrCommands){if(pathOrCommands.commands){pathOrCommands=pathOrCommands.commands}Array.prototype.push.apply(this.commands,pathOrCommands)};Path.prototype.draw=function(ctx){ctx.beginPath();for(var i=0;i&lt;this.commands.length;i+=1){var cmd=this.commands[i];if(cmd.type===&quot;M&quot;){ctx.moveTo(cmd.x,cmd.y)}else if(cmd.type===&quot;L&quot;){ctx.lineTo(cmd.x,cmd.y)}else if(cmd.type===&quot;C&quot;){ctx.bezierCurveTo(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type===&quot;Q&quot;){ctx.quadraticCurveTo(cmd.x1,cmd.y1,cmd.x,cmd.y)}else if(cmd.type===&quot;Z&quot;){ctx.closePath()}}if(this.fill){ctx.fillStyle=this.fill;ctx.fill()}if(this.stroke){ctx.strokeStyle=this.stroke;ctx.lineWidth=this.strokeWidth;ctx.stroke()}};Path.prototype.toPathData=function(decimalPlaces){decimalPlaces=decimalPlaces!==undefined?decimalPlaces:2;function floatToString(v){if(Math.round(v)===v){return&quot;&quot;+Math.round(v)}else{return v.toFixed(decimalPlaces)}}function packValues(){var s=&quot;&quot;;for(var i=0;i&lt;arguments.length;i+=1){var v=arguments[i];if(v&gt;=0&amp;&amp;i&gt;0){s+=&quot; &quot;}s+=floatToString(v)}return s}var d=&quot;&quot;;for(var i=0;i&lt;this.commands.length;i+=1){var cmd=this.commands[i];if(cmd.type===&quot;M&quot;){d+=&quot;M&quot;+packValues(cmd.x,cmd.y)}else if(cmd.type===&quot;L&quot;){d+=&quot;L&quot;+packValues(cmd.x,cmd.y)}else if(cmd.type===&quot;C&quot;){d+=&quot;C&quot;+packValues(cmd.x1,cmd.y1,cmd.x2,cmd.y2,cmd.x,cmd.y)}else if(cmd.type===&quot;Q&quot;){d+=&quot;Q&quot;+packValues(cmd.x1,cmd.y1,cmd.x,cmd.y)}else if(cmd.type===&quot;Z&quot;){d+=&quot;Z&quot;}}return d};Path.prototype.toSVG=function(decimalPlaces){var svg=&#39;&lt;path d=&quot;&#39;;svg+=this.toPathData(decimalPlaces);svg+=&#39;&quot;&#39;;if(this.fill&amp;this.fill!==&quot;black&quot;){if(this.fill===null){svg+=&#39; fill=&quot;none&quot;&#39;}else{svg+=&#39; fill=&quot;&#39;+this.fill+&#39;&quot;&#39;}}if(this.stroke){svg+=&#39; stroke=&quot;&#39;+this.stroke+&#39;&quot; stroke-width=&quot;&#39;+this.strokeWidth+&#39;&quot;&#39;}svg+=&quot;/&gt;&quot;;return svg};function Table(tableName,fields,options){var i;for(i=0;i&lt;fields.length;i+=1){var field=fields[i];this[field.name]=field.value}this.tableName=tableName;this.fields=fields;if(options){var optionKeys=Object.keys(options);for(i=0;i&lt;optionKeys.length;i+=1){var k=optionKeys[i];var v=options[k];if(this[k]!==undefined){this[k]=v}}}}Table.prototype.encode=function(){return encode.TABLE(this)};Table.prototype.sizeOf=function(){return sizeOf.TABLE(this)};function equals(a,b){if(a===b){return true}else if(Array.isArray(a)&amp;&amp;Array.isArray(b)){if(a.length!==b.length){return false}for(var i=0;i&lt;a.length;i+=1){if(!equals(a[i],b[i])){return false}}return true}else{return false}}function parseCFFIndex(data,start,conversionFn){var offsets=[];var objects=[];var count=getCard16(data,start);var i;var objectOffset;var endOffset;if(count!==0){var offsetSize=getByte(data,start+2);objectOffset=start+(count+1)*offsetSize+2;var pos=start+3;for(i=0;i&lt;count+1;i+=1){offsets.push(getOffset(data,pos,offsetSize));pos+=offsetSize}endOffset=objectOffset+offsets[count]}else{endOffset=start+2}for(i=0;i&lt;offsets.length-1;i+=1){var value=getBytes(data,objectOffset+offsets[i],objectOffset+offsets[i+1]);if(conversionFn){value=conversionFn(value)}objects.push(value)}return{objects:objects,startOffset:start,endOffset:endOffset}}function parseFloatOperand(parser){var s=&quot;&quot;;var eof=15;var lookup=[&quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;.&quot;,&quot;E&quot;,&quot;E-&quot;,null,&quot;-&quot;];while(true){var b=parser.parseByte();var n1=b&gt;&gt;4;var n2=b&amp;15;if(n1===eof){break}s+=lookup[n1];if(n2===eof){break}s+=lookup[n2]}return parseFloat(s)}function parseOperand(parser,b0){var b1;var b2;var b3;var b4;if(b0===28){b1=parser.parseByte();b2=parser.parseByte();return b1&lt;&lt;8|b2}if(b0===29){b1=parser.parseByte();b2=parser.parseByte();b3=parser.parseByte();b4=parser.parseByte();return b1&lt;&lt;24|b2&lt;&lt;16|b3&lt;&lt;8|b4}if(b0===30){return parseFloatOperand(parser)}if(b0&gt;=32&amp;&amp;b0&lt;=246){return b0-139}if(b0&gt;=247&amp;&amp;b0&lt;=250){b1=parser.parseByte();return(b0-247)*256+b1+108}if(b0&gt;=251&amp;&amp;b0&lt;=254){b1=parser.parseByte();return-(b0-251)*256-b1-108}throw new Error(&quot;Invalid b0 &quot;+b0)}function entriesToObject(entries){var o={};for(var i=0;i&lt;entries.length;i+=1){var key=entries[i][0];var values=entries[i][1];var value;if(values.length===1){value=values[0]}else{value=values}if(o.hasOwnProperty(key)){throw new Error(&quot;Object &quot;+o+&quot; already has key &quot;+key)}o[key]=value}return o}function parseCFFDict(data,start,size){start=start!==undefined?start:0;var parser=new Parser(data,start);var entries=[];var operands=[];size=size!==undefined?size:data.length;while(parser.relativeOffset&lt;size){var op=parser.parseByte();if(op&lt;=21){if(op===12){op=1200+parser.parseByte()}entries.push([op,operands]);operands=[]}else{operands.push(parseOperand(parser,op))}}return entriesToObject(entries)}function getCFFString(strings,index){if(index&lt;=390){index=cffStandardStrings[index]}else{index=strings[index-391]}return index}function interpretDict(dict,meta,strings){var newDict={};for(var i=0;i&lt;meta.length;i+=1){var m=meta[i];var value=dict[m.op];if(value===undefined){value=m.value!==undefined?m.value:null}if(m.type===&quot;SID&quot;){value=getCFFString(strings,value)}newDict[m.name]=value}return newDict}function parseCFFHeader(data,start){var header={};header.formatMajor=getCard8(data,start);header.formatMinor=getCard8(data,start+1);header.size=getCard8(data,start+2);header.offsetSize=getCard8(data,start+3);header.startOffset=start;header.endOffset=start+4;return header}var TOP_DICT_META=[{name:&quot;version&quot;,op:0,type:&quot;SID&quot;},{name:&quot;notice&quot;,op:1,type:&quot;SID&quot;},{name:&quot;copyright&quot;,op:1200,type:&quot;SID&quot;},{name:&quot;fullName&quot;,op:2,type:&quot;SID&quot;},{name:&quot;familyName&quot;,op:3,type:&quot;SID&quot;},{name:&quot;weight&quot;,op:4,type:&quot;SID&quot;},{name:&quot;isFixedPitch&quot;,op:1201,type:&quot;number&quot;,value:0},{name:&quot;italicAngle&quot;,op:1202,type:&quot;number&quot;,value:0},{name:&quot;underlinePosition&quot;,op:1203,type:&quot;number&quot;,value:-100},{name:&quot;underlineThickness&quot;,op:1204,type:&quot;number&quot;,value:50},{name:&quot;paintType&quot;,op:1205,type:&quot;number&quot;,value:0},{name:&quot;charstringType&quot;,op:1206,type:&quot;number&quot;,value:2},{name:&quot;fontMatrix&quot;,op:1207,type:[&quot;real&quot;,&quot;real&quot;,&quot;real&quot;,&quot;real&quot;,&quot;real&quot;,&quot;real&quot;],value:[.001,0,0,.001,0,0]},{name:&quot;uniqueId&quot;,op:13,type:&quot;number&quot;},{name:&quot;fontBBox&quot;,op:5,type:[&quot;number&quot;,&quot;number&quot;,&quot;number&quot;,&quot;number&quot;],value:[0,0,0,0]},{name:&quot;strokeWidth&quot;,op:1208,type:&quot;number&quot;,value:0},{name:&quot;xuid&quot;,op:14,type:[],value:null},{name:&quot;charset&quot;,op:15,type:&quot;offset&quot;,value:0},{name:&quot;encoding&quot;,op:16,type:&quot;offset&quot;,value:0},{name:&quot;charStrings&quot;,op:17,type:&quot;offset&quot;,value:0},{name:&quot;private&quot;,op:18,type:[&quot;number&quot;,&quot;offset&quot;],value:[0,0]}];var PRIVATE_DICT_META=[{name:&quot;subrs&quot;,op:19,type:&quot;offset&quot;,value:0},{name:&quot;defaultWidthX&quot;,op:20,type:&quot;number&quot;,value:0},{name:&quot;nominalWidthX&quot;,op:21,type:&quot;number&quot;,value:0}];function parseCFFTopDict(data,strings){var dict=parseCFFDict(data,0,data.byteLength);return interpretDict(dict,TOP_DICT_META,strings)}function parseCFFPrivateDict(data,start,size,strings){var dict=parseCFFDict(data,start,size);return interpretDict(dict,PRIVATE_DICT_META,strings)}function parseCFFCharset(data,start,nGlyphs,strings){var i;var sid;var count;var parser=new Parser(data,start);nGlyphs-=1;var charset=[&quot;.notdef&quot;];var format=parser.parseCard8();if(format===0){for(i=0;i&lt;nGlyphs;i+=1){sid=parser.parseSID();charset.push(getCFFString(strings,sid))}}else if(format===1){while(charset.length&lt;=nGlyphs){sid=parser.parseSID();count=parser.parseCard8();for(i=0;i&lt;=count;i+=1){charset.push(getCFFString(strings,sid));sid+=1}}}else if(format===2){while(charset.length&lt;=nGlyphs){sid=parser.parseSID();count=parser.parseCard16();for(i=0;i&lt;=count;i+=1){charset.push(getCFFString(strings,sid));sid+=1}}}else{throw new Error(&quot;Unknown charset format &quot;+format)}return charset}function parseCFFEncoding(data,start,charset){var i;var code;var enc={};var parser=new Parser(data,start);var format=parser.parseCard8();if(format===0){var nCodes=parser.parseCard8();for(i=0;i&lt;nCodes;i+=1){code=parser.parseCard8();enc[code]=i}}else if(format===1){var nRanges=parser.parseCard8();code=1;for(i=0;i&lt;nRanges;i+=1){var first=parser.parseCard8();var nLeft=parser.parseCard8();for(var j=first;j&lt;=first+nLeft;j+=1){enc[j]=code;code+=1}}}else{throw new Error(&quot;Unknown encoding format &quot;+format)}return new CffEncoding(enc,charset)}function parseCFFCharstring(font,glyph,code){var c1x;var c1y;var c2x;var c2y;var p=new Path;var stack=[];var nStems=0;var haveWidth=false;var width=font.defaultWidthX;var open=false;var x=0;var y=0;function newContour(x,y){if(open){p.closePath()}p.moveTo(x,y);open=true}function parseStems(){var hasWidthArg;hasWidthArg=stack.length%2!==0;if(hasWidthArg&amp;&amp;!haveWidth){width=stack.shift()+font.nominalWidthX}nStems+=stack.length&gt;&gt;1;stack.length=0;haveWidth=true}function parse(code){var b1;var b2;var b3;var b4;var codeIndex;var subrCode;var jpx;var jpy;var c3x;var c3y;var c4x;var c4y;var i=0;while(i&lt;code.length){var v=code[i];i+=1;switch(v){case 1:parseStems();break;case 3:parseStems();break;case 4:if(stack.length&gt;1&amp;&amp;!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}y+=stack.pop();newContour(x,y);break;case 5:while(stack.length&gt;0){x+=stack.shift();y+=stack.shift();p.lineTo(x,y)}break;case 6:while(stack.length&gt;0){x+=stack.shift();p.lineTo(x,y);if(stack.length===0){break}y+=stack.shift();p.lineTo(x,y)}break;case 7:while(stack.length&gt;0){y+=stack.shift();p.lineTo(x,y);if(stack.length===0){break}x+=stack.shift();p.lineTo(x,y)}break;case 8:while(stack.length&gt;0){c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 10:codeIndex=stack.pop()+font.subrsBias;subrCode=font.subrs[codeIndex];if(subrCode){parse(subrCode)}break;case 11:return;case 12:v=code[i];i+=1;switch(v){case 35:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y+stack.shift();c3x=jpx+stack.shift();c3y=jpy+stack.shift();c4x=c3x+stack.shift();c4y=c3y+stack.shift();x=c4x+stack.shift();y=c4y+stack.shift();stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 34:c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y;c3x=jpx+stack.shift();c3y=c2y;c4x=c3x+stack.shift();c4y=y;x=c4x+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 36:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y;c3x=jpx+stack.shift();c3y=c2y;c4x=c3x+stack.shift();c4y=c3y+stack.shift();x=c4x+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;case 37:c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();jpx=c2x+stack.shift();jpy=c2y+stack.shift();c3x=jpx+stack.shift();c3y=jpy+stack.shift();c4x=c3x+stack.shift();c4y=c3y+stack.shift();if(Math.abs(c4x-x)&gt;Math.abs(c4y-y)){x=c4x+stack.shift()}else{y=c4y+stack.shift()}p.curveTo(c1x,c1y,c2x,c2y,jpx,jpy);p.curveTo(c3x,c3y,c4x,c4y,x,y);break;default:console.log(&quot;Glyph &quot;+glyph.index+&quot;: unknown operator &quot;+1200+v);stack.length=0}break;case 14:if(stack.length&gt;0&amp;&amp;!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}if(open){p.closePath();open=false}break;case 18:parseStems();break;case 19:case 20:parseStems();i+=nStems+7&gt;&gt;3;break;case 21:if(stack.length&gt;2&amp;&amp;!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}y+=stack.pop();x+=stack.pop();newContour(x,y);break;case 22:if(stack.length&gt;1&amp;&amp;!haveWidth){width=stack.shift()+font.nominalWidthX;haveWidth=true}x+=stack.pop();newContour(x,y);break;case 23:parseStems();break;case 24:while(stack.length&gt;2){c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}x+=stack.shift();y+=stack.shift();p.lineTo(x,y);break;case 25:while(stack.length&gt;6){x+=stack.shift();y+=stack.shift();p.lineTo(x,y)}c1x=x+stack.shift();c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y);break;case 26:if(stack.length%2){x+=stack.shift()}while(stack.length&gt;0){c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x;y=c2y+stack.shift();p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 27:if(stack.length%2){y+=stack.shift()}while(stack.length&gt;0){c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y;p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 28:b1=code[i];b2=code[i+1];</td>
      </tr>
      <tr>
        <td id="L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="LC4" class="blob-code blob-code-inner js-file-line">stack.push((b1&lt;&lt;24|b2&lt;&lt;16)&gt;&gt;16);i+=2;break;case 29:codeIndex=stack.pop()+font.gsubrsBias;subrCode=font.gsubrs[codeIndex];if(subrCode){parse(subrCode)}break;case 30:while(stack.length&gt;0){c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y);if(stack.length===0){break}c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();y=c2y+stack.shift();x=c2x+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;case 31:while(stack.length&gt;0){c1x=x+stack.shift();c1y=y;c2x=c1x+stack.shift();c2y=c1y+stack.shift();y=c2y+stack.shift();x=c2x+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y);if(stack.length===0){break}c1x=x;c1y=y+stack.shift();c2x=c1x+stack.shift();c2y=c1y+stack.shift();x=c2x+stack.shift();y=c2y+(stack.length===1?stack.shift():0);p.curveTo(c1x,c1y,c2x,c2y,x,y)}break;default:if(v&lt;32){console.log(&quot;Glyph &quot;+glyph.index+&quot;: unknown operator &quot;+v)}else if(v&lt;247){stack.push(v-139)}else if(v&lt;251){b1=code[i];i+=1;stack.push((v-247)*256+b1+108)}else if(v&lt;255){b1=code[i];i+=1;stack.push(-(v-251)*256-b1-108)}else{b1=code[i];b2=code[i+1];b3=code[i+2];b4=code[i+3];i+=4;stack.push((b1&lt;&lt;24|b2&lt;&lt;16|b3&lt;&lt;8|b4)/65536)}}}}parse(code);glyph.advanceWidth=width;return p}function calcCFFSubroutineBias(subrs){var bias;if(subrs.length&lt;1240){bias=107}else if(subrs.length&lt;33900){bias=1131}else{bias=32768}return bias}function parseCFFTable(data,start,font){font.tables.cff={};var header=parseCFFHeader(data,start);var nameIndex=parseCFFIndex(data,header.endOffset,bytesToString);var topDictIndex=parseCFFIndex(data,nameIndex.endOffset);var stringIndex=parseCFFIndex(data,topDictIndex.endOffset,bytesToString);var globalSubrIndex=parseCFFIndex(data,stringIndex.endOffset);font.gsubrs=globalSubrIndex.objects;font.gsubrsBias=calcCFFSubroutineBias(font.gsubrs);var topDictData=new DataView(new Uint8Array(topDictIndex.objects[0]).buffer);var topDict=parseCFFTopDict(topDictData,stringIndex.objects);font.tables.cff.topDict=topDict;var privateDictOffset=start+topDict[&quot;private&quot;][1];var privateDict=parseCFFPrivateDict(data,privateDictOffset,topDict[&quot;private&quot;][0],stringIndex.objects);font.defaultWidthX=privateDict.defaultWidthX;font.nominalWidthX=privateDict.nominalWidthX;if(privateDict.subrs!==0){var subrOffset=privateDictOffset+privateDict.subrs;var subrIndex=parseCFFIndex(data,subrOffset);font.subrs=subrIndex.objects;font.subrsBias=calcCFFSubroutineBias(font.subrs)}else{font.subrs=[];font.subrsBias=0}var charStringsIndex=parseCFFIndex(data,start+topDict.charStrings);font.nGlyphs=charStringsIndex.objects.length;var charset=parseCFFCharset(data,start+topDict.charset,font.nGlyphs,stringIndex.objects);if(topDict.encoding===0){font.cffEncoding=new CffEncoding(cffStandardEncoding,charset)}else if(topDict.encoding===1){font.cffEncoding=new CffEncoding(cffExpertEncoding,charset)}else{font.cffEncoding=parseCFFEncoding(data,start+topDict.encoding,charset)}font.encoding=font.encoding||font.cffEncoding;font.glyphs=new GlyphSet(font);for(var i=0;i&lt;font.nGlyphs;i+=1){var charString=charStringsIndex.objects[i];font.glyphs.push(i,cffGlyphLoader(font,i,parseCFFCharstring,charString))}}function encodeString(s,strings){var sid;var i=cffStandardStrings.indexOf(s);if(i&gt;=0){sid=i}i=strings.indexOf(s);if(i&gt;=0){sid=i+cffStandardStrings.length}else{sid=cffStandardStrings.length+strings.length;strings.push(s)}return sid}function makeHeader(){return new table.Record(&quot;Header&quot;,[{name:&quot;major&quot;,type:&quot;Card8&quot;,value:1},{name:&quot;minor&quot;,type:&quot;Card8&quot;,value:0},{name:&quot;hdrSize&quot;,type:&quot;Card8&quot;,value:4},{name:&quot;major&quot;,type:&quot;Card8&quot;,value:1}])}function makeNameIndex(fontNames){var t=new table.Record(&quot;Name INDEX&quot;,[{name:&quot;names&quot;,type:&quot;INDEX&quot;,value:[]}]);t.names=[];for(var i=0;i&lt;fontNames.length;i+=1){t.names.push({name:&quot;name_&quot;+i,type:&quot;NAME&quot;,value:fontNames[i]})}return t}function makeDict(meta,attrs,strings){var m={};for(var i=0;i&lt;meta.length;i+=1){var entry=meta[i];var value=attrs[entry.name];if(value!==undefined&amp;&amp;!equals(value,entry.value)){if(entry.type===&quot;SID&quot;){value=encodeString(value,strings)}m[entry.op]={name:entry.name,type:entry.type,value:value}}}return m}function makeTopDict(attrs,strings){var t=new table.Record(&quot;Top DICT&quot;,[{name:&quot;dict&quot;,type:&quot;DICT&quot;,value:{}}]);t.dict=makeDict(TOP_DICT_META,attrs,strings);return t}function makeTopDictIndex(topDict){var t=new table.Record(&quot;Top DICT INDEX&quot;,[{name:&quot;topDicts&quot;,type:&quot;INDEX&quot;,value:[]}]);t.topDicts=[{name:&quot;topDict_0&quot;,type:&quot;TABLE&quot;,value:topDict}];return t}function makeStringIndex(strings){var t=new table.Record(&quot;String INDEX&quot;,[{name:&quot;strings&quot;,type:&quot;INDEX&quot;,value:[]}]);t.strings=[];for(var i=0;i&lt;strings.length;i+=1){t.strings.push({name:&quot;string_&quot;+i,type:&quot;STRING&quot;,value:strings[i]})}return t}function makeGlobalSubrIndex(){return new table.Record(&quot;Global Subr INDEX&quot;,[{name:&quot;subrs&quot;,type:&quot;INDEX&quot;,value:[]}])}function makeCharsets(glyphNames,strings){var t=new table.Record(&quot;Charsets&quot;,[{name:&quot;format&quot;,type:&quot;Card8&quot;,value:0}]);for(var i=0;i&lt;glyphNames.length;i+=1){var glyphName=glyphNames[i];var glyphSID=encodeString(glyphName,strings);t.fields.push({name:&quot;glyph_&quot;+i,type:&quot;SID&quot;,value:glyphSID})}return t}function glyphToOps(glyph){var ops=[];var path=glyph.path;ops.push({name:&quot;width&quot;,type:&quot;NUMBER&quot;,value:glyph.advanceWidth});var x=0;var y=0;for(var i=0;i&lt;path.commands.length;i+=1){var dx;var dy;var cmd=path.commands[i];if(cmd.type===&quot;Q&quot;){var _13=1/3;var _23=2/3;cmd={type:&quot;C&quot;,x:cmd.x,y:cmd.y,x1:_13*x+_23*cmd.x1,y1:_13*y+_23*cmd.y1,x2:_13*cmd.x+_23*cmd.x1,y2:_13*cmd.y+_23*cmd.y1}}if(cmd.type===&quot;M&quot;){dx=Math.round(cmd.x-x);dy=Math.round(cmd.y-y);ops.push({name:&quot;dx&quot;,type:&quot;NUMBER&quot;,value:dx});ops.push({name:&quot;dy&quot;,type:&quot;NUMBER&quot;,value:dy});ops.push({name:&quot;rmoveto&quot;,type:&quot;OP&quot;,value:21});x=Math.round(cmd.x);y=Math.round(cmd.y)}else if(cmd.type===&quot;L&quot;){dx=Math.round(cmd.x-x);dy=Math.round(cmd.y-y);ops.push({name:&quot;dx&quot;,type:&quot;NUMBER&quot;,value:dx});ops.push({name:&quot;dy&quot;,type:&quot;NUMBER&quot;,value:dy});ops.push({name:&quot;rlineto&quot;,type:&quot;OP&quot;,value:5});x=Math.round(cmd.x);y=Math.round(cmd.y)}else if(cmd.type===&quot;C&quot;){var dx1=Math.round(cmd.x1-x);var dy1=Math.round(cmd.y1-y);var dx2=Math.round(cmd.x2-cmd.x1);var dy2=Math.round(cmd.y2-cmd.y1);dx=Math.round(cmd.x-cmd.x2);dy=Math.round(cmd.y-cmd.y2);ops.push({name:&quot;dx1&quot;,type:&quot;NUMBER&quot;,value:dx1});ops.push({name:&quot;dy1&quot;,type:&quot;NUMBER&quot;,value:dy1});ops.push({name:&quot;dx2&quot;,type:&quot;NUMBER&quot;,value:dx2});ops.push({name:&quot;dy2&quot;,type:&quot;NUMBER&quot;,value:dy2});ops.push({name:&quot;dx&quot;,type:&quot;NUMBER&quot;,value:dx});ops.push({name:&quot;dy&quot;,type:&quot;NUMBER&quot;,value:dy});ops.push({name:&quot;rrcurveto&quot;,type:&quot;OP&quot;,value:8});x=Math.round(cmd.x);y=Math.round(cmd.y)}}ops.push({name:&quot;endchar&quot;,type:&quot;OP&quot;,value:14});return ops}function makeCharStringsIndex(glyphs){var t=new table.Record(&quot;CharStrings INDEX&quot;,[{name:&quot;charStrings&quot;,type:&quot;INDEX&quot;,value:[]}]);for(var i=0;i&lt;glyphs.length;i+=1){var glyph=glyphs.get(i);var ops=glyphToOps(glyph);t.charStrings.push({name:glyph.name,type:&quot;CHARSTRING&quot;,value:ops})}return t}function makePrivateDict(attrs,strings){var t=new table.Record(&quot;Private DICT&quot;,[{name:&quot;dict&quot;,type:&quot;DICT&quot;,value:{}}]);t.dict=makeDict(PRIVATE_DICT_META,attrs,strings);return t}function makeCFFTable(glyphs,options){var t=new table.Table(&quot;CFF &quot;,[{name:&quot;header&quot;,type:&quot;RECORD&quot;},{name:&quot;nameIndex&quot;,type:&quot;RECORD&quot;},{name:&quot;topDictIndex&quot;,type:&quot;RECORD&quot;},{name:&quot;stringIndex&quot;,type:&quot;RECORD&quot;},{name:&quot;globalSubrIndex&quot;,type:&quot;RECORD&quot;},{name:&quot;charsets&quot;,type:&quot;RECORD&quot;},{name:&quot;charStringsIndex&quot;,type:&quot;RECORD&quot;},{name:&quot;privateDict&quot;,type:&quot;RECORD&quot;}]);var fontScale=1/options.unitsPerEm;var attrs={version:options.version,fullName:options.fullName,familyName:options.familyName,weight:options.weightName,fontBBox:options.fontBBox||[0,0,0,0],fontMatrix:[fontScale,0,0,fontScale,0,0],charset:999,encoding:0,charStrings:999,&quot;private&quot;:[0,999]};var privateAttrs={};var glyphNames=[];var glyph;for(var i=1;i&lt;glyphs.length;i+=1){glyph=glyphs.get(i);glyphNames.push(glyph.name)}var strings=[];t.header=makeHeader();t.nameIndex=makeNameIndex([options.postScriptName]);var topDict=makeTopDict(attrs,strings);t.topDictIndex=makeTopDictIndex(topDict);t.globalSubrIndex=makeGlobalSubrIndex();t.charsets=makeCharsets(glyphNames,strings);t.charStringsIndex=makeCharStringsIndex(glyphs);t.privateDict=makePrivateDict(privateAttrs,strings);t.stringIndex=makeStringIndex(strings);var startOffset=t.header.sizeOf()+t.nameIndex.sizeOf()+t.topDictIndex.sizeOf()+t.stringIndex.sizeOf()+t.globalSubrIndex.sizeOf();attrs.charset=startOffset;attrs.encoding=0;attrs.charStrings=attrs.charset+t.charsets.sizeOf();attrs.private[1]=attrs.charStrings+t.charStringsIndex.sizeOf();topDict=makeTopDict(attrs,strings);t.topDictIndex=makeTopDictIndex(topDict);return t}function parseCmapTable(data,start){var i;var cmap={};cmap.version=getUShort(data,start);assert(cmap.version===0,&quot;cmap table version should be 0.&quot;);cmap.numTables=getUShort(data,start+2);var offset=-1;for(i=0;i&lt;cmap.numTables;i+=1){var platformId=getUShort(data,start+4+i*8);var encodingId=getUShort(data,start+4+i*8+2);if(platformId===3&amp;&amp;(encodingId===1||encodingId===0)){offset=getULong(data,start+4+i*8+4);break}}if(offset===-1){return null}var p=new Parser(data,start+offset);cmap.format=p.parseUShort();assert(cmap.format===4,&quot;Only format 4 cmap tables are supported.&quot;);cmap.length=p.parseUShort();cmap.language=p.parseUShort();var segCount;cmap.segCount=segCount=p.parseUShort()&gt;&gt;1;p.skip(&quot;uShort&quot;,3);cmap.glyphIndexMap={};var endCountParser=new Parser(data,start+offset+14);var startCountParser=new Parser(data,start+offset+16+segCount*2);var idDeltaParser=new Parser(data,start+offset+16+segCount*4);var idRangeOffsetParser=new Parser(data,start+offset+16+segCount*6);var glyphIndexOffset=start+offset+16+segCount*8;for(i=0;i&lt;segCount-1;i+=1){var glyphIndex;var endCount=endCountParser.parseUShort();var startCount=startCountParser.parseUShort();var idDelta=idDeltaParser.parseShort();var idRangeOffset=idRangeOffsetParser.parseUShort();for(var c=startCount;c&lt;=endCount;c+=1){if(idRangeOffset!==0){glyphIndexOffset=idRangeOffsetParser.offset+idRangeOffsetParser.relativeOffset-2;glyphIndexOffset+=idRangeOffset;glyphIndexOffset+=(c-startCount)*2;glyphIndex=getUShort(data,glyphIndexOffset);if(glyphIndex!==0){glyphIndex=glyphIndex+idDelta&amp;65535}}else{glyphIndex=c+idDelta&amp;65535}cmap.glyphIndexMap[c]=glyphIndex}}return cmap}function addSegment(t,code,glyphIndex){t.segments.push({end:code,start:code,delta:-(code-glyphIndex),offset:0})}function addTerminatorSegment(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(glyphs){var i;var t=new table.Table(&quot;cmap&quot;,[{name:&quot;version&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;numTables&quot;,type:&quot;USHORT&quot;,value:1},{name:&quot;platformID&quot;,type:&quot;USHORT&quot;,value:3},{name:&quot;encodingID&quot;,type:&quot;USHORT&quot;,value:1},{name:&quot;offset&quot;,type:&quot;ULONG&quot;,value:12},{name:&quot;format&quot;,type:&quot;USHORT&quot;,value:4},{name:&quot;length&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;language&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;segCountX2&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;searchRange&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;entrySelector&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;rangeShift&quot;,type:&quot;USHORT&quot;,value:0}]);t.segments=[];for(i=0;i&lt;glyphs.length;i+=1){var glyph=glyphs.get(i);for(var j=0;j&lt;glyph.unicodes.length;j+=1){addSegment(t,glyph.unicodes[j],i)}t.segments=t.segments.sort(function(a,b){return a.start-b.start})}addTerminatorSegment(t);var segCount;segCount=t.segments.length;t.segCountX2=segCount*2;t.searchRange=Math.pow(2,Math.floor(Math.log(segCount)/Math.log(2)))*2;t.entrySelector=Math.log(t.searchRange/2)/Math.log(2);t.rangeShift=t.segCountX2-t.searchRange;var endCounts=[];var startCounts=[];var idDeltas=[];var idRangeOffsets=[];var glyphIds=[];for(i=0;i&lt;segCount;i+=1){var segment=t.segments[i];endCounts=endCounts.concat({name:&quot;end_&quot;+i,type:&quot;USHORT&quot;,value:segment.end});startCounts=startCounts.concat({name:&quot;start_&quot;+i,type:&quot;USHORT&quot;,value:segment.start});idDeltas=idDeltas.concat({name:&quot;idDelta_&quot;+i,type:&quot;SHORT&quot;,value:segment.delta});idRangeOffsets=idRangeOffsets.concat({name:&quot;idRangeOffset_&quot;+i,type:&quot;USHORT&quot;,value:segment.offset});if(segment.glyphId!==undefined){glyphIds=glyphIds.concat({name:&quot;glyph_&quot;+i,type:&quot;USHORT&quot;,value:segment.glyphId})}}t.fields=t.fields.concat(endCounts);t.fields.push({name:&quot;reservedPad&quot;,type:&quot;USHORT&quot;,value:0});t.fields=t.fields.concat(startCounts);t.fields=t.fields.concat(idDeltas);t.fields=t.fields.concat(idRangeOffsets);t.fields=t.fields.concat(glyphIds);t.length=14+endCounts.length*2+2+startCounts.length*2+idDeltas.length*2+idRangeOffsets.length*2+glyphIds.length*2;return t}function addName(name,names){var nameString=JSON.stringify(name);var nameID=256;for(var nameKey in names){var n=parseInt(nameKey);if(!n||n&lt;256){continue}if(JSON.stringify(names[nameKey])===nameString){return n}if(nameID&lt;=n){nameID=n+1}}names[nameID]=name;return nameID}function makeFvarAxis(n,axis,names){var nameID=addName(axis.name,names);return[{name:&quot;tag_&quot;+n,type:&quot;TAG&quot;,value:axis.tag},{name:&quot;minValue_&quot;+n,type:&quot;FIXED&quot;,value:axis.minValue&lt;&lt;16},{name:&quot;defaultValue_&quot;+n,type:&quot;FIXED&quot;,value:axis.defaultValue&lt;&lt;16},{name:&quot;maxValue_&quot;+n,type:&quot;FIXED&quot;,value:axis.maxValue&lt;&lt;16},{name:&quot;flags_&quot;+n,type:&quot;USHORT&quot;,value:0},{name:&quot;nameID_&quot;+n,type:&quot;USHORT&quot;,value:nameID}]}function parseFvarAxis(data,start,names){var axis={};var p=new Parser(data,start);axis.tag=p.parseTag();axis.minValue=p.parseFixed();axis.defaultValue=p.parseFixed();axis.maxValue=p.parseFixed();p.skip(&quot;uShort&quot;,1);axis.name=names[p.parseUShort()]||{};return axis}function makeFvarInstance(n,inst,axes,names){var nameID=addName(inst.name,names);var fields=[{name:&quot;nameID_&quot;+n,type:&quot;USHORT&quot;,value:nameID},{name:&quot;flags_&quot;+n,type:&quot;USHORT&quot;,value:0}];for(var i=0;i&lt;axes.length;++i){var axisTag=axes[i].tag;fields.push({name:&quot;axis_&quot;+n+&quot; &quot;+axisTag,type:&quot;FIXED&quot;,value:inst.coordinates[axisTag]&lt;&lt;16})}return fields}function parseFvarInstance(data,start,axes,names){var inst={};var p=new Parser(data,start);inst.name=names[p.parseUShort()]||{};p.skip(&quot;uShort&quot;,1);inst.coordinates={};for(var i=0;i&lt;axes.length;++i){inst.coordinates[axes[i].tag]=p.parseFixed()}return inst}function makeFvarTable(fvar,names){var result=new table.Table(&quot;fvar&quot;,[{name:&quot;version&quot;,type:&quot;ULONG&quot;,value:65536},{name:&quot;offsetToData&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;countSizePairs&quot;,type:&quot;USHORT&quot;,value:2},{name:&quot;axisCount&quot;,type:&quot;USHORT&quot;,value:fvar.axes.length},{name:&quot;axisSize&quot;,type:&quot;USHORT&quot;,value:20},{name:&quot;instanceCount&quot;,type:&quot;USHORT&quot;,value:fvar.instances.length},{name:&quot;instanceSize&quot;,type:&quot;USHORT&quot;,value:4+fvar.axes.length*4}]);result.offsetToData=result.sizeOf();for(var i=0;i&lt;fvar.axes.length;i++){result.fields=result.fields.concat(makeFvarAxis(i,fvar.axes[i],names))}for(var j=0;j&lt;fvar.instances.length;j++){result.fields=result.fields.concat(makeFvarInstance(j,fvar.instances[j],fvar.axes,names))}return result}function parseFvarTable(data,start,names){var p=new Parser(data,start);var tableVersion=p.parseULong();assert(tableVersion===65536,&quot;Unsupported fvar table version.&quot;);var offsetToData=p.parseOffset16();p.skip(&quot;uShort&quot;,1);var axisCount=p.parseUShort();var axisSize=p.parseUShort();var instanceCount=p.parseUShort();var instanceSize=p.parseUShort();var axes=[];for(var i=0;i&lt;axisCount;i++){axes.push(parseFvarAxis(data,start+offsetToData+i*axisSize,names))}var instances=[];var instanceStart=start+offsetToData+axisCount*axisSize;for(var j=0;j&lt;instanceCount;j++){instances.push(parseFvarInstance(data,instanceStart+j*instanceSize,axes,names))}return{axes:axes,instances:instances}}function parseGlyphCoordinate(p,flag,previousValue,shortVectorBitMask,sameBitMask){var v;if((flag&amp;shortVectorBitMask)&gt;0){v=p.parseByte();if((flag&amp;sameBitMask)===0){v=-v}v=previousValue+v}else{if((flag&amp;sameBitMask)&gt;0){v=previousValue}else{v=previousValue+p.parseShort()}}return v}function parseGlyph(glyph,data,start){var p=new Parser(data,start);glyph.numberOfContours=p.parseShort();glyph.xMin=p.parseShort();glyph.yMin=p.parseShort();glyph.xMax=p.parseShort();glyph.yMax=p.parseShort();var flags;var flag;if(glyph.numberOfContours&gt;0){var i;var endPointIndices=glyph.endPointIndices=[];for(i=0;i&lt;glyph.numberOfContours;i+=1){endPointIndices.push(p.parseUShort())}glyph.instructionLength=p.parseUShort();glyph.instructions=[];for(i=0;i&lt;glyph.instructionLength;i+=1){glyph.instructions.push(p.parseByte())}var numberOfCoordinates=endPointIndices[endPointIndices.length-1]+1;flags=[];for(i=0;i&lt;numberOfCoordinates;i+=1){flag=p.parseByte();flags.push(flag);if((flag&amp;8)&gt;0){var repeatCount=p.parseByte();for(var j=0;j&lt;repeatCount;j+=1){flags.push(flag);i+=1}}}assert(flags.length===numberOfCoordinates,&quot;Bad flags.&quot;);if(endPointIndices.length&gt;0){var points=[];var point;if(numberOfCoordinates&gt;0){for(i=0;i&lt;numberOfCoordinates;i+=1){flag=flags[i];point={};point.onCurve=!!(flag&amp;1);point.lastPointOfContour=endPointIndices.indexOf(i)&gt;=0;points.push(point)}var px=0;for(i=0;i&lt;numberOfCoordinates;i+=1){flag=flags[i];point=points[i];point.x=parseGlyphCoordinate(p,flag,px,2,16);px=point.x}var py=0;for(i=0;i&lt;numberOfCoordinates;i+=1){flag=flags[i];point=points[i];point.y=parseGlyphCoordinate(p,flag,py,4,32);py=point.y}}glyph.points=points}else{glyph.points=[]}}else if(glyph.numberOfContours===0){glyph.points=[]}else{glyph.isComposite=true;glyph.points=[];glyph.components=[];var moreComponents=true;while(moreComponents){flags=p.parseUShort();var component={glyphIndex:p.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};if((flags&amp;1)&gt;0){component.dx=p.parseShort();component.dy=p.parseShort()}else{component.dx=p.parseChar();component.dy=p.parseChar()}if((flags&amp;8)&gt;0){component.xScale=component.yScale=p.parseF2Dot14()}else if((flags&amp;64)&gt;0){component.xScale=p.parseF2Dot14();component.yScale=p.parseF2Dot14()}else if((flags&amp;128)&gt;0){component.xScale=p.parseF2Dot14();component.scale01=p.parseF2Dot14();component.scale10=p.parseF2Dot14();component.yScale=p.parseF2Dot14()}glyph.components.push(component);moreComponents=!!(flags&amp;32)}}}function transformPoints(points,transform){var newPoints=[];for(var i=0;i&lt;points.length;i+=1){var pt=points[i];var newPt={x:transform.xScale*pt.x+transform.scale01*pt.y+transform.dx,y:transform.scale10*pt.x+transform.yScale*pt.y+transform.dy,onCurve:pt.onCurve,lastPointOfContour:pt.lastPointOfContour};newPoints.push(newPt)}return newPoints}function getContours(points){var contours=[];var currentContour=[];for(var i=0;i&lt;points.length;i+=1){var pt=points[i];currentContour.push(pt);if(pt.lastPointOfContour){contours.push(currentContour);currentContour=[]}}assert(currentContour.length===0,&quot;There are still points left in the current contour.&quot;);return contours}function getPath(points){var p=new Path;if(!points){return p}var contours=getContours(points);for(var i=0;i&lt;contours.length;i+=1){var contour=contours[i];var firstPt=contour[0];var lastPt=contour[contour.length-1];var curvePt;var realFirstPoint;if(firstPt.onCurve){curvePt=null;realFirstPoint=true}else{if(lastPt.onCurve){firstPt=lastPt}else{firstPt={x:(firstPt.x+lastPt.x)/2,y:(firstPt.y+lastPt.y)/2}}curvePt=firstPt;realFirstPoint=false}p.moveTo(firstPt.x,firstPt.y);for(var j=realFirstPoint?1:0;j&lt;contour.length;j+=1){var pt=contour[j];var prevPt=j===0?firstPt:contour[j-1];if(prevPt.onCurve&amp;&amp;pt.onCurve){p.lineTo(pt.x,pt.y)}else if(prevPt.onCurve&amp;&amp;!pt.onCurve){curvePt=pt}else if(!prevPt.onCurve&amp;&amp;!pt.onCurve){var midPt={x:(prevPt.x+pt.x)/2,y:(prevPt.y+pt.y)/2};p.quadraticCurveTo(prevPt.x,prevPt.y,midPt.x,midPt.y);curvePt=pt}else if(!prevPt.onCurve&amp;&amp;pt.onCurve){p.quadraticCurveTo(curvePt.x,curvePt.y,pt.x,pt.y);curvePt=null}else{throw new Error(&quot;Invalid state.&quot;)}}if(firstPt!==lastPt){if(curvePt){p.quadraticCurveTo(curvePt.x,curvePt.y,firstPt.x,firstPt.y)}else{p.lineTo(firstPt.x,firstPt.y)}}}p.closePath();return p}function buildPath(glyphs,glyph){if(glyph.isComposite){for(var j=0;j&lt;glyph.components.length;j+=1){var component=glyph.components[j];var componentGlyph=glyphs.get(component.glyphIndex);componentGlyph.getPath();if(componentGlyph.points){var transformedPoints=transformPoints(componentGlyph.points,component);glyph.points=glyph.points.concat(transformedPoints)}}}return getPath(glyph.points)}function parseGlyfTable(data,start,loca,font){var glyphs=new GlyphSet(font);var i;for(i=0;i&lt;loca.length-1;i+=1){var offset=loca[i];var nextOffset=loca[i+1];if(offset!==nextOffset){glyphs.push(i,ttfGlyphLoader(font,i,parseGlyph,data,start+offset,buildPath))}else{glyphs.push(i,glyphLoader(font,i))}}return glyphs}function parseTaggedListTable(data,start){var p=new Parser(data,start);var n=p.parseUShort();var list=[];for(var i=0;i&lt;n;i++){list[p.parseTag()]={offset:p.parseUShort()}}return list}function parseCoverageTable(data,start){var p=new Parser(data,start);var format=p.parseUShort();var count=p.parseUShort();if(format===1){return p.parseUShortList(count)}else if(format===2){var coverage=[];for(;count--;){var begin=p.parseUShort();var end=p.parseUShort();var index=p.parseUShort();for(var i=begin;i&lt;=end;i++){coverage[index++]=i}}return coverage}}function parseClassDefTable(data,start){var p=new Parser(data,start);var format=p.parseUShort();if(format===1){var startGlyph=p.parseUShort();var glyphCount=p.parseUShort();var classes=p.parseUShortList(glyphCount);return function(glyphID){return classes[glyphID-startGlyph]||0}}else if(format===2){var rangeCount=p.parseUShort();var startGlyphs=[];var endGlyphs=[];var classValues=[];for(var i=0;i&lt;rangeCount;i++){startGlyphs[i]=p.parseUShort();endGlyphs[i]=p.parseUShort();classValues[i]=p.parseUShort()}return function(glyphID){var l=0;var r=startGlyphs.length-1;while(l&lt;r){var c=l+r+1&gt;&gt;1;if(glyphID&lt;startGlyphs[c]){r=c-1}else{l=c}}if(startGlyphs[l]&lt;=glyphID&amp;&amp;glyphID&lt;=endGlyphs[l]){return classValues[l]||0}return 0}}}function parsePairPosSubTable(data,start){var p=new Parser(data,start);var format=p.parseUShort();var coverageOffset=p.parseUShort();var coverage=parseCoverageTable(data,start+coverageOffset);var valueFormat1=p.parseUShort();var valueFormat2=p.parseUShort();var value1;var value2;if(valueFormat1!==4||valueFormat2!==0)return;var sharedPairSets={};if(format===1){var pairSetCount=p.parseUShort();var pairSet=[];var pairSetOffsets=p.parseOffset16List(pairSetCount);for(var firstGlyph=0;firstGlyph&lt;pairSetCount;firstGlyph++){var pairSetOffset=pairSetOffsets[firstGlyph];var sharedPairSet=sharedPairSets[pairSetOffset];if(!sharedPairSet){sharedPairSet={};p.relativeOffset=pairSetOffset;var pairValueCount=p.parseUShort();for(;pairValueCount--;){var secondGlyph=p.parseUShort();if(valueFormat1)value1=p.parseShort();if(valueFormat2)value2=p.parseShort();sharedPairSet[secondGlyph]=value1}}pairSet[coverage[firstGlyph]]=sharedPairSet}return function(leftGlyph,rightGlyph){var pairs=pairSet[leftGlyph];if(pairs)return pairs[rightGlyph]}}else if(format===2){var classDef1Offset=p.parseUShort();var classDef2Offset=p.parseUShort();var class1Count=p.parseUShort();var class2Count=p.parseUShort();var getClass1=parseClassDefTable(data,start+classDef1Offset);var getClass2=parseClassDefTable(data,start+classDef2Offset);var kerningMatrix=[];for(var i=0;i&lt;class1Count;i++){var kerningRow=kerningMatrix[i]=[];for(var j=0;j&lt;class2Count;j++){if(valueFormat1)value1=p.parseShort();if(valueFormat2)value2=p.parseShort();kerningRow[j]=value1}}var covered={};for(i=0;i&lt;coverage.length;i++)covered[coverage[i]]=1;return function(leftGlyph,rightGlyph){if(!covered[leftGlyph])return;var class1=getClass1(leftGlyph);var class2=getClass2(rightGlyph);var kerningRow=kerningMatrix[class1];if(kerningRow){return kerningRow[class2]}}}}function parseLookupTable(data,start){var p=new Parser(data,start);var lookupType=p.parseUShort();var lookupFlag=p.parseUShort();var useMarkFilteringSet=lookupFlag&amp;16;var subTableCount=p.parseUShort();var subTableOffsets=p.parseOffset16List(subTableCount);var table={lookupType:lookupType,lookupFlag:lookupFlag,markFilteringSet:useMarkFilteringSet?p.parseUShort():-1};if(lookupType===2){var subtables=[];for(var i=0;i&lt;subTableCount;i++){subtables.push(parsePairPosSubTable(data,start+subTableOffsets[i]))}table.getKerningValue=function(leftGlyph,rightGlyph){for(var i=subtables.length;i--;){var value=subtables[i](leftGlyph,rightGlyph);if(value!==undefined)return value}return 0}}return table}function parseGposTable(data,start,font){var p=new Parser(data,start);var tableVersion=p.parseFixed();assert(tableVersion===1,&quot;Unsupported GPOS table version.&quot;);parseTaggedListTable(data,start+p.parseUShort());parseTaggedListTable(data,start+p.parseUShort());var lookupListOffset=p.parseUShort();p.relativeOffset=lookupListOffset;var lookupCount=p.parseUShort();var lookupTableOffsets=p.parseOffset16List(lookupCount);var lookupListAbsoluteOffset=start+lookupListOffset;for(var i=0;i&lt;lookupCount;i++){var table=parseLookupTable(data,lookupListAbsoluteOffset+lookupTableOffsets[i]);if(table.lookupType===2&amp;&amp;!font.getGposKerningValue)font.getGposKerningValue=table.getKerningValue}}function parseHeadTable(data,start){var head={};var p=new Parser(data,start);head.version=p.parseVersion();head.fontRevision=Math.round(p.parseFixed()*1e3)/1e3;head.checkSumAdjustment=p.parseULong();head.magicNumber=p.parseULong();assert(head.magicNumber===1594834165,&quot;Font header has wrong magic number.&quot;);head.flags=p.parseUShort();head.unitsPerEm=p.parseUShort();head.created=p.parseLongDateTime();head.modified=p.parseLongDateTime();head.xMin=p.parseShort();head.yMin=p.parseShort();head.xMax=p.parseShort();head.yMax=p.parseShort();head.macStyle=p.parseUShort();head.lowestRecPPEM=p.parseUShort();head.fontDirectionHint=p.parseShort();head.indexToLocFormat=p.parseShort();head.glyphDataFormat=p.parseShort();return head}function makeHeadTable(options){return new table.Table(&quot;head&quot;,[{name:&quot;version&quot;,type:&quot;FIXED&quot;,value:65536},{name:&quot;fontRevision&quot;,type:&quot;FIXED&quot;,value:65536},{name:&quot;checkSumAdjustment&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;magicNumber&quot;,type:&quot;ULONG&quot;,value:1594834165},{name:&quot;flags&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;unitsPerEm&quot;,type:&quot;USHORT&quot;,value:1e3},{name:&quot;created&quot;,type:&quot;LONGDATETIME&quot;,value:0},{name:&quot;modified&quot;,type:&quot;LONGDATETIME&quot;,value:0},{name:&quot;xMin&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;yMin&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;xMax&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;yMax&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;macStyle&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;lowestRecPPEM&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;fontDirectionHint&quot;,type:&quot;SHORT&quot;,value:2},{name:&quot;indexToLocFormat&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;glyphDataFormat&quot;,type:&quot;SHORT&quot;,value:0}],options)}function parseHheaTable(data,start){var hhea={};var p=new Parser(data,start);hhea.version=p.parseVersion();hhea.ascender=p.parseShort();hhea.descender=p.parseShort();hhea.lineGap=p.parseShort();hhea.advanceWidthMax=p.parseUShort();hhea.minLeftSideBearing=p.parseShort();hhea.minRightSideBearing=p.parseShort();hhea.xMaxExtent=p.parseShort();hhea.caretSlopeRise=p.parseShort();hhea.caretSlopeRun=p.parseShort();hhea.caretOffset=p.parseShort();p.relativeOffset+=8;hhea.metricDataFormat=p.parseShort();hhea.numberOfHMetrics=p.parseUShort();return hhea}function makeHheaTable(options){return new table.Table(&quot;hhea&quot;,[{name:&quot;version&quot;,type:&quot;FIXED&quot;,value:65536},{name:&quot;ascender&quot;,type:&quot;FWORD&quot;,value:0},{name:&quot;descender&quot;,type:&quot;FWORD&quot;,value:0},{name:&quot;lineGap&quot;,type:&quot;FWORD&quot;,value:0},{name:&quot;advanceWidthMax&quot;,type:&quot;UFWORD&quot;,value:0},{name:&quot;minLeftSideBearing&quot;,type:&quot;FWORD&quot;,value:0},{name:&quot;minRightSideBearing&quot;,type:&quot;FWORD&quot;,value:0},{name:&quot;xMaxExtent&quot;,type:&quot;FWORD&quot;,value:0},{name:&quot;caretSlopeRise&quot;,type:&quot;SHORT&quot;,value:1},{name:&quot;caretSlopeRun&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;caretOffset&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;reserved1&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;reserved2&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;reserved3&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;reserved4&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;metricDataFormat&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;numberOfHMetrics&quot;,type:&quot;USHORT&quot;,value:0}],options)}function parseHmtxTable(data,start,numMetrics,numGlyphs,glyphs){var advanceWidth;var leftSideBearing;var p=new Parser(data,start);for(var i=0;i&lt;numGlyphs;i+=1){if(i&lt;numMetrics){advanceWidth=p.parseUShort();leftSideBearing=p.parseShort()}var glyph=glyphs.get(i);glyph.advanceWidth=advanceWidth;glyph.leftSideBearing=leftSideBearing}}function makeHmtxTable(glyphs){var t=new table.Table(&quot;hmtx&quot;,[]);for(var i=0;i&lt;glyphs.length;i+=1){var glyph=glyphs.get(i);var advanceWidth=glyph.advanceWidth||0;var leftSideBearing=glyph.leftSideBearing||0;t.fields.push({name:&quot;advanceWidth_&quot;+i,type:&quot;USHORT&quot;,value:advanceWidth});t.fields.push({name:&quot;leftSideBearing_&quot;+i,type:&quot;SHORT&quot;,value:leftSideBearing})}return t}function parseKernTable(data,start){var pairs={};var p=new Parser(data,start);var tableVersion=p.parseUShort();assert(tableVersion===0,&quot;Unsupported kern table version.&quot;);p.skip(&quot;uShort&quot;,1);var subTableVersion=p.parseUShort();assert(subTableVersion===0,&quot;Unsupported kern sub-table version.&quot;);p.skip(&quot;uShort&quot;,2);var nPairs=p.parseUShort();p.skip(&quot;uShort&quot;,3);for(var i=0;i&lt;nPairs;i+=1){var leftIndex=p.parseUShort();var rightIndex=p.parseUShort();var value=p.parseShort();pairs[leftIndex+&quot;,&quot;+rightIndex]=value}return pairs}function parseLocaTable(data,start,numGlyphs,shortVersion){var p=new Parser(data,start);var parseFn=shortVersion?p.parseUShort:p.parseULong;var glyphOffsets=[];for(var i=0;i&lt;numGlyphs+1;i+=1){var glyphOffset=parseFn.call(p);if(shortVersion){glyphOffset*=2}glyphOffsets.push(glyphOffset)}return glyphOffsets}function makeLtagTable(tags){var result=new table.Table(&quot;ltag&quot;,[{name:&quot;version&quot;,type:&quot;ULONG&quot;,value:1},{name:&quot;flags&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;numTags&quot;,type:&quot;ULONG&quot;,value:tags.length}]);var stringPool=&quot;&quot;;var stringPoolOffset=12+tags.length*4;for(var i=0;i&lt;tags.length;++i){var pos=stringPool.indexOf(tags[i]);if(pos&lt;0){pos=stringPool.length;stringPool+=tags[i]}result.fields.push({name:&quot;offset &quot;+i,type:&quot;USHORT&quot;,value:stringPoolOffset+pos});result.fields.push({name:&quot;length &quot;+i,type:&quot;USHORT&quot;,value:tags[i].length})}result.fields.push({name:&quot;stringPool&quot;,type:&quot;CHARARRAY&quot;,value:stringPool});return result}function parseLtagTable(data,start){var p=new Parser(data,start);var tableVersion=p.parseULong();assert(tableVersion===1,&quot;Unsupported ltag table version.&quot;);p.skip(&quot;uLong&quot;,1);var numTags=p.parseULong();var tags=[];for(var i=0;i&lt;numTags;i++){var tag=&quot;&quot;;var offset=start+p.parseUShort();var length=p.parseUShort();for(var j=offset;j&lt;offset+length;++j){tag+=String.fromCharCode(data.getInt8(j))}tags.push(tag)}return tags}function parseMaxpTable(data,start){var maxp={};var p=new Parser(data,start);maxp.version=p.parseVersion();maxp.numGlyphs=p.parseUShort();if(maxp.version===1){maxp.maxPoints=p.parseUShort();maxp.maxContours=p.parseUShort();maxp.maxCompositePoints=p.parseUShort();maxp.maxCompositeContours=p.parseUShort();maxp.maxZones=p.parseUShort();maxp.maxTwilightPoints=p.parseUShort();maxp.maxStorage=p.parseUShort();maxp.maxFunctionDefs=p.parseUShort();maxp.maxInstructionDefs=p.parseUShort();maxp.maxStackElements=p.parseUShort();maxp.maxSizeOfInstructions=p.parseUShort();maxp.maxComponentElements=p.parseUShort();maxp.maxComponentDepth=p.parseUShort()}return maxp}function makeMaxpTable(numGlyphs){return new table.Table(&quot;maxp&quot;,[{name:&quot;version&quot;,type:&quot;FIXED&quot;,value:20480},{name:&quot;numGlyphs&quot;,type:&quot;USHORT&quot;,value:numGlyphs}])}var nameTableNames=[&quot;copyright&quot;,&quot;fontFamily&quot;,&quot;fontSubfamily&quot;,&quot;uniqueID&quot;,&quot;fullName&quot;,&quot;version&quot;,&quot;postScriptName&quot;,&quot;trademark&quot;,&quot;manufacturer&quot;,&quot;designer&quot;,&quot;description&quot;,&quot;manufacturerURL&quot;,&quot;designerURL&quot;,&quot;license&quot;,&quot;licenseURL&quot;,&quot;reserved&quot;,&quot;preferredFamily&quot;,&quot;preferredSubfamily&quot;,&quot;compatibleFullName&quot;,&quot;sampleText&quot;,&quot;postScriptFindFontName&quot;,&quot;wwsFamily&quot;,&quot;wwsSubfamily&quot;];var macLanguages={0:&quot;en&quot;,1:&quot;fr&quot;,2:&quot;de&quot;,3:&quot;it&quot;,4:&quot;nl&quot;,5:&quot;sv&quot;,6:&quot;es&quot;,7:&quot;da&quot;,8:&quot;pt&quot;,9:&quot;no&quot;,10:&quot;he&quot;,11:&quot;ja&quot;,12:&quot;ar&quot;,13:&quot;fi&quot;,14:&quot;el&quot;,15:&quot;is&quot;,16:&quot;mt&quot;,17:&quot;tr&quot;,18:&quot;hr&quot;,19:&quot;zh-Hant&quot;,20:&quot;ur&quot;,21:&quot;hi&quot;,22:&quot;th&quot;,23:&quot;ko&quot;,24:&quot;lt&quot;,25:&quot;pl&quot;,26:&quot;hu&quot;,27:&quot;es&quot;,28:&quot;lv&quot;,29:&quot;se&quot;,30:&quot;fo&quot;,31:&quot;fa&quot;,32:&quot;ru&quot;,33:&quot;zh&quot;,34:&quot;nl-BE&quot;,35:&quot;ga&quot;,36:&quot;sq&quot;,37:&quot;ro&quot;,38:&quot;cz&quot;,39:&quot;sk&quot;,40:&quot;si&quot;,41:&quot;yi&quot;,42:&quot;sr&quot;,43:&quot;mk&quot;,44:&quot;bg&quot;,45:&quot;uk&quot;,46:&quot;be&quot;,47:&quot;uz&quot;,48:&quot;kk&quot;,49:&quot;az-Cyrl&quot;,50:&quot;az-Arab&quot;,51:&quot;hy&quot;,52:&quot;ka&quot;,53:&quot;mo&quot;,54:&quot;ky&quot;,55:&quot;tg&quot;,56:&quot;tk&quot;,57:&quot;mn-CN&quot;,58:&quot;mn&quot;,59:&quot;ps&quot;,60:&quot;ks&quot;,61:&quot;ku&quot;,62:&quot;sd&quot;,63:&quot;bo&quot;,64:&quot;ne&quot;,65:&quot;sa&quot;,66:&quot;mr&quot;,67:&quot;bn&quot;,68:&quot;as&quot;,69:&quot;gu&quot;,70:&quot;pa&quot;,71:&quot;or&quot;,72:&quot;ml&quot;,73:&quot;kn&quot;,74:&quot;ta&quot;,75:&quot;te&quot;,76:&quot;si&quot;,77:&quot;my&quot;,78:&quot;km&quot;,79:&quot;lo&quot;,80:&quot;vi&quot;,81:&quot;id&quot;,82:&quot;tl&quot;,83:&quot;ms&quot;,84:&quot;ms-Arab&quot;,85:&quot;am&quot;,86:&quot;ti&quot;,87:&quot;om&quot;,88:&quot;so&quot;,89:&quot;sw&quot;,90:&quot;rw&quot;,91:&quot;rn&quot;,92:&quot;ny&quot;,93:&quot;mg&quot;,94:&quot;eo&quot;,128:&quot;cy&quot;,129:&quot;eu&quot;,130:&quot;ca&quot;,131:&quot;la&quot;,132:&quot;qu&quot;,133:&quot;gn&quot;,134:&quot;ay&quot;,135:&quot;tt&quot;,136:&quot;ug&quot;,137:&quot;dz&quot;,138:&quot;jv&quot;,139:&quot;su&quot;,140:&quot;gl&quot;,141:&quot;af&quot;,142:&quot;br&quot;,143:&quot;iu&quot;,144:&quot;gd&quot;,145:&quot;gv&quot;,146:&quot;ga&quot;,147:&quot;to&quot;,148:&quot;el-polyton&quot;,149:&quot;kl&quot;,150:&quot;az&quot;,151:&quot;nn&quot;};</td>
      </tr>
      <tr>
        <td id="L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="LC5" class="blob-code blob-code-inner js-file-line">var macLanguageToScript={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0};var windowsLanguages={1078:&quot;af&quot;,1052:&quot;sq&quot;,1156:&quot;gsw&quot;,1118:&quot;am&quot;,5121:&quot;ar-DZ&quot;,15361:&quot;ar-BH&quot;,3073:&quot;ar&quot;,2049:&quot;ar-IQ&quot;,11265:&quot;ar-JO&quot;,13313:&quot;ar-KW&quot;,12289:&quot;ar-LB&quot;,4097:&quot;ar-LY&quot;,6145:&quot;ary&quot;,8193:&quot;ar-OM&quot;,16385:&quot;ar-QA&quot;,1025:&quot;ar-SA&quot;,10241:&quot;ar-SY&quot;,7169:&quot;aeb&quot;,14337:&quot;ar-AE&quot;,9217:&quot;ar-YE&quot;,1067:&quot;hy&quot;,1101:&quot;as&quot;,2092:&quot;az-Cyrl&quot;,1068:&quot;az&quot;,1133:&quot;ba&quot;,1069:&quot;eu&quot;,1059:&quot;be&quot;,2117:&quot;bn&quot;,1093:&quot;bn-IN&quot;,8218:&quot;bs-Cyrl&quot;,5146:&quot;bs&quot;,1150:&quot;br&quot;,1026:&quot;bg&quot;,1027:&quot;ca&quot;,3076:&quot;zh-HK&quot;,5124:&quot;zh-MO&quot;,2052:&quot;zh&quot;,4100:&quot;zh-SG&quot;,1028:&quot;zh-TW&quot;,1155:&quot;co&quot;,1050:&quot;hr&quot;,4122:&quot;hr-BA&quot;,1029:&quot;cs&quot;,1030:&quot;da&quot;,1164:&quot;prs&quot;,1125:&quot;dv&quot;,2067:&quot;nl-BE&quot;,1043:&quot;nl&quot;,3081:&quot;en-AU&quot;,10249:&quot;en-BZ&quot;,4105:&quot;en-CA&quot;,9225:&quot;en-029&quot;,16393:&quot;en-IN&quot;,6153:&quot;en-IE&quot;,8201:&quot;en-JM&quot;,17417:&quot;en-MY&quot;,5129:&quot;en-NZ&quot;,13321:&quot;en-PH&quot;,18441:&quot;en-SG&quot;,7177:&quot;en-ZA&quot;,11273:&quot;en-TT&quot;,2057:&quot;en-GB&quot;,1033:&quot;en&quot;,12297:&quot;en-ZW&quot;,1061:&quot;et&quot;,1080:&quot;fo&quot;,1124:&quot;fil&quot;,1035:&quot;fi&quot;,2060:&quot;fr-BE&quot;,3084:&quot;fr-CA&quot;,1036:&quot;fr&quot;,5132:&quot;fr-LU&quot;,6156:&quot;fr-MC&quot;,4108:&quot;fr-CH&quot;,1122:&quot;fy&quot;,1110:&quot;gl&quot;,1079:&quot;ka&quot;,3079:&quot;de-AT&quot;,1031:&quot;de&quot;,5127:&quot;de-LI&quot;,4103:&quot;de-LU&quot;,2055:&quot;de-CH&quot;,1032:&quot;el&quot;,1135:&quot;kl&quot;,1095:&quot;gu&quot;,1128:&quot;ha&quot;,1037:&quot;he&quot;,1081:&quot;hi&quot;,1038:&quot;hu&quot;,1039:&quot;is&quot;,1136:&quot;ig&quot;,1057:&quot;id&quot;,1117:&quot;iu&quot;,2141:&quot;iu-Latn&quot;,2108:&quot;ga&quot;,1076:&quot;xh&quot;,1077:&quot;zu&quot;,1040:&quot;it&quot;,2064:&quot;it-CH&quot;,1041:&quot;ja&quot;,1099:&quot;kn&quot;,1087:&quot;kk&quot;,1107:&quot;km&quot;,1158:&quot;quc&quot;,1159:&quot;rw&quot;,1089:&quot;sw&quot;,1111:&quot;kok&quot;,1042:&quot;ko&quot;,1088:&quot;ky&quot;,1108:&quot;lo&quot;,1062:&quot;lv&quot;,1063:&quot;lt&quot;,2094:&quot;dsb&quot;,1134:&quot;lb&quot;,1071:&quot;mk&quot;,2110:&quot;ms-BN&quot;,1086:&quot;ms&quot;,1100:&quot;ml&quot;,1082:&quot;mt&quot;,1153:&quot;mi&quot;,1146:&quot;arn&quot;,1102:&quot;mr&quot;,1148:&quot;moh&quot;,1104:&quot;mn&quot;,2128:&quot;mn-CN&quot;,1121:&quot;ne&quot;,1044:&quot;nb&quot;,2068:&quot;nn&quot;,1154:&quot;oc&quot;,1096:&quot;or&quot;,1123:&quot;ps&quot;,1045:&quot;pl&quot;,1046:&quot;pt&quot;,2070:&quot;pt-PT&quot;,1094:&quot;pa&quot;,1131:&quot;qu-BO&quot;,2155:&quot;qu-EC&quot;,3179:&quot;qu&quot;,1048:&quot;ro&quot;,1047:&quot;rm&quot;,1049:&quot;ru&quot;,9275:&quot;smn&quot;,4155:&quot;smj-NO&quot;,5179:&quot;smj&quot;,3131:&quot;se-FI&quot;,1083:&quot;se&quot;,2107:&quot;se-SE&quot;,8251:&quot;sms&quot;,6203:&quot;sma-NO&quot;,7227:&quot;sms&quot;,1103:&quot;sa&quot;,7194:&quot;sr-Cyrl-BA&quot;,3098:&quot;sr&quot;,6170:&quot;sr-Latn-BA&quot;,2074:&quot;sr-Latn&quot;,1132:&quot;nso&quot;,1074:&quot;tn&quot;,1115:&quot;si&quot;,1051:&quot;sk&quot;,1060:&quot;sl&quot;,11274:&quot;es-AR&quot;,16394:&quot;es-BO&quot;,13322:&quot;es-CL&quot;,9226:&quot;es-CO&quot;,5130:&quot;es-CR&quot;,7178:&quot;es-DO&quot;,12298:&quot;es-EC&quot;,17418:&quot;es-SV&quot;,4106:&quot;es-GT&quot;,18442:&quot;es-HN&quot;,2058:&quot;es-MX&quot;,19466:&quot;es-NI&quot;,6154:&quot;es-PA&quot;,15370:&quot;es-PY&quot;,10250:&quot;es-PE&quot;,20490:&quot;es-PR&quot;,3082:&quot;es&quot;,1034:&quot;es&quot;,21514:&quot;es-US&quot;,14346:&quot;es-UY&quot;,8202:&quot;es-VE&quot;,2077:&quot;sv-FI&quot;,1053:&quot;sv&quot;,1114:&quot;syr&quot;,1064:&quot;tg&quot;,2143:&quot;tzm&quot;,1097:&quot;ta&quot;,1092:&quot;tt&quot;,1098:&quot;te&quot;,1054:&quot;th&quot;,1105:&quot;bo&quot;,1055:&quot;tr&quot;,1090:&quot;tk&quot;,1152:&quot;ug&quot;,1058:&quot;uk&quot;,1070:&quot;hsb&quot;,1056:&quot;ur&quot;,2115:&quot;uz-Cyrl&quot;,1091:&quot;uz&quot;,1066:&quot;vi&quot;,1106:&quot;cy&quot;,1160:&quot;wo&quot;,1157:&quot;sah&quot;,1144:&quot;ii&quot;,1130:&quot;yo&quot;};function getLanguageCode(platformID,languageID,ltag){switch(platformID){case 0:if(languageID===65535){return&quot;und&quot;}else if(ltag){return ltag[languageID]}break;case 1:return macLanguages[languageID];case 3:return windowsLanguages[languageID]}return undefined}var utf16=&quot;utf-16&quot;;var macScriptEncodings={0:&quot;macintosh&quot;,1:&quot;x-mac-japanese&quot;,2:&quot;x-mac-chinesetrad&quot;,3:&quot;x-mac-korean&quot;,6:&quot;x-mac-greek&quot;,7:&quot;x-mac-cyrillic&quot;,9:&quot;x-mac-devanagai&quot;,10:&quot;x-mac-gurmukhi&quot;,11:&quot;x-mac-gujarati&quot;,12:&quot;x-mac-oriya&quot;,13:&quot;x-mac-bengali&quot;,14:&quot;x-mac-tamil&quot;,15:&quot;x-mac-telugu&quot;,16:&quot;x-mac-kannada&quot;,17:&quot;x-mac-malayalam&quot;,18:&quot;x-mac-sinhalese&quot;,19:&quot;x-mac-burmese&quot;,20:&quot;x-mac-khmer&quot;,21:&quot;x-mac-thai&quot;,22:&quot;x-mac-lao&quot;,23:&quot;x-mac-georgian&quot;,24:&quot;x-mac-armenian&quot;,25:&quot;x-mac-chinesesimp&quot;,26:&quot;x-mac-tibetan&quot;,27:&quot;x-mac-mongolian&quot;,28:&quot;x-mac-ethiopic&quot;,29:&quot;x-mac-ce&quot;,30:&quot;x-mac-vietnamese&quot;,31:&quot;x-mac-extarabic&quot;};var macLanguageEncodings={15:&quot;x-mac-icelandic&quot;,17:&quot;x-mac-turkish&quot;,18:&quot;x-mac-croatian&quot;,24:&quot;x-mac-ce&quot;,25:&quot;x-mac-ce&quot;,26:&quot;x-mac-ce&quot;,27:&quot;x-mac-ce&quot;,28:&quot;x-mac-ce&quot;,30:&quot;x-mac-icelandic&quot;,37:&quot;x-mac-romanian&quot;,38:&quot;x-mac-ce&quot;,39:&quot;x-mac-ce&quot;,40:&quot;x-mac-ce&quot;,143:&quot;x-mac-inuit&quot;,146:&quot;x-mac-gaelic&quot;};function getEncoding(platformID,encodingID,languageID){switch(platformID){case 0:return utf16;case 1:return macLanguageEncodings[languageID]||macScriptEncodings[encodingID];case 3:if(encodingID===1||encodingID===10){return utf16}break}return undefined}function parseNameTable(data,start,ltag){var name={};var p=new Parser(data,start);var format=p.parseUShort();var count=p.parseUShort();var stringOffset=p.offset+p.parseUShort();for(var i=0;i&lt;count;i++){var platformID=p.parseUShort();var encodingID=p.parseUShort();var languageID=p.parseUShort();var nameID=p.parseUShort();var property=nameTableNames[nameID]||nameID;var byteLength=p.parseUShort();var offset=p.parseUShort();var language=getLanguageCode(platformID,languageID,ltag);var encoding=getEncoding(platformID,encodingID,languageID);if(encoding!==undefined&amp;&amp;language!==undefined){var text;if(encoding===utf16){text=decode.UTF16(data,stringOffset+offset,byteLength)}else{text=decode.MACSTRING(data,stringOffset+offset,byteLength,encoding)}if(text){var translations=name[property];if(translations===undefined){translations=name[property]={}}translations[language]=text}}}var langTagCount=0;if(format===1){langTagCount=p.parseUShort()}return name}function reverseDict(dict){var result={};for(var key in dict){result[dict[key]]=parseInt(key)}return result}function makeNameRecord(platformID,encodingID,languageID,nameID,length,offset){return new table.Record(&quot;NameRecord&quot;,[{name:&quot;platformID&quot;,type:&quot;USHORT&quot;,value:platformID},{name:&quot;encodingID&quot;,type:&quot;USHORT&quot;,value:encodingID},{name:&quot;languageID&quot;,type:&quot;USHORT&quot;,value:languageID},{name:&quot;nameID&quot;,type:&quot;USHORT&quot;,value:nameID},{name:&quot;length&quot;,type:&quot;USHORT&quot;,value:length},{name:&quot;offset&quot;,type:&quot;USHORT&quot;,value:offset}])}function findSubArray(needle,haystack){var needleLength=needle.length;var limit=haystack.length-needleLength+1;loop:for(var pos=0;pos&lt;limit;pos++){for(;pos&lt;limit;pos++){for(var k=0;k&lt;needleLength;k++){if(haystack[pos+k]!==needle[k]){continue loop}}return pos}}return-1}function addStringToPool(s,pool){var offset=findSubArray(s,pool);if(offset&lt;0){offset=pool.length;for(var i=0,len=s.length;i&lt;len;++i){pool.push(s[i])}}return offset}function makeNameTable(names,ltag){var nameID;var nameIDs=[];var namesWithNumericKeys={};var nameTableIds=reverseDict(nameTableNames);for(var key in names){var id=nameTableIds[key];if(id===undefined){id=key}nameID=parseInt(id);namesWithNumericKeys[nameID]=names[key];nameIDs.push(nameID)}var macLanguageIds=reverseDict(macLanguages);var windowsLanguageIds=reverseDict(windowsLanguages);var nameRecords=[];var stringPool=[];for(var i=0;i&lt;nameIDs.length;i++){nameID=nameIDs[i];var translations=namesWithNumericKeys[nameID];for(var lang in translations){var text=translations[lang];var macPlatform=1;var macLanguage=macLanguageIds[lang];var macScript=macLanguageToScript[macLanguage];var macEncoding=getEncoding(macPlatform,macScript,macLanguage);var macName=encode.MACSTRING(text,macEncoding);if(macName===undefined){macPlatform=0;macLanguage=ltag.indexOf(lang);if(macLanguage&lt;0){macLanguage=ltag.length;ltag.push(lang)}macScript=4;macName=encode.UTF16(text)}var macNameOffset=addStringToPool(macName,stringPool);nameRecords.push(makeNameRecord(macPlatform,macScript,macLanguage,nameID,macName.length,macNameOffset));var winLanguage=windowsLanguageIds[lang];if(winLanguage!==undefined){var winName=encode.UTF16(text);var winNameOffset=addStringToPool(winName,stringPool);nameRecords.push(makeNameRecord(3,1,winLanguage,nameID,winName.length,winNameOffset))}}}nameRecords.sort(function(a,b){return a.platformID-b.platformID||a.encodingID-b.encodingID||a.languageID-b.languageID||a.nameID-b.nameID});var t=new table.Table(&quot;name&quot;,[{name:&quot;format&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;count&quot;,type:&quot;USHORT&quot;,value:nameRecords.length},{name:&quot;stringOffset&quot;,type:&quot;USHORT&quot;,value:6+nameRecords.length*12}]);for(var r=0;r&lt;nameRecords.length;r++){t.fields.push({name:&quot;record_&quot;+r,type:&quot;RECORD&quot;,value:nameRecords[r]})}t.fields.push({name:&quot;strings&quot;,type:&quot;LITERAL&quot;,value:stringPool});return t}var unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(unicode){for(var i=0;i&lt;unicodeRanges.length;i+=1){var range=unicodeRanges[i];if(unicode&gt;=range.begin&amp;&amp;unicode&lt;range.end){return i}}return-1}var os2={};function parseOS2Table(data,start){var p=new Parser(data,start);os2.version=p.parseUShort();os2.xAvgCharWidth=p.parseShort();os2.usWeightClass=p.parseUShort();os2.usWidthClass=p.parseUShort();os2.fsType=p.parseUShort();os2.ySubscriptXSize=p.parseShort();os2.ySubscriptYSize=p.parseShort();os2.ySubscriptXOffset=p.parseShort();os2.ySubscriptYOffset=p.parseShort();os2.ySuperscriptXSize=p.parseShort();os2.ySuperscriptYSize=p.parseShort();os2.ySuperscriptXOffset=p.parseShort();os2.ySuperscriptYOffset=p.parseShort();os2.yStrikeoutSize=p.parseShort();os2.yStrikeoutPosition=p.parseShort();os2.sFamilyClass=p.parseShort();os2.panose=[];for(var i=0;i&lt;10;i++){os2.panose[i]=p.parseByte()}os2.ulUnicodeRange1=p.parseULong();os2.ulUnicodeRange2=p.parseULong();os2.ulUnicodeRange3=p.parseULong();os2.ulUnicodeRange4=p.parseULong();os2.achVendID=String.fromCharCode(p.parseByte(),p.parseByte(),p.parseByte(),p.parseByte());os2.fsSelection=p.parseUShort();os2.usFirstCharIndex=p.parseUShort();os2.usLastCharIndex=p.parseUShort();os2.sTypoAscender=p.parseShort();os2.sTypoDescender=p.parseShort();os2.sTypoLineGap=p.parseShort();os2.usWinAscent=p.parseUShort();os2.usWinDescent=p.parseUShort();if(os2.version&gt;=1){os2.ulCodePageRange1=p.parseULong();os2.ulCodePageRange2=p.parseULong()}if(os2.version&gt;=2){os2.sxHeight=p.parseShort();os2.sCapHeight=p.parseShort();os2.usDefaultChar=p.parseUShort();os2.usBreakChar=p.parseUShort();os2.usMaxContent=p.parseUShort()}return os2}function makeOS2Table(options){return new table.Table(&quot;OS/2&quot;,[{name:&quot;version&quot;,type:&quot;USHORT&quot;,value:3},{name:&quot;xAvgCharWidth&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;usWeightClass&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;usWidthClass&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;fsType&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;ySubscriptXSize&quot;,type:&quot;SHORT&quot;,value:650},{name:&quot;ySubscriptYSize&quot;,type:&quot;SHORT&quot;,value:699},{name:&quot;ySubscriptXOffset&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;ySubscriptYOffset&quot;,type:&quot;SHORT&quot;,value:140},{name:&quot;ySuperscriptXSize&quot;,type:&quot;SHORT&quot;,value:650},{name:&quot;ySuperscriptYSize&quot;,type:&quot;SHORT&quot;,value:699},{name:&quot;ySuperscriptXOffset&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;ySuperscriptYOffset&quot;,type:&quot;SHORT&quot;,value:479},{name:&quot;yStrikeoutSize&quot;,type:&quot;SHORT&quot;,value:49},{name:&quot;yStrikeoutPosition&quot;,type:&quot;SHORT&quot;,value:258},{name:&quot;sFamilyClass&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;bFamilyType&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bSerifStyle&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bWeight&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bProportion&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bContrast&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bStrokeVariation&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bArmStyle&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bLetterform&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bMidline&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;bXHeight&quot;,type:&quot;BYTE&quot;,value:0},{name:&quot;ulUnicodeRange1&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;ulUnicodeRange2&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;ulUnicodeRange3&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;ulUnicodeRange4&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;achVendID&quot;,type:&quot;CHARARRAY&quot;,value:&quot;XXXX&quot;},{name:&quot;fsSelection&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;usFirstCharIndex&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;usLastCharIndex&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;sTypoAscender&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;sTypoDescender&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;sTypoLineGap&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;usWinAscent&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;usWinDescent&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;ulCodePageRange1&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;ulCodePageRange2&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;sxHeight&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;sCapHeight&quot;,type:&quot;SHORT&quot;,value:0},{name:&quot;usDefaultChar&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;usBreakChar&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;usMaxContext&quot;,type:&quot;USHORT&quot;,value:0}],options)}function parsePostTable(data,start){var post={};var p=new Parser(data,start);var i;post.version=p.parseVersion();post.italicAngle=p.parseFixed();post.underlinePosition=p.parseShort();post.underlineThickness=p.parseShort();post.isFixedPitch=p.parseULong();post.minMemType42=p.parseULong();post.maxMemType42=p.parseULong();post.minMemType1=p.parseULong();post.maxMemType1=p.parseULong();switch(post.version){case 1:post.names=standardNames.slice();break;case 2:post.numberOfGlyphs=p.parseUShort();post.glyphNameIndex=new Array(post.numberOfGlyphs);for(i=0;i&lt;post.numberOfGlyphs;i++){post.glyphNameIndex[i]=p.parseUShort()}post.names=[];for(i=0;i&lt;post.numberOfGlyphs;i++){if(post.glyphNameIndex[i]&gt;=standardNames.length){var nameLength=p.parseChar();post.names.push(p.parseString(nameLength))}}break;case 2.5:post.numberOfGlyphs=p.parseUShort();post.offset=new Array(post.numberOfGlyphs);for(i=0;i&lt;post.numberOfGlyphs;i++){post.offset[i]=p.parseChar()}break}return post}function makePostTable(){return new table.Table(&quot;post&quot;,[{name:&quot;version&quot;,type:&quot;FIXED&quot;,value:196608},{name:&quot;italicAngle&quot;,type:&quot;FIXED&quot;,value:0},{name:&quot;underlinePosition&quot;,type:&quot;FWORD&quot;,value:0},{name:&quot;underlineThickness&quot;,type:&quot;FWORD&quot;,value:0},{name:&quot;isFixedPitch&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;minMemType42&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;maxMemType42&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;minMemType1&quot;,type:&quot;ULONG&quot;,value:0},{name:&quot;maxMemType1&quot;,type:&quot;ULONG&quot;,value:0}])}function log2(v){return Math.log(v)/Math.log(2)|0}function computeCheckSum(bytes){while(bytes.length%4!==0){bytes.push(0)}var sum=0;for(var i=0;i&lt;bytes.length;i+=4){sum+=(bytes[i]&lt;&lt;24)+(bytes[i+1]&lt;&lt;16)+(bytes[i+2]&lt;&lt;8)+bytes[i+3]}sum%=Math.pow(2,32);return sum}function makeTableRecord(tag,checkSum,offset,length){return new table.Record(&quot;Table Record&quot;,[{name:&quot;tag&quot;,type:&quot;TAG&quot;,value:tag!==undefined?tag:&quot;&quot;},{name:&quot;checkSum&quot;,type:&quot;ULONG&quot;,value:checkSum!==undefined?checkSum:0},{name:&quot;offset&quot;,type:&quot;ULONG&quot;,value:offset!==undefined?offset:0},{name:&quot;length&quot;,type:&quot;ULONG&quot;,value:length!==undefined?length:0}])}function makeSfntTable(tables){var sfnt=new table.Table(&quot;sfnt&quot;,[{name:&quot;version&quot;,type:&quot;TAG&quot;,value:&quot;OTTO&quot;},{name:&quot;numTables&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;searchRange&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;entrySelector&quot;,type:&quot;USHORT&quot;,value:0},{name:&quot;rangeShift&quot;,type:&quot;USHORT&quot;,value:0}]);sfnt.tables=tables;sfnt.numTables=tables.length;var highestPowerOf2=Math.pow(2,log2(sfnt.numTables));sfnt.searchRange=16*highestPowerOf2;sfnt.entrySelector=log2(highestPowerOf2);sfnt.rangeShift=sfnt.numTables*16-sfnt.searchRange;var recordFields=[];var tableFields=[];var offset=sfnt.sizeOf()+makeTableRecord().sizeOf()*sfnt.numTables;while(offset%4!==0){offset+=1;tableFields.push({name:&quot;padding&quot;,type:&quot;BYTE&quot;,value:0})}for(var i=0;i&lt;tables.length;i+=1){var t=tables[i];assert(t.tableName.length===4,&quot;Table name&quot;+t.tableName+&quot; is invalid.&quot;);var tableLength=t.sizeOf();var tableRecord=makeTableRecord(t.tableName,computeCheckSum(t.encode()),offset,tableLength);recordFields.push({name:tableRecord.tag+&quot; Table Record&quot;,type:&quot;RECORD&quot;,value:tableRecord});tableFields.push({name:t.tableName+&quot; table&quot;,type:&quot;RECORD&quot;,value:t});offset+=tableLength;assert(!isNaN(offset),&quot;Something went wrong calculating the offset.&quot;);while(offset%4!==0){offset+=1;tableFields.push({name:&quot;padding&quot;,type:&quot;BYTE&quot;,value:0})}}recordFields.sort(function(r1,r2){if(r1.value.tag&gt;r2.value.tag){return 1}else{return-1}});sfnt.fields=sfnt.fields.concat(recordFields);sfnt.fields=sfnt.fields.concat(tableFields);return sfnt}function metricsForChar(font,chars,notFoundMetrics){for(var i=0;i&lt;chars.length;i+=1){var glyphIndex=font.charToGlyphIndex(chars[i]);if(glyphIndex&gt;0){var glyph=font.glyphs.get(glyphIndex);return glyph.getMetrics()}}return notFoundMetrics}function average(vs){var sum=0;for(var i=0;i&lt;vs.length;i+=1){sum+=vs[i]}return sum/vs.length}function fontToSfntTable(font){var xMins=[];var yMins=[];var xMaxs=[];var yMaxs=[];var advanceWidths=[];var leftSideBearings=[];var rightSideBearings=[];var firstCharIndex;var lastCharIndex=0;var ulUnicodeRange1=0;var ulUnicodeRange2=0;var ulUnicodeRange3=0;var ulUnicodeRange4=0;for(var i=0;i&lt;font.glyphs.length;i+=1){var glyph=font.glyphs.get(i);var unicode=glyph.unicode|0;if(typeof glyph.advanceWidth===&quot;undefined&quot;){throw new Error(&quot;Glyph &quot;+glyph.name+&quot; (&quot;+i+&quot;): advanceWidth is required.&quot;)}if(firstCharIndex&gt;unicode||firstCharIndex===null){firstCharIndex=unicode}if(lastCharIndex&lt;unicode){lastCharIndex=unicode}var position=os2.getUnicodeRange(unicode);if(position&lt;32){ulUnicodeRange1|=1&lt;&lt;position}else if(position&lt;64){ulUnicodeRange2|=1&lt;&lt;position-32}else if(position&lt;96){ulUnicodeRange3|=1&lt;&lt;position-64}else if(position&lt;123){ulUnicodeRange4|=1&lt;&lt;position-96}else{throw new Error(&quot;Unicode ranges bits &gt; 123 are reserved for internal usage&quot;)}if(glyph.name===&quot;.notdef&quot;)continue;var metrics=glyph.getMetrics();xMins.push(metrics.xMin);yMins.push(metrics.yMin);xMaxs.push(metrics.xMax);yMaxs.push(metrics.yMax);leftSideBearings.push(metrics.leftSideBearing);rightSideBearings.push(metrics.rightSideBearing);advanceWidths.push(glyph.advanceWidth)}var globals={xMin:Math.min.apply(null,xMins),yMin:Math.min.apply(null,yMins),xMax:Math.max.apply(null,xMaxs),yMax:Math.max.apply(null,yMaxs),advanceWidthMax:Math.max.apply(null,advanceWidths),advanceWidthAvg:average(advanceWidths),minLeftSideBearing:Math.min.apply(null,leftSideBearings),maxLeftSideBearing:Math.max.apply(null,leftSideBearings),minRightSideBearing:Math.min.apply(null,rightSideBearings)};globals.ascender=font.ascender;globals.descender=font.descender;var headTable=head.make({flags:3,unitsPerEm:font.unitsPerEm,xMin:globals.xMin,yMin:globals.yMin,xMax:globals.xMax,yMax:globals.yMax,lowestRecPPEM:3});var hheaTable=hhea.make({ascender:globals.ascender,descender:globals.descender,advanceWidthMax:globals.advanceWidthMax,minLeftSideBearing:globals.minLeftSideBearing,minRightSideBearing:globals.minRightSideBearing,xMaxExtent:globals.maxLeftSideBearing+(globals.xMax-globals.xMin),numberOfHMetrics:font.glyphs.length});var maxpTable=maxp.make(font.glyphs.length);var os2Table=os2.make({xAvgCharWidth:Math.round(globals.advanceWidthAvg),usWeightClass:500,usWidthClass:5,usFirstCharIndex:firstCharIndex,usLastCharIndex:lastCharIndex,ulUnicodeRange1:ulUnicodeRange1,ulUnicodeRange2:ulUnicodeRange2,ulUnicodeRange3:ulUnicodeRange3,ulUnicodeRange4:ulUnicodeRange4,fsSelection:64,sTypoAscender:globals.ascender,sTypoDescender:globals.descender,sTypoLineGap:0,usWinAscent:globals.yMax,usWinDescent:Math.abs(globals.yMin),ulCodePageRange1:1,sxHeight:metricsForChar(font,&quot;xyvw&quot;,{yMax:Math.round(globals.ascender/2)}).yMax,sCapHeight:metricsForChar(font,&quot;HIKLEFJMNTZBDPRAGOQSUVWXY&quot;,globals).yMax,usDefaultChar:font.hasChar(&quot; &quot;)?32:0,usBreakChar:font.hasChar(&quot; &quot;)?32:0});var hmtxTable=hmtx.make(font.glyphs);var cmapTable=cmap.make(font.glyphs);var englishFamilyName=font.getEnglishName(&quot;fontFamily&quot;);var englishStyleName=font.getEnglishName(&quot;fontSubfamily&quot;);var englishFullName=englishFamilyName+&quot; &quot;+englishStyleName;var postScriptName=font.getEnglishName(&quot;postScriptName&quot;);if(!postScriptName){postScriptName=englishFamilyName.replace(/\s/g,&quot;&quot;)+&quot;-&quot;+englishStyleName}var names={};for(var n in font.names){names[n]=font.names[n]}if(!names.uniqueID){names.uniqueID={en:font.getEnglishName(&quot;manufacturer&quot;)+&quot;:&quot;+englishFullName}}if(!names.postScriptName){names.postScriptName={en:postScriptName}}if(!names.preferredFamily){names.preferredFamily=font.names.fontFamily}if(!names.preferredSubfamily){names.preferredSubfamily=font.names.fontSubfamily}var languageTags=[];var nameTable=makeNameTable(names,languageTags);var ltagTable=languageTags.length&gt;0?ltag.make(languageTags):undefined;var postTable=post.make();var cffTable=cff.make(font.glyphs,{version:font.getEnglishName(&quot;version&quot;),fullName:englishFullName,familyName:englishFamilyName,weightName:englishStyleName,postScriptName:postScriptName,unitsPerEm:font.unitsPerEm,fontBBox:[0,globals.yMin,globals.ascender,globals.advanceWidthMax]});var tables=[headTable,hheaTable,maxpTable,os2Table,nameTable,cmapTable,postTable,cffTable,hmtxTable];if(ltagTable){tables.push(ltagTable)}var sfntTable=makeSfntTable(tables);var bytes=sfntTable.encode();var checkSum=computeCheckSum(bytes);var tableFields=sfntTable.fields;var checkSumAdjusted=false;for(i=0;i&lt;tableFields.length;i+=1){if(tableFields[i].name===&quot;head table&quot;){tableFields[i].value.checkSumAdjustment=2981146554-checkSum;checkSumAdjusted=true;break}}if(!checkSumAdjusted){throw new Error(&quot;Could not find head table with checkSum to adjust.&quot;)}return sfntTable}var LIMIT16=32768;var LIMIT32=2147483648;var decode={};var encode={};var sizeOf={};function constant(v){return function(){return v}}encode.BYTE=function(v){assert(v&gt;=0&amp;&amp;v&lt;=255,&quot;Byte value should be between 0 and 255.&quot;);return[v]};sizeOf.BYTE=constant(1);encode.CHAR=function(v){return[v.charCodeAt(0)]};sizeOf.CHAR=constant(1);encode.CHARARRAY=function(v){var b=[];for(var i=0;i&lt;v.length;i+=1){b.push(v.charCodeAt(i))}return b};sizeOf.CHARARRAY=function(v){return v.length};encode.USHORT=function(v){return[v&gt;&gt;8&amp;255,v&amp;255]};sizeOf.USHORT=constant(2);encode.SHORT=function(v){if(v&gt;=LIMIT16){v=-(2*LIMIT16-v)}return[v&gt;&gt;8&amp;255,v&amp;255]};sizeOf.SHORT=constant(2);encode.UINT24=function(v){return[v&gt;&gt;16&amp;255,v&gt;&gt;8&amp;255,v&amp;255]};sizeOf.UINT24=constant(3);encode.ULONG=function(v){return[v&gt;&gt;24&amp;255,v&gt;&gt;16&amp;255,v&gt;&gt;8&amp;255,v&amp;255]};sizeOf.ULONG=constant(4);encode.LONG=function(v){if(v&gt;=LIMIT32){v=-(2*LIMIT32-v)}return[v&gt;&gt;24&amp;255,v&gt;&gt;16&amp;255,v&gt;&gt;8&amp;255,v&amp;255]};sizeOf.LONG=constant(4);encode.FIXED=encode.ULONG;sizeOf.FIXED=sizeOf.ULONG;encode.FWORD=encode.SHORT;sizeOf.FWORD=sizeOf.SHORT;encode.UFWORD=encode.USHORT;sizeOf.UFWORD=sizeOf.USHORT;encode.LONGDATETIME=function(){return[0,0,0,0,0,0,0,0]};sizeOf.LONGDATETIME=constant(8);encode.TAG=function(v){assert(v.length===4,&quot;Tag should be exactly 4 ASCII characters.&quot;);return[v.charCodeAt(0),v.charCodeAt(1),v.charCodeAt(2),v.charCodeAt(3)]};sizeOf.TAG=constant(4);encode.Card8=encode.BYTE;sizeOf.Card8=sizeOf.BYTE;encode.Card16=encode.USHORT;sizeOf.Card16=sizeOf.USHORT;encode.OffSize=encode.BYTE;sizeOf.OffSize=sizeOf.BYTE;encode.SID=encode.USHORT;sizeOf.SID=sizeOf.USHORT;encode.NUMBER=function(v){if(v&gt;=-107&amp;&amp;v&lt;=107){return[v+139]}else if(v&gt;=108&amp;&amp;v&lt;=1131){v=v-108;return[(v&gt;&gt;8)+247,v&amp;255]}else if(v&gt;=-1131&amp;&amp;v&lt;=-108){v=-v-108;return[(v&gt;&gt;8)+251,v&amp;255]}else if(v&gt;=-32768&amp;&amp;v&lt;=32767){return encode.NUMBER16(v)}else{return encode.NUMBER32(v)}};sizeOf.NUMBER=function(v){return encode.NUMBER(v).length};encode.NUMBER16=function(v){return[28,v&gt;&gt;8&amp;255,v&amp;255]};sizeOf.NUMBER16=constant(3);encode.NUMBER32=function(v){return[29,v&gt;&gt;24&amp;255,v&gt;&gt;16&amp;255,v&gt;&gt;8&amp;255,v&amp;255]};sizeOf.NUMBER32=constant(5);encode.REAL=function(v){var value=v.toString();var m=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(value);if(m){var epsilon=parseFloat(&quot;1e&quot;+((m[2]?+m[2]:0)+m[1].length));value=(Math.round(v*epsilon)/epsilon).toString()}var nibbles=&quot;&quot;;var i;var ii;for(i=0,ii=value.length;i&lt;ii;i+=1){var c=value[i];if(c===&quot;e&quot;){nibbles+=value[++i]===&quot;-&quot;?&quot;c&quot;:&quot;b&quot;}else if(c===&quot;.&quot;){nibbles+=&quot;a&quot;}else if(c===&quot;-&quot;){nibbles+=&quot;e&quot;}else{nibbles+=c}}nibbles+=nibbles.length&amp;1?&quot;f&quot;:&quot;ff&quot;;var out=[30];for(i=0,ii=nibbles.length;i&lt;ii;i+=2){out.push(parseInt(nibbles.substr(i,2),16))}return out};sizeOf.REAL=function(v){return encode.REAL(v).length};encode.NAME=encode.CHARARRAY;sizeOf.NAME=sizeOf.CHARARRAY;encode.STRING=encode.CHARARRAY;sizeOf.STRING=sizeOf.CHARARRAY;decode.UTF16=function(data,offset,numBytes){var codePoints=[];var numChars=numBytes/2;for(var j=0;j&lt;numChars;j++,offset+=2){codePoints[j]=data.getUint16(offset)}return String.fromCharCode.apply(null,codePoints)};encode.UTF16=function(v){var b=[];for(var i=0;i&lt;v.length;i+=1){var codepoint=v.charCodeAt(i);b.push(codepoint&gt;&gt;8&amp;255);b.push(codepoint&amp;255)}return b};sizeOf.UTF16=function(v){return v.length*2};var eightBitMacEncodings={&quot;x-mac-croatian&quot;:&quot;ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø&quot;+&quot;¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ&quot;,&quot;x-mac-cyrillic&quot;:&quot;АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњ&quot;+&quot;јЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю&quot;,&quot;x-mac-gaelic&quot;:&quot;ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæø&quot;+&quot;ṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ&quot;,&quot;x-mac-greek&quot;:&quot;Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩ&quot;+&quot;άΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­&quot;,&quot;x-mac-icelandic&quot;:&quot;ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø&quot;+&quot;¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ&quot;,&quot;x-mac-inuit&quot;:&quot;ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗ&quot;+&quot;ᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł&quot;,&quot;x-mac-ce&quot;:&quot;ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅ&quot;+&quot;ņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ&quot;,macintosh:&quot;ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø&quot;+&quot;¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ&quot;,&quot;x-mac-romanian&quot;:&quot;ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș&quot;+&quot;¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ&quot;,&quot;x-mac-turkish&quot;:&quot;ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø&quot;+&quot;¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ&quot;};decode.MACSTRING=function(dataView,offset,dataLength,encoding){var table=eightBitMacEncodings[encoding];if(table===undefined){return undefined}var result=&quot;&quot;;for(var i=0;i&lt;dataLength;i++){var c=dataView.getUint8(offset+i);if(c&lt;=127){result+=String.fromCharCode(c)}else{result+=table[c&amp;127]}}return result};var macEncodingTableCache=typeof WeakMap===&quot;function&quot;&amp;&amp;new WeakMap;var macEncodingCacheKeys;var getMacEncodingTable=function(encoding){if(!macEncodingCacheKeys){macEncodingCacheKeys={};for(var e in eightBitMacEncodings){macEncodingCacheKeys[e]=new String(e)}}var cacheKey=macEncodingCacheKeys[encoding];if(cacheKey===undefined){return undefined}if(macEncodingTableCache){var cachedTable=macEncodingTableCache.get(cacheKey);if(cachedTable!==undefined){return cachedTable}}var decodingTable=eightBitMacEncodings[encoding];if(decodingTable===undefined){return undefined}var encodingTable={};for(var i=0;i&lt;decodingTable.length;i++){encodingTable[decodingTable.charCodeAt(i)]=i+128}if(macEncodingTableCache){macEncodingTableCache.set(cacheKey,encodingTable)}return encodingTable};encode.MACSTRING=function(str,encoding){var table=getMacEncodingTable(encoding);if(table===undefined){return undefined}var result=[];for(var i=0;i&lt;str.length;i++){var c=str.charCodeAt(i);if(c&gt;=128){c=table[c];if(c===undefined){return undefined}}result.push(c)}return result};sizeOf.MACSTRING=function(str,encoding){var b=encode.MACSTRING(str,encoding);if(b!==undefined){return b.length}else{return 0}};encode.INDEX=function(l){var i;var offset=1;var offsets=[offset];var data=[];var dataSize=0;for(i=0;i&lt;l.length;i+=1){var v=encode.OBJECT(l[i]);Array.prototype.push.apply(data,v);dataSize+=v.length;offset+=v.length;offsets.push(offset)}if(data.length===0){return[0,0]}var encodedOffsets=[];var offSize=1+Math.floor(Math.log(dataSize)/Math.log(2))/8|0;var offsetEncoder=[undefined,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][offSize];for(i=0;i&lt;offsets.length;i+=1){var encodedOffset=offsetEncoder(offsets[i]);Array.prototype.push.apply(encodedOffsets,encodedOffset)}return Array.prototype.concat(encode.Card16(l.length),encode.OffSize(offSize),encodedOffsets,data)};sizeOf.INDEX=function(v){return encode.INDEX(v).length};encode.DICT=function(m){var d=[];var keys=Object.keys(m);var length=keys.length;for(var i=0;i&lt;length;i+=1){var k=parseInt(keys[i],0);var v=m[k];d=d.concat(encode.OPERAND(v.value,v.type));d=d.concat(encode.OPERATOR(k))}return d};sizeOf.DICT=function(m){return encode.DICT(m).length};encode.OPERATOR=function(v){if(v&lt;1200){return[v]}else{return[12,v-1200]}};encode.OPERAND=function(v,type){var d=[];if(Array.isArray(type)){for(var i=0;i&lt;type.length;i+=1){assert(v.length===type.length,&quot;Not enough arguments given for type&quot;+type);d=d.concat(encode.OPERAND(v[i],type[i]))}}else{if(type===&quot;SID&quot;){d=d.concat(encode.NUMBER(v))}else if(type===&quot;offset&quot;){d=d.concat(encode.NUMBER32(v))}else if(type===&quot;number&quot;){d=d.concat(encode.NUMBER(v))}else if(type===&quot;real&quot;){d=d.concat(encode.REAL(v))}else{throw new Error(&quot;Unknown operand type &quot;+type)}}return d};encode.OP=encode.BYTE;sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap===&quot;function&quot;&amp;&amp;new WeakMap;encode.CHARSTRING=function(ops){if(wmm){var cachedValue=wmm.get(ops);if(cachedValue!==undefined){return cachedValue}}var d=[];var length=ops.length;for(var i=0;i&lt;length;i+=1){var op=ops[i];d=d.concat(encode[op.type](op.value))}if(wmm){wmm.set(ops,d)}return d};sizeOf.CHARSTRING=function(ops){return encode.CHARSTRING(ops).length};encode.OBJECT=function(v){var encodingFunction=encode[v.type];assert(encodingFunction!==undefined,&quot;No encoding function for type &quot;+v.type);return encodingFunction(v.value)};sizeOf.OBJECT=function(v){var sizeOfFunction=sizeOf[v.type];assert(sizeOfFunction!==undefined,&quot;No sizeOf function for type &quot;+v.type);return sizeOfFunction(v.value)};encode.TABLE=function(table){var d=[];var length=table.fields.length;var subtables=[];var subtableOffsets=[];</td>
      </tr>
      <tr>
        <td id="L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="LC6" class="blob-code blob-code-inner js-file-line">var i;for(i=0;i&lt;length;i+=1){var field=table.fields[i];var encodingFunction=encode[field.type];assert(encodingFunction!==undefined,&quot;No encoding function for field type &quot;+field.type+&quot; (&quot;+field.name+&quot;)&quot;);var value=table[field.name];if(value===undefined){value=field.value}var bytes=encodingFunction(value);if(field.type===&quot;TABLE&quot;){subtableOffsets.push(d.length);d=d.concat([0,0]);subtables.push(bytes)}else{d=d.concat(bytes)}}for(i=0;i&lt;subtables.length;i+=1){var o=subtableOffsets[i];var offset=d.length;assert(offset&lt;65536,&quot;Table &quot;+table.tableName+&quot; too big.&quot;);d[o]=offset&gt;&gt;8;d[o+1]=offset&amp;255;d=d.concat(subtables[i])}return d};sizeOf.TABLE=function(table){var numBytes=0;var length=table.fields.length;for(var i=0;i&lt;length;i+=1){var field=table.fields[i];var sizeOfFunction=sizeOf[field.type];assert(sizeOfFunction!==undefined,&quot;No sizeOf function for field type &quot;+field.type+&quot; (&quot;+field.name+&quot;)&quot;);var value=table[field.name];if(value===undefined){value=field.value}numBytes+=sizeOfFunction(value);if(field.type===&quot;TABLE&quot;){numBytes+=2}}return numBytes};encode.RECORD=encode.TABLE;sizeOf.RECORD=sizeOf.TABLE;encode.LITERAL=function(v){return v};sizeOf.LITERAL=function(v){return v.length};opentype_isBrowser=function(){return typeof window!==&quot;undefined&quot;};opentype_isNode=function(){return typeof window===&quot;undefined&quot;};opentype_nodeBufferToArrayBuffer=function(buffer){var ab=new ArrayBuffer(buffer.length);var view=new Uint8Array(ab);for(var i=0;i&lt;buffer.length;++i){view[i]=buffer[i]}return ab};opentype_arrayBufferToNodeBuffer=function(ab){var buffer=new Buffer(ab.byteLength);var view=new Uint8Array(ab);for(var i=0;i&lt;buffer.length;++i){buffer[i]=view[i]}return buffer};opentype_checkArgument=function(expression,message){if(!expression){throw message}};function assert(condition,message){if(!condition){throw new Error(message||&quot;Assert Failed&quot;)}}var Node=function(p,t){this.point=p;this.triangle=t||null;this.next=null;this.prev=null;this.value=p.x};var AdvancingFront=function(head,tail){this.head_=head;this.tail_=tail;this.search_node_=head};AdvancingFront.prototype.head=function(){return this.head_};AdvancingFront.prototype.setHead=function(node){this.head_=node};AdvancingFront.prototype.tail=function(){return this.tail_};AdvancingFront.prototype.setTail=function(node){this.tail_=node};AdvancingFront.prototype.search=function(){return this.search_node_};AdvancingFront.prototype.setSearch=function(node){this.search_node_=node};AdvancingFront.prototype.findSearchNode=function(){return this.search_node_};AdvancingFront.prototype.locateNode=function(x){var node=this.search_node_;if(x&lt;node.value){while(node=node.prev){if(x&gt;=node.value){this.search_node_=node;return node}}}else{while(node=node.next){if(x&lt;node.value){this.search_node_=node.prev;return node.prev}}}return null};AdvancingFront.prototype.locatePoint=function(point){var px=point.x;var node=this.findSearchNode(px);var nx=node.point.x;if(px===nx){if(point!==node.point){if(point===node.prev.point){node=node.prev}else if(point===node.next.point){node=node.next}else{throw new Error(&quot;poly2tri Invalid AdvancingFront.locatePoint() call&quot;)}}}else if(px&lt;nx){while(node=node.prev){if(point===node.point){break}}}else{while(node=node.next){if(point===node.point){break}}}if(node){this.search_node_=node}return node};var Point=function(x,y){this.x=+x||0;this.y=+y||0;this._p2t_edge_list=null};Point.prototype.toJSON=function(){return{x:this.x,y:this.y}};Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.set_zero=function(){this.x=0;this.y=0;return this};Point.prototype.set=function(x,y){this.x=+x||0;this.y=+y||0;return this};Point.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};Point.prototype.add=function(n){this.x+=n.x;this.y+=n.y;return this};Point.prototype.sub=function(n){this.x-=n.x;this.y-=n.y;return this};Point.prototype.mul=function(s){this.x*=s;this.y*=s;return this};Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Point.prototype.normalize=function(){var len=this.length();this.x/=len;this.y/=len;return len};Point.prototype.equals=function(p){return this.x===p.x&amp;&amp;this.y===p.y};Point.negate=function(p){return new Point(-p.x,-p.y)};Point.add=function(a,b){return new Point(a.x+b.x,a.y+b.y)};Point.sub=function(a,b){return new Point(a.x-b.x,a.y-b.y)};Point.mul=function(s,p){return new Point(s*p.x,s*p.y)};Point.cross=function(a,b){if(typeof a===&quot;number&quot;){if(typeof b===&quot;number&quot;){return a*b}else{return new Point(-a*b.y,a*b.x)}}else{if(typeof b===&quot;number&quot;){return new Point(b*a.y,-b*a.x)}else{return a.x*b.y-a.y*b.x}}};Point.compare=function(a,b){if(a.y===b.y){return a.x-b.x}else{return a.y-b.y}};Point.toString=function(p){var s=p.toString();return s===&quot;[object Object]&quot;?toStringBase(p):s};Point.equals=function(a,b){return a.x===b.x&amp;&amp;a.y===b.y};Point.dot=function(a,b){return a.x*b.x+a.y*b.y};var PointError=function(message,points){this.name=&quot;PointError&quot;;this.points=points=points||[];this.message=message||&quot;Invalid Points!&quot;};PointError.prototype=new Error;PointError.prototype.constructor=PointError;var EPSILON=1e-12;var Orientation={CW:1,CCW:-1,COLLINEAR:0};function orient2d(pa,pb,pc){var detleft=(pa.x-pc.x)*(pb.y-pc.y);var detright=(pa.y-pc.y)*(pb.x-pc.x);var val=detleft-detright;if(val&gt;-EPSILON&amp;&amp;val&lt;EPSILON){return Orientation.COLLINEAR}else if(val&gt;0){return Orientation.CCW}else{return Orientation.CW}}function inScanArea(pa,pb,pc,pd){var oadb=(pa.x-pb.x)*(pd.y-pb.y)-(pd.x-pb.x)*(pa.y-pb.y);if(oadb&gt;=-EPSILON){return false}var oadc=(pa.x-pc.x)*(pd.y-pc.y)-(pd.x-pc.x)*(pa.y-pc.y);if(oadc&lt;=EPSILON){return false}return true}function isAngleObtuse(pa,pb,pc){var ax=pb.x-pa.x;var ay=pb.y-pa.y;var bx=pc.x-pa.x;var by=pc.y-pa.y;return ax*bx+ay*by&lt;0}function triangulate(tcx){tcx.initTriangulation();tcx.createAdvancingFront();sweepPoints(tcx);finalizationPolygon(tcx)}function sweepPoints(tcx){var i,len=tcx.pointCount();for(i=1;i&lt;len;++i){var point=tcx.getPoint(i);var node=pointEvent(tcx,point);var edges=point._p2t_edge_list;for(var j=0;edges&amp;&amp;j&lt;edges.length;++j){edgeEventByEdge(tcx,edges[j],node)}}}function finalizationPolygon(tcx){var t=tcx.front().head().next.triangle;var p=tcx.front().head().next.point;while(!t.getConstrainedEdgeCW(p)){t=t.neighborCCW(p)}tcx.meshClean(t)}function pointEvent(tcx,point){var node=tcx.locateNode(point);var new_node=newFrontTriangle(tcx,point,node);if(point.x&lt;=node.point.x+EPSILON){fill(tcx,node)}fillAdvancingFront(tcx,new_node);return new_node}function edgeEventByEdge(tcx,edge,node){tcx.edge_event.constrained_edge=edge;tcx.edge_event.right=edge.p.x&gt;edge.q.x;if(isEdgeSideOfTriangle(node.triangle,edge.p,edge.q)){return}fillEdgeEvent(tcx,edge,node);edgeEventByPoints(tcx,edge.p,edge.q,node.triangle,edge.q)}function edgeEventByPoints(tcx,ep,eq,triangle,point){if(isEdgeSideOfTriangle(triangle,ep,eq)){return}var p1=triangle.pointCCW(point);var o1=orient2d(eq,p1,ep);if(o1===Orientation.COLLINEAR){throw new PointError(&quot;poly2tri EdgeEvent: Collinear not supported!&quot;,[eq,p1,ep])}var p2=triangle.pointCW(point);var o2=orient2d(eq,p2,ep);if(o2===Orientation.COLLINEAR){throw new PointError(&quot;poly2tri EdgeEvent: Collinear not supported!&quot;,[eq,p2,ep])}if(o1===o2){if(o1===Orientation.CW){triangle=triangle.neighborCCW(point)}else{triangle=triangle.neighborCW(point)}edgeEventByPoints(tcx,ep,eq,triangle,point)}else{flipEdgeEvent(tcx,ep,eq,triangle,point)}}function isEdgeSideOfTriangle(triangle,ep,eq){var index=triangle.edgeIndex(ep,eq);if(index!==-1){triangle.markConstrainedEdgeByIndex(index);var t=triangle.getNeighbor(index);if(t){t.markConstrainedEdgeByPoints(ep,eq)}return true}return false}function newFrontTriangle(tcx,point,node){var triangle=new Triangle(point,node.point,node.next.point);triangle.markNeighbor(node.triangle);tcx.addToMap(triangle);var new_node=new Node(point);new_node.next=node.next;new_node.prev=node;node.next.prev=new_node;node.next=new_node;if(!legalize(tcx,triangle)){tcx.mapTriangleToNodes(triangle)}return new_node}function fill(tcx,node){var triangle=new Triangle(node.prev.point,node.point,node.next.point);triangle.markNeighbor(node.prev.triangle);triangle.markNeighbor(node.triangle);tcx.addToMap(triangle);node.prev.next=node.next;node.next.prev=node.prev;if(!legalize(tcx,triangle)){tcx.mapTriangleToNodes(triangle)}}function fillAdvancingFront(tcx,n){var node=n.next;while(node.next){if(isAngleObtuse(node.point,node.next.point,node.prev.point)){break}fill(tcx,node);node=node.next}node=n.prev;while(node.prev){if(isAngleObtuse(node.point,node.next.point,node.prev.point)){break}fill(tcx,node);node=node.prev}if(n.next&amp;&amp;n.next.next){if(isBasinAngleRight(n)){fillBasin(tcx,n)}}}function isBasinAngleRight(node){var ax=node.point.x-node.next.next.point.x;var ay=node.point.y-node.next.next.point.y;assert(ay&gt;=0,&quot;unordered y&quot;);return ax&gt;=0||Math.abs(ax)&lt;ay}function legalize(tcx,t){for(var i=0;i&lt;3;++i){if(t.delaunay_edge[i]){continue}var ot=t.getNeighbor(i);if(ot){var p=t.getPoint(i);var op=ot.oppositePoint(t,p);var oi=ot.index(op);if(ot.constrained_edge[oi]||ot.delaunay_edge[oi]){t.constrained_edge[i]=ot.constrained_edge[oi];continue}var inside=inCircle(p,t.pointCCW(p),t.pointCW(p),op);if(inside){t.delaunay_edge[i]=true;ot.delaunay_edge[oi]=true;rotateTrianglePair(t,p,ot,op);var not_legalized=!legalize(tcx,t);if(not_legalized){tcx.mapTriangleToNodes(t)}not_legalized=!legalize(tcx,ot);if(not_legalized){tcx.mapTriangleToNodes(ot)}t.delaunay_edge[i]=false;ot.delaunay_edge[oi]=false;return true}}}return false}function inCircle(pa,pb,pc,pd){var adx=pa.x-pd.x;var ady=pa.y-pd.y;var bdx=pb.x-pd.x;var bdy=pb.y-pd.y;var adxbdy=adx*bdy;var bdxady=bdx*ady;var oabd=adxbdy-bdxady;if(oabd&lt;=0){return false}var cdx=pc.x-pd.x;var cdy=pc.y-pd.y;var cdxady=cdx*ady;var adxcdy=adx*cdy;var ocad=cdxady-adxcdy;if(ocad&lt;=0){return false}var bdxcdy=bdx*cdy;var cdxbdy=cdx*bdy;var alift=adx*adx+ady*ady;var blift=bdx*bdx+bdy*bdy;var clift=cdx*cdx+cdy*cdy;var det=alift*(bdxcdy-cdxbdy)+blift*ocad+clift*oabd;return det&gt;0}function rotateTrianglePair(t,p,ot,op){var n1,n2,n3,n4;n1=t.neighborCCW(p);n2=t.neighborCW(p);n3=ot.neighborCCW(op);n4=ot.neighborCW(op);var ce1,ce2,ce3,ce4;ce1=t.getConstrainedEdgeCCW(p);ce2=t.getConstrainedEdgeCW(p);ce3=ot.getConstrainedEdgeCCW(op);ce4=ot.getConstrainedEdgeCW(op);var de1,de2,de3,de4;de1=t.getDelaunayEdgeCCW(p);de2=t.getDelaunayEdgeCW(p);de3=ot.getDelaunayEdgeCCW(op);de4=ot.getDelaunayEdgeCW(op);t.legalize(p,op);ot.legalize(op,p);ot.setDelaunayEdgeCCW(p,de1);t.setDelaunayEdgeCW(p,de2);t.setDelaunayEdgeCCW(op,de3);ot.setDelaunayEdgeCW(op,de4);ot.setConstrainedEdgeCCW(p,ce1);t.setConstrainedEdgeCW(p,ce2);t.setConstrainedEdgeCCW(op,ce3);ot.setConstrainedEdgeCW(op,ce4);t.clearNeighbors();ot.clearNeighbors();if(n1){ot.markNeighbor(n1)}if(n2){t.markNeighbor(n2)}if(n3){t.markNeighbor(n3)}if(n4){ot.markNeighbor(n4)}t.markNeighbor(ot)}function fillBasin(tcx,node){if(orient2d(node.point,node.next.point,node.next.next.point)===Orientation.CCW){tcx.basin.left_node=node.next.next}else{tcx.basin.left_node=node.next}tcx.basin.bottom_node=tcx.basin.left_node;while(tcx.basin.bottom_node.next&amp;&amp;tcx.basin.bottom_node.point.y&gt;=tcx.basin.bottom_node.next.point.y){tcx.basin.bottom_node=tcx.basin.bottom_node.next}if(tcx.basin.bottom_node===tcx.basin.left_node){return}tcx.basin.right_node=tcx.basin.bottom_node;while(tcx.basin.right_node.next&amp;&amp;tcx.basin.right_node.point.y&lt;tcx.basin.right_node.next.point.y){tcx.basin.right_node=tcx.basin.right_node.next}if(tcx.basin.right_node===tcx.basin.bottom_node){return}tcx.basin.width=tcx.basin.right_node.point.x-tcx.basin.left_node.point.x;tcx.basin.left_highest=tcx.basin.left_node.point.y&gt;tcx.basin.right_node.point.y;fillBasinReq(tcx,tcx.basin.bottom_node)}function fillBasinReq(tcx,node){if(isShallow(tcx,node)){return}fill(tcx,node);var o;if(node.prev===tcx.basin.left_node&amp;&amp;node.next===tcx.basin.right_node){return}else if(node.prev===tcx.basin.left_node){o=orient2d(node.point,node.next.point,node.next.next.point);if(o===Orientation.CW){return}node=node.next}else if(node.next===tcx.basin.right_node){o=orient2d(node.point,node.prev.point,node.prev.prev.point);if(o===Orientation.CCW){return}node=node.prev}else{if(node.prev.point.y&lt;node.next.point.y){node=node.prev}else{node=node.next}}fillBasinReq(tcx,node)}function isShallow(tcx,node){var height;if(tcx.basin.left_highest){height=tcx.basin.left_node.point.y-node.point.y}else{height=tcx.basin.right_node.point.y-node.point.y}if(tcx.basin.width&gt;height){return true}return false}function fillEdgeEvent(tcx,edge,node){if(tcx.edge_event.right){fillRightAboveEdgeEvent(tcx,edge,node)}else{fillLeftAboveEdgeEvent(tcx,edge,node)}}function fillRightAboveEdgeEvent(tcx,edge,node){while(node.next.point.x&lt;edge.p.x){if(orient2d(edge.q,node.next.point,edge.p)===Orientation.CCW){fillRightBelowEdgeEvent(tcx,edge,node)}else{node=node.next}}}function fillRightBelowEdgeEvent(tcx,edge,node){if(node.point.x&lt;edge.p.x){if(orient2d(node.point,node.next.point,node.next.next.point)===Orientation.CCW){fillRightConcaveEdgeEvent(tcx,edge,node)}else{fillRightConvexEdgeEvent(tcx,edge,node);fillRightBelowEdgeEvent(tcx,edge,node)}}}function fillRightConcaveEdgeEvent(tcx,edge,node){fill(tcx,node.next);if(node.next.point!==edge.p){if(orient2d(edge.q,node.next.point,edge.p)===Orientation.CCW){if(orient2d(node.point,node.next.point,node.next.next.point)===Orientation.CCW){fillRightConcaveEdgeEvent(tcx,edge,node)}else{}}}}function fillRightConvexEdgeEvent(tcx,edge,node){if(orient2d(node.next.point,node.next.next.point,node.next.next.next.point)===Orientation.CCW){fillRightConcaveEdgeEvent(tcx,edge,node.next)}else{if(orient2d(edge.q,node.next.next.point,edge.p)===Orientation.CCW){fillRightConvexEdgeEvent(tcx,edge,node.next)}else{}}}function fillLeftAboveEdgeEvent(tcx,edge,node){while(node.prev.point.x&gt;edge.p.x){if(orient2d(edge.q,node.prev.point,edge.p)===Orientation.CW){fillLeftBelowEdgeEvent(tcx,edge,node)}else{node=node.prev}}}function fillLeftBelowEdgeEvent(tcx,edge,node){if(node.point.x&gt;edge.p.x){if(orient2d(node.point,node.prev.point,node.prev.prev.point)===Orientation.CW){fillLeftConcaveEdgeEvent(tcx,edge,node)}else{fillLeftConvexEdgeEvent(tcx,edge,node);fillLeftBelowEdgeEvent(tcx,edge,node)}}}function fillLeftConvexEdgeEvent(tcx,edge,node){if(orient2d(node.prev.point,node.prev.prev.point,node.prev.prev.prev.point)===Orientation.CW){fillLeftConcaveEdgeEvent(tcx,edge,node.prev)}else{if(orient2d(edge.q,node.prev.prev.point,edge.p)===Orientation.CW){fillLeftConvexEdgeEvent(tcx,edge,node.prev)}else{}}}function fillLeftConcaveEdgeEvent(tcx,edge,node){fill(tcx,node.prev);if(node.prev.point!==edge.p){if(orient2d(edge.q,node.prev.point,edge.p)===Orientation.CW){if(orient2d(node.point,node.prev.point,node.prev.prev.point)===Orientation.CW){fillLeftConcaveEdgeEvent(tcx,edge,node)}else{}}}}function flipEdgeEvent(tcx,ep,eq,t,p){var ot=t.neighborAcross(p);assert(ot,&quot;FLIP failed due to missing triangle!&quot;);var op=ot.oppositePoint(t,p);if(t.getConstrainedEdgeAcross(p)){var index=t.index(p);throw new PointError(&quot;poly2tri Intersecting Constraints&quot;,[p,op,t.getPoint((index+1)%3),t.getPoint((index+2)%3)])}if(inScanArea(p,t.pointCCW(p),t.pointCW(p),op)){rotateTrianglePair(t,p,ot,op);tcx.mapTriangleToNodes(t);tcx.mapTriangleToNodes(ot);if(p===eq&amp;&amp;op===ep){if(eq===tcx.edge_event.constrained_edge.q&amp;&amp;ep===tcx.edge_event.constrained_edge.p){t.markConstrainedEdgeByPoints(ep,eq);ot.markConstrainedEdgeByPoints(ep,eq);legalize(tcx,t);legalize(tcx,ot)}else{}}else{var o=orient2d(eq,op,ep);t=nextFlipTriangle(tcx,o,t,ot,p,op);flipEdgeEvent(tcx,ep,eq,t,p)}}else{var newP=nextFlipPoint(ep,eq,ot,op);flipScanEdgeEvent(tcx,ep,eq,t,ot,newP);edgeEventByPoints(tcx,ep,eq,t,p)}}function nextFlipTriangle(tcx,o,t,ot,p,op){var edge_index;if(o===Orientation.CCW){edge_index=ot.edgeIndex(p,op);ot.delaunay_edge[edge_index]=true;legalize(tcx,ot);ot.clearDelaunayEdges();return t}edge_index=t.edgeIndex(p,op);t.delaunay_edge[edge_index]=true;legalize(tcx,t);t.clearDelaunayEdges();return ot}function nextFlipPoint(ep,eq,ot,op){var o2d=orient2d(eq,op,ep);if(o2d===Orientation.CW){return ot.pointCCW(op)}else if(o2d===Orientation.CCW){return ot.pointCW(op)}else{throw new PointError(&quot;poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!&quot;,[eq,op,ep])}}function flipScanEdgeEvent(tcx,ep,eq,flip_triangle,t,p){var ot=t.neighborAcross(p);assert(ot,&quot;FLIP failed due to missing triangle&quot;);var op=ot.oppositePoint(t,p);if(inScanArea(eq,flip_triangle.pointCCW(eq),flip_triangle.pointCW(eq),op)){flipEdgeEvent(tcx,eq,op,ot,op)}else{var newP=nextFlipPoint(ep,eq,ot,op);flipScanEdgeEvent(tcx,ep,eq,flip_triangle,ot,newP)}}var kAlpha=.3;var Edge=function(p1,p2){this.p=p1;this.q=p2;if(p1.y&gt;p2.y){this.q=p1;this.p=p2}else if(p1.y===p2.y){if(p1.x&gt;p2.x){this.q=p1;this.p=p2}else if(p1.x===p2.x){throw new PointError(&quot;poly2tri Invalid Edge constructor: repeated points!&quot;,[p1])}}if(!this.q._p2t_edge_list){this.q._p2t_edge_list=[]}this.q._p2t_edge_list.push(this)};var Basin=function(){this.left_node=null;this.bottom_node=null;this.right_node=null;this.width=0;this.left_highest=false};Basin.prototype.clear=function(){this.left_node=null;this.bottom_node=null;this.right_node=null;this.width=0;this.left_highest=false};var EdgeEvent=function(){this.constrained_edge=null;this.right=false};var SweepContext=function(contour,options){options=options||{};this.triangles_=[];this.map_=[];this.points_=options.cloneArrays?contour.slice(0):contour;this.edge_list=[];this.pmin_=this.pmax_=null;this.front_=null;this.head_=null;this.tail_=null;this.af_head_=null;this.af_middle_=null;this.af_tail_=null;this.basin=new Basin;this.edge_event=new EdgeEvent;this.initEdges(this.points_)};SweepContext.prototype.addHole=function(polyline){this.initEdges(polyline);var i,len=polyline.length;for(i=0;i&lt;len;i++){this.points_.push(polyline[i])}return this};SweepContext.prototype.AddHole=SweepContext.prototype.addHole;SweepContext.prototype.addHoles=function(holes){var i,len=holes.length;for(i=0;i&lt;len;i++){this.initEdges(holes[i])}this.points_=this.points_.concat.apply(this.points_,holes);return this};SweepContext.prototype.addPoint=function(point){this.points_.push(point);return this};SweepContext.prototype.AddPoint=SweepContext.prototype.addPoint;SweepContext.prototype.addPoints=function(points){this.points_=this.points_.concat(points);return this};SweepContext.prototype.triangulate=function(){triangulate(this);return this};SweepContext.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};SweepContext.prototype.getTriangles=function(){return this.triangles_};SweepContext.prototype.GetTriangles=SweepContext.prototype.getTriangles;SweepContext.prototype.front=function(){return this.front_};SweepContext.prototype.pointCount=function(){return this.points_.length};SweepContext.prototype.head=function(){return this.head_};SweepContext.prototype.setHead=function(p1){this.head_=p1};SweepContext.prototype.tail=function(){return this.tail_};SweepContext.prototype.setTail=function(p1){this.tail_=p1};SweepContext.prototype.getMap=function(){return this.map_};SweepContext.prototype.initTriangulation=function(){var xmax=this.points_[0].x;var xmin=this.points_[0].x;var ymax=this.points_[0].y;var ymin=this.points_[0].y;var i,len=this.points_.length;for(i=1;i&lt;len;i++){var p=this.points_[i];p.x&gt;xmax&amp;&amp;(xmax=p.x);p.x&lt;xmin&amp;&amp;(xmin=p.x);p.y&gt;ymax&amp;&amp;(ymax=p.y);p.y&lt;ymin&amp;&amp;(ymin=p.y)}this.pmin_=new Point(xmin,ymin);this.pmax_=new Point(xmax,ymax);var dx=kAlpha*(xmax-xmin);var dy=kAlpha*(ymax-ymin);this.head_=new Point(xmax+dx,ymin-dy);this.tail_=new Point(xmin-dx,ymin-dy);this.points_.sort(Point.compare)};SweepContext.prototype.initEdges=function(polyline){var i,len=polyline.length;for(i=0;i&lt;len;++i){this.edge_list.push(new Edge(polyline[i],polyline[(i+1)%len]))}};SweepContext.prototype.getPoint=function(index){return this.points_[index]};SweepContext.prototype.addToMap=function(triangle){this.map_.push(triangle)};SweepContext.prototype.locateNode=function(point){return this.front_.locateNode(point.x)};SweepContext.prototype.createAdvancingFront=function(){var head;var middle;var tail;var triangle=new Triangle(this.points_[0],this.tail_,this.head_);this.map_.push(triangle);head=new Node(triangle.getPoint(1),triangle);middle=new Node(triangle.getPoint(0),triangle);tail=new Node(triangle.getPoint(2));this.front_=new AdvancingFront(head,tail);head.next=middle;middle.next=tail;middle.prev=head;tail.prev=middle};SweepContext.prototype.removeNode=function(node){};SweepContext.prototype.mapTriangleToNodes=function(t){for(var i=0;i&lt;3;++i){if(!t.getNeighbor(i)){var n=this.front_.locatePoint(t.pointCW(t.getPoint(i)));if(n){n.triangle=t}}}};SweepContext.prototype.removeFromMap=function(triangle){var i,map=this.map_,len=map.length;for(i=0;i&lt;len;i++){if(map[i]===triangle){map.splice(i,1);break}}};SweepContext.prototype.meshClean=function(triangle){var triangles=[triangle],t,i;while(t=triangles.pop()){if(!t.isInterior()){t.setInterior(true);this.triangles_.push(t);for(i=0;i&lt;3;i++){if(!t.constrained_edge[i]){triangles.push(t.getNeighbor(i))}}}}};var Triangle=function(a,b,c){this.points_=[a,b,c];this.neighbors_=[null,null,null];this.interior_=false;this.constrained_edge=[false,false,false];this.delaunay_edge=[false,false,false]};Triangle.prototype.getPoint=function(index){return this.points_[index]};Triangle.prototype.GetPoint=Triangle.prototype.getPoint;Triangle.prototype.getPoints=function(){return this.points_};Triangle.prototype.getNeighbor=function(index){return this.neighbors_[index]};Triangle.prototype.containsPoint=function(point){var points=this.points_;return point===points[0]||point===points[1]||point===points[2]};Triangle.prototype.containsEdge=function(edge){return this.containsPoint(edge.p)&amp;&amp;this.containsPoint(edge.q)};Triangle.prototype.containsPoints=function(p1,p2){return this.containsPoint(p1)&amp;&amp;this.containsPoint(p2)};Triangle.prototype.isInterior=function(){return this.interior_};Triangle.prototype.setInterior=function(interior){this.interior_=interior;return this};Triangle.prototype.markNeighborPointers=function(p1,p2,t){var points=this.points_;if(p1===points[2]&amp;&amp;p2===points[1]||p1===points[1]&amp;&amp;p2===points[2]){this.neighbors_[0]=t}else if(p1===points[0]&amp;&amp;p2===points[2]||p1===points[2]&amp;&amp;p2===points[0]){this.neighbors_[1]=t}else if(p1===points[0]&amp;&amp;p2===points[1]||p1===points[1]&amp;&amp;p2===points[0]){this.neighbors_[2]=t}else{throw new Error(&quot;poly2tri Invalid Triangle.markNeighborPointers() call&quot;)}};Triangle.prototype.markNeighbor=function(t){var points=this.points_;if(t.containsPoints(points[1],points[2])){this.neighbors_[0]=t;t.markNeighborPointers(points[1],points[2],this)}else if(t.containsPoints(points[0],points[2])){this.neighbors_[1]=t;t.markNeighborPointers(points[0],points[2],this)}else if(t.containsPoints(points[0],points[1])){this.neighbors_[2]=t;t.markNeighborPointers(points[0],points[1],this)}};Triangle.prototype.clearNeighbors=function(){this.neighbors_[0]=null;this.neighbors_[1]=null;this.neighbors_[2]=null};Triangle.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=false;this.delaunay_edge[1]=false;this.delaunay_edge[2]=false};Triangle.prototype.pointCW=function(p){var points=this.points_;if(p===points[0]){return points[2]}else if(p===points[1]){return points[0]}else if(p===points[2]){return points[1]}else{return null}};Triangle.prototype.pointCCW=function(p){var points=this.points_;if(p===points[0]){return points[1]}else if(p===points[1]){return points[2]}else if(p===points[2]){return points[0]}else{return null}};Triangle.prototype.neighborCW=function(p){if(p===this.points_[0]){return this.neighbors_[1]}else if(p===this.points_[1]){return this.neighbors_[2]}else{return this.neighbors_[0]}};Triangle.prototype.neighborCCW=function(p){if(p===this.points_[0]){return this.neighbors_[2]}else if(p===this.points_[1]){return this.neighbors_[0]}else{return this.neighbors_[1]}};Triangle.prototype.getConstrainedEdgeCW=function(p){if(p===this.points_[0]){return this.constrained_edge[1]}else if(p===this.points_[1]){return this.constrained_edge[2]}else{return this.constrained_edge[0]}};Triangle.prototype.getConstrainedEdgeCCW=function(p){if(p===this.points_[0]){return this.constrained_edge[2]}else if(p===this.points_[1]){return this.constrained_edge[0]}else{return this.constrained_edge[1]}};Triangle.prototype.getConstrainedEdgeAcross=function(p){if(p===this.points_[0]){return this.constrained_edge[0]}else if(p===this.points_[1]){return this.constrained_edge[1]}else{return this.constrained_edge[2]}};Triangle.prototype.setConstrainedEdgeCW=function(p,ce){if(p===this.points_[0]){this.constrained_edge[1]=ce}else if(p===this.points_[1]){this.constrained_edge[2]=ce}else{this.constrained_edge[0]=ce}};Triangle.prototype.setConstrainedEdgeCCW=function(p,ce){if(p===this.points_[0]){this.constrained_edge[2]=ce}else if(p===this.points_[1]){this.constrained_edge[0]=ce}else{this.constrained_edge[1]=ce}};Triangle.prototype.getDelaunayEdgeCW=function(p){if(p===this.points_[0]){return this.delaunay_edge[1]}else if(p===this.points_[1]){return this.delaunay_edge[2]}else{return this.delaunay_edge[0]}};Triangle.prototype.getDelaunayEdgeCCW=function(p){if(p===this.points_[0]){return this.delaunay_edge[2]}else if(p===this.points_[1]){return this.delaunay_edge[0]}else{return this.delaunay_edge[1]}};Triangle.prototype.setDelaunayEdgeCW=function(p,e){if(p===this.points_[0]){this.delaunay_edge[1]=e}else if(p===this.points_[1]){this.delaunay_edge[2]=e}else{this.delaunay_edge[0]=e}};Triangle.prototype.setDelaunayEdgeCCW=function(p,e){if(p===this.points_[0]){this.delaunay_edge[2]=e}else if(p===this.points_[1]){this.delaunay_edge[0]=e}else{this.delaunay_edge[1]=e}};Triangle.prototype.neighborAcross=function(p){if(p===this.points_[0]){return this.neighbors_[0]}else if(p===this.points_[1]){return this.neighbors_[1]}else{return this.neighbors_[2]}};Triangle.prototype.oppositePoint=function(t,p){var cw=t.pointCW(p);return this.pointCW(cw)};Triangle.prototype.legalize=function(opoint,npoint){var points=this.points_;if(opoint===points[0]){points[1]=points[0];points[0]=points[2];points[2]=npoint}else if(opoint===points[1]){points[2]=points[1];points[1]=points[0];points[0]=npoint}else if(opoint===points[2]){points[0]=points[2];points[2]=points[1];points[1]=npoint}else{throw new Error(&quot;poly2tri Invalid Triangle.legalize() call&quot;)}};Triangle.prototype.index=function(p){var points=this.points_;if(p===points[0]){return 0}else if(p===points[1]){return 1}else if(p===points[2]){return 2}else{throw new Error(&quot;poly2tri Invalid Triangle.index() call&quot;)}};Triangle.prototype.edgeIndex=function(p1,p2){var points=this.points_;if(p1===points[0]){if(p2===points[1]){return 2}else if(p2===points[2]){return 1}}else if(p1===points[1]){if(p2===points[2]){return 0}else if(p2===points[0]){return 2}}else if(p1===points[2]){if(p2===points[0]){return 1}else if(p2===points[1]){return 0}}return-1};Triangle.prototype.markConstrainedEdgeByIndex=function(index){this.constrained_edge[index]=true};Triangle.prototype.markConstrainedEdgeByEdge=function(edge){this.markConstrainedEdgeByPoints(edge.p,edge.q)};Triangle.prototype.markConstrainedEdgeByPoints=function(p,q){var points=this.points_;if(q===points[0]&amp;&amp;p===points[1]||q===points[1]&amp;&amp;p===points[0]){this.constrained_edge[2]=true}else if(q===points[0]&amp;&amp;p===points[2]||q===points[2]&amp;&amp;p===points[0]){this.constrained_edge[1]=true}else if(q===points[1]&amp;&amp;p===points[2]||q===points[2]&amp;&amp;p===points[1]){this.constrained_edge[0]=true}};if(typeof Float32Array!=&quot;undefined&quot;){glMatrixArrayType=Float32Array}else if(typeof WebGLFloatArray!=&quot;undefined&quot;){glMatrixArrayType=WebGLFloatArray}else{glMatrixArrayType=Array}var vec3={};vec3.create=function(vec){var dest=new glMatrixArrayType(3);if(vec){dest[0]=vec[0];dest[1]=vec[1];dest[2]=vec[2]}return dest};vec3.set=function(vec,dest){dest[0]=vec[0];dest[1]=vec[1];dest[2]=vec[2];return dest};vec3.add=function(vec,vec2,dest){if(!dest||vec==dest){vec[0]+=vec2[0];vec[1]+=vec2[1];vec[2]+=vec2[2];return vec}dest[0]=vec[0]+vec2[0];dest[1]=vec[1]+vec2[1];dest[2]=vec[2]+vec2[2];return dest};vec3.subtract=function(vec,vec2,dest){if(!dest||vec==dest){vec[0]-=vec2[0];vec[1]-=vec2[1];vec[2]-=vec2[2];return vec}dest[0]=vec[0]-vec2[0];dest[1]=vec[1]-vec2[1];dest[2]=vec[2]-vec2[2];return dest};vec3.negate=function(vec,dest){if(!dest){dest=vec}dest[0]=-vec[0];dest[1]=-vec[1];dest[2]=-vec[2];return dest};vec3.scale=function(vec,val,dest){if(!dest||vec==dest){vec[0]*=val;vec[1]*=val;vec[2]*=val;return vec}dest[0]=vec[0]*val;dest[1]=vec[1]*val;dest[2]=vec[2]*val;return dest};vec3.normalize=function(vec,dest){if(!dest){dest=vec}var x=vec[0],y=vec[1],z=vec[2];var len=Math.sqrt(x*x+y*y+z*z);if(!len){dest[0]=0;dest[1]=0;dest[2]=0;return dest}else if(len==1){dest[0]=x;dest[1]=y;dest[2]=z;return dest}len=1/len;dest[0]=x*len;dest[1]=y*len;dest[2]=z*len;return dest};vec3.cross=function(vec,vec2,dest){if(!dest){dest=vec}var x=vec[0],y=vec[1],z=vec[2];var x2=vec2[0],y2=vec2[1],z2=vec2[2];dest[0]=y*z2-z*y2;dest[1]=z*x2-x*z2;dest[2]=x*y2-y*x2;return dest};vec3.length=function(vec){var x=vec[0],y=vec[1],z=vec[2];return Math.sqrt(x*x+y*y+z*z)};vec3.dot=function(vec,vec2){return vec[0]*vec2[0]+vec[1]*vec2[1]+vec[2]*vec2[2]};vec3.direction=function(vec,vec2,dest){if(!dest){dest=vec}var x=vec[0]-vec2[0];var y=vec[1]-vec2[1];var z=vec[2]-vec2[2];var len=Math.sqrt(x*x+y*y+z*z);if(!len){dest[0]=0;dest[1]=0;dest[2]=0;return dest}len=1/len;dest[0]=x*len;dest[1]=y*len;dest[2]=z*len;return dest};vec3.lerp=function(vec,vec2,lerp,dest){if(!dest){dest=vec}dest[0]=vec[0]+lerp*(vec2[0]-vec[0]);dest[1]=vec[1]+lerp*(vec2[1]-vec[1]);dest[2]=vec[2]+lerp*(vec2[2]-vec[2]);return dest};vec3.str=function(vec){return&quot;[&quot;+vec[0]+&quot;, &quot;+vec[1]+&quot;, &quot;+vec[2]+&quot;]&quot;};var mat3={};mat3.create=function(mat){var dest=new glMatrixArrayType(9);if(mat){dest[0]=mat[0];dest[1]=mat[1];dest[2]=mat[2];dest[3]=mat[3];dest[4]=mat[4];dest[5]=mat[5];dest[6]=mat[6];dest[7]=mat[7];dest[8]=mat[8]}return dest};mat3.set=function(mat,dest){dest[0]=mat[0];dest[1]=mat[1];dest[2]=mat[2];dest[3]=mat[3];dest[4]=mat[4];dest[5]=mat[5];dest[6]=mat[6];dest[7]=mat[7];dest[8]=mat[8];return dest};mat3.identity=function(dest){dest[0]=1;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=1;dest[5]=0;dest[6]=0;dest[7]=0;dest[8]=1;return dest};mat3.transpose=function(mat,dest){if(!dest||mat==dest){var a01=mat[1],a02=mat[2];var a12=mat[5];mat[1]=mat[3];mat[2]=mat[6];mat[3]=a01;mat[5]=mat[7];mat[6]=a02;mat[7]=a12;return mat}dest[0]=mat[0];dest[1]=mat[3];dest[2]=mat[6];dest[3]=mat[1];dest[4]=mat[4];dest[5]=mat[7];dest[6]=mat[2];dest[7]=mat[5];dest[8]=mat[8];return dest};mat3.toMat4=function(mat,dest){if(!dest){dest=mat4.create()}dest[0]=mat[0];dest[1]=mat[1];dest[2]=mat[2];dest[3]=0;dest[4]=mat[3];dest[5]=mat[4];dest[6]=mat[5];dest[7]=0;dest[8]=mat[6];dest[9]=mat[7];dest[10]=mat[8];dest[11]=0;dest[12]=0;dest[13]=0;dest[14]=0;dest[15]=1;return dest};mat3.str=function(mat){return&quot;[&quot;+mat[0]+&quot;, &quot;+mat[1]+&quot;, &quot;+mat[2]+&quot;, &quot;+mat[3]+&quot;, &quot;+mat[4]+&quot;, &quot;+mat[5]+&quot;, &quot;+mat[6]+&quot;, &quot;+mat[7]+&quot;, &quot;+mat[8]+&quot;]&quot;};var mat4={};mat4.create=function(mat){var dest=new glMatrixArrayType(16);if(mat){dest[0]=mat[0];dest[1]=mat[1];dest[2]=mat[2];dest[3]=mat[3];dest[4]=mat[4];dest[5]=mat[5];dest[6]=mat[6];dest[7]=mat[7];dest[8]=mat[8];dest[9]=mat[9];dest[10]=mat[10];dest[11]=mat[11];dest[12]=mat[12];dest[13]=mat[13];dest[14]=mat[14];dest[15]=mat[15]}return dest};mat4.set=function(mat,dest){dest[0]=mat[0];dest[1]=mat[1];dest[2]=mat[2];dest[3]=mat[3];dest[4]=mat[4];dest[5]=mat[5];dest[6]=mat[6];dest[7]=mat[7];dest[8]=mat[8];dest[9]=mat[9];dest[10]=mat[10];dest[11]=mat[11];dest[12]=mat[12];dest[13]=mat[13];dest[14]=mat[14];dest[15]=mat[15];return dest};mat4.identity=function(dest){dest[0]=1;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=1;dest[6]=0;dest[7]=0;dest[8]=0;dest[9]=0;dest[10]=1;dest[11]=0;dest[12]=0;dest[13]=0;dest[14]=0;dest[15]=1;return dest};mat4.transpose=function(mat,dest){if(!dest||mat==dest){var a01=mat[1],a02=mat[2],a03=mat[3];var a12=mat[6],a13=mat[7];var a23=mat[11];mat[1]=mat[4];mat[2]=mat[8];mat[3]=mat[12];</td>
      </tr>
      <tr>
        <td id="L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="LC7" class="blob-code blob-code-inner js-file-line">mat[4]=a01;mat[6]=mat[9];mat[7]=mat[13];mat[8]=a02;mat[9]=a12;mat[11]=mat[14];mat[12]=a03;mat[13]=a13;mat[14]=a23;return mat}dest[0]=mat[0];dest[1]=mat[4];dest[2]=mat[8];dest[3]=mat[12];dest[4]=mat[1];dest[5]=mat[5];dest[6]=mat[9];dest[7]=mat[13];dest[8]=mat[2];dest[9]=mat[6];dest[10]=mat[10];dest[11]=mat[14];dest[12]=mat[3];dest[13]=mat[7];dest[14]=mat[11];dest[15]=mat[15];return dest};mat4.determinant=function(mat){var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3];var a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7];var a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11];var a30=mat[12],a31=mat[13],a32=mat[14],a33=mat[15];return a30*a21*a12*a03-a20*a31*a12*a03-a30*a11*a22*a03+a10*a31*a22*a03+a20*a11*a32*a03-a10*a21*a32*a03-a30*a21*a02*a13+a20*a31*a02*a13+a30*a01*a22*a13-a00*a31*a22*a13-a20*a01*a32*a13+a00*a21*a32*a13+a30*a11*a02*a23-a10*a31*a02*a23-a30*a01*a12*a23+a00*a31*a12*a23+a10*a01*a32*a23-a00*a11*a32*a23-a20*a11*a02*a33+a10*a21*a02*a33+a20*a01*a12*a33-a00*a21*a12*a33-a10*a01*a22*a33+a00*a11*a22*a33};mat4.inverse=function(mat,dest){if(!dest){dest=mat}var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3];var a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7];var a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11];var a30=mat[12],a31=mat[13],a32=mat[14],a33=mat[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var invDet=1/(b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06);dest[0]=(a11*b11-a12*b10+a13*b09)*invDet;dest[1]=(-a01*b11+a02*b10-a03*b09)*invDet;dest[2]=(a31*b05-a32*b04+a33*b03)*invDet;dest[3]=(-a21*b05+a22*b04-a23*b03)*invDet;dest[4]=(-a10*b11+a12*b08-a13*b07)*invDet;dest[5]=(a00*b11-a02*b08+a03*b07)*invDet;dest[6]=(-a30*b05+a32*b02-a33*b01)*invDet;dest[7]=(a20*b05-a22*b02+a23*b01)*invDet;dest[8]=(a10*b10-a11*b08+a13*b06)*invDet;dest[9]=(-a00*b10+a01*b08-a03*b06)*invDet;dest[10]=(a30*b04-a31*b02+a33*b00)*invDet;dest[11]=(-a20*b04+a21*b02-a23*b00)*invDet;dest[12]=(-a10*b09+a11*b07-a12*b06)*invDet;dest[13]=(a00*b09-a01*b07+a02*b06)*invDet;dest[14]=(-a30*b03+a31*b01-a32*b00)*invDet;dest[15]=(a20*b03-a21*b01+a22*b00)*invDet;return dest};mat4.toRotationMat=function(mat,dest){if(!dest){dest=mat4.create()}dest[0]=mat[0];dest[1]=mat[1];dest[2]=mat[2];dest[3]=mat[3];dest[4]=mat[4];dest[5]=mat[5];dest[6]=mat[6];dest[7]=mat[7];dest[8]=mat[8];dest[9]=mat[9];dest[10]=mat[10];dest[11]=mat[11];dest[12]=0;dest[13]=0;dest[14]=0;dest[15]=1;return dest};mat4.toMat3=function(mat,dest){if(!dest){dest=mat3.create()}dest[0]=mat[0];dest[1]=mat[1];dest[2]=mat[2];dest[3]=mat[4];dest[4]=mat[5];dest[5]=mat[6];dest[6]=mat[8];dest[7]=mat[9];dest[8]=mat[10];return dest};mat4.toInverseMat3=function(mat,dest){var a00=mat[0],a01=mat[1],a02=mat[2];var a10=mat[4],a11=mat[5],a12=mat[6];var a20=mat[8],a21=mat[9],a22=mat[10];var b01=a22*a11-a12*a21;var b11=-a22*a10+a12*a20;var b21=a21*a10-a11*a20;var d=a00*b01+a01*b11+a02*b21;if(!d){return null}var id=1/d;if(!dest){dest=mat3.create()}dest[0]=b01*id;dest[1]=(-a22*a01+a02*a21)*id;dest[2]=(a12*a01-a02*a11)*id;dest[3]=b11*id;dest[4]=(a22*a00-a02*a20)*id;dest[5]=(-a12*a00+a02*a10)*id;dest[6]=b21*id;dest[7]=(-a21*a00+a01*a20)*id;dest[8]=(a11*a00-a01*a10)*id;return dest};mat4.multiply=function(mat,mat2,dest){if(!dest){dest=mat}var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3];var a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7];var a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11];var a30=mat[12],a31=mat[13],a32=mat[14],a33=mat[15];var b00=mat2[0],b01=mat2[1],b02=mat2[2],b03=mat2[3];var b10=mat2[4],b11=mat2[5],b12=mat2[6],b13=mat2[7];var b20=mat2[8],b21=mat2[9],b22=mat2[10],b23=mat2[11];var b30=mat2[12],b31=mat2[13],b32=mat2[14],b33=mat2[15];dest[0]=b00*a00+b01*a10+b02*a20+b03*a30;dest[1]=b00*a01+b01*a11+b02*a21+b03*a31;dest[2]=b00*a02+b01*a12+b02*a22+b03*a32;dest[3]=b00*a03+b01*a13+b02*a23+b03*a33;dest[4]=b10*a00+b11*a10+b12*a20+b13*a30;dest[5]=b10*a01+b11*a11+b12*a21+b13*a31;dest[6]=b10*a02+b11*a12+b12*a22+b13*a32;dest[7]=b10*a03+b11*a13+b12*a23+b13*a33;dest[8]=b20*a00+b21*a10+b22*a20+b23*a30;dest[9]=b20*a01+b21*a11+b22*a21+b23*a31;dest[10]=b20*a02+b21*a12+b22*a22+b23*a32;dest[11]=b20*a03+b21*a13+b22*a23+b23*a33;dest[12]=b30*a00+b31*a10+b32*a20+b33*a30;dest[13]=b30*a01+b31*a11+b32*a21+b33*a31;dest[14]=b30*a02+b31*a12+b32*a22+b33*a32;dest[15]=b30*a03+b31*a13+b32*a23+b33*a33;return dest};mat4.multiplyVec3=function(mat,vec,dest){if(!dest){dest=vec}var x=vec[0],y=vec[1],z=vec[2];dest[0]=mat[0]*x+mat[4]*y+mat[8]*z+mat[12];dest[1]=mat[1]*x+mat[5]*y+mat[9]*z+mat[13];dest[2]=mat[2]*x+mat[6]*y+mat[10]*z+mat[14];return dest};mat4.multiplyVec4=function(mat,vec,dest){if(!dest){dest=vec}var x=vec[0],y=vec[1],z=vec[2],w=vec[3];dest[0]=mat[0]*x+mat[4]*y+mat[8]*z+mat[12]*w;dest[1]=mat[1]*x+mat[5]*y+mat[9]*z+mat[13]*w;dest[2]=mat[2]*x+mat[6]*y+mat[10]*z+mat[14]*w;dest[3]=mat[3]*x+mat[7]*y+mat[11]*z+mat[15]*w;return dest};mat4.translate=function(mat,vec,dest){var x=vec[0],y=vec[1],z=vec[2];if(!dest||mat==dest){mat[12]=mat[0]*x+mat[4]*y+mat[8]*z+mat[12];mat[13]=mat[1]*x+mat[5]*y+mat[9]*z+mat[13];mat[14]=mat[2]*x+mat[6]*y+mat[10]*z+mat[14];mat[15]=mat[3]*x+mat[7]*y+mat[11]*z+mat[15];return mat}var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3];var a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7];var a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11];dest[0]=a00;dest[1]=a01;dest[2]=a02;dest[3]=a03;dest[4]=a10;dest[5]=a11;dest[6]=a12;dest[7]=a13;dest[8]=a20;dest[9]=a21;dest[10]=a22;dest[11]=a23;dest[12]=a00*x+a10*y+a20*z+mat[12];dest[13]=a01*x+a11*y+a21*z+mat[13];dest[14]=a02*x+a12*y+a22*z+mat[14];dest[15]=a03*x+a13*y+a23*z+mat[15];return dest};mat4.scale=function(mat,vec,dest){var x=vec[0],y=vec[1],z=vec[2];if(!dest||mat==dest){mat[0]*=x;mat[1]*=x;mat[2]*=x;mat[3]*=x;mat[4]*=y;mat[5]*=y;mat[6]*=y;mat[7]*=y;mat[8]*=z;mat[9]*=z;mat[10]*=z;mat[11]*=z;return mat}dest[0]=mat[0]*x;dest[1]=mat[1]*x;dest[2]=mat[2]*x;dest[3]=mat[3]*x;dest[4]=mat[4]*y;dest[5]=mat[5]*y;dest[6]=mat[6]*y;dest[7]=mat[7]*y;dest[8]=mat[8]*z;dest[9]=mat[9]*z;dest[10]=mat[10]*z;dest[11]=mat[11]*z;dest[12]=mat[12];dest[13]=mat[13];dest[14]=mat[14];dest[15]=mat[15];return dest};mat4.rotate=function(mat,angle,axis,dest){var x=axis[0],y=axis[1],z=axis[2];var len=Math.sqrt(x*x+y*y+z*z);if(!len){return null}if(len!=1){len=1/len;x*=len;y*=len;z*=len}var s=Math.sin(angle);var c=Math.cos(angle);var t=1-c;var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3];var a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7];var a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11];var b00=x*x*t+c,b01=y*x*t+z*s,b02=z*x*t-y*s;var b10=x*y*t-z*s,b11=y*y*t+c,b12=z*y*t+x*s;var b20=x*z*t+y*s,b21=y*z*t-x*s,b22=z*z*t+c;if(!dest){dest=mat}else if(mat!=dest){dest[12]=mat[12];dest[13]=mat[13];dest[14]=mat[14];dest[15]=mat[15]}dest[0]=a00*b00+a10*b01+a20*b02;dest[1]=a01*b00+a11*b01+a21*b02;dest[2]=a02*b00+a12*b01+a22*b02;dest[3]=a03*b00+a13*b01+a23*b02;dest[4]=a00*b10+a10*b11+a20*b12;dest[5]=a01*b10+a11*b11+a21*b12;dest[6]=a02*b10+a12*b11+a22*b12;dest[7]=a03*b10+a13*b11+a23*b12;dest[8]=a00*b20+a10*b21+a20*b22;dest[9]=a01*b20+a11*b21+a21*b22;dest[10]=a02*b20+a12*b21+a22*b22;dest[11]=a03*b20+a13*b21+a23*b22;return dest};mat4.rotateX=function(mat,angle,dest){var s=Math.sin(angle);var c=Math.cos(angle);var a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7];var a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11];if(!dest){dest=mat}else if(mat!=dest){dest[0]=mat[0];dest[1]=mat[1];dest[2]=mat[2];dest[3]=mat[3];dest[12]=mat[12];dest[13]=mat[13];dest[14]=mat[14];dest[15]=mat[15]}dest[4]=a10*c+a20*s;dest[5]=a11*c+a21*s;dest[6]=a12*c+a22*s;dest[7]=a13*c+a23*s;dest[8]=a10*-s+a20*c;dest[9]=a11*-s+a21*c;dest[10]=a12*-s+a22*c;dest[11]=a13*-s+a23*c;return dest};mat4.rotateY=function(mat,angle,dest){var s=Math.sin(angle);var c=Math.cos(angle);var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3];var a20=mat[8],a21=mat[9],a22=mat[10],a23=mat[11];if(!dest){dest=mat}else if(mat!=dest){dest[4]=mat[4];dest[5]=mat[5];dest[6]=mat[6];dest[7]=mat[7];dest[12]=mat[12];dest[13]=mat[13];dest[14]=mat[14];dest[15]=mat[15]}dest[0]=a00*c+a20*-s;dest[1]=a01*c+a21*-s;dest[2]=a02*c+a22*-s;dest[3]=a03*c+a23*-s;dest[8]=a00*s+a20*c;dest[9]=a01*s+a21*c;dest[10]=a02*s+a22*c;dest[11]=a03*s+a23*c;return dest};mat4.rotateZ=function(mat,angle,dest){var s=Math.sin(angle);var c=Math.cos(angle);var a00=mat[0],a01=mat[1],a02=mat[2],a03=mat[3];var a10=mat[4],a11=mat[5],a12=mat[6],a13=mat[7];if(!dest){dest=mat}else if(mat!=dest){dest[8]=mat[8];dest[9]=mat[9];dest[10]=mat[10];dest[11]=mat[11];dest[12]=mat[12];dest[13]=mat[13];dest[14]=mat[14];dest[15]=mat[15]}dest[0]=a00*c+a10*s;dest[1]=a01*c+a11*s;dest[2]=a02*c+a12*s;dest[3]=a03*c+a13*s;dest[4]=a00*-s+a10*c;dest[5]=a01*-s+a11*c;dest[6]=a02*-s+a12*c;dest[7]=a03*-s+a13*c;return dest};mat4.frustum=function(left,right,bottom,top,near,far,dest){if(!dest){dest=mat4.create()}var rl=right-left;var tb=top-bottom;var fn=far-near;dest[0]=near*2/rl;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=near*2/tb;dest[6]=0;dest[7]=0;dest[8]=(right+left)/rl;dest[9]=(top+bottom)/tb;dest[10]=-(far+near)/fn;dest[11]=-1;dest[12]=0;dest[13]=0;dest[14]=-(far*near*2)/fn;dest[15]=0;return dest};mat4.perspective=function(fovy,aspect,near,far,dest){var top=near*Math.tan(fovy*Math.PI/360);var right=top*aspect;return mat4.frustum(-right,right,-top,top,near,far,dest)};mat4.ortho=function(left,right,bottom,top,near,far,dest){if(!dest){dest=mat4.create()}var rl=right-left;var tb=top-bottom;var fn=far-near;dest[0]=2/rl;dest[1]=0;dest[2]=0;dest[3]=0;dest[4]=0;dest[5]=2/tb;dest[6]=0;dest[7]=0;dest[8]=0;dest[9]=0;dest[10]=-2/fn;dest[11]=0;dest[12]=-(left+right)/rl;dest[13]=-(top+bottom)/tb;dest[14]=-(far+near)/fn;dest[15]=1;return dest};mat4.lookAt=function(eye,center,up,dest){if(!dest){dest=mat4.create()}var eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(eyex==centerx&amp;&amp;eyey==centery&amp;&amp;eyez==centerz){return mat4.identity(dest)}var z0,z1,z2,x0,x1,x2,y0,y1,y2,len;z0=eyex-center[0];z1=eyey-center[1];z2=eyez-center[2];len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}dest[0]=x0;dest[1]=y0;dest[2]=z0;dest[3]=0;dest[4]=x1;dest[5]=y1;dest[6]=z1;dest[7]=0;dest[8]=x2;dest[9]=y2;dest[10]=z2;dest[11]=0;dest[12]=-(x0*eyex+x1*eyey+x2*eyez);dest[13]=-(y0*eyex+y1*eyey+y2*eyez);dest[14]=-(z0*eyex+z1*eyey+z2*eyez);dest[15]=1;return dest};mat4.str=function(mat){return&quot;[&quot;+mat[0]+&quot;, &quot;+mat[1]+&quot;, &quot;+mat[2]+&quot;, &quot;+mat[3]+&quot;, &quot;+mat[4]+&quot;, &quot;+mat[5]+&quot;, &quot;+mat[6]+&quot;, &quot;+mat[7]+&quot;, &quot;+mat[8]+&quot;, &quot;+mat[9]+&quot;, &quot;+mat[10]+&quot;, &quot;+mat[11]+&quot;, &quot;+mat[12]+&quot;, &quot;+mat[13]+&quot;, &quot;+mat[14]+&quot;, &quot;+mat[15]+&quot;]&quot;};quat4={};quat4.create=function(quat){var dest=new glMatrixArrayType(4);if(quat){dest[0]=quat[0];dest[1]=quat[1];dest[2]=quat[2];dest[3]=quat[3]}return dest};quat4.set=function(quat,dest){dest[0]=quat[0];dest[1]=quat[1];dest[2]=quat[2];dest[3]=quat[3];return dest};quat4.calculateW=function(quat,dest){var x=quat[0],y=quat[1],z=quat[2];if(!dest||quat==dest){quat[3]=-Math.sqrt(Math.abs(1-x*x-y*y-z*z));return quat}dest[0]=x;dest[1]=y;dest[2]=z;dest[3]=-Math.sqrt(Math.abs(1-x*x-y*y-z*z));return dest};quat4.inverse=function(quat,dest){if(!dest||quat==dest){quat[0]*=-1;quat[1]*=-1;quat[2]*=-1;return quat}dest[0]=-quat[0];dest[1]=-quat[1];dest[2]=-quat[2];dest[3]=quat[3];return dest};quat4.length=function(quat){var x=quat[0],y=quat[1],z=quat[2],w=quat[3];return Math.sqrt(x*x+y*y+z*z+w*w)};quat4.normalize=function(quat,dest){if(!dest){dest=quat}var x=quat[0],y=quat[1],z=quat[2],w=quat[3];var len=Math.sqrt(x*x+y*y+z*z+w*w);if(len==0){dest[0]=0;dest[1]=0;dest[2]=0;dest[3]=0;return dest}len=1/len;dest[0]=x*len;dest[1]=y*len;dest[2]=z*len;dest[3]=w*len;return dest};quat4.multiply=function(quat,quat2,dest){if(!dest){dest=quat}var qax=quat[0],qay=quat[1],qaz=quat[2],qaw=quat[3];var qbx=quat2[0],qby=quat2[1],qbz=quat2[2],qbw=quat2[3];dest[0]=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;dest[1]=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;dest[2]=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;dest[3]=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;return dest};quat4.multiplyVec3=function(quat,vec,dest){if(!dest){dest=vec}var x=vec[0],y=vec[1],z=vec[2];var qx=quat[0],qy=quat[1],qz=quat[2],qw=quat[3];var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;dest[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;dest[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;dest[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return dest};quat4.toMat3=function(quat,dest){if(!dest){dest=mat3.create()}var x=quat[0],y=quat[1],z=quat[2],w=quat[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;dest[0]=1-(yy+zz);dest[1]=xy-wz;dest[2]=xz+wy;dest[3]=xy+wz;dest[4]=1-(xx+zz);dest[5]=yz-wx;dest[6]=xz-wy;dest[7]=yz+wx;dest[8]=1-(xx+yy);return dest};quat4.toMat4=function(quat,dest){if(!dest){dest=mat4.create()}var x=quat[0],y=quat[1],z=quat[2],w=quat[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;dest[0]=1-(yy+zz);dest[1]=xy-wz;dest[2]=xz+wy;dest[3]=0;dest[4]=xy+wz;dest[5]=1-(xx+zz);dest[6]=yz-wx;dest[7]=0;dest[8]=xz-wy;dest[9]=yz+wx;dest[10]=1-(xx+yy);dest[11]=0;dest[12]=0;dest[13]=0;dest[14]=0;dest[15]=1;return dest};quat4.slerp=function(quat,quat2,slerp,dest){if(!dest){dest=quat}var cosHalfTheta=quat[0]*quat2[0]+quat[1]*quat2[1]+quat[2]*quat2[2]+quat[3]*quat2[3];if(Math.abs(cosHalfTheta)&gt;=1){if(dest!=quat){dest[0]=quat[0];dest[1]=quat[1];dest[2]=quat[2];dest[3]=quat[3]}return dest}var halfTheta=Math.acos(cosHalfTheta);var sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)&lt;.001){dest[0]=quat[0]*.5+quat2[0]*.5;dest[1]=quat[1]*.5+quat2[1]*.5;dest[2]=quat[2]*.5+quat2[2]*.5;dest[3]=quat[3]*.5+quat2[3]*.5;return dest}var ratioA=Math.sin((1-slerp)*halfTheta)/sinHalfTheta;var ratioB=Math.sin(slerp*halfTheta)/sinHalfTheta;dest[0]=quat[0]*ratioA+quat2[0]*ratioB;dest[1]=quat[1]*ratioA+quat2[1]*ratioB;dest[2]=quat[2]*ratioA+quat2[2]*ratioB;dest[3]=quat[3]*ratioA+quat2[3]*ratioB;return dest};quat4.str=function(quat){return&quot;[&quot;+quat[0]+&quot;, &quot;+quat[1]+&quot;, &quot;+quat[2]+&quot;, &quot;+quat[3]+&quot;]&quot;};WebGLUtils=function(){var makeFailHTML=function(msg){return&quot;&quot;+&#39;&lt;table style=&quot;background-color: #8CE; width: 100%; height: 100%;&quot;&gt;&lt;tr&gt;&#39;+&#39;&lt;td align=&quot;center&quot;&gt;&#39;+&#39;&lt;div style=&quot;display: table-cell; vertical-align: middle;&quot;&gt;&#39;+&#39;&lt;div style=&quot;&quot;&gt;&#39;+msg+&quot;&lt;/div&gt;&quot;+&quot;&lt;/div&gt;&quot;+&quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;};var GET_A_WEBGL_BROWSER=&quot;&quot;+&quot;This page requires a browser that supports WebGL.&lt;br/&gt;&quot;+&#39;&lt;a href=&quot;http://get.webgl.org&quot; target=&quot;_blank&quot;&gt;Click here to upgrade your browser.&lt;/a&gt;&#39;;var OTHER_PROBLEM=&quot;&quot;+&quot;It doesn&#39;t appear your computer can support WebGL.&lt;br/&gt;&quot;+&#39;&lt;a href=&quot;http://get.webgl.org/troubleshooting/&quot; target=&quot;_blank&quot;&gt;Click here for more information.&lt;/a&gt;&#39;;var setupWebGL=function(canvas,opt_attribs){function showLink(str){var container=canvas.parentNode;if(container){container.innerHTML=makeFailHTML(str)}}if(!window.WebGLRenderingContext){showLink(GET_A_WEBGL_BROWSER);return null}var context=create3DContext(canvas,opt_attribs);if(!context){showLink(OTHER_PROBLEM)}return context};var create3DContext=function(canvas,opt_attribs){var names=[&quot;webgl&quot;,&quot;experimental-webgl&quot;,&quot;webkit-3d&quot;,&quot;moz-webgl&quot;];var context=null;for(var ii=0;ii&lt;names.length;++ii){try{context=canvas.getContext(names[ii],opt_attribs)}catch(e){}if(context){break}}return context};return{create3DContext:create3DContext,setupWebGL:setupWebGL}}();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1e3/60)}}();(function(){&quot;use strict&quot;;var glowscript={version:&quot;2.1&quot;};var property={declare:function(proto,propertyMap){$.each(propertyMap,function(name,definition){if(definition===null||definition.value===undefined&amp;&amp;!definition.get)definition={value:definition};definition.name=name;var internal=definition.internal||name.substr(0,2)===&quot;__&quot;;if(definition.enumerable===undefined)definition.enumerable=!internal;if(definition.type===undefined&amp;&amp;!definition.get&amp;&amp;!internal){var tp=typeof definition.value;if(tp===&quot;number&quot;)definition.type=property.check_number;else if(tp===&quot;string&quot;)definition.type=property.check_string;else if(definition.value instanceof attributeVector)definition.type=property.check_attributeVector;else if(definition.value instanceof attributeVectorPos)definition.type=property.check_attributeVectorPos;else if(definition.value instanceof attributeVectorAxis)definition.type=property.check_attributeVectorAxis;else if(definition.value instanceof attributeVectorSize)definition.type=property.check_attributeVectorSize;else if(definition.value instanceof vec)definition.type=property.check_vec}if(definition.readonly&amp;&amp;definition.set||definition.onchanged&amp;&amp;definition.set||definition.value!==undefined&amp;&amp;definition.get)throw new Error(&quot;Erroneous property definition &#39;&quot;+name+&quot;&#39;.&quot;);function readOnlyError(){throw new Error(&quot;Property &#39;&quot;+name+&quot;&#39; is read-only.&quot;)}if(definition.get){Object.defineProperty(proto,name,{enumerable:definition.enumerable,get:definition.get,set:definition.set||readOnlyError})}else{if(!definition.type&amp;&amp;!definition.onchanged)Object.defineProperty(proto,name,{enumerable:definition.enumerable,writable:!definition.readonly,value:definition.value});else{var internal=&quot;__&quot;+name;var prop={enumerable:definition.enumerable,get:function(){return this[internal]}};if(definition.set)prop.set=definition.set;else if(definition.onchanged&amp;&amp;definition.type)prop.set=function(val){var old=this[internal];this[internal]=definition.type.call(this,val,definition);definition.onchanged.call(this,old)};else if(definition.onchanged)prop.set=function(val){var old=this[internal];this[internal]=val;definition.onchanged.call(this,old)};else if(definition.type)prop.set=function(val){this[internal]=definition.type.call(this,val,definition)};Object.defineProperty(proto,internal,{enumerable:false,writable:true,value:definition.value});Object.defineProperty(proto,name,prop)}}})},nullable_attributeVector:function nullable_attributeVector(v,def){if(v===null)return null;return property.check_attributeVector.call(this,v,def)},check_attributeVector:function check_attributeVector(v,def){if(!(v instanceof vec))throw new Error(&quot;Property &#39;&quot;+def.name+&quot;&#39; must be a vector.&quot;);return new attributeVector(this,v.x,v.y,v.z)},check_attributeVectorPos:function check_attributeVectorPos(v,def){if(!(v instanceof vec))throw new Error(&quot;Property &#39;&quot;+def.name+&quot;&#39; must be a vector.&quot;);return new attributeVectorPos(this,v.x,v.y,v.z)},check_attributeVectorAxis:function check_attributeVectorAxis(v,def){if(!(v instanceof vec))throw new Error(&quot;Property &#39;&quot;+def.name+&quot;&#39; must be a vector.&quot;);return new attributeVectorAxis(this,v.x,v.y,v.z)},check_attributeVectorSize:function check_attributeVectorSize(v,def){if(!(v instanceof vec))throw new Error(&quot;Property &#39;&quot;+def.name+&quot;&#39; must be a vector.&quot;);return new attributeVectorSize(this,v.x,v.y,v.z)},check_vec:function check_vec(v,def){if(!v instanceof vec)throw new Error(&quot;Property &#39;&quot;+def.name+&quot;&#39; must be a vector.&quot;);return v},check_number:function check_number(v,def){return v},check_string:function check_string(v,def){return v}};var global=window;function Export(exports){for(var id in exports){glowscript[id]=exports[id];global[id]=exports[id]}}var module_exports={glowscript:glowscript,property:property,Export:Export};Export(module_exports)})();(function(){&quot;use strict&quot;;function vec(x,y,z){if(!(this instanceof vec)){if(y===undefined)if(z===undefined)return new vec(x.x,x.y,x.z);return new vec(x,y,z)}if(z===undefined||y===undefined)throw new Error(&quot;vector() requires 3 arguments: x, y, and z.&quot;);this.x=x;this.y=y;this.z=z}function attributeVector(parent,x,y,z){this.__parent=parent;this.__x=x;this.__y=y;this.__z=z;if(parent){parent.__change()}}attributeVector.prototype=new vec(0,0,0);attributeVector.prototype.constructor=attributeVector;function attributeVectorPos(parent,x,y,z){this.__parent=parent;this.__x=x;this.__y=y;this.__z=z;if(parent){parent.__change();if(parent.__make_trail)parent.__update_trail(vec(x,y,z))}}attributeVectorPos.prototype=new vec(0,0,0);attributeVectorPos.prototype.constructor=attributeVectorPos;function attributeVectorAxis(parent,x,y,z){this.__parent=parent;this.__x=x;this.__y=y;this.__z=z;if(parent){parent.__size.__x=Math.sqrt(x*x+y*y+z*z);parent.__change()}}attributeVectorAxis.prototype=new vec(1,0,0);attributeVectorAxis.prototype.constructor=attributeVectorAxis;function attributeVectorSize(parent,x,y,z){this.__parent=parent;this.__x=x;this.__y=y;this.__z=z;if(parent){if(x!==0){var v=parent.__axis.norm().multiply(x);parent.__axis.__x=v.x;parent.__axis.__y=v.y;parent.__axis.__z=v.z}parent.__change()}}attributeVectorSize.prototype=new vec(1,1,1);attributeVectorSize.prototype.constructor=attributeVectorSize;Object.defineProperty(attributeVector.prototype,&quot;__x&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVector.prototype,&quot;x&quot;,{enumerable:true,get:function(){return this.__x},set:function(value){this.__x=value;this.__parent.__change()}});Object.defineProperty(attributeVector.prototype,&quot;__y&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVector.prototype,&quot;y&quot;,{enumerable:true,get:function(){return this.__y},set:function(value){this.__y=value;this.__parent.__change()}});Object.defineProperty(attributeVector.prototype,&quot;__z&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVector.prototype,&quot;z&quot;,{enumerable:true,get:function(){return this.__z},set:function(value){this.__z=value;this.__parent.__change()}});Object.defineProperty(attributeVectorPos.prototype,&quot;__x&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorPos.prototype,&quot;x&quot;,{enumerable:true,get:function(){return this.__x},set:function(value){this.__x=value;this.__parent.__change();if(this.__parent.__make_trail)this.__parent.__update_trail(vec(this.__x,this.__y,this.__z))}});Object.defineProperty(attributeVectorPos.prototype,&quot;__y&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorPos.prototype,&quot;y&quot;,{enumerable:true,get:function(){return this.__y},set:function(value){this.__y=value;this.__parent.__change();if(this.__parent.__make_trail)this.__parent.__update_trail(vec(this.__x,this.__y,this.__z))}});Object.defineProperty(attributeVectorPos.prototype,&quot;__z&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorPos.prototype,&quot;z&quot;,{enumerable:true,get:function(){return this.__z},set:function(value){this.__z=value;this.__parent.__change();if(this.__parent.__make_trail)this.__parent.__update_trail(vec(this.__x,this.__y,this.__z))}});Object.defineProperty(attributeVectorAxis.prototype,&quot;__x&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorAxis.prototype,&quot;x&quot;,{enumerable:true,get:function(){return this.__x},set:function(value){this.__x=this.__parent.__axis.__x=value;this.__parent.__size.x=this.mag;this.__parent.__change()}});Object.defineProperty(attributeVectorAxis.prototype,&quot;__y&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorAxis.prototype,&quot;y&quot;,{enumerable:true,get:function(){return this.__y},set:function(value){this.__y=this.__parent.__axis.__y=value;this.__parent.__size.x=this.mag;this.__parent.__change()}});Object.defineProperty(attributeVectorAxis.prototype,&quot;__z&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorAxis.prototype,&quot;z&quot;,{enumerable:true,get:function(){return this.__z},set:function(value){this.__z=this.__parent.__axis.__z=value;this.__parent.__size.x=this.mag;this.__parent.__change()}});Object.defineProperty(attributeVectorSize.prototype,&quot;__x&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorSize.prototype,&quot;x&quot;,{enumerable:true,get:function(){return this.__x},set:function(value){this.__x=value;var v=this.__parent.__axis.norm().multiply(value);this.__parent.__axis.__x=v.x;this.__parent.__axis.__y=v.y;this.__parent.__axis.__z=v.z;this.__parent.__change()}});Object.defineProperty(attributeVectorSize.prototype,&quot;__y&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorSize.prototype,&quot;y&quot;,{enumerable:true,get:function(){return this.__y},set:function(value){this.__y=value;this.__parent.__change()}});Object.defineProperty(attributeVectorSize.prototype,&quot;__z&quot;,{enumerable:false,writable:true,value:0});Object.defineProperty(attributeVectorSize.prototype,&quot;z&quot;,{enumerable:true,get:function(){return this.__z},set:function(value){this.__z=value;this.__parent.__change()}});vec.prototype.toString=function(){var input=[this.x,this.y,this.z];var output=[];var c,eloc,period,char,end;for(var i=0;i&lt;3;i++){var c=input[i];if(c==0){output.push(&quot;0&quot;);continue}if(Math.abs(c)&lt;1e-4)c=c.toExponential(5);else c=c.toPrecision(6);period=c.indexOf(&quot;.&quot;);if(period&gt;=0){end=c.indexOf(&quot;e&quot;);if(end&lt;0)end=c.length;char=end;while(true){char--;if(c.charAt(char)==&quot;0&quot;)continue;if(char==period){output.push(c.slice(0,period).concat(c.slice(end,c.length)));break}if(end==c.length)output.push(c.slice(0,char+1));else output.push(c.slice(0,char+1).concat(c.slice(end,c.length)));break}}else output.push(c)}return&quot;&lt; &quot;+output[0]+&quot;, &quot;+output[1]+&quot;, &quot;+output[2]+&quot; &gt;&quot;};vec.prototype.add=function(v){return new vec(this.x+v.x,this.y+v.y,this.z+v.z)};vec.prototype.sub=function(v){return new vec(this.x-v.x,this.y-v.y,this.z-v.z)};vec.prototype.multiply=function(s){return new vec(this.x*s,this.y*s,this.z*s)};vec.prototype.divide=function(s){return new vec(this.x/s,this.y/s,this.z/s)};property.declare(vec.prototype,{mag:{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},set:function(value){var v=this.norm().multiply(value);this.x=v.x;this.y=v.y;this.z=v.z}},mag2:{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},set:function(value){var v=this.norm().multiply(Math.sqrt(value));this.x=v.x;this.y=v.y;this.z=v.z}},hat:{get:function(){return this.norm()},set:function(value){var v=value.hat.multiply(this.mag);this.x=v.x;this.y=v.y;this.z=v.z}}});vec.prototype.norm=function(){var r=this.mag;if(r==0)return new vec(0,0,0);return new vec(this.x/r,this.y/r,this.z/r)};vec.prototype.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z};vec.prototype.equals=function(v){if(v===null)return false;return this.x===v.x&amp;&amp;this.y===v.y&amp;&amp;this.z===v.z};vec.prototype.proj=function(v){var B=norm(v);return B.multiply(this.dot(B))};vec.prototype.comp=function(v){return this.dot(norm(v))};vec.prototype.cross=function(v){return new vec(this.y*v.z-this.z*v.y,this.z*v.x-this.x*v.z,this.x*v.y-this.y*v.x)};vec.prototype.diff_angle=function(v){var a=this.norm().dot(v.norm());if(a&gt;1)return 0;if(a&lt;-1)return Math.PI;return Math.acos(a)};vec.prototype.rotate=function(args){var angle,axis;if(arguments.length==1){if(args!==null&amp;&amp;args!==undefined){if(typeof args===&quot;number&quot;){angle=args}else{angle=args.angle;axis=args.axis}}}else if(arguments.length==2){angle=arguments[0];axis=arguments[1]}if(angle===undefined)throw new Error(&quot;To rotate a vector you must specify an angle.&quot;);if(axis===undefined)axis=new vec(0,0,1);var theta=this.diff_angle(axis);if(theta==0)return new vec(this.x,this.y,this.z);var axis=axis.norm();var parallel=axis.multiply(axis.dot(this));var perp=axis.cross(this);var pmag=perp.mag;perp=perp.norm();var y=perp.cross(axis);var rotated=y.multiply(pmag*Math.cos(angle)).add(perp.multiply(pmag*Math.sin(angle)));return parallel.add(rotated)};vec.random=function(){return new vec(-1+2*Math.random(),-1+2*Math.random(),-1+2*Math.random())};String.prototype[&quot;+&quot;]=function(r){return this+r};Number.prototype[&quot;+&quot;]=function(r){return this+r};Number.prototype[&quot;-&quot;]=function(r){return this-r};Number.prototype[&quot;*&quot;]=function(r){return r instanceof vec?r.multiply(this):r*this};Number.prototype[&quot;/&quot;]=function(r){return this/r};Number.prototype[&quot;%&quot;]=function(r){return this%r};Number.prototype[&quot;-u&quot;]=function(){return-this};vec.prototype[&quot;+&quot;]=vec.prototype.add;vec.prototype[&quot;-&quot;]=vec.prototype.sub;vec.prototype[&quot;*&quot;]=vec.prototype.multiply;vec.prototype[&quot;/&quot;]=function(r){return this.divide(r)};vec.prototype[&quot;-u&quot;]=function(){return new vec(-this.x,-this.y,-this.z)};var exports={vec:vec,attributeVector:attributeVector,attributeVectorPos:attributeVectorPos,attributeVectorAxis:attributeVectorAxis,attributeVectorSize:attributeVectorSize};Export(exports)})();(function vectorLibraryWrappers(){&quot;use strict&quot;;function mag(A){return A.mag}function mag2(A){return A.mag2}function norm(A){return A.norm()}function hat(A){return A.hat}function dot(A,B){return A.dot(B)}function cross(A,B){return A.cross(B)}function proj(A,B){return A.proj(B)}function comp(A,B){return A.comp(B)}function diff_angle(A,B){return A.diff_angle(B)}function rotate(args){var angle,axis;var v=arguments[0];if(arguments.length==2){var args=arguments[1];if(args!==null&amp;&amp;args!==undefined){if(typeof args===&quot;number&quot;){angle=args}else{angle=args.angle;axis=args.axis}}}else if(arguments.length==3){angle=arguments[1];axis=arguments[2]}if(angle===undefined)throw new Error(&quot;To rotate a vector you must specify an angle.&quot;);if(axis===undefined)axis=new vec(0,0,1);return v.rotate({angle:angle,axis:axis})}var exports={mag:mag,mag2:mag2,norm:norm,hat:hat,dot:dot,cross:cross,proj:proj,comp:comp,diff_angle:diff_angle,rotate:rotate};Export(exports)})();(function(){&quot;use strict&quot;;function Mesh(){this.pos=[];this.normal=[];this.color=[];this.opacity=[];this.shininess=[];this.emissive=[];this.texpos=[];this.bumpaxis=[];this.index=[];this.model_transparent=false}$.extend(Mesh.prototype,{merge:function merge(otherMesh,object,bias){var xmin=null,xmax=null,ymin=null,ymax=null,zmin=null,zmax=null;var offset=this.pos.length/3;if(object instanceof vertex){if(bias&lt;0)this.index.push(offset+bias);else{if(xmin===null||object.__pos.x&lt;xmin)xmin=object.__pos.x;if(xmax===null||object.__pos.x&gt;xmax)xmax=object.__pos.x;if(ymin===null||object.__pos.y&lt;ymin)ymin=object.__pos.y;if(ymax===null||object.__pos.y&gt;ymax)ymax=object.__pos.y;if(zmin===null||object.__pos.z&lt;zmin)zmin=object.__pos.z;if(zmax===null||object.__pos.z&gt;zmax)zmax=object.__pos.z;this.pos.push(object.__pos.x,object.__pos.y,object.__pos.z);this.normal.push(object.__normal.x,object.__normal.y,object.__normal.z);this.color.push(object.__color.x,object.__color.y,object.__color.z);if(object.__opacity&lt;1)this.model_transparent=true;this.opacity.push(object.__opacity);this.shininess.push(object.__shininess);this.emissive.push(object.__emissive);this.texpos.push(object.__texpos.x,object.__texpos.y);this.bumpaxis.push(object.__bumpaxis.x,object.__bumpaxis.y,object.__bumpaxis.z);this.index.push(offset)}}else{var c=[object.__color.x,object.__color.y,object.__color.z];for(var j=0;j&lt;otherMesh.pos.length;j++){if(j%3===0){if(xmin===null||otherMesh.pos[j]&lt;xmin)xmin=otherMesh.pos[j];if(xmax===null||otherMesh.pos[j]&gt;xmax)xmax=otherMesh.pos[j]}else if(j%3===1){if(ymin===null||otherMesh.pos[j]&lt;ymin)ymin=otherMesh.pos[j];if(ymax===null||otherMesh.pos[j]&gt;ymax)ymax=otherMesh.pos[j]}else if(j%3===2){if(zmin===null||otherMesh.pos[j]&lt;zmin)zmin=otherMesh.pos[j];if(zmax===null||otherMesh.pos[j]&gt;zmax)zmax=otherMesh.pos[j]}this.pos.push(otherMesh.pos[j])}for(var j=0;j&lt;otherMesh.normal.length;j++)this.normal.push(otherMesh.normal[j]);for(var j=0;j&lt;otherMesh.color.length;j++)this.color.push(c[j%3]*otherMesh.color[j]);for(var j=0;j&lt;otherMesh.opacity.length;j++){var opacity=object.__opacity*otherMesh.opacity[j];if(opacity&lt;1)this.model_transparent=true;this.opacity.push(opacity)}for(var j=0;j&lt;otherMesh.shininess.length;j++){var shininess=object.__shininess*otherMesh.shininess[j];</td>
      </tr>
      <tr>
        <td id="L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="LC8" class="blob-code blob-code-inner js-file-line">this.shininess.push(shininess)}for(var j=0;j&lt;otherMesh.emissive.length;j++){var emissive=object.__emissive||otherMesh.emissive[j]?1:0;this.emissive.push(emissive)}for(var j=0;j&lt;otherMesh.texpos.length;j++)this.texpos.push(otherMesh.texpos[j]);for(var j=0;j&lt;otherMesh.bumpaxis.length;j++)this.bumpaxis.push(otherMesh.bumpaxis[j]);for(var j=0;j&lt;otherMesh.index.length;j++)this.index.push(offset+otherMesh.index[j])}return{__xmin:xmin,__ymin:ymin,__zmin:zmin,__xmax:xmax,__ymax:ymax,__zmax:zmax}},transformed:function transformed(matrix){var normalTrans=mat3.toMat4(mat3.transpose(mat4.toInverseMat3(matrix)));var out=new Mesh;out.index=this.index;out.color=this.color;out.opacity=this.opacity;out.shininess=this.shininess;out.emissive=this.emissive;out.texpos=this.texpos;for(var i=0;i&lt;this.pos.length;i+=3){var v=[this.pos[i],this.pos[i+1],this.pos[i+2]];var n=[this.normal[i],this.normal[i+1],this.normal[i+2],0];var b=[this.bumpaxis[i],this.bumpaxis[i+1],this.bumpaxis[i+2]];mat4.multiplyVec3(matrix,v);mat4.multiplyVec4(normalTrans,n);mat4.multiplyVec3(matrix,b);out.pos.push(v[0],v[1],v[2]);out.normal.push(n[0],n[1],n[2]);out.bumpaxis.push(b[0],b[1],b[2])}return out},adjust:function adjust(v,s){var dx=v.x,dy=v.y,dz=v.z;var sx=s.x,sy=s.y,sz=s.z;for(var i=0;i&lt;this.pos.length;i+=3){this.pos[i]=(this.pos[i]-dx)/sx;this.pos[i+1]=(this.pos[i+1]-dy)/sy;this.pos[i+2]=(this.pos[i+2]-dz)/sz;this.normal[i]*=sx;this.normal[i+1]*=sy;this.normal[i+2]*=sz}}});$.extend(Mesh,{makeCube:function(){var m=new Mesh;var s=.5;m.pos.push(+s,+s,+s,+s,-s,+s,+s,-s,-s,+s,+s,-s,-s,+s,-s,-s,-s,-s,-s,-s,+s,-s,+s,+s,-s,-s,+s,-s,-s,-s,+s,-s,-s,+s,-s,+s,-s,+s,-s,-s,+s,+s,+s,+s,+s,+s,+s,-s,-s,+s,+s,-s,-s,+s,+s,-s,+s,+s,+s,+s,+s,+s,-s,+s,-s,-s,-s,-s,-s,-s,+s,-s);m.normal.push(+1,0,0,+1,0,0,+1,0,0,+1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,-1,0,0,-1,0,0,-1,0,0,-1);m.color.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1);m.opacity.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1);m.shininess.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1);m.emissive.push(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);m.texpos.push(0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1);m.bumpaxis.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,+1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,+1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0);m.index.push(0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23);return m},makeQuad:function(){var m=new Mesh;m.pos.push(-1,-1,0,+1,-1,0,+1,+1,0,-1,+1,0);m.normal.push(0,0,1,0,0,1,0,0,1,0,0,1);m.color.push(1,1,1,1,1,1,1,1,1,1,1,1);m.opacity.push(1,1,1,1);m.shininess.push(1,1,1,1);m.emissive.push(0,0,0,0);m.texpos.push(0,0,1,0,1,1,0,1);m.bumpaxis.push(1,0,0,1,0,0,1,0,0,1,0,0);m.index.push(0,1,2,0,2,3);return m},makeCylinder:function(R){var N=50;var dtheta=2*Math.PI/N;var sind=Math.sin(dtheta),cosd=Math.cos(dtheta);var y=-R,z=0;var newy,newz;var m=new Mesh;m.pos.push(0,0,0,1,0,0);m.normal.push(-1,0,0,1,0,0);m.color.push(1,1,1,1,1,1);m.opacity.push(1,1);m.shininess.push(1,1);m.emissive.push(0,0);m.texpos.push(.5,.5,.5,.5);m.bumpaxis.push(0,0,1,0,0,-1);var k=4*N;for(var i=2;i&lt;=2+4*N;i+=4){m.pos.push(0,y,z,0,y,z,1,y,z,1,y,z);m.normal.push(-1,0,0,0,y,z,1,0,0,0,y,z);m.color.push(1,1,1,1,1,1,1,1,1,1,1,1);m.opacity.push(1,1,1,1);m.shininess.push(1,1,1,1);m.emissive.push(0,0,0,0);if(i&lt;2+2*N){m.texpos.push(.5*(1+z/R),.5+.5*y/R,0,(i-2)/4/(N/2),.5*(1-z/R),.5+.5*y/R,1,(i-2)/4/(N/2))}else{m.texpos.push(.5*(1+z/R),.5+.5*y/R,0,1-(i-2-2*N)/4/(N/2),.5*(1-z/R),.5+.5*y/R,1,1-(i-2-2*N)/4/(N/2))}m.bumpaxis.push(0,0,1,1,0,0,0,0,-1,1,0,0);if(i!=2+4*N)m.index.push(0,(i-2)%k+2,(i+4-2)%k+2,i+1,(i+3-2)%k+2,(i+7-2)%k+2,i+1,(i+7-2)%k+2,(i+5-2)%k+2,1,(i+6-2)%k+2,(i+2-2)%k+2);newy=y*cosd+z*sind;newz=z*cosd-y*sind;y=newy;z=newz}return m},makeRing:function(R1,R2){var NC=64;var dphi=2*Math.PI/NC;var sphi=Math.sin(dphi),cphi=Math.cos(dphi);var N=20;var dtheta=2*Math.PI/N;var sind=Math.sin(dtheta),cosd=Math.cos(dtheta);var x=0,z=R2,newx,newz;var shape=[];for(var c=0;c&lt;N;c++){shape.push(vec(x,0,z-R2));newx=x*cosd+z*sind;newz=z*cosd-x*sind;x=newx;z=newz}var m=new Mesh;var y=0,z=R1+R2,newy,newz;var pts=[];var normals=[];for(var c=0;c&lt;NC;c++){var r=vec(0,y,z);for(var i=0;i&lt;N;i++){pts.push(shape[i]);normals.push(r)}newy=y*cphi+z*sphi;newz=z*cphi-y*sphi;y=newy;z=newz}for(var c=0;c&lt;NC;c++){for(var i=0;i&lt;N;i++){var inext=(i+1)%N;var cnext=(c+1)%NC;var v0=pts[c*N+i];m.pos.push(v0.x,v0.y,v0.z);v0=normals[c*N+i];m.normal.push(v0.x,v0.y,v0.z);m.color.push(1,1,1);m.opacity.push(1);m.shininess.push(1);m.emissive.push(0);m.texpos.push(i/N,c/NC);v0=pts[c*N+inext].sub(pts[c*N+i]);m.bumpaxis.push(v0.x,v0.y,v0.z);m.index.push(N*c+i,N*cnext+i,N*cnext+inext,N*c+i,N*cnext+inext,N*c+inext)}}return m},makeRing_compound:function(size){var R2=size.x/2;var R1=size.y/2-R2;var NC=64;var dphi=2*Math.PI/NC;var sphi=Math.sin(dphi),cphi=Math.cos(dphi);var N=20;var dtheta=2*Math.PI/N;var sind=Math.sin(dtheta),cosd=Math.cos(dtheta);var x=0,z=R2,newx,newz;var shape=[];for(var c=0;c&lt;N;c++){shape.push(vec(x,0,z-R2));newx=x*cosd+z*sind;newz=z*cosd-x*sind;x=newx;z=newz}var y=0,z=.5,newy,newz;var pts=[];var normals=[];for(var c=0;c&lt;NC;c++){var r=vec(0,y*size.y,z*size.z);var n=vec(0,y,z).norm();var center=r.sub(n.multiply(R2));for(var i=0;i&lt;N;i++){var xc=shape[i].x;var zc=shape[i].z;var p=vec(xc,0,0).add(n.multiply(zc)).add(r);pts.push(p);normals.push(p.sub(center).norm())}newy=y*cphi+z*sphi;newz=z*cphi-y*sphi;y=newy;z=newz}var m=new Mesh;for(var c=0;c&lt;NC;c++){for(var i=0;i&lt;N;i++){var inext=(i+1)%N;var cnext=(c+1)%NC;var v0=pts[c*N+i];m.pos.push(v0.x,v0.y,v0.z);v0=normals[c*N+i];m.normal.push(v0.x,v0.y,v0.z);m.color.push(1,1,1);m.opacity.push(1);m.shininess.push(1);m.emissive.push(0);m.texpos.push(i/N,c/NC);v0=pts[c*N+inext].sub(pts[c*N+i]);m.bumpaxis.push(v0.x,v0.y,v0.z);m.index.push(N*c+i,N*cnext+i,N*cnext+inext,N*c+i,N*cnext+inext,N*c+inext)}}return m},makeSphere:function(R,N,hemi){var Nlat=N,Nlong=N;var offset=Nlong;var dtheta=Math.PI/Nlat;var dphi=2*Math.PI/Nlong;var sint=Math.sin(dtheta),cost=Math.cos(dtheta);var sinp=Math.sin(dphi),cosp=Math.cos(dphi);var offset=Nlong;if(hemi){Nlat=N/2;Nlong=4;offset=Nlong+1;dtheta=Math.PI/Nlat;sint=-Math.sin(dtheta);cost=Math.cos(dtheta);dphi=Math.PI/Nlong;sinp=Math.sin(dphi);cosp=Math.cos(dphi)}var m=new Mesh;var x1,x2,y1,y2,z1,z2,newx1,newz1,s,firstz2;var i,j;x1=0;y1=R;z1=0;for(i=0;i&lt;Nlat+1;i++){x2=0;y2=y1*cost+z1*sint;firstz2=z2=z1*cost-y1*sint;for(j=0;j&lt;Nlong+1;j++){m.pos.push(x1,y1,z1);m.normal.push(x1/R,y1/R,z1/R);m.color.push(1,1,1);m.opacity.push(1);m.shininess.push(1);m.emissive.push(0);m.texpos.push(j/Nlong,1-i/Nlat);m.bumpaxis.push(z1/R,0,-x1/R);newx1=x1*cosp+z1*sinp;newz1=z1*cosp-x1*sinp;x1=newx1;z1=newz1;if(hemi&amp;&amp;j&gt;=Nlong)break;s=i*offset;if(j&lt;Nlong)m.index.push(s+j,s+j+offset,s+j+offset+1,s+j,s+j+offset+1,s+j+1);else m.index.push(s+j,s+j+offset,s+0+offset,s+j,s+0+offset,s+0)}x1=0;y1=y2;z1=firstz2;if(i==Nlat){z1=0;for(j=0;j&lt;Nlong;j+=1){m.pos.push(0,-R,0);m.normal.push(-1,0,0);m.color.push(1,1,1);m.opacity.push(1);m.shininess.push(1);m.emissive.push(0);m.texpos.push(j/Nlong,0);m.bumpaxis.push(z1/R,0,-x1/R);newx1=x1*cosp+z1*sinp;newz1=z1*cosp-x1*sinp;x1=newx1;z1=newz1}}}return m},makeCone:function(R){var N=200;var m=new Mesh;m.pos.push(0,0,0);m.normal.push(-1,0,0);m.color.push(1,1,1);m.opacity.push(1);m.shininess.push(1);m.emissive.push(0);m.texpos.push(.5,.5);m.bumpaxis.push(0,0,1);var dtheta=2*Math.PI/N;var sind=Math.sin(dtheta),cosd=Math.cos(dtheta);var k=1/(R*Math.sqrt(5));var y=0,z=-R;var newy,newz;for(var i=1;i&lt;=1+3*N;i+=3){newy=y*cosd+z*sind;newz=z*cosd-y*sind;m.pos.push(0,y,z,0,y,z,1,0,0);m.normal.push(-1,0,0,k*R,2*k*y,2*k*z,k*R,2*k*(y+newy)/2,2*k*(z+newz)/2);m.color.push(1,1,1,1,1,1,1,1,1);m.opacity.push(1,1,1);m.shininess.push(1,1,1);m.emissive.push(0,0,0);m.texpos.push(.5*(1+z/R),.5*(1+y/R),1-(i-1)/N/3,0,1-(i-1)/N/3,1);m.bumpaxis.push(0,0,1,0,0,1,0,-z,y);if(i!=1+3*N)m.index.push(0,i,i+3,i+1,i+2,i+4);y=newy;z=newz}return m},makePyramid:function(){var m=new Mesh;var k=1/Math.sqrt(5);m.pos.push(0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,1,0,0,0,-.5,-.5,0,.5,-.5,1,0,0,0,-.5,.5,0,-.5,-.5,1,0,0,0,.5,.5,0,-.5,.5,1,0,0);m.normal.push(-1,0,0,-1,0,0,-1,0,0,-1,0,0,k,2*k,0,k,2*k,0,k,2*k,0,k,0,-2*k,k,0,-2*k,k,0,-2*k,k,-2*k,0,k,-2*k,0,k,-2*k,0,k,0,2*k,k,0,2*k,k,0,2*k);m.color.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1);m.opacity.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1);m.shininess.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1);m.emissive.push(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);m.texpos.push(1,1,0,1,0,0,1,0,0,0,.25,0,.125,1,1,0,.75,0,.875,1,.5,0,.75,0,.625,1,.25,0,.5,0,.375,1);m.bumpaxis.push(0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0);m.index.push(0,1,2,0,2,3,4,5,6,7,8,9,10,11,12,13,14,15);return m},makeCurveSegment:function(R){var N=16;var dtheta=2*Math.PI/N;var sind=Math.sin(dtheta),cosd=Math.cos(dtheta);var y=0,z=-R;var newy,newz;var m=new Mesh;for(var i=0;i&lt;=2*N;i+=2){m.pos.push(0,y,z,0,0,y,z,1);m.normal.push(0,y,z,0,y,z);m.color.push(1,1,1,1,1,1);m.opacity.push(1,1);m.shininess.push(1,1);m.emissive.push(0,0);m.texpos.push(0,0,0,0);m.bumpaxis.push(0,0,0,0,0,0);if(i!=2*N)m.index.push(i,i+2,i+1,i+1,i+2,i+3);newy=y*cosd+z*sind;newz=z*cosd-y*sind;y=newy;z=newz}var offset=m.pos.length/4;var sph=Mesh.makeSphere(R,N,true);var L=sph.pos.length;for(var i=0;i&lt;L;i++){m.pos.push(sph.pos[3*i],sph.pos[3*i+1],sph.pos[3*i+2],1);m.normal.push(sph.normal[3*i],sph.normal[3*i+1],sph.normal[3*i+2]);m.color.push(1,1,1);m.opacity.push(1);m.shininess.push(1);m.emissive.push(0);m.texpos.push(sph.texpos[2*i],sph.texpos[2*i+1]);m.bumpaxis.push(sph.bumpaxis[3*i],sph.bumpaxis[3*i+1],sph.bumpaxis[3*i+2])}for(var i=0;i&lt;sph.index.length;i++)m.index.push(sph.index[i]+offset);return m}});var exports={Mesh:Mesh};Export(exports)})();(function(){&quot;use strict&quot;;var _unshifted=[&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;backspace&quot;,&quot;tab&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;\n&quot;,&quot;&quot;,&quot;&quot;,&quot;shift&quot;,&quot;ctrl&quot;,&quot;alt&quot;,&quot;&quot;,&quot;caps lock&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;esc&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot; &quot;,&quot;pageup&quot;,&quot;pagedown&quot;,&quot;end&quot;,&quot;home&quot;,&quot;left&quot;,&quot;up&quot;,&quot;right&quot;,&quot;down&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;,&quot;,&quot;insert&quot;,&quot;delete&quot;,&quot;/&quot;,&quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;&quot;,&quot;;&quot;,&quot;&quot;,&quot;=&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;i&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;o&quot;,&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;u&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;[&quot;,&quot;\\&quot;,&quot;]&quot;,&quot;&quot;,&quot;&quot;,&quot;`&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;delete&quot;];_unshifted[187]=&quot;=&quot;;_unshifted[189]=&quot;-&quot;;_unshifted[192]=&quot;`&quot;;_unshifted[219]=&quot;[&quot;;_unshifted[220]=&quot;\\&quot;;_unshifted[221]=&quot;]&quot;;_unshifted[186]=&quot;;&quot;;_unshifted[222]=&quot;&#39;&quot;;_unshifted[188]=&quot;,&quot;;_unshifted[190]=&quot;.&quot;;_unshifted[191]=&quot;/&quot;;var _shifted=[&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;backspace&quot;,&quot;tab&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;\n&quot;,&quot;&quot;,&quot;&quot;,&quot;shift&quot;,&quot;ctrl&quot;,&quot;alt&quot;,&quot;break&quot;,&quot;caps lock&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;esc&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;!&quot;,&#39;&quot;&#39;,&quot;//&quot;,&quot;$&quot;,&quot;%&quot;,&quot;&amp;&quot;,&#39;&quot;&#39;,&quot;(&quot;,&quot;)&quot;,&quot;*&quot;,&quot;+&quot;,&quot;&lt;&quot;,&quot;_&quot;,&quot;&gt;&quot;,&quot;?&quot;,&quot;)&quot;,&quot;!&quot;,&quot;@&quot;,&quot;#&quot;,&quot;$&quot;,&quot;%&quot;,&quot;^&quot;,&quot;&amp;&quot;,&quot;*&quot;,&quot;(&quot;,&quot;:&quot;,&quot;:&quot;,&quot;&lt;&quot;,&quot;=&quot;,&quot;&gt;&quot;,&quot;?&quot;,&quot;@&quot;,&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;E&quot;,&quot;F&quot;,&quot;G&quot;,&quot;H&quot;,&quot;I&quot;,&quot;J&quot;,&quot;K&quot;,&quot;L&quot;,&quot;M&quot;,&quot;N&quot;,&quot;O&quot;,&quot;P&quot;,&quot;Q&quot;,&quot;R&quot;,&quot;S&quot;,&quot;T&quot;,&quot;U&quot;,&quot;V&quot;,&quot;W&quot;,&quot;X&quot;,&quot;Y&quot;,&quot;Z&quot;,&quot;{&quot;,&quot;|&quot;,&quot;}&quot;,&quot;^&quot;,&quot;_&quot;,&quot;~&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;*&quot;,&quot;+&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;f1&quot;,&quot;f2&quot;,&quot;f3&quot;,&quot;f4&quot;,&quot;f5&quot;,&quot;f6&quot;,&quot;f7&quot;,&quot;f8&quot;,&quot;f9&quot;,&quot;f10&quot;,&quot;&quot;,&quot;{&quot;,&quot;|&quot;,&quot;}&quot;,&quot;~&quot;,&quot;delete&quot;];_shifted[187]=&quot;+&quot;;_shifted[189]=&quot;_&quot;;_shifted[192]=&quot;~&quot;;_shifted[219]=&quot;{&quot;;_shifted[220]=&quot;|&quot;;_shifted[221]=&quot;}&quot;;_shifted[186]=&quot;:&quot;;_shifted[222]=&#39;&quot;&#39;;_shifted[188]=&quot;&lt;&quot;;_shifted[190]=&quot;&gt;&quot;;_shifted[191]=&quot;?&quot;;var shiftlock=false;var __waitfor;var __waitfor_canvas;var __waitfor__expecting_key;$.fn.extend({gsmenubar:function(cmd){if(!this.is(&quot;ul&quot;)){alert(&quot;MenuBar top level must be unordered list, i.e. &lt;ul&gt;.&quot;);return}this.addClass(&quot;gsmenubar&quot;);this.children(&quot;li&quot;).children(&quot;ul&quot;).each(function(){$(this).menu()})}});$.fn.waitfor=function(eventTypes,callback){var self=this;function cb(ev){self.unbind(eventTypes,cb);__waitfor=&quot;&quot;;__waitfor_canvas.__expecting_key=__waitfor__expecting_key;callback(null,ev)}this.bind(eventTypes,cb)};$.fn.pause=function(prompt,callback){var self=this;function cb(ev){prompt.visible=false;self.unbind(&quot;click&quot;,cb);__waitfor=&quot;&quot;;__waitfor_canvas.__expecting_key=__waitfor__expecting_key;callback(null,ev)}this.bind(&quot;click&quot;,cb)};window.print_anchor=$(&quot;&lt;div/&gt;&quot;).css(&quot;white-space&quot;,&quot;pre&quot;).appendTo($(&quot;body&quot;));window.print_anchor.css({&quot;float&quot;:&quot;left&quot;});function canvas(options){if(!(this instanceof canvas))return new canvas(options);if(!options)options={};canvas.all.push(this);canvas.selected=this;canvas.hasmouse=null;this.__title_anchor=$(&quot;&lt;div/&gt;&quot;);this.__caption_anchor=$(&quot;&lt;div/&gt;&quot;);this.__titletext=&quot;&quot;;this.__captiontext=&quot;&quot;;if(&quot;title&quot;in options){this.__titletext=options.title;delete options.title}if(&quot;caption&quot;in options){this.__captiontext=options.caption;delete options.caption}this.__align=&quot;none&quot;;if(&quot;align&quot;in options){this.__align=options.align;delete options.align}this.__lastevent=null;this.__autoscale=true;if(&quot;autoscale&quot;in options){this.__autoscale=options.autoscale;delete options.autoscale}this.__range=10;for(var id in options)this[id]=options[id];this.hasmouse=false;this.__needs_update=false;this.events=$(&quot;&lt;div/&gt;&quot;);this.wrapper=$(&quot;&lt;div/&gt;&quot;);this.menu=$(&quot;&lt;div/&gt;&quot;);this.__canvas_element=document.createElement(&quot;canvas&quot;);this.__overlay_element=document.createElement(&quot;canvas&quot;);this.elements=$([this.__canvas_element,this.__overlay_element]);this.__overlay_objects={objects:[],__changed:false};this.__visiblePrimitives={};this.lights=[{direction:vec(.21821789,.4364357,.8728715),color:vec(.8,.8,.8)},{direction:vec(-.872872,-.218218,-.436436),color:vec(.3,.3,.3)}];this.trails=[];this.arrows=[];this.billboards=[];this.update_billboards=false;this.__points_objects=[];this.__opaque_objects={};this.__transparent_objects={};this.vertex_id=1;var N=100;this.__vertices={Nalloc:N,pos:new Float32Array(3*N),normal:new Float32Array(3*N),color:new Float32Array(3*N),opacity:new Float32Array(N),shininess:new Float32Array(N),emissive:new Float32Array(N),texpos:new Float32Array(2*N),bumpaxis:new Float32Array(3*N),index:new Uint16Array(N),model_transparent:false,object_info:{},available:[]};this.__vertices.normal[2]=1;this.__sort_objects={opaque:{plain:{},textures:{},bumpmaps:{},textures_and_bumpmaps:{}},transparent:{plain:{},textures:{},bumpmaps:{},textures_and_bumpmaps:{}}};this.camera=orbital_camera(this);this.mouse=new Mouse(this);this.mouse.pos=vec(0,0,0);this.mouse.ray=vec(0,0,1);this.textures={};this.textures_requested={};this.__changed={};this.__vertex_changed={};this.visible=true;this.waitfor_textures=false;__waitfor=&quot;&quot;;this.__expecting_key=false}property.declare(canvas.prototype,{__activate:function(){this.__activated=true;this.__activate=function(){};var container=canvas.container;this.__title_anchor.css(&quot;white-space&quot;,&quot;pre&quot;).appendTo(container);this.menu.css(&quot;white-space&quot;,&quot;pre&quot;).appendTo(container);this.wrapper.addClass(&quot;glowscript-canvas-wrapper&quot;).appendTo(container);this.__caption_anchor.css(&quot;white-space&quot;,&quot;pre&quot;).appendTo(container);this.wrapper.css(&quot;position&quot;,&quot;relative&quot;);var cv=this.__canvas_element;cv.style.position=&quot;absolute&quot;;var overlay=this.__overlay_element;overlay.style.position=&quot;relative&quot;;overlay.style.backgroundColor=&quot;transparent&quot;;this.__canvas_element.setAttribute(&quot;width&quot;,this.width);this.__overlay_element.setAttribute(&quot;width&quot;,this.width);this.__canvas_element.setAttribute(&quot;height&quot;,this.height);this.__overlay_element.setAttribute(&quot;height&quot;,this.height);this.wrapper.append(this.__canvas_element);this.wrapper.append(this.__overlay_element);$(this.wrapper).resizable();$(this.wrapper).on(&quot;resize&quot;,{&quot;this&quot;:this},function(event,ui){event.data.this.width=ui.size.width;event.data.this.height=ui.size.height});if(!this.resizable)$(this.wrapper).resizable(&quot;disable&quot;);this.wrapper.css(&quot;float&quot;,this.__align);this.__renderer=new WebGLRenderer(this,cv,overlay);if(this.camera.__activate)this.camera.__activate();this.__handleEvents();if(this.__titletext)this.title=this.__titletext;if(this.__captiontext)this.caption=this.__captiontext},remove:function(){for(var id in this.__visiblePrimitives)this.__visiblePrimitives[id].visible=false;for(var id in this.__overlay_objects.objects)this.__overlay_objects.objects[id].visible=false;this.wrapper.remove()},__change_size:function(){if(this.__activated){this.__canvas_element.style.width=Math.floor(this.width).toString()+&quot;px&quot;;this.__overlay_element.style.width=Math.floor(this.width).toString()+&quot;px&quot;;this.__canvas_element.style.height=Math.floor(this.height).toString()+&quot;px&quot;;this.__overlay_element.style.height=Math.floor(this.height).toString()+&quot;px&quot;}},__handleEvents:function(){var canvas=this;var elements=canvas.elements;elements.bind(&quot;mouseenter mouseleave&quot;,function(ev){canvas.trigger(&quot;mouse&quot;,ev)});var keys={shift:16,ctrl:17,alt:18};$(document).bind(&quot;keydown keyup&quot;,function(ev){for(var k in keys){if(keys[k]==ev.which){canvas.mouse[k]=ev.type==&quot;keydown&quot;;break}}if(!canvas.__expecting_key)return;ev.event=ev.type;if(ev.which==20&amp;&amp;ev.type==&quot;keydown&quot;)shiftlock=!shiftlock;ev.shift=canvas.mouse.shift||shiftlock;ev.key=_unshifted[ev.which];if(shiftlock&amp;&amp;(65&lt;=ev.which&amp;&amp;ev.which&lt;=90))ev.key=_shifted[ev.which];else if(canvas.mouse.shift)ev.key=_shifted[ev.which];ev.alt=canvas.mouse.alt;ev.ctrl=canvas.mouse.ctrl;canvas.trigger(ev.type,ev)})},waitfor:function(eventTypes,callback){__waitfor_canvas=this;__waitfor__expecting_key=this.__expecting_key;if(eventTypes.search(&quot;key&quot;)&gt;=0){__waitfor=eventTypes;this.__expecting_key=true}else{__waitfor=&quot;&quot;;this.__expecting_key=false}if(eventTypes==&quot;textures&quot;)this.waitfor_textures=true;return this.events.waitfor(eventTypes,callback)},pause:function(args){__waitfor_canvas=this;__waitfor__expecting_key=this.__expecting_key;__waitfor=&quot;&quot;;var prompt=&quot;&quot;,callback;if(arguments.length==1)callback=arguments[0];else{prompt=arguments[0];callback=arguments[1]}if(prompt.length&gt;0){if(this.__prompt==undefined){this.__prompt=label({canvas:this,align:&quot;right&quot;,pixel_pos:true,height:14,color:color.black,background:color.white,opacity:1,box:false})}this.__prompt.pos=vec(this.__width,this.__height-12,0);this.__prompt.text=prompt;this.__prompt.visible=true;this.events.pause(this.__prompt,callback)}else{if(this.__draw==undefined)this.__draw=draw({canvas:this});var x=this.width-5,y=this.height-20;this.__draw.points=[vec(x,y,0),vec(x-30,y-13,0),vec(x-30,y+15,0),vec(x,y,0)];this.__draw.opacity=1;this.__draw.color=color.black;this.__draw.fillcolor=color.white;this.__draw.visible=true;this.events.pause(this.__draw,callback)}},select:function(){window.__context.canvas_selected=this},title_anchor:{get:function(){if(!this.__activated)this.__activate();return this.__title_anchor},set:function(value){throw new Error(&quot;Cannot change title_anchor&quot;)}},caption_anchor:{get:function(){if(!this.__activated)this.__activate();return this.__caption_anchor},set:function(value){throw new Error(&quot;Cannot change caption_anchor&quot;)}},title:{get:function(){return this.__titletext},set:function(value){this.__titletext=value;this.__title_anchor.html(value)}},caption:{get:function(){return this.__captiontext},set:function(value){this.__captiontext=value;this.__caption_anchor.html(value)}},append_to_title:function(args){var s=&quot;&quot;;var L=arguments.length;for(var i=0;i&lt;L;i++)s+=print_to_string(arguments[i])+&quot; &quot;;s=s.slice(0,-1);this.__titletext+=s;this.__title_anchor.append(s)},append_to_caption:function(args){var s=&quot;&quot;;var L=arguments.length;for(var i=0;i&lt;L;i++)s+=print_to_string(arguments[i])+&quot; &quot;;s=s.slice(0,-1);this.__captiontext+=s;this.__caption_anchor.append(s)},bind:function(eventTypes,callback){if(eventTypes.search(&quot;key&quot;)&gt;=0)this.__expecting_key=true;return this.events.bind(eventTypes,callback)},unbind:function(eventTypes,callback){if(eventTypes.search(&quot;key&quot;)&gt;=0)this.__expecting_key=false;return this.events.unbind(eventTypes,callback)},one:function(eventTypes,callback){return this.events.one(eventTypes,callback)},trigger:function(type,ev){if(ev===undefined)ev={type:type,event:event};if(type==&quot;mouse&quot;){type=ev.type;var ev={type:type,pageX:ev.pageX,pageY:ev.pageY,which:1};this.mouse.__update(ev);ev.event=ev.type;ev.pos=this.mouse.pos;if(ev.type==&quot;mousedown&quot;){ev.press=&quot;left&quot;;ev.release=null}else if(ev.type==&quot;mousemove&quot;){ev.press=null;ev.release=null}else if(ev.type==&quot;mouseup&quot;){ev.press=null;ev.release=&quot;left&quot;}else if(ev.type==&quot;mouseenter&quot;||ev.type==&quot;mouseleave&quot;){ev.press=null;ev.release=null}else if(ev.type==&quot;click&quot;){ev.press=null;ev.release=&quot;left&quot;}}if(ev!==null)ev.canvas=this;var nev=new $.Event(type,ev);this.events.trigger(nev)},background:new vec(0,0,0),ambient:new vec(.2,.2,.2),__change:function(){if(this.__lastevent!==null&amp;&amp;this.hasmouse)this.mouse.__update(this.__lastevent)},center:new attributeVector(null,0,0,0),forward:new attributeVector(null,0,0,-1),up:new attributeVector(null,0,1,0),__last_forward:null,__activated:false,userzoom:true,userspin:true,fov:60*Math.PI/180,width:{value:640,onchanged:function(){this.__change_size()}},height:{value:400,onchanged:function(){this.__change_size()}},align:{get:function(){return this.__align},set:function(value){if(value==&quot;left&quot;||value==&quot;right&quot;||value==&quot;none&quot;){this.__align=value}else throw new Error(&quot;align must be &#39;left&#39;, &#39;right&#39;, or &#39;none&#39; (the default).&quot;)}},resizable:{value:false,onchanged:function(){if(this.__activated){$(this.wrapper).resizable((this.resizable?&quot;en&quot;:&quot;dis&quot;)+&quot;able&quot;)}}},autoscale:{get:function(){return this.__autoscale},set:function(value){if(this.__autoscale&amp;&amp;!value)Autoscale.compute_autoscale(this);this.__autoscale=value}},range:{get:function(){if(this.__autoscale){Autoscale.compute_autoscale(this)}return this.__range},set:function(value){this.__autoscale=false;this.__range=value;if(this.__lastevent!==null)this.mouse.__update(this.__lastevent)}},pixel_to_world:{get:function(){var w=this.__width;var h=this.__height;var d=2*this.range;if(w&gt;=h){return d/h}else{return d/w}},set:function(value){throw new Error(&quot;Cannot assign a value to pixel_to_world.&quot;)}},objects:{get:function(){var all=[];for(var id in this.__visiblePrimitives){var v=this.__visiblePrimitives[id];if(v.__obj){if(v==v.__obj.__components[0]&amp;&amp;v.__obj.visible)all.push(v.__obj)}else all.push(v)}for(var id in this.__overlay_objects.objects){var obj=this.__overlay_objects.objects[id];if(obj instanceof label)all.push(obj)}return all}}});property.declare(canvas,{selected:{get:function(){return window.__context.canvas_selected||null},set:function(value){window.__context.canvas_selected=value}},get_selected:function(){return window.__context.canvas_selected||null},all:{get:function(){var v=window.__context.canvas_all;if(v===undefined)v=window.__context.canvas_all=[];return v}},container:{get:function(){return window.__context.glowscript_container||null},set:function(value){window.__context.glowscript_container=$(value)}}});function Mouse(canvas){this.canvas=canvas}property.declare(Mouse.prototype,{canvas:null,pos:null,ray:null,__pickx:null,__picky:null,pick:function(){return this.canvas.__renderer.render(1)},project:function(args){if(args.normal===undefined)throw new Error(&quot;scene.mouse.project() must specify a normal&quot;);var normal=args.normal;var dist;if(args.d===undefined&amp;&amp;args.point===undefined)dist=normal.dot(this.canvas.__center);else if(args.d!==undefined){dist=args.d}else if(args.point!==undefined){dist=normal.dot(args.point)}var ndc=normal.dot(this.canvas.camera.pos)-dist;var ndr=normal.dot(this.ray);if(ndr==0)return null;var t=-ndc/ndr;return this.canvas.camera.pos.add(this.ray.multiply(t))},alt:false,ctrl:false,shift:false,__update:function(ev){var cv=this.canvas,factor;if(cv.__width&gt;cv.__height)factor=2*cv.__range/cv.__height;else factor=2*cv.__range/cv.__width;var o=$(cv.__canvas_element).offset();this.__pickx=ev.pageX-o.left;this.__picky=cv.__height-(ev.pageY-o.top);var mx=(this.__pickx-cv.__width/2)*factor;var my=(this.__picky-cv.__height/2)*factor;var xaxis=cv.__forward.norm().cross(cv.__up).norm();var yaxis=xaxis.cross(cv.__forward.norm());this.pos=cv.__center.add(xaxis.multiply(mx).add(yaxis.multiply(my)));this.ray=this.pos.sub(cv.camera.pos).norm();canvas.hasmouse=cv;cv.__lastevent=ev}});var exports={canvas:canvas};Export(exports)})();(function(){&quot;use strict&quot;;function orbital_camera(canvas,args){if(!(this instanceof orbital_camera))return new orbital_camera(canvas,args);this.canvas=canvas;this.follower=null}property.declare(orbital_camera.prototype,{pos:{get:function(){var c=this.canvas;return c.center.sub(c.forward.norm().multiply(c.range/Math.tan(c.fov/2)))},set:function(val){var c=this.canvas;c.center=val.add(this.axis)}},axis:{get:function(){var c=this.canvas;return c.forward.norm().multiply(c.range/Math.tan(c.fov/2))},set:function(val){var c=this.canvas;c.center=this.pos.add(val);c.forward=norm(val);c.range=mag(val)*Math.tan(c.fov/2)}},rotate:function(args){if(args===undefined||args.angle===undefined){throw new Error(&quot;object.rotate() requires an angle&quot;)}var angle=args.angle;var rotaxis,origin;if(args.axis===undefined){rotaxis=this.axis.norm()}else rotaxis=args.axis.norm();if(args.origin===undefined){origin=this.pos}else origin=args.origin;this.pos=origin.add(this.pos.sub(origin).rotate({angle:angle,axis:rotaxis}));this.axis=this.axis.rotate({angle:angle,axis:rotaxis})},follow:function(objectOrFunction){this.follower=objectOrFunction},__activate:function(){var canvas=this.canvas;var camera=this;var contextMenuDisabled=false;var lastX=[null,null],lastY=[null,null];var downX=[null,null],downY=[null,null];var angleX=0,angleY=0;var afterdown=false;var rotating,zrotating,zooming;var leftButton=false,rightButton=false,mouseWheel=false;var lastSep=null;var lastAngle=null;var fingers=0;var nomove=false;var tstart;var zoompos=[null,null];var saveEvent;var zoom=function(delta){var z=Math.exp(-delta*.05);canvas.range=canvas.range*z};var zrotate=function(dtheta){canvas.up=canvas.up.rotate({angle:2*dtheta,axis:canvas.__forward})};var spin=function(ev){var dx=ev.pageX-lastX[0];var dy=ev.pageY-lastY[0];angleX+=dx*.01;angleY+=dy*.01;if(angleY&lt;-1.4)angleY=-1.4;if(angleY&gt;1.4)angleY=1.4;canvas.__forward=canvas.__forward.rotate({angle:-.01*dx,axis:canvas.up});var max_vertical_angle=canvas.up.diff_angle(canvas.__forward.multiply(-1));var vertical_angle=.01*dy;if(!(vertical_angle&gt;=max_vertical_angle||vertical_angle&lt;=max_vertical_angle-Math.PI)){canvas.__forward=canvas.__forward.rotate({angle:-vertical_angle,axis:canvas.__forward.cross(canvas.__up)})}};$(document).bind(&quot;contextmenu&quot;,function(e){return!contextMenuDisabled});canvas.elements.mousewheel(function(ev,delta){if(canvas.userzoom)zoom(delta);return false});canvas.elements.mousedown(function(ev){if(ev.which==1)leftButton=true;if(ev.which==3)rightButton=true;rotating=canvas.userspin&amp;&amp;(ev.which==3||ev.which==1&amp;&amp;canvas.mouse.ctrl&amp;&amp;!canvas.mouse.alt);zooming=canvas.userzoom&amp;&amp;(ev.which==2||ev.which==1&amp;&amp;canvas.mouse.alt&amp;&amp;!canvas.mouse.ctrl||leftButton&amp;&amp;rightButton);if(ev.which==3&amp;&amp;!(rotating||zooming))return;downX[0]=lastX[0]=ev.pageX;downY[0]=lastY[0]=ev.pageY;if(rotating||zooming)contextMenuDisabled=true;else if(ev.which==1)canvas.trigger(&quot;mouse&quot;,ev);afterdown=true;ev.preventDefault();ev.stopPropagation();return false});canvas.elements.mousemove(function(ev){if(ev.pageX===lastX[0]&amp;&amp;ev.pageY===lastY[0])return;if(!afterdown){canvas.mouse.__update(ev);return}if(zooming){var dy=lastY[0]-ev.pageY;if(dy!==0)zoom(.1*dy)}else if(rotating){spin(ev)}else if(ev.which==1)canvas.trigger(&quot;mouse&quot;,ev);lastX[0]=ev.pageX;lastY[0]=ev.pageY});canvas.elements.mouseup(function(ev){if(ev.which==1)leftButton=false;if(ev.which==3)rightButton=false;if(!afterdown)return;if(ev.which==3&amp;&amp;contextMenuDisabled)setTimeout(function(){contextMenuDisabled=false},0);if(!(rotating||zooming)){if(ev.which==1){canvas.trigger(&quot;mouse&quot;,ev);if(abs(ev.pageX-downX[0])&lt;=5&amp;&amp;abs(ev.pageY-downY[0])&lt;=5){ev.type=&quot;click&quot;;canvas.trigger(&quot;mouse&quot;,ev)}}else if(ev.which==3){contextMenuDisabled=true;return}}rotating=zooming=afterdown=false;lastX=[null,null];lastY=[null,null]});canvas.elements.bind(&quot;touchstart&quot;,function(ev){rotating=zooming=nomove=false;lastSep=lastAngle=null;var pt;var data=ev.originalEvent.targetTouches;if(data.length&gt;2)return;if(data.length==2&amp;&amp;!(canvas.userspin||canvas.userzoom))return;fingers++;for(var i=0;i&lt;data.length;i++){pt=data[i];downX[i]=lastX[i]=pt.clientX;downY[i]=lastY[i]=pt.clientY;zoompos[i]=vec(downX[i],downY[i],0)}lastSep=null;saveEvent={type:&quot;mousedown&quot;,pageX:downX[0],pageY:downY[0],which:1};if(!(canvas.userspin||canvas.userzoom)){canvas.trigger(&quot;mouse&quot;,saveEvent);saveEvent=null}tstart=msclock();ev.preventDefault();ev.stopPropagation();return false});canvas.elements.bind(&quot;touchmove&quot;,function(ev){if(nomove){canvas.mouse.__update(ev);return}var t=msclock()-tstart;var data=ev.originalEvent.targetTouches;if(data.length&gt;2)return;var pt;var newx=[null,null],newy=[null,null];var relx=[0,0],rely=[0,0];for(var i=0;i&lt;data.length;i++){pt=data[i];newx[i]=pt.clientX;newy[i]=pt.clientY;relx[i]=newx[i]-downX[i];rely[i]=newy[i]-downY[i]}if(data.length==2){if(!(canvas.userspin||canvas.userzoom))return;var dzoom=[null,null];if(!zooming){zrotating=false;for(var i=0;i&lt;2;i++)dzoom[i]=vec(newx[i],newy[i],0).sub(zoompos[i]);if(dzoom[0].mag&gt;15||dzoom[1].mag&gt;15){saveEvent=null;zooming=true;var r=zoompos[1].sub(zoompos[0]).norm();var angmom=r.cross(dzoom[1]).sub(r.cross(dzoom[0])).mag;if(angmom&gt;10){zrotating=canvas.userspin;if(!canvas.userspin)zooming=false}}else return}}if(saveEvent!==null){if(data.length==2){saveEvent=null}else{var near=relx[0]&lt;=5&amp;&amp;rely[0]&lt;=5;if(!rotating&amp;&amp;t&gt;150&amp;&amp;near){canvas.trigger(&quot;mouse&quot;,saveEvent);saveEvent=null}else if(!near){rotating=canvas.userspin;saveEvent=null}}}else{if(newx[0]===lastX[0]&amp;&amp;newy[0]===lastY[0]&amp;&amp;newx[1]===lastX[1]&amp;&amp;newy[1]===lastY[1])return;ev.pageX=newx[0];ev.pageY=newy[0];ev.type=&quot;mousemove&quot;;if(rotating)spin(ev);else if(zooming){var xx=newx[1]-newx[0];var yy=newy[1]-newy[0];if(zrotating){var angle=Math.atan2(yy,xx);if(lastAngle!==null){var dangle;var va=vec(Math.cos(lastAngle),Math.sin(lastAngle),0);var vb=vec(Math.cos(angle),Math.sin(angle),0);var vc=va.cross(vb);var amag=Math.abs(Math.asin(vc.mag));if(vc.z&gt;=0)dangle=-amag;else dangle=amag;zrotate(dangle)}lastAngle=angle}else if(canvas.userzoom){var sep=Math.sqrt(xx*xx+yy*yy);if(lastSep!==null&amp;&amp;sep!=lastSep)zoom(.2*(sep-lastSep));lastSep=sep}}else canvas.trigger(&quot;mouse&quot;,ev)}lastX[0]=newx[0];lastX[1]=newx[1];lastY[0]=newy[0];lastY[1]=newy[1]});canvas.elements.bind(&quot;touchend&quot;,function(ev){fingers--;if(saveEvent!==null&amp;&amp;!(rotating||zooming)){canvas.trigger(&quot;mouse&quot;,saveEvent);saveEvent=null}var data=ev.originalEvent.changedTouches;ev.pageX=data[0].clientX;ev.pageY=data[0].clientY;if(!(rotating||zooming)){ev.type=&quot;mouseup&quot;;canvas.trigger(&quot;mouse&quot;,ev);if(abs(ev.pageX-downX[0])&lt;=5&amp;&amp;abs(ev.pageY-downY[0])&lt;=5){ev.type=&quot;click&quot;;canvas.trigger(&quot;mouse&quot;,ev)}}if(zooming){if(fingers&gt;0)nomove=true;else zooming=nomove=false}rotating=false;lastX=[null,null];lastY=[null,null];lastSep=lastAngle=null})}});var exports={orbital_camera:orbital_camera};Export(exports)})();(function(){&quot;use strict&quot;;function extent(){}$.extend(extent.prototype,{xmin:null,ymin:null,zmin:null,xmax:null,ymax:null,zmax:null,zx_camera:0,zy_camera:0,last_zx_camera:-1,last_zy_camera:-1,point_extent:function(obj,p){this.xmin=Math.min(p.x,this.xmin);this.ymin=Math.min(p.y,this.ymin);this.zmin=Math.min(p.z,this.zmin);this.xmax=Math.max(p.x,this.xmax);this.ymax=Math.max(p.y,this.ymax);this.zmax=Math.max(p.z,this.zmax);obj.__xmin=Math.min(p.x,obj.__xmin);obj.__ymin=Math.min(p.y,obj.__ymin);obj.__zmin=Math.min(p.z,obj.__zmin);obj.__xmax=Math.max(p.x,obj.__xmax);obj.__ymax=Math.max(p.y,obj.__ymax);obj.__zmax=Math.max(p.z,obj.__zmax)}});var exports={Autoscale:{compute_autoscale:function compute_autoscale(canvas){var ext=canvas.__extent;if(!ext)ext=canvas.__extent=new extent;var ctrx=canvas.center.x,ctry=canvas.center.y,ctrz=canvas.center.z;var all=canvas.__visiblePrimitives;ext.zx_camera=0;ext.zy_camera=0;var cot_hfov=1/Math.tan(canvas.__fov/2);</td>
      </tr>
      <tr>
        <td id="L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="LC9" class="blob-code blob-code-inner js-file-line">ext.__cot_hfov=cot_hfov;ext.__centerx=canvas.center.x;ext.__centery=canvas.center.y;ext.__centerz=canvas.center.z;var check=false;var obj;for(var id in all){obj=all[id];if(obj.constructor.name==&quot;point&quot;)continue;if(obj.constructor.name==&quot;points&quot;)continue;check=true;if(canvas.__changed[obj.__id]||obj.__zx_camera===null||obj.__zy_camera===null){obj.__get_extent(ext);if(obj.__xmin===null)continue;var xx=Math.max(Math.abs(obj.__xmin-ctrx),Math.abs(obj.__xmax-ctrx));var yy=Math.max(Math.abs(obj.__ymin-ctry),Math.abs(obj.__ymax-ctry));var zz=Math.max(Math.abs(obj.__zmin-ctrz),Math.abs(obj.__zmax-ctrz));obj.__zx_camera=xx*cot_hfov+zz;obj.__zy_camera=yy*cot_hfov+zz}ext.zx_camera=Math.max(ext.zx_camera,obj.__zx_camera);ext.zy_camera=Math.max(ext.zy_camera,obj.__zy_camera)}if(check){if(ext.zx_camera&gt;ext.last_zx_camera||ext.zx_camera&lt;ext.last_zx_camera/3||ext.zy_camera&gt;ext.last_zy_camera||ext.zy_camera&lt;ext.last_zy_camera/3){var predicted_zy=ext.zx_camera*canvas.__height/canvas.__width;if(predicted_zy&gt;ext.zy_camera){if(canvas.__width&gt;=canvas.__height){canvas.__range=1.1*(canvas.__height/canvas.__width)*ext.zx_camera/cot_hfov}else{canvas.__range=1.1*ext.zx_camera/cot_hfov}}else{if(canvas.__width&gt;=canvas.__height){canvas.__range=1.1*ext.zy_camera/cot_hfov}else{canvas.__range=1.1*(canvas.__width/canvas.__height)*ext.zy_camera/cot_hfov}}ext.last_zx_camera=ext.zx_camera;ext.last_zy_camera=ext.zy_camera}}},find_extent:function find_extent(obj,ext){if(obj.constructor.name==&quot;points&quot;)return;var size=obj.__size;var sizex=size.x,sizey=size.y,sizez=size.z;var start=obj.__pos;var startx=start.x,starty=start.y,startz=start.z;var center_pos=obj.__hasPosAtCenter;var length;if(center_pos)length=Math.sqrt(sizex*sizex+sizey*sizey+sizez*sizez)/2;else length=Math.sqrt(sizex*sizex+sizey*sizey/4+sizez*sizez/4);var px=startx-ext.__centerx;var py=starty-ext.__centery;var pz=startz-ext.__centerz;var zzx=(Math.abs(px)+length)*ext.__cot_hfov+Math.abs(pz)+length;var zzy=(Math.abs(py)+length)*ext.__cot_hfov+Math.abs(pz)+length;if(zzx&lt;ext.zx_camera&amp;&amp;zzy&lt;ext.zy_camera)return;var axis=obj.__axis.norm();var up=obj.__up.norm();if(center_pos)start=start.sub(axis.multiply(sizex/2));var long=axis.multiply(sizex);var z=axis.cross(up).norm();if(z.dot(z)&lt;1e-10){z=axis.cross(vec(1,0,0)).norm();if(z.dot(z)&lt;1e-10)z=axis.cross(vec(0,1,0)).norm()}var y=z.cross(axis);var pt1=start.add(y.multiply(-sizey/2).add(z.multiply(-sizez/2)));var pt2=pt1.add(y.multiply(sizey));var pt3=pt1.add(z.multiply(sizez));var pt4=pt2.add(z.multiply(sizez));var pt5=pt1.add(long);var pt6=pt2.add(long);var pt7=pt3.add(long);var pt8=pt4.add(long);ext.point_extent(obj,pt1);ext.point_extent(obj,pt2);ext.point_extent(obj,pt3);ext.point_extent(obj,pt4);ext.point_extent(obj,pt5);ext.point_extent(obj,pt6);ext.point_extent(obj,pt7);ext.point_extent(obj,pt8)}}};Export(exports)})();(function(){&quot;use strict&quot;;var RENDER=0,PICK=1,EXTENT=2,RENDER_TEXTURE=3;var PEEL_C0=4;var PEEL_D0=5;var PEEL_C1=6;var PEEL_D1=7;var PEEL_C2=8;var PEEL_D2=9;var PEEL_C3=10;var PEEL_D3=11;var PEEL_C4=12;var MERGE=13;var fps=0;var renderMS=0;var lastStartRedraw=0;var lastEndRedraw=0;function WebGLRenderer(canvas,canvasElement,overlay){var renderer=this;var gl=WebGLUtils.setupWebGL(canvasElement);if(!gl)throw new Error(&quot;Can&#39;t create canvas: WebGL not supported&quot;);canvas.overlay_context=overlay.getContext(&quot;2d&quot;);var MAX_LIGHTS=8;var light_pos=new Float32Array(MAX_LIGHTS*4);var light_color=new Float32Array(MAX_LIGHTS*3);var light_ambient=new Float32Array(3);var canvas_size=new Float32Array(2);var save=new Array(4);var pixels=new Uint8Array(4);var standard_program=null,curve_program=null,triangle_program=null;var ring_program=null;var peel_depth_programD0=null;var peel_color_programC1=null;var peel_depth_programD1=null;var peel_color_programC2=null;var peel_depth_programD2=null;var peel_color_programC3=null;var peel_depth_programD3=null;var peel_color_programC4=null;var ring_peel_depth_programD0=null;var ring_peel_color_programC1=null;var ring_peel_depth_programD1=null;var ring_peel_color_programC2=null;var ring_peel_depth_programD2=null;var ring_peel_color_programC3=null;var ring_peel_depth_programD3=null;var ring_peel_color_programC4=null;var tri_peel_depth_programD0=null;var tri_peel_color_programC1=null;var tri_peel_depth_programD1=null;var tri_peel_color_programC2=null;var tri_peel_depth_programD2=null;var tri_peel_color_programC3=null;var tri_peel_depth_programD3=null;var tri_peel_color_programC4=null;var curve_peel_depth_programD0=null;var pick_program=null,curve_pick_program=null,tri_pick_program=null,ring_pick_program=null;var extent_program=null,curve_extent_program=null;var merge_program=null;var merge_program2=null;function shaderProgram(fragSrc,vertSrc,gls){function makeShader(text,type,glx){var shader=glx.createShader(type);glx.shaderSource(shader,text);glx.compileShader(shader);if(!glx.getShaderParameter(shader,glx.COMPILE_STATUS)){alert(glx.getShaderInfoLog(shader));throw new Error(&quot;Shader compile error&quot;)}return shader}var vertexShader=makeShader(vertSrc,gls.VERTEX_SHADER,gls);var fragmentShader=makeShader(fragSrc,gls.FRAGMENT_SHADER,gls);var P=gls.createProgram();gls.attachShader(P,vertexShader);gls.attachShader(P,fragmentShader);gls.linkProgram(P);if(!gls.getProgramParameter(P,gls.LINK_STATUS)){alert(gls.getProgramInfoLog(P));throw new Error(&quot;Shader link error&quot;)}var uniforms=gls.getProgramParameter(P,gls.ACTIVE_UNIFORMS);P.uniforms={};for(var i=0;i&lt;uniforms;i++){var t=gls.getActiveUniform(P,i);var name=t.name;if(name.substring(name.length-3)==&quot;[0]&quot;)name=name.substring(0,name.length-3);P.uniforms[name]=gls.getUniformLocation(P,name)}var attributes=gls.getProgramParameter(P,gls.ACTIVE_ATTRIBUTES);P.attributes={};for(var i=0;i&lt;attributes;i++){var t=gls.getActiveAttrib(P,i);P.attributes[t.name]=gls.getAttribLocation(P,t.name)}return P}var Model=function(mesh,dynamism){if(dynamism)this.dynamism=gl.DYNAMIC_DRAW;else this.dynamism=gl.STATIC_DRAW;this.elementType=gl.TRIANGLES;this.mesh=mesh;this.model_transparent=mesh.model_transparent;this.pos=new Float32Array(mesh.pos);this.normal=new Float32Array(mesh.normal);this.color=new Float32Array(mesh.color);this.opacity=new Float32Array(mesh.opacity);this.shininess=new Float32Array(mesh.shininess);this.emissive=new Float32Array(mesh.emissive);this.texpos=new Float32Array(mesh.texpos);this.bumpaxis=new Float32Array(mesh.bumpaxis);this.index=new Uint16Array(mesh.index);this.posBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.posBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.pos,this.dynamism);this.normalBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.normalBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.normal,this.dynamism);this.colorBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.color,this.dynamism);this.opacityBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.opacityBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.opacity,this.dynamism);this.shininessBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.shininessBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.shininess,this.dynamism);this.emissiveBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.emissiveBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.emissive,this.dynamism);this.texposBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.texposBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.texpos,this.dynamism);this.bumpaxisBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.bumpaxisBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.bumpaxis,this.dynamism);this.indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.index,this.dynamism)};var mbox=new Model(Mesh.makeCube(),false);var mcylinder=new Model(Mesh.makeCylinder(.5),false);var msphere=new Model(Mesh.makeSphere(.5,30,false),false);var mpyramid=new Model(Mesh.makePyramid(),false);var mcone=new Model(Mesh.makeCone(.5),false);var mring=new Model(Mesh.makeRing(.5-.05,.05),false);var object_models={triangle:new Model(canvas.__vertices,true),quad:new Model(Mesh.makeQuad(),false),curve:new Model(Mesh.makeCurveSegment(1),false)};if(window.__GSlang==&quot;vpython&quot;){object_models.vp_box=mbox;object_models.vp_pyramid=mpyramid;object_models.vp_cylinder=mcylinder;object_models.vp_cone=mcone;object_models.vp_sphere=msphere;object_models.vp_ellipsoid=msphere;object_models.vp_ring=mring}else{object_models.box=mbox;object_models.pyramid=mpyramid;object_models.cylinder=mcylinder;object_models.cone=mcone;object_models.sphere=msphere;object_models.ring=mring}var models=this.models={};for(var id in object_models)models[id]=object_models[id];this.add_model=function(mesh,dynamism){var i=mesh.__mesh_id;models[i]=object_models[i]=new Model(mesh,dynamism);models[i].id_object={}};this.remove_model=function(mesh,dynamism){var i=mesh.__mesh_id;delete models[i];delete object_models[i]};this.screenshot=function screenshot(callback){canvas.waitfor(&quot;draw_complete&quot;,function(err){var image=new Image;image.src=canvasElement.toDataURL();callback(err,image)})};this.reset=function(){for(var t in object_models)object_models[t].id_object={}};var camera={target:vec3.create([0,0,0]),up:vec3.create([0,1,0]),fovy:60,angleX:0,angleY:0,distance:1};this.reset();function isPowerOfTwo(x){return(x&amp;x-1)===0}function nextHighestPowerOfTwo(x){--x;for(var i=1;i&lt;32;i&lt;&lt;=1){x=x|x&gt;&gt;i}return x+1}function handleLoadedTexture(image,obj,bump){var name,t0,ref;if(bump){name=obj.__tex.bumpmap;ref=obj.__tex.bumpmap_ref;t0=obj.__tex.bumpmap_t0}else{name=obj.__tex.file;ref=obj.__tex.texture_ref;t0=obj.__tex.texture_t0}var tf=msclock();tf=tf-t0;if(name in canvas.textures){ref.reference=canvas.textures[name]}else{canvas.textures[name]=ref.reference=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,ref.reference);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,true);if(!isPowerOfTwo(image.width)||!isPowerOfTwo(image.height)){var c=document.createElement(&quot;canvas&quot;);c.width=nextHighestPowerOfTwo(image.width);c.height=nextHighestPowerOfTwo(image.height);var ctx=c.getContext(&quot;2d&quot;);ctx.drawImage(image,0,0,c.width,c.height);image=c}gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST);gl.generateMipmap(gl.TEXTURE_2D);gl.bindTexture(gl.TEXTURE_2D,null)}if(name in canvas.textures_requested){var done=canvas.textures_requested[name];while(done.length&gt;0){var data=done.pop();if(data[1]){data[0].__tex.bumpmap_ref.reference=ref.reference}else{data[0].__tex.texture_ref.reference=ref.reference}data[0].__change()}}}this.initTexture=function(name,obj,bump){if(bump)obj.__tex.bumpmap=name;else obj.__tex.file=name;if(name in canvas.textures){if(bump)obj.__tex.bumpmap_ref.reference=canvas.textures[name];else obj.__tex.texture_ref.reference=canvas.textures[name];return}if(name in canvas.textures_requested){canvas.textures_requested[name].push([obj,bump]);return}else canvas.textures_requested[name]=[[obj,bump]];var t0=msclock();if(bump)obj.__tex.bumpmap_t0=t0;else obj.__tex.texture_t0=t0;var image=new Image;image.crossOrigin=&quot;anonymous&quot;;image.src=name;image.onload=function(){handleLoadedTexture(image,obj,bump)}};var update_vertices=0;var last_width=-1;var last_height=-1;var ktexture=1;var peels={C0:null,D0:null,C1:null,D1:null,C2:null,D2:null,C3:null,D3:null,C4:null,EXTENT_TEXTURE:null};var fullpeels=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)&gt;=16;var textureN={C0:gl.TEXTURE2,D0:gl.TEXTURE3,C1:gl.TEXTURE4,D1:gl.TEXTURE5,C2:gl.TEXTURE6,D2:gl.TEXTURE7,C3:gl.TEXTURE8,D3:gl.TEXTURE9,C4:gl.TEXTURE10,EXTENT_TEXTURE:gl.TEXTURE11};function makeTexture(T){gl.activeTexture(textureN[T]);gl.bindTexture(gl.TEXTURE_2D,peels[T]);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(false&amp;&amp;T==&quot;EXTENT_TEXTURE&quot;)gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,3,3,0,gl.RGBA,gl.UNSIGNED_BYTE,null);else gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,ktexture*canvas.__width,ktexture*canvas.__height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.bindTexture(gl.TEXTURE_2D,null)}for(var T in peels){peels[T]=gl.createTexture();makeTexture(T)}var peelFramebuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,peelFramebuffer);var peelRenderbuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,peelRenderbuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,ktexture*canvas.__width,ktexture*canvas.__height);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,peelRenderbuffer);gl.bindRenderbuffer(gl.RENDERBUFFER,null);gl.bindFramebuffer(gl.FRAMEBUFFER,null);last_width=canvas.__width;last_height=canvas.__height;var data=new Uint8Array(3);var tex1=gl.createTexture();gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,tex1);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,1,1,0,gl.RGB,gl.UNSIGNED_BYTE,data);var tex0=gl.createTexture();gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,tex0);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,1,1,0,gl.RGB,gl.UNSIGNED_BYTE,data);this.render=function(mode){if(mode==RENDER){if(canvas.waitfor_textures){var check_objects=canvas.objects;for(var o in check_objects){var obj=check_objects[o];if(obj.__tex===undefined)continue;if(!obj.ready)return}canvas.waitfor_textures=false;canvas.trigger(&quot;textures&quot;,null)}}if(!canvas.visible){if(mode==RENDER)return;return null}if(canvas.__width!=last_width||canvas.__height!=last_height){for(var T in peels){makeTexture(T)}last_width=canvas.__width;last_height=canvas.__height}if(canvas.autoscale)Autoscale.compute_autoscale(canvas);if(canvas.camera.follower!==null){canvas.center=typeof canvas.camera.follower!==&quot;function&quot;?canvas.camera.follower.pos:canvas.camera.follower()}if(mode==RENDER){for(var i in canvas.arrows){var pos;var a=canvas.arrows[i];if(!a.run)continue;if(a.obj!==undefined){if(a.obj.pos!==undefined)pos=a.obj.pos;else continue}if(a.last_pos!==null&amp;&amp;pos.equals(a.last_pos))continue;a.arrow.pos=pos;if(a.obj[a.attr]!==undefined){if(!a.arrow.visible)a.arrow.visible=true;if(window.__GSlang==&quot;vpython&quot;)a.arrow.axis=a.obj[a.attr].multiply(a.scale);else a.arrow.axis_and_length=a.obj[a.attr].multiply(a.scale)}}for(var i in canvas.trails){var pos;var a=canvas.trails[i];if(!a.__run)continue;var obj=a.__obj;if(obj===undefined)continue;if(typeof obj===&quot;string&quot;){pos=a[obj];if(pos===undefined)continue}else if(typeof obj!==&quot;function&quot;){if(obj!==undefined&amp;&amp;obj.visible){if(obj.__interval&gt;0)continue;if(obj.__pos!==undefined)pos=obj.__pos;else continue}else continue}else pos=obj();if(a.__last_pos!==null&amp;&amp;pos.equals(a.__last_pos))continue;if(a.pps&gt;0){var tnow=msclock();if(a.__last_time===null)a.last_time=tnow;if(tnow-a.__last_time&gt;1e3/a.pps)a.__last_time=tnow;else if(tnow!=a.__last_time)continue}a.__trail.push({pos:pos,color:a.__options.color,radius:a.radius,retain:a.retain});a.__last_pos=vec(pos)}if(canvas.update_billboards||!canvas.__forward.equals(canvas.__last_forward)||!canvas.__up.equals(canvas.__last_up)){canvas.update_billboards=false;for(var i=0;i&lt;canvas.billboards.length;i++){var T=canvas.billboards[i];if(T.billboard){var x=cross(canvas.__forward,canvas.__up);var y=cross(x,canvas.forward);T.axis=x;T.up=y}}}}camera.target=vec3.create([canvas.__center.x,canvas.__center.y,canvas.__center.z]);camera.up=vec3.create([canvas.__up.x,canvas.__up.y,canvas.__up.z]);camera.fovy=canvas.__fov*180/Math.PI;var xz_unit_vector=vec(canvas.__forward.x,0,canvas.__forward.z).norm();camera.angleX=Math.atan2(xz_unit_vector.x,-xz_unit_vector.z);camera.angleY=Math.PI/2-Math.acos(-canvas.__forward.norm().y);if(canvasElement.clientWidth&gt;=canvasElement.clientHeight)camera.distance=canvas.__range/Math.tan(canvas.__fov/2);else camera.distance=canvas.__range*(canvasElement.clientHeight/canvasElement.clientWidth)/Math.tan(canvas.__fov/2);camera.pos=mat4.multiplyVec3(mat4.rotateX(mat4.rotateY(mat4.identity(mat4.create()),-camera.angleX),-camera.angleY),vec3.create([0,0,camera.distance]));camera.pos=vec3.create([canvas.__center.x+camera.pos[0],canvas.__center.y+camera.pos[1],canvas.__center.z+camera.pos[2]]);camera.zNear=camera.distance/100;camera.zFar=camera.distance*10;var projMatrix=mat4.perspective(camera.fovy,canvasElement.clientWidth/canvasElement.clientHeight,camera.zNear,camera.zFar);var viewMatrix=mat4.lookAt(camera.pos,camera.target,camera.up);var light_count=Math.min(canvas.lights.length,MAX_LIGHTS);for(var i=0;i&lt;light_count;i++){var light=canvas.lights[i];if(light.direction===undefined)var lightVec4=[light.pos.x,light.pos.y,light.pos.z,1];else var lightVec4=[light.direction.x,light.direction.y,light.direction.z,0];mat4.multiplyVec4(viewMatrix,lightVec4);for(var c=0;c&lt;4;c++)light_pos[i*4+c]=lightVec4[c];light_color[i*3]=light.color.x;light_color[i*3+1]=light.color.y;light_color[i*3+2]=light.color.z}light_ambient[0]=canvas.ambient.x;light_ambient[1]=canvas.ambient.y;light_ambient[2]=canvas.ambient.z;if(canvas.__points_objects.length&gt;0){var ptsobj=canvas.__points_objects;var scale=3*canvas.__range/canvas.__width;var D;for(var i=0;i&lt;ptsobj.length;i++){var p=ptsobj[i];if(p.__pixels){if(p===undefined||p.__last_range===canvas.__range)continue;p.__last_range=canvas.__range;D=p.__radius===0?10*scale:2*scale*p.__radius}else D=2*p.__radius;for(var s=0;s&lt;p.__points.length;s++)p.__points[s].size=vec(D,D,D)}}if(mode==RENDER){if(canvas.__overlay_objects.objects.length&gt;0&amp;&amp;(canvas.__overlay_objects.__changed||!(canvas.__forward.equals(canvas.__last_forward)&amp;&amp;canvas.__up.equals(canvas.__last_up)&amp;&amp;canvas.__range==canvas.__last_range))){canvas.__overlay_objects.__changed=false;var ctx=canvas.overlay_context;ctx.clearRect(0,0,canvas.__width,canvas.__height);for(var i=0;i&lt;canvas.__overlay_objects.objects.length;i++){var obj=canvas.__overlay_objects.objects[i];if(!obj.visible)continue;obj.__update(ctx,camera)}}}var lengths={pos:3,normal:3,color:3,opacity:1,shininess:1,emissive:1,texpos:2,bumpaxis:3};var c=canvas.__vertices;for(var id in canvas.__vertex_changed){var vert=canvas.__vertex_changed[id];var Nvert=vert.__id;update_vertices++;for(var t in lengths){var g=vert[&quot;__&quot;+t];if(lengths[t]==1){c[t][Nvert]=g}else if(lengths[t]==2){c[t][2*Nvert]=g.x;c[t][2*Nvert+1]=g.y}else{c[t][3*Nvert]=g.x;c[t][3*Nvert+1]=g.y;c[t][3*Nvert+2]=g.z}}}canvas.__vertex_changed={};for(var i=0;i&lt;2;i++){var arrow_updates=[];for(var id in canvas.__changed){var c=canvas.__changed[id];if(c.__obj){if(arrow_updates.indexOf(c.__obj)&lt;0){c.__obj.__update();arrow_updates.push(c.__obj)}delete canvas.__changed[c.__id];if(!c.__obj.visible)delete c.__model.id_object[c.__id]}else{c.__update();delete canvas.__changed[id]}}}canvas.__changed={};for(var m in object_models){canvas.__opaque_objects[m]={};canvas.__transparent_objects[m]={}}var need_RENDER_TEXTURE=false;for(var m in object_models){if(m==&quot;triangle&quot;||m==&quot;quad&quot;||m==&quot;point&quot;)continue;var model=object_models[m];var objs=model.id_object;for(var id in objs){var obj=objs[id];if(m==&quot;curve&quot;){canvas.__opaque_objects[m][id]=obj;continue}if(mode==RENDER&amp;&amp;(obj.__data[19]&lt;1||model.model_transparent)){canvas.__transparent_objects[m][id]=obj;need_RENDER_TEXTURE=true}else{canvas.__opaque_objects[m][id]=obj}}}var sort=canvas.__sort_objects;for(var op in sort){for(var a in sort[op])sort[op][a]={}}var Nvert;var vnames=[&quot;v0&quot;,&quot;v1&quot;,&quot;v2&quot;,&quot;v3&quot;];function add_indices(A,T,obj){if(obj.__owner!==undefined&amp;&amp;!obj.__owner.__vis)return;var c=A[T];if(c===undefined)c=A[T]=[obj];if(Nvert==3)c.push(obj.v0.__id,obj.v1.__id,obj.v2.__id);else c.push(obj.v0.__id,obj.v1.__id,obj.v2.__id,obj.v0.__id,obj.v2.__id,obj.v3.__id)}var pickdata={pos:[],color:[],index:[]};var triangles_exist=false,model;for(var m=0;m&lt;2;m++){if(m===0){Nvert=3;model=object_models[&quot;triangle&quot;]}else{Nvert=4;model=object_models[&quot;quad&quot;]}var objs=model.id_object;for(var id in objs){triangles_exist=true;var obj=objs[id];if(mode==PICK){var color=obj.__falsecolor;var p;for(var i=0;i&lt;3;i++){p=obj[vnames[i]].pos;pickdata.pos.push(p.x,p.y,p.z);pickdata.color.push(color[0],color[1],color[2],color[3]);pickdata.index.push(pickdata.index.length)}if(Nvert==4){var indices=[0,2,3];for(var ind=0;ind&lt;3;ind++){var i=indices[ind];p=obj[vnames[i]].pos;pickdata.pos.push(p.x,p.y,p.z);pickdata.color.push(color[0],color[1],color[2],color[3]);pickdata.index.push(pickdata.index.length)}}}else if(mode==RENDER){var opaque=true;for(var i=0;i&lt;Nvert;i++){if(obj[vnames[i]].opacity&lt;1){opaque=false;break}}var t=obj.__tex.file;var b=obj.__tex.bumpmap;if(opaque){if(t!==null){add_indices(sort.opaque.textures,t,obj);if(b!=null){add_indices(sort.opaque.textures_and_bumpmaps,b,obj)}}else if(b!=null){add_indices(sort.opaque.bumpmaps,b,obj)}else add_indices(sort.opaque.plain,&quot;all&quot;,obj)}else{need_RENDER_TEXTURE=true;if(t!==null){add_indices(sort.transparent.textures,t,obj);if(b!=null){add_indices(sort.transparent.textures_and_bumpmaps,b,obj)}}else if(b!=null){add_indices(sort.transparent.bumpmaps,b,obj)}else add_indices(sort.transparent.plain,&quot;all&quot;,obj)}}}}if(need_RENDER_TEXTURE)mode=RENDER_TEXTURE;var program;canvas_size[0]=ktexture*canvas.__width;canvas_size[1]=ktexture*canvas.__height;function useProgram(prog,minormode){program=prog;gl.useProgram(prog);gl.enableVertexAttribArray(prog.attributes.pos);if(mode==MERGE||minormode&gt;PEEL_D0)gl.uniform2fv(prog.uniforms.canvas_size,canvas_size);if(minormode!=MERGE){if(mode==RENDER||minormode==PEEL_C0||minormode==PEEL_C1||minormode==PEEL_C2||minormode==PEEL_C3||minormode==PEEL_C4){gl.uniform1i(prog.uniforms.light_count,light_count);gl.uniform4fv(prog.uniforms.light_pos,light_pos);gl.uniform3fv(prog.uniforms.light_color,light_color);gl.uniform3fv(prog.uniforms.light_ambient,light_ambient);gl.enableVertexAttribArray(prog.attributes.normal);if(prog!=curve_program){gl.enableVertexAttribArray(prog.attributes.color);gl.enableVertexAttribArray(prog.attributes.opacity);gl.enableVertexAttribArray(prog.attributes.shininess);gl.enableVertexAttribArray(prog.attributes.emissive);gl.enableVertexAttribArray(prog.attributes.texpos);gl.enableVertexAttribArray(prog.attributes.bumpaxis);gl.uniform1i(prog.uniforms.texmap,0);gl.uniform1i(prog.uniforms.bumpmap,1)}}gl.uniformMatrix4fv(prog.uniforms.viewMatrix,false,viewMatrix);gl.uniformMatrix4fv(prog.uniforms.projMatrix,false,projMatrix)}if(minormode==MERGE){gl.uniform1i(prog.uniforms.C0,2);gl.uniform1i(prog.uniforms.C1,4);if(fullpeels){gl.uniform1i(prog.uniforms.C2,6);gl.uniform1i(prog.uniforms.C3,8);gl.uniform1i(prog.uniforms.C4,10)}}else if(minormode&gt;PEEL_D0){gl.uniform1i(prog.uniforms.D0,3);if(minormode==PEEL_C2||minormode==PEEL_D2)gl.uniform1i(prog.uniforms.D1,5);else if(minormode==PEEL_C3||minormode==PEEL_D3)gl.uniform1i(prog.uniforms.D2,7);else if(minormode==PEEL_C4)gl.uniform1i(prog.uniforms.D3,9)}}function subrender(minormode,T,Trefs){if(mode==RENDER_TEXTURE&amp;&amp;Trefs.length&gt;0){for(var i=0;i&lt;Trefs.length;i++){var a=Trefs[i];if(a==T)continue;gl.activeTexture(textureN[a]);gl.bindTexture(gl.TEXTURE_2D,peels[a])}}if(T===null){gl.bindFramebuffer(gl.FRAMEBUFFER,null)}else{gl.bindFramebuffer(gl.FRAMEBUFFER,peelFramebuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,peels[T],0)}gl.viewport(0,0,canvas_size[0],canvas_size[1]);gl.enable(gl.DEPTH_TEST);if(mode==PICK||minormode&gt;PEEL_C0)gl.clearColor(0,0,0,0);else if(mode==EXTENT)gl.clearColor(0,0,0,1);else gl.clearColor(canvas.__background.x,canvas.__background.y,canvas.__background.z,1);if(mode==EXTENT){gl.depthFunc(gl.GREATER);gl.clearDepth(0)}else{gl.depthFunc(gl.LEQUAL);gl.clearDepth(1)}gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);function render_curves(){var model=object_models.curve;var objs=model.id_object;var elements=model.elementType;var model_length=model.index.length;var setup=true;for(var id in objs){if(!objs[id].visible)break;if(minormode&gt;PEEL_D0)break;if(setup){if(minormode==RENDER||minormode==PEEL_C0){if(curve_program==null)curve_program=shaderProgram(shaders.opaque_render_fragment,shaders.curve_render_vertex,gl);useProgram(curve_program,minormode)}else if(minormode==PEEL_D0){if(curve_peel_depth_programD0==null)curve_peel_depth_programD0=shaderProgram(shaders.peel_depth_fragmentD0,shaders.curve_peel_depth_vertex,gl);useProgram(curve_peel_depth_programD0,minormode)}else if(minormode==PICK){if(curve_pick_program==null)curve_pick_program=shaderProgram(shaders.pick_fragment,shaders.curve_pick_vertex,gl);useProgram(curve_pick_program,minormode)}gl.bindBuffer(gl.ARRAY_BUFFER,model.posBuffer);gl.vertexAttribPointer(program.attributes.pos,4,gl.FLOAT,false,0,0);if(minormode!=PICK&amp;&amp;minormode&lt;PEEL_D0){gl.bindBuffer(gl.ARRAY_BUFFER,model.normalBuffer);gl.vertexAttribPointer(program.attributes.normal,3,gl.FLOAT,false,0,0)}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,model.indexBuffer);if(mode==EXTENT)elements=gl.POINTS;setup=false}var obj=objs[id];var p=obj.__points;var length=p.length;var save_radius=obj.__data[15];if(save_radius===0){obj.__data[15]=4*canvas.__range/canvas.__width}gl.uniform4fv(program.uniforms.objectData,obj.__data);for(var t=1;t&lt;length;t++){var pnt=p[t];if(!pnt.visible)continue;var data=pnt.__prevsegment;if(mode==PICK){var falsecolor=pnt.__falsecolor;for(var i=0;i&lt;4;i++){save[i]=data[8+i];save[i+4]=data[12+i];data[12+i]=data[8+i]=falsecolor[i]}}gl.uniform4fv(program.uniforms.segmentData,data);gl.drawElements(elements,model_length,gl.UNSIGNED_SHORT,0);if(mode==PICK){for(var i=0;i&lt;8;i++)data[8+i]=save[i]}}obj.__data[15]=save_radius}}function render_triangles(){var model=object_models.triangle;var elements=model.elementType;var model_arrays=canvas.__vertices;if(mode==PICK){if(tri_pick_program==null)tri_pick_program=shaderProgram(shaders.pick_fragment,shaders.tri_pick_vertex,gl);useProgram(tri_pick_program,minormode);model_arrays={};model_arrays.pos=new Float32Array(pickdata.pos);model_arrays.color=new Float32Array(pickdata.color);model_index=new Uint16Array(pickdata.index);model_length=model_index.length;gl.bindBuffer(gl.ARRAY_BUFFER,model.posBuffer);gl.bufferData(gl.ARRAY_BUFFER,model_arrays.pos,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.pos,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,model_arrays.color,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.color,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,model.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,model_index,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.color,4,gl.FLOAT,false,0,0);gl.drawElements(elements,model_length,gl.UNSIGNED_SHORT,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.posBuffer);gl.bufferData(gl.ARRAY_BUFFER,canvas.__vertices.pos,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,model.colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,canvas.__vertices.color,gl.DYNAMIC_DRAW);return}var sort=canvas.__sort_objects;for(var op in sort){if(minormode&gt;PEEL_D0){if(op==&quot;opaque&quot;)continue}else{if(op==&quot;transparent&quot;)continue}var first=true;for(var sort_type in sort[op]){for(var sort_list in sort[op][sort_type]){if(first){first=false;switch(minormode){case RENDER:case PEEL_C0:if(triangle_program===null)triangle_program=shaderProgram(shaders.opaque_render_fragment,shaders.tri_render_vertex,gl);useProgram(triangle_program,minormode);break;case EXTENT:if(extent_program===null)extent_program=shaderProgram(shaders.pick_fragment,shaders.extent_vertex,gl);useProgram(extent_program,minormode);break;case PEEL_D0:if(tri_peel_depth_programD0===null)tri_peel_depth_programD0=shaderProgram(shaders.peel_depth_fragmentD0,shaders.tri_peel_depth_vertex,gl);useProgram(tri_peel_depth_programD0,minormode);break;case PEEL_D1:if(tri_peel_depth_programD1===null)tri_peel_depth_programD1=shaderProgram(shaders.peel_depth_fragmentD1,shaders.tri_peel_depth_vertex,gl);useProgram(tri_peel_depth_programD1,minormode);break;case PEEL_D2:if(tri_peel_depth_programD2===null)tri_peel_depth_programD2=shaderProgram(shaders.peel_depth_fragmentD2,shaders.tri_peel_depth_vertex,gl);useProgram(tri_peel_depth_programD2,minormode);break;case PEEL_D3:if(tri_peel_depth_programD3===null)tri_peel_depth_programD3=shaderProgram(shaders.peel_depth_fragmentD3,shaders.tri_peel_depth_vertex,gl);useProgram(tri_peel_depth_programD3,minormode);break;case PEEL_C1:if(tri_peel_color_programC1===null)tri_peel_color_programC1=shaderProgram(shaders.peel_color_fragmentC1,shaders.tri_render_vertex,gl);useProgram(tri_peel_color_programC1,minormode);break;case PEEL_C2:if(tri_peel_color_programC2===null)tri_peel_color_programC2=shaderProgram(shaders.peel_color_fragmentC2,shaders.tri_render_vertex,gl);useProgram(tri_peel_color_programC2,minormode);break;case PEEL_C3:if(tri_peel_color_programC3===null)tri_peel_color_programC3=shaderProgram(shaders.peel_color_fragmentC3,shaders.tri_render_vertex,gl);useProgram(tri_peel_color_programC3,minormode);break;case PEEL_C4:if(tri_peel_color_programC4===null)tri_peel_color_programC4=shaderProgram(shaders.peel_color_fragmentC4,shaders.tri_render_vertex,gl);useProgram(tri_peel_color_programC4,minormode);break}gl.bindBuffer(gl.ARRAY_BUFFER,model.posBuffer);if(update_vertices)gl.bufferData(gl.ARRAY_BUFFER,model_arrays.pos,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.pos,3,gl.FLOAT,false,0,0);if(mode==RENDER||minormode==PEEL_C0||minormode==PEEL_C1||minormode==PEEL_C2||minormode==PEEL_C3||minormode==PEEL_C4){gl.bindBuffer(gl.ARRAY_BUFFER,model.normalBuffer);if(update_vertices)gl.bufferData(gl.ARRAY_BUFFER,model_arrays.normal,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.normal,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.colorBuffer);if(update_vertices)gl.bufferData(gl.ARRAY_BUFFER,model_arrays.color,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.color,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.opacityBuffer);if(update_vertices)gl.bufferData(gl.ARRAY_BUFFER,model_arrays.opacity,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.opacity,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.shininessBuffer);if(update_vertices)gl.bufferData(gl.ARRAY_BUFFER,model_arrays.shininess,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.shininess,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.emissiveBuffer);if(update_vertices)gl.bufferData(gl.ARRAY_BUFFER,model_arrays.emissive,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.emissive,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.texposBuffer);if(update_vertices)gl.bufferData(gl.ARRAY_BUFFER,model_arrays.texpos,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.texpos,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.bumpaxisBuffer);if(update_vertices)gl.bufferData(gl.ARRAY_BUFFER,model_arrays.bumpaxis,gl.DYNAMIC_DRAW);gl.vertexAttribPointer(program.attributes.bumpaxis,3,gl.FLOAT,false,0,0);update_vertices=0}}var indices=sort[op][sort_type][sort_list];var tbobj=indices[0];var model_index=new Uint16Array(indices.slice(1));var model_length=model_index.length;gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,model.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,model_index,gl.DYNAMIC_DRAW);if(mode==EXTENT)elements=gl.POINTS;var Tdata=0,Bdata=0;if(sort_type==&quot;textures&quot;){if((mode==RENDER||mode==RENDER_TEXTURE)&amp;&amp;tbobj.__tex.file!==null){if(tbobj.__tex.texture_ref.reference!==null){gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,tbobj.__tex.texture_ref.reference);Tdata=1}else continue}}else if(sort_type==&quot;bumpmaps&quot;){if((mode==RENDER||mode==RENDER_TEXTURE)&amp;&amp;tbobj.__tex.bumpmap!==null){if(tbobj.__tex.bumpmap_ref.reference!==null){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,tbobj.__tex.bumpmap_ref.reference);Bdata=1}else continue}}else if(sort_type==&quot;textures_and_bumpmaps&quot;){if((mode==RENDER||mode==RENDER_TEXTURE)&amp;&amp;tbobj.__tex.file!==null){if(tbobj.__tex.texture_ref.reference!==null){gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,tbobj.__tex.texture_ref.reference);Tdata=1}else continue}if((mode==RENDER||mode==RENDER_TEXTURE)&amp;&amp;tbobj.__tex.bumpmap!==null){if(tbobj.__tex.bumpmap_ref.reference!==null){gl.activeTexture(gl.TEXTURE1);</td>
      </tr>
      <tr>
        <td id="L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="LC10" class="blob-code blob-code-inner js-file-line">gl.bindTexture(gl.TEXTURE_2D,tbobj.__tex.bumpmap_ref.reference);Bdata=1}else continue}}gl.uniform1f(program.uniforms.T,Tdata);gl.uniform1f(program.uniforms.B,Bdata);gl.drawElements(elements,model_length,gl.UNSIGNED_SHORT,0)}}}}function render_merge(){var model=object_models.quad;var elements=model.elementType;var model_length=model.index.length;if(fullpeels){if(merge_program==null)merge_program=shaderProgram(shaders.merge_fragment,shaders.merge_vertex,gl);useProgram(merge_program,minormode)}else{if(merge_program2==null)merge_program2=shaderProgram(shaders.merge_fragment2,shaders.merge_vertex,gl);useProgram(merge_program2,minormode)}gl.bindBuffer(gl.ARRAY_BUFFER,model.posBuffer);gl.vertexAttribPointer(program.attributes.pos,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,model.indexBuffer);gl.drawElements(elements,model_length,gl.UNSIGNED_SHORT,0)}for(var m in object_models){if(minormode&gt;=MERGE){render_merge();break}if(m==&quot;quad&quot;||m==&quot;triangle&quot;){if(triangles_exist)render_triangles();continue}else if(m==&quot;curve&quot;){render_curves();continue}var model=object_models[m];var elements=model.elementType;var model_length=model.index.length;var objs;if(minormode&gt;PEEL_D0){if(canvas.__transparent_objects[m]===undefined)continue;objs=canvas.__transparent_objects[m]}else{if(canvas.__opaque_objects[m]===undefined)continue;objs=canvas.__opaque_objects[m]}var gotobjects=false;for(var id in objs){gotobjects=true;break}if(!gotobjects)continue;var ringobject=m==&quot;ring&quot;||m==&quot;vp_ring&quot;;switch(minormode){case RENDER:case PEEL_C0:if(ringobject){if(ring_program===null)ring_program=shaderProgram(shaders.opaque_render_fragment,shaders.ring_render_vertex,gl);useProgram(ring_program,minormode)}else{if(standard_program===null)standard_program=shaderProgram(shaders.opaque_render_fragment,shaders.render_vertex,gl);useProgram(standard_program,minormode)}break;case PICK:if(ringobject){if(ring_pick_program===null)ring_pick_program=shaderProgram(shaders.pick_fragment,shaders.ring_pick_vertex,gl);useProgram(ring_pick_program,minormode)}else{if(pick_program===null)pick_program=shaderProgram(shaders.pick_fragment,shaders.pick_vertex,gl);useProgram(pick_program,minormode)}break;case EXTENT:if(extent_program===null)extent_program=shaderProgram(shaders.pick_fragment,shaders.extent_vertex,gl);useProgram(extent_program,minormode);break;case PEEL_D0:if(ringobject){if(ring_peel_depth_programD0===null)ring_peel_depth_programD0=shaderProgram(shaders.peel_depth_fragmentD0,shaders.ring_peel_depth_vertex,gl);useProgram(ring_peel_depth_programD0,minormode)}else{if(peel_depth_programD0===null)peel_depth_programD0=shaderProgram(shaders.peel_depth_fragmentD0,shaders.peel_depth_vertex,gl);useProgram(peel_depth_programD0,minormode)}break;case PEEL_D1:if(ringobject){if(ring_peel_depth_programD1===null)ring_peel_depth_programD1=shaderProgram(shaders.peel_depth_fragmentD1,shaders.ring_peel_depth_vertex,gl);useProgram(ring_peel_depth_programD1,minormode)}else{if(peel_depth_programD1===null)peel_depth_programD1=shaderProgram(shaders.peel_depth_fragmentD1,shaders.peel_depth_vertex,gl);useProgram(peel_depth_programD1,minormode)}break;case PEEL_D2:if(ringobject){if(ring_peel_depth_programD2===null)ring_peel_depth_programD2=shaderProgram(shaders.peel_depth_fragmentD2,shaders.ring_peel_depth_vertex,gl);useProgram(ring_peel_depth_programD2,minormode)}else{if(peel_depth_programD2===null)peel_depth_programD2=shaderProgram(shaders.peel_depth_fragmentD2,shaders.peel_depth_vertex,gl);useProgram(peel_depth_programD2,minormode)}break;case PEEL_D3:if(ringobject){if(ring_peel_depth_programD3===null)ring_peel_depth_programD3=shaderProgram(shaders.peel_depth_fragmentD3,shaders.ring_peel_depth_vertex,gl);useProgram(ring_peel_depth_programD3,minormode)}else{if(peel_depth_programD3===null)peel_depth_programD3=shaderProgram(shaders.peel_depth_fragmentD3,shaders.peel_depth_vertex,gl);useProgram(peel_depth_programD3,minormode)}break;case PEEL_C1:if(ringobject){if(ring_peel_color_programC1===null)ring_peel_color_programC1=shaderProgram(shaders.peel_color_fragmentC1,shaders.ring_render_vertex,gl);useProgram(ring_peel_color_programC1,minormode)}else{if(peel_color_programC1===null)peel_color_programC1=shaderProgram(shaders.peel_color_fragmentC1,shaders.render_vertex,gl);useProgram(peel_color_programC1,minormode)}break;case PEEL_C2:if(ringobject){if(ring_peel_color_programC2===null)ring_peel_color_programC2=shaderProgram(shaders.peel_color_fragmentC2,shaders.ring_render_vertex,gl);useProgram(ring_peel_color_programC2,minormode)}else{if(peel_color_programC2===null)peel_color_programC2=shaderProgram(shaders.peel_color_fragmentC2,shaders.render_vertex,gl);useProgram(peel_color_programC2,minormode)}break;case PEEL_C3:if(ringobject){if(ring_peel_color_programC3===null)ring_peel_color_programC3=shaderProgram(shaders.peel_color_fragmentC3,shaders.ring_render_vertex,gl);useProgram(ring_peel_color_programC3,minormode)}else{if(peel_color_programC3===null)peel_color_programC3=shaderProgram(shaders.peel_color_fragmentC3,shaders.render_vertex,gl);useProgram(peel_color_programC3,minormode)}break;case PEEL_C4:if(ringobject){if(ring_peel_color_programC4===null)ring_peel_color_programC4=shaderProgram(shaders.peel_color_fragmentC4,shaders.ring_render_vertex,gl);useProgram(ring_peel_color_programC4,minormode)}else{if(peel_color_programC4===null)peel_color_programC4=shaderProgram(shaders.peel_color_fragmentC4,shaders.render_vertex,gl);useProgram(peel_color_programC4,minormode)}break}gl.bindBuffer(gl.ARRAY_BUFFER,model.posBuffer);gl.vertexAttribPointer(program.attributes.pos,3,gl.FLOAT,false,0,0);if(mode!=PICK&amp;&amp;(mode==RENDER||minormode==PEEL_C0||minormode==PEEL_C1||minormode==PEEL_C2||minormode==PEEL_C3||minormode==PEEL_C4)){gl.bindBuffer(gl.ARRAY_BUFFER,model.normalBuffer);gl.vertexAttribPointer(program.attributes.normal,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.colorBuffer);gl.vertexAttribPointer(program.attributes.color,3,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.opacityBuffer);gl.vertexAttribPointer(program.attributes.opacity,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.shininessBuffer);gl.vertexAttribPointer(program.attributes.shininess,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.emissiveBuffer);gl.vertexAttribPointer(program.attributes.emissive,1,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.texposBuffer);gl.vertexAttribPointer(program.attributes.texpos,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,model.bumpaxisBuffer);gl.vertexAttribPointer(program.attributes.bumpaxis,3,gl.FLOAT,false,0,0)}else if(ringobject){gl.bindBuffer(gl.ARRAY_BUFFER,model.normalBuffer);gl.vertexAttribPointer(program.attributes.normal,3,gl.FLOAT,false,0,0)}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,model.indexBuffer);if(mode==EXTENT)elements=gl.POINTS;for(var id in objs){var obj=objs[id];var data=obj.__data;if(minormode&lt;MERGE&amp;&amp;mode!=PICK){if((mode==RENDER||mode==RENDER_TEXTURE)&amp;&amp;obj.__tex.file!==null){if(obj.__tex.texture_ref.reference!==null){gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,obj.__tex.texture_ref.reference)}else continue}if((mode==RENDER||mode==RENDER_TEXTURE)&amp;&amp;obj.__tex.bumpmap!==null){if(obj.__tex.bumpmap_ref.reference!==null){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,obj.__tex.bumpmap_ref.reference)}else continue}}if(mode==PICK){var falsecolor=obj.__falsecolor;for(var i=0;i&lt;4;i++){save[i]=data[16+i];data[16+i]=falsecolor[i]}}gl.uniform4fv(program.uniforms.objectData,data);gl.drawElements(elements,model_length,gl.UNSIGNED_SHORT,0);if(mode==PICK){for(var i=0;i&lt;4;i++)data[16+i]=save[i]}}}if(mode!=PICK){gl.bindRenderbuffer(gl.RENDERBUFFER,null);gl.bindFramebuffer(gl.FRAMEBUFFER,null)}}if(mode==RENDER){subrender(mode,null,[])}else if(mode==PICK){subrender(mode,&quot;C0&quot;,[&quot;&quot;])}else if(mode==EXTENT){subrender(mode,&quot;EXTENT_TEXTURE&quot;,[])}else if(mode==RENDER_TEXTURE){subrender(PEEL_C0,&quot;C0&quot;,[]);subrender(PEEL_D0,&quot;D0&quot;,[]);subrender(PEEL_C1,&quot;C1&quot;,[&quot;D0&quot;]);if(fullpeels){subrender(PEEL_D1,&quot;D1&quot;,[&quot;D0&quot;]);subrender(PEEL_C2,&quot;C2&quot;,[&quot;D0&quot;,&quot;D1&quot;]);subrender(PEEL_D2,&quot;D2&quot;,[&quot;D0&quot;,&quot;D1&quot;]);subrender(PEEL_C3,&quot;C3&quot;,[&quot;D0&quot;,&quot;D2&quot;]);subrender(PEEL_D3,&quot;D3&quot;,[&quot;D0&quot;,&quot;D2&quot;]);subrender(PEEL_C4,&quot;C4&quot;,[&quot;D0&quot;,&quot;D3&quot;]);subrender(MERGE,null,[&quot;C0&quot;,&quot;C1&quot;,&quot;C2&quot;,&quot;C3&quot;,&quot;C4&quot;])}else subrender(MERGE,null,[&quot;C0&quot;,&quot;C1&quot;])}if(mode==EXTENT){gl.readPixels(0,0,1,1,gl.RGBA,gl.UNSIGNED_BYTE,pixels);var mantissa=(256*pixels[1]+pixels[2])/65536;var exponent=pixels[0];if(exponent&gt;128){exponent=-(exponent-128);mantissa=-mantissa}var extent;if(mantissa==0&amp;&amp;exponent==0)extent=0;else extent=Math.exp(mantissa+exponent);return null}else if(mode==PICK){gl.readPixels(canvas.mouse.__pickx,canvas.mouse.__picky,1,1,gl.RGBA,gl.UNSIGNED_BYTE,pixels);var id=16777216*pixels[0]+65536*pixels[1]+256*pixels[2]+pixels[3];var obj=canvas.__visiblePrimitives[id];if(!obj)return null;else if(obj.__obj&amp;&amp;obj.__obj.pickable)return obj.__obj;else if(obj.constructor.name==&quot;point&quot;){if(!obj.__curve.pickable||!obj.pickable)return null;var pts=obj.__curve.__points;var L=pts.length;for(var i=0;i&lt;L;i++){if(pts[i]===obj){obj=obj.__curve;obj.pick=i;obj.segment=i;return obj}}return null}if(!obj.pickable)return null;else return obj}};function trigger_render(){var doAverage=lastStartRedraw&gt;0;var t=msclock();var elapsed=0;if(doAverage)elapsed=t-lastStartRedraw;lastStartRedraw=t;canvas.trigger(&quot;redraw&quot;,{dt:elapsed});renderer.render(RENDER);t=msclock();elapsed=0;if(doAverage)elapsed=t-lastEndRedraw;lastEndRedraw=t;if(doAverage){renderMS=renderMS*.95+(t-lastStartRedraw)*.05;fps=fps*.95+1e3/elapsed*.05}else{renderMS=t-lastStartRedraw;fps=0}var total=fps*renderMS;$(&quot;#fps&quot;).text(fps.toFixed(1)+&quot; renders/s * &quot;+renderMS.toFixed(1)+&quot; ms/render = &quot;+total.toFixed(1)+&quot; ms rendering/s&quot;);canvas.trigger(&quot;draw_complete&quot;,{dt:elapsed});canvas.__last_forward=canvas.__forward;canvas.__last_range=canvas.__range;canvas.__last_up=canvas.__up;window.requestAnimFrame(trigger_render,canvasElement)}this.reset();trigger_render()}var desired_fps=60;var N=0;var enditers;function rate(iters,cb){if(cb===undefined)throw new Error(&quot;rate(iterations_per_second, wait) called without wait&quot;);if(N&gt;0){N--;if(msclock()&gt;enditers)N=0;if(N&gt;0)cb();else{setTimeout(cb,Math.ceil(1e3/desired_fps))}}else{if(iters&lt;=120){setTimeout(cb,Math.ceil(1e3/iters))}else{N=Math.ceil(iters/desired_fps);enditers=msclock()+Math.ceil(1e3/desired_fps);cb()}}}var exports={WebGLRenderer:WebGLRenderer,rate:rate};Export(exports)})();(function(){&quot;use strict&quot;;function log10(val){return Math.log(val)/Math.LN10}var eformat=false;var nformat=0;var nmax=0;function format_number(val,axis){if(axis.ticks.length==0){var delta=axis.tickSize;var amin=axis.min,amax=axis.max;var nticks=Math.floor((amax-amin)/delta+.5)+1;var vmax,test;for(var i=0;i&lt;nticks;i++){test=abs(amin+i*delta);if(vmax===undefined||test&gt;vmax&amp;&amp;test!=0)vmax=test}nmax=Math.floor(log10(vmax))+1;var n=Math.floor(log10(delta))+1;if(n&gt;3){eformat=true;nformat=n}else if(n&gt;0){eformat=false;nformat=0}else if(n&lt;0){eformat=true;nformat=n;if(nmax&gt;=0){eformat=false;nformat=-n+1}}else{eformat=false;nformat=1}}if(val==0)return&quot;0&quot;;if(eformat){var nf,nexp;var mantissa=val*pow(10,-nformat+1);nf=0;nexp=nformat-1;if(nmax&gt;nformat){mantissa*=.1;nf+=1;nexp+=1}return mantissa.toFixed(nf)+&quot;e&quot;+nexp}else{return val.toFixed(nformat)}}function graph(options){if(!(this instanceof graph))return new graph(options);if(options===undefined)options={};this.graph_options={series:{shadowSize:0},crosshair:{mode:&quot;xy&quot;,color:&quot;rgba(0,0,0,1)&quot;}};this.__width=640;this.__height=400;this.__title=&quot;&quot;;this.__plot=null;this.__xmin=this.__xmax=this.__ymin=this.__ymax=null;this.wrapper=$(&quot;&lt;div/&gt;&quot;);if(options.width!==undefined){this.__width=options.width;delete options.width}if(options.height!==undefined){this.__height=options.height;delete options.height}this.__align=&quot;none&quot;;if(options.align!==undefined){this.__align=options.align;delete options.align}this.graph_options.xaxis={min:null,max:null,tickFormatter:format_number};this.graph_options.yaxis={min:null,max:null,tickFormatter:format_number};if(options.title!==undefined){if(options.title!==null)this.__title=options.title;delete options.title}this.__foreground=color.black;this.__background=color.gray(.95);if(options.foreground!==undefined){var v=options.foreground;if(!(v instanceof vec))throw new Error(&quot;graph foreground must be a vector.&quot;);this.__foreground=v;delete options.foreground}if(options.background!==undefined){var v=options.background;if(!(v instanceof vec))throw new Error(&quot;graph background must be a vector.&quot;);this.__background=v;delete options.background}this.graph_options.grid={color:color.to_html(this.__foreground),backgroundColor:color.to_html(this.__background)};if(options.xmin!==undefined){this.__xmin=this.graph_options.xaxis.min=options.xmin;delete options.xmin}if(options.xmax!==undefined){this.__xmax=this.graph_options.xaxis.max=options.xmax;delete options.xmax}if(options.ymin!==undefined){this.__ymin=this.graph_options.yaxis.min=options.ymin;delete options.ymin}if(options.ymax!==undefined){this.__ymax=this.graph_options.yaxis.max=options.ymax;delete options.ymax}this.__logx=this.__logy=false;if(options.logx!==undefined){this.__logx=this.graph_options.logx=options.logx;delete options.logx}if(options.logy!==undefined){this.__logy=this.graph_options.logy=options.logy;delete options.logy}if(this.__logx){this.graph_options.xaxis.transform=function(v){return log10(v)};this.graph_options.xaxis.inverseTransform=function(v){return pow(10,v)}}if(this.__logy){this.graph_options.yaxis.transform=function(v){return log10(v)};this.graph_options.yaxis.inverseTransform=function(v){return pow(10,v)}}var err=&quot;&quot;,count=0;for(var attr in options){count+=1;err+=attr+&quot;, &quot;}if(err.length&gt;0){if(count==1)throw new Error(err.slice(0,err.length-2)+&quot; is not an attribute of a graph&quot;);else throw new Error(&quot;These are not attributes of a graph: &quot;+err.slice(0,err.length-2))}graph.selected=this;this.graph_series=[];this.__activated=false}property.declare(graph,{selected:{get:function(){return window.__context.graph_selected||null},set:function(value){window.__context.graph_selected=value}}});property.declare(graph.prototype,{__activate:function(){if(this.__activated)return;this.__activated=true;this.__activate=function(){};if(this.__title!==undefined&amp;&amp;this.__title.length&gt;0)$(&quot;&lt;div&gt;&quot;+this.__title+&quot;&lt;/div&gt;&quot;).appendTo(canvas.container);this.wrapper.addClass(&quot;glowscript-graph&quot;).css(&quot;width&quot;,this.__width).css(&quot;height&quot;,this.__height).appendTo(canvas.container);this.wrapper.css(&quot;float&quot;,this.__align);this.__update()},__update:function(){var self=this;window.requestAnimFrame(function(){self.__update.call(self)},this.wrapper.get(0));if(!this.changed)return;var info=[];for(var i=0;i&lt;this.graph_series.length;i++){var thisseries=this.graph_series[i];if(thisseries.__visible){info.push(thisseries.options);if(thisseries.__dot&amp;&amp;thisseries.__type==&quot;line&quot;&amp;&amp;thisseries.options.data.length&gt;0){var dotdisplay={points:{show:true}};if(thisseries.__dot_radius!==null)dotdisplay.points.radius=thisseries.__dot_radius;else dotdisplay.points.radius=thisseries.__width+1;if(thisseries.__dot_color!==null)dotdisplay.color=color.to_html(thisseries.__dot_color);else dotdisplay.color=color.to_html(thisseries.__color);dotdisplay.points.fillColor=dotdisplay.color;dotdisplay.data=[thisseries.options.data[thisseries.options.data.length-1]];info.push(dotdisplay)}}}this.changed=false;if(info.length==0)return;this.__plot=$.plot(this.wrapper,info,this.graph_options);this.__plot.draw()},add_to_graph:function(obj){this.graph_series.push(obj);if(obj.options.data.length&gt;0)this.__activate()},changed:false,remove:function(){this.wrapper.remove()},width:{get:function(){return this.__width},set:function(value){this.__width=value;this.wrapper.css(&quot;width&quot;,value);var plot=$.plot(this.wrapper,[],this.graph_options);plot.resize();plot.setupGrid();this.changed=true}},height:{get:function(){return this.__height},set:function(value){this.__height=value;this.wrapper.css(&quot;height&quot;,value);var plot=$.plot(this.wrapper,[],this.graph_options);plot.resize();plot.setupGrid();this.changed=true}},align:{get:function(){return this.__align},set:function(value){if(value==&quot;left&quot;||value==&quot;right&quot;||value==&quot;none&quot;){this.__align=value}else throw new Error(&quot;align must be &#39;left&#39;, &#39;right&#39;, or &#39;none&#39; (the default).&quot;)}},title:{get:function(){return this.__title},set:function(value){this.__title=value;this.changed=true}},xmin:{get:function(){return this.__xmin},set:function(value){this.__xmin=this.graph_options.xaxis.min=value;this.changed=true}},xmax:{get:function(){return this.__xmax},set:function(value){this.__xmax=this.graph_options.xaxis.max=value;this.changed=true}},ymin:{get:function(){return this.__ymin},set:function(value){this.__ymin=this.graph_options.yaxis.min=value;this.changed=true}},ymax:{get:function(){return this.__ymax},set:function(value){this.__ymax=this.graph_options.yaxis.max=value;this.changed=true}},logx:{get:function(){return this.__logx},set:function(value){if(this.__logx==value)return;if(value){this.graph_options.xaxis.transform=function(v){return log10(v)};this.graph_options.xaxis.inverseTransform=function(v){return pow(10,v)}}else{delete this.graph_options.xaxis.transform;delete this.graph_options.xaxis.inverseTransform}this.__logx=value;this.changed=true}},logy:{get:function(){return this.__logy},set:function(value){if(this.__logy==value)return;if(value){this.graph_options.yaxis.transform=function(v){return log10(v)};this.graph_options.yaxis.inverseTransform=function(v){return pow(10,v)}}else{delete this.graph_options.yaxis.transform;delete this.graph_options.yaxis.inverseTransform}this.__logy=value;this.changed=true}},foreground:{get:function(){return this.__foreground},set:function(value){if(!(value instanceof vec))throw new Error(&quot;graph foreground color must be a vector.&quot;);if(this.__foreground.equals(value))return;this.__foreground=value;this.graph_options.grid.color=color.to_html(value);this.changed=true}},background:{get:function(){return this.__background},set:function(value){if(!(value instanceof vec))throw new Error(&quot;graph background color must be a vector.&quot;);if(this.__background.equals(value))return;this.__background=value;this.graph_options.grid.backgroundColor=color.to_html(value);this.changed=true}}});var type_to_flot_type={line:&quot;lines&quot;,scatter:&quot;points&quot;,bar:&quot;bars&quot;,__proto__:null};function gobject(options){if(options===undefined)options={data:[]};else if(options.data===undefined)options.data=[];this.__color=vec(0,0,0);this.__label=null;this.__delta=1;this.__width=1;this.__radius=3;this.__horizontal=false;this.__dot=false;this.__dot_color=null;this.__dot_radius=null;this.__data=[];this.__xmin=null;this.__xmax=null;this.__ymin=null;this.__ymax=null;this.__interval=-1;if(options.graph!==undefined){this.__graph=options.graph;delete options.graph}else if(options.gdisplay!==undefined){this.__graph=options.gdisplay;delete options.gdisplay}else{this.__graph=graph.selected;if(!this.__graph)this.__graph=graph()}this.__type=&quot;line&quot;;if(options.type!==undefined){this.__type=options.type;delete options.type}var ftype=this.__ftype=type_to_flot_type[this.__type];if(!ftype)throw new Error(&quot;Unknown series type: &quot;+this.__type);this.options={};this.options.data=options.data;delete options.data;this.options[ftype]={show:true,align:&quot;center&quot;,horizontal:false,barWidth:1};if(this.__type==&quot;scatter&quot;)this.options.fill=1;else if(this.__type==&quot;bar&quot;)this.options.fill=.5;else this.options.fill=0;if(options.horizontal!==undefined){this.__horizontal=this.options[ftype].horizontal=options.horizontal;delete options.horizontal}if(options.delta!==undefined){this.__delta=this.options[ftype].barWidth=options.delta;delete options.delta}if(options.width!==undefined){this.__width=this.options[ftype].lineWidth=options.width;delete options.width}if(options.color!==undefined){var c=options.color;if(!(c instanceof vec))throw new Error(&quot;graph color must be a vector.&quot;);this.__color=c;delete options.color}this.options.color=color.to_html(this.__color);if(this.__type==&quot;scatter&quot;)this.options[ftype].fillColor=this.options.color;else this.options.fillColor=this.options.color;if(options.radius!==undefined){this.__radius=this.options[ftype].radius=options.radius;delete options.radius}if(options.dot!==undefined){this.__dot=options.dot;delete options.dot}if(options.dot_color!==undefined){var v=options.dot_color;if(!(v instanceof vec))throw new Error(&quot;graph dot_color must be a vector.&quot;);this.__dot_color=v;delete options.dot_color}if(options.dot_radius!==undefined){this.__dot_radius=options.dot_radius;delete options.dot_radius}if(options.label!==undefined){this.__label=this.options.label=options.label;delete options.label}if(options.interval!==undefined){this.__interval=options.interval;this.__ninterval=options.interval;delete options.interval}if(this.options.data.length&gt;0)this.__graph.changed=true;this.__visible=true;if(options.visible!==undefined){this.__visible=options.visible;delete options.visible}var err=&quot;&quot;,count=0;for(var attr in options){count+=1;err+=attr+&quot;, &quot;}if(err.length&gt;0){if(count==1)throw new Error(err.slice(0,err.length-2)+&quot; is not an attribute of a series&quot;);else throw new Error(&quot;These are not attributes of a graph object: &quot;+err.slice(0,err.length-2))}this.__graph.add_to_graph(this);this.remove=function(){this.__graph.changed=true;this.options.data=[]};var toType=function(obj){return{}.toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};var resolveargs=function(args){var v,ret;ret=[];if(toType(arguments[0])==&quot;array&quot;){if(toType(arguments[0][0])!=&quot;array&quot;){for(var i=0;i&lt;arguments.length;i++){v=arguments[i];if(toType(v)==&quot;array&quot;&amp;&amp;v.length==2)ret.push(v);else return null}}else{for(var i=0;i&lt;arguments[0].length;i++){v=arguments[0][i];if(toType(v)==&quot;array&quot;&amp;&amp;v.length==2)ret.push(v);else return null}}}else{if(arguments.length==2)return[[arguments[0],arguments[1]]];return null}return ret};var toType=function(obj){return{}.toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};var resolveargs=function(args){var v,ret;ret=[];if(toType(arguments[0][0])!=&quot;array&quot;){for(var i=0;i&lt;arguments.length;i++){v=arguments[i];if(toType(v)==&quot;array&quot;&amp;&amp;v.length==2)ret.push(v);else return null}}else{for(var i=0;i&lt;arguments[0].length;i++){v=arguments[0][i];if(toType(v)==&quot;array&quot;&amp;&amp;v.length==2)ret.push(v);else return null}}return ret};this.plot=function(args){if(this.__interval===0)return;var data;if(args.color!==undefined)throw new Error(&quot;Cannot currently change color in a plot statement.&quot;);if(args.pos!==undefined)data=resolveargs(args.pos);else if(toType(args)==&quot;array&quot;&amp;&amp;arguments.length==1)data=resolveargs(args);else{var a=[];for(var i=0;i&lt;arguments.length;i++)a.push(arguments[i]);if(toType(a[0])==&quot;array&quot;)data=resolveargs(a);else data=resolveargs([a])}if(data===null)throw new Error(&quot;Must be plot(x,y) or plot(pos=[x,y]) or plot([x,y]) or plot([x,y], ...) or plot([ [x,y], ... ])&quot;);else{if(this.__type!=&quot;line&quot;){for(var i=0;i&lt;data.length;i++){if(this.__interval&gt;0){this.__ninterval++;if(this.__ninterval&gt;=this.__interval)this.__ninterval=0;else continue}this.options.data.push(data[i])}}else{var pt,x,y,xscale,yscale,dx,dy,x1,x2,y1,y2;var g=this.__graph;var gxmin=g.__xmin;var gxmax=g.__xmax;var gymin=g.__ymin;var gymax=g.__ymax;if(this.options.data.length===0){pt=data[0];x=pt[0];y=pt[1];if(gxmin===null)this.__xmin=x;if(gxmax===null)this.__xmax=x;if(gymin===null)this.__ymin=y;if(gymax===null)this.__ymax=y;this.__lastx=1e300;this.__lasty=1e300}for(var i=0;i&lt;data.length;i++){if(this.__interval&gt;0){this.__ninterval++;if(this.__ninterval&gt;=this.__interval)this.__ninterval=0;else continue}pt=data[i];x=pt[0];y=pt[1];if(gxmin===null&amp;&amp;x&lt;this.__xmin)this.__xmin=x;if(gxmax===null&amp;&amp;x&gt;this.__xmax)this.__xmax=x;if(gymin===null&amp;&amp;y&gt;this.__ymin)this.__ymin=y;if(gymax===null&amp;&amp;y&lt;this.__ymax)this.__ymax=y;x1=gxmin===null?this.__xmin:gxmin;x2=gxmax===null?this.__xmax:gxmax;y1=gymin===null?this.__ymin:gymin;y2=gymax===null?this.__ymax:gymax;xscale=g.__width/(x2-x1);yscale=g.__height/(y2-y1);dx=xscale*Math.abs(x-this.__lastx);dy=yscale*Math.abs(y-this.__lasty);if(dx&lt;2&amp;&amp;dy&lt;2)continue;this.__lastx=x;this.__lasty=y;this.options.data.push(pt)}}}this.__graph.changed=true;this.__graph.__activate()}}property.declare(gobject.prototype,{graph:{get:function(){return this.__graph},set:function(value){this.__graph.changed=true;this.__graph.graph_series.splice(this.__graph.graph_series.indexOf(this),1);this.__graph=value;this.__graph.add_to_graph(this);this.__graph.changed=true}},type:{get:function(){return this.__type},set:function(value){var oldftype=this.__ftype;var ftype=type_to_flot_type[value];if(!ftype)throw new Error(&quot;Unknown series type: &quot;+value);if(ftype==oldftype)return;this.options[ftype]=this.options[oldftype];delete this.options[oldftype];if(value==&quot;scatter&quot;){this.options.fill=1;this.options[ftype].fillColor=this.options.color}else if(value==&quot;bar&quot;){this.options.fill=.5;this.options.fillColor=this.options.color}else{this.options.fill=0;this.options.fillColor=this.options.color}this.__type=value;this.__graph.changed=true}},color:{get:function(){return this.__color},set:function(value){if(!(value instanceof vec))throw new Error(&quot;graph color must be a vector.&quot;);if(this.__color.equals(value))return;this.__color=value;this.options.color=color.to_html(value);if(this.__type==&quot;scatter&quot;)this.options[this.__ftype].fillColor=this.options.color;else this.options.fillColor=this.options.color;this.__graph.changed=true}},label:{get:function(){if(this.options.label===undefined)return&quot;&quot;;return this.options.label},set:function(value){if(this.options.label==value)return;this.options.label=value;this.__graph.changed=true}},delta:{get:function(){return this.__delta},set:function(value){if(this.__delta==value)return;this.__delta=value;var ftype=type_to_flot_type[this.__type];this.options[ftype].barWidth=value;this.__graph.changed=true}},width:{get:function(){return this.__width},set:function(value){if(this.__width==value)return;this.__width=value;var ftype=type_to_flot_type[this.__type];this.options[ftype].lineWidth=value;this.__graph.changed=true}},radius:{get:function(){return this.__radius},set:function(value){if(this.__radius==value)return;this.__radius=value;var ftype=type_to_flot_type[this.__type];this.options[ftype].radius=value;this.__graph.changed=true}},size:{get:function(){return 2*this.__radius},set:function(value){if(2*this.__radius==value)return;this.__radius=value/2;var ftype=type_to_flot_type[this.__type];this.options[ftype].radius=value/2;this.__graph.changed=true}},horizontal:{get:function(){return this.__horizontal},set:function(value){if(this.__horizontal==value)return;this.__horizontal=value;var ftype=type_to_flot_type[this.__type];this.options[ftype].horizontal=value;this.__graph.changed=true}},dot:{get:function(){return this.__dot},set:function(value){if(this.__dot==value)return;this.__dot=value;this.__graph.changed=true}},dot_color:{get:function(){return this.__dot_color},set:function(value){if(!(value instanceof vec))throw new Error(&quot;graph dot_color must be a vector.&quot;);if(this.__dot_color.equals(value))return;this.__dot_color=value;this.__graph.changed=true}},dot_radius:{get:function(){return this.__dot_radius},set:function(value){if(this.__dot_radius==value)return;this.__dot_radius=value;this.__graph.changed=true}},visible:{get:function(){return this.__visible},set:function(value){if(this.__visible==value)return;this.__visible=value;this.__graph.changed=true}},data:{get:function(){return this.options.data},set:function(value){this.options.data=[];this.plot(value)}}});function series(options){return new gobject(options)}function vp_graph(options){if(options===undefined)return new graph;if(options.x!==undefined)delete options.x;if(options.y!==undefined)delete options.y;var title=&quot;&quot;,xtitle=&quot;&quot;,ytitle=&quot;&quot;;var indent=&quot;&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&quot;;if(options.title!==undefined){if(options.title!==null)title=options.title;delete options.title}if(options.xtitle!==undefined){if(options.xtitle!==null)xtitle=options.xtitle;delete options.xtitle}if(options.ytitle!==undefined){if(options.ytitle!==null)ytitle=options.ytitle;delete options.ytitle}var t1=&quot;&quot;;var t2=&quot;&quot;;if(title.length&gt;0&amp;&amp;(xtitle.length&gt;0||ytitle.length&gt;0))t1=title+&quot;&lt;br&gt;&quot;;else if(title.length&gt;0)t1=title;if(ytitle.length&gt;0){t2=ytitle;if(xtitle.length&gt;0)t2+=&quot; vs &quot;+xtitle}else if(xtitle.length&gt;0)t2=xtitle;if(t1.length&gt;0)t1=indent+t1;if(t2.length&gt;0)options.title=t1+indent+t2;else if(t1.length&gt;0)options.title=t1;return new graph(options)}function gcurve(options){if(options===undefined)options={};options.type=&quot;line&quot;;if(options.pos!==undefined){options.data=options.pos;delete options.pos}if(options.size!==undefined){options.dot_radius=options.size/2;delete options.size}else options.dot_radius=4;var ret=new gobject(options);ret.gcurve=ret;return ret}function gdots(options){if(options===undefined)options={};options.type=&quot;scatter&quot;;if(options.pos!==undefined){options.data=options.pos;delete options.pos}if(options.size!==undefined){options.radius=options.size/2;delete options.size}else options.radius=2.6;var ret=new gobject(options);ret.dots=ret;return ret}function gvbars(options){if(options===undefined)options={};options.type=&quot;bar&quot;;if(options.pos!==undefined){options.data=options.pos;delete options.pos}return new gobject(options)}function ghbars(options){if(options===undefined)options={};options.type=&quot;bar&quot;;options.horizontal=true;if(options.pos!==undefined){options.data=options.pos;delete options.pos}return new gobject(options)}function ghistogram(options){throw new Error(&quot;ghistogram is not implemented in GlowScript.&quot;)}var exports={graph:graph,series:series,gdisplay:vp_graph,vp_graph:vp_graph,gcurve:gcurve,gdots:gdots,gvbars:gvbars,ghbars:ghbars};Export(exports)})();(function(){&quot;use strict&quot;;var color={red:vec(1,0,0),green:vec(0,1,0),blue:vec(0,0,1),yellow:vec(1,1,0),orange:vec(1,.6,0),cyan:vec(0,1,1),magenta:vec(1,0,1),white:vec(1,1,1),black:vec(0,0,0),gray:function(g){return vec(g,g,g)},hsv_to_rgb:function(hsv){var h=hsv.x;var s=hsv.y;var v=hsv.z;if(s==0){return vec(v,v,v)}var i=Math.floor(6*h);var f=6*h-i;var p=v*(1-s);var q=v*(1-s*f);var t=v*(1-s*(1-f));var i=i%6;switch(i){case 0:return vec(v,t,p);case 1:return vec(q,v,p);case 2:return vec(p,v,t);case 3:return vec(p,q,v);case 4:return vec(t,p,v);case 5:return vec(v,p,q)}},rgb_to_hsv:function(rgb){var r=rgb.x;var g=rgb.y;var b=rgb.z;var maxc=Math.max(r,g,b);var minc=Math.min(r,g,b);var v=maxc;if(minc==maxc){return vec(0,0,v)}var s=(maxc-minc)/maxc;var rc=(maxc-r)/(maxc-minc);var gc=(maxc-g)/(maxc-minc);var bc=(maxc-b)/(maxc-minc);var h;if(r==maxc){h=bc-gc}else if(g==maxc){h=2+rc-bc}else{h=4+gc-rc}h=h/6;if(h&lt;0)h++;return vec(h,s,v)},to_html:function(color){var r=Math.floor(255*color.x);var g=Math.floor(255*color.y);var b=Math.floor(255*color.z);return&quot;rgb(&quot;+r+&quot;,&quot;+g+&quot;,&quot;+b+&quot;)&quot;},to_html_rgba:function(color,opacity){var r=Math.floor(255*color.x);var g=Math.floor(255*color.y);var b=Math.floor(255*color.z);return&quot;rgba(&quot;+r+&quot;,&quot;+g+&quot;,&quot;+b+&quot;,&quot;+opacity+&quot;)&quot;}};var exports={color:color};Export(exports)})();(function(){&quot;use strict&quot;;var npdefault=64;function shape_object(){}shape_object.prototype.roundc=function roundc(cps,args){var cp=[],i;for(i=0;i&lt;cps.length;i++)cp.push(vec(cps[i][0],cps[i][1],0));args=args||{};var roundness=.1;var nseg=16;var invert=false;if(args.roundness!==undefined)roundness=args.roundness;if(args.nseg!==undefined)nseg=args.nseg;if(args.invert!==undefined)invert=args.invert;var dv,vord,p1,p2,lm,L,r,ncp,i1,i2,wrt,v1,v2,rax,afl,cc,ccp,tt,t1,t2,nc,dseg,a;vord=0;cp.pop();var lcp=cp.length;for(i=0;i&lt;lcp;i++){i1=(i+1)%lcp;i2=(i+2)%lcp;v1=cp[i1].sub(cp[i]);v2=cp[i2].sub(cp[i1]);dv=cross(v1,v2).z;vord+=dv}if(vord&lt;0)cp.reverse();L=1e200;for(i=0;i&lt;lcp;i++){p1=cp[i];p2=cp[(i+1)%lcp];lm=mag(p2.sub(p1));if(lm&lt;L){L=lm}}r=L*roundness;var d,dtheta;ncp=[[0,0]];for(i=0;i&lt;lcp;i++){v1=cp[(i+1)%lcp].sub(cp[i%lcp]);v2=cp[(i+2)%lcp].sub(cp[(i+1)%lcp]);var theta=diff_angle(v1,v2);d=r*Math.tan(theta/2);p1=cp[i].add(v1.sub(norm(v1).multiply(d)));p2=cp[(i+1)%lcp].add(norm(v2).multiply(d));ncp.push([p1.x,p1.y]);var N=cross(norm(v1),norm(v2));</td>
      </tr>
      <tr>
        <td id="L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="LC11" class="blob-code blob-code-inner js-file-line">var center=p1.add(norm(cross(N,v1)).multiply(r));var v=p1.sub(center);dtheta=theta/(nseg+1);if(N.z&lt;0)dtheta=-dtheta;if(invert){var c=p1.add(p2).multiply(.5);center=c.add(c.sub(center));v=p1.sub(center);dtheta=-dtheta}for(var j=1;j&lt;=nseg;j++){v1=center.add(v.rotate(j*dtheta));ncp.push([v1.x,v1.y])}ncp.push([p2.x,p2.y])}v1=cp[1].sub(cp[0]);v1=cp[0].add(norm(v1).multiply(d));ncp[0]=[v1.x,v1.y];return ncp};shape_object.prototype.rotatecp=function rotatecp(cp,pr,angle){var sinr,cosr,cpr,x,y,xRel,yRel,newx,newy,p;sinr=Math.sin(angle);cosr=Math.cos(angle);xRel=pr[0];yRel=pr[1];cpr=[];for(var i=0;i&lt;cp.length;i++){p=cp[i];x=p[0];y=p[1];newx=x*cosr-y*sinr-xRel*cosr+yRel*sinr+xRel;newy=x*sinr+y*cosr-xRel*sinr-yRel*cosr+yRel;cpr.push([newx,newy])}return cpr};shape_object.prototype.scale=function scale(cp,xscale,yscale){var cpr,p;cpr=[];for(var i=0;i&lt;cp.length;i++){p=cp[i];cpr.push([xscale*p[0],yscale*p[1]])}return cpr};shape_object.prototype.addpos=function addpos(pos,cp){var p;for(var i=0;i&lt;cp.length;i++){p=cp[i];p[0]+=pos[0];p[1]+=pos[1]}return cp};shape_object.prototype.rframe=function rframe(args){args=args||{};if(args.thickness===undefined)args.thickness=null;if(args.pos===undefined)args.pos=[0,0];if(args.width===undefined)args.width=1;if(args.height===undefined)args.height=null;if(args.rotate===undefined)args.rotate=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.height===null){args.height=args.width}if(args.thickness===null)args.thickness=min(args.height,args.width)*.2;else args.thickness=min(args.height,args.width)*args.thickness*2;var outer,inner;outer=this.rectangle({pos:args.pos,width:args.width,height:args.height});inner=this.rectangle({pos:args.pos,width:args.width-args.thickness,height:args.height-args.thickness});if(args.rotate!==0){outer=this.rotatecp(outer,args.pos,args.rotate);inner=this.rotatecp(inner,args.pos,args.rotate)}if(args.xscale!==1||args.yscale!==1){outer=this.scale(outer,args.xscale,args.yscale);inner=this.scale(inner,args.xscale,args.yscale)}if(args.roundness&gt;0){outer=this.roundc(outer,{roundness:args.roundness,invert:args.invert});inner=this.roundc(inner,{roundness:args.roundness,invert:args.invert})}return[outer,inner]};shape_object.prototype.rectangle=function rectangle(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.width===undefined)args.width=1;if(args.height===undefined)args.height=null;if(args.rotate===undefined)args.rotate=0;if(args.thickness===undefined)args.thickness=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;var w2,h2,cp;if(args.height===null){args.height=args.width}if(args.thickness===0){cp=[];w2=args.width/2;h2=args.height/2;cp=[[w2,-h2],[w2,h2],[-w2,h2],[-w2,-h2],[w2,-h2]];cp=this.addpos(args.pos,cp);if(args.rotate!==0)cp=this.rotatecp(cp,args.pos,args.rotate);if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)cp=this.scale(cp,args.xscale,args.yscale);if(args.roundness&gt;0)cp=this.roundc(cp,{roundness:args.roundness,invert:args.invert})}else{cp=this.rframe(args)}return cp};shape_object.prototype.cross=function cross(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.width===undefined)args.width=1;if(args.rotate===undefined)args.rotate=0;if(args.thickness===undefined)args.thickness=.2;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;var wtp,w2,t2,cp;wtp=(args.width+args.thickness)/2;w2=args.width/2;t2=args.thickness/2;cp=[[w2,-t2],[w2,t2],[t2,t2],[t2,w2],[-t2,w2],[-t2,t2],[-w2,t2],[-w2,-t2],[-t2,-t2],[-t2,-w2],[t2,-w2],[t2,-t2],[w2,-t2]];cp=this.addpos(args.pos,cp);if(rotate!==0)cp=this.rotatecp(cp,args.pos,args.rotate);if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)cp=this.scale(cp,args.xscale,args.yscale);if(args.roundness&gt;0)cp=this.roundc(cp,{roundness:args.roundness,invert:args.invert});return cp};shape_object.prototype.trframe=function trframe(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.width===undefined)args.width=2;if(args.height===undefined)args.height=1;if(args.top===undefined)args.top=null;if(args.rotate===undefined)args.rotate=0;if(args.thickness===undefined)args.thickness=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;var angle,db,outer,inner;if(args.top===null){args.top=width/2}if(args.thickness===null){args.thickness=min(args.height,args.top)*.2}else{args.thickness=min(args.height,args.top)*args.thickness*2}outer=this.trapezoid({pos:args.pos,width:args.width,height:args.height,top:args.top});angle=Math.atan((args.width-args.top)/2/args.height);db=args.thickness/Math.cos(angle);inner=this.trapezoid({pos:args.pos,width:args.width-db-args.thickness*Math.tan(angle),height:args.height-args.thickness,top:args.top-(db-args.thickness*Math.tan(angle))});outer=this.addpos(args.pos,outer);inner=this.addpos(args.pos,inner);if(args.rotate!==0){outer=this.rotatecp(outer,args.pos,args.rotate);inner=this.rotatecp(inner,args.pos,args.rotate)}if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1){outer=this.scale(outer,args.xscale,args.yscale);inner=this.scale(inner,args.xscale,args.yscale)}if(args.roundness&gt;0){outer=this.roundc(outer,{roundness:args.roundness,invert:args.invert});inner=this.roundc(inner,{roundness:args.roundness,invert:args.invert})}return[outer,inner]};shape_object.prototype.trapezoid=function trapezoid(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.width===undefined)args.width=2;if(args.height===undefined)args.height=1;if(args.top===undefined)args.top=null;if(args.rotate===undefined)args.rotate=0;if(args.thickness===undefined)args.thickness=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;var w2,h2,t2,cp;w2=args.width/2;h2=args.height/2;if(args.top===null){args.top=w2}t2=args.top/2;if(args.thickness===0){cp=[[w2,-h2],[t2,h2],[-t2,h2],[-w2,-h2],[w2,-h2]];cp=this.addpos(args.pos,cp);if(args.rotate!==0)cp=this.rotatecp(cp,args.pos,args.rotate);if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)cp=this.scale(cp,args.xscale,args.yscale);if(args.roundness&gt;0)cp=this.roundc(cp,{roundness:args.roundness,invert:args.invert})}else{cp=this.trframe(args)}return cp};shape_object.prototype.circframe=function circframe(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.radius===undefined)args.radius=.5;if(args.iradius===undefined)args.iradius=null;if(args.np===undefined)args.np=npdefault;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.angle1===undefined)args.angle1=0;if(args.angle2===undefined)args.angle2=2*Math.PI;if(args.rotate===undefined)args.rotate=0;args.thickness=0;var outer,inner;if(args.iradius===null)args.iradius=args.radius*.8;outer=this.circle(args);if(args.angle1===0&amp;&amp;args.angle2==2*Math.PI){args.radius=args.iradius}else{var t=args.radius-args.iradius;var angle=(args.angle1+args.angle2)/2;var offset=t/Math.sin((args.angle2-args.angle1)/2);args.corner=[args.pos[0]+offset*Math.cos(angle),args.pos[1]+offset*Math.sin(angle)];var dangle=Math.asin(t/args.iradius);args.angle1=args.angle1+dangle;args.angle2=args.angle2-dangle;args.radius=args.iradius}inner=this.circle(args);if(args.rotate!==0){outer=this.rotatecp(outer,args.pos,args.rotate);inner=this.rotatecp(inner,args.pos,args.rotate)}if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1){outer=this.scale(outer,args.xscale,args.yscale);inner=this.scale(inner,args.xscale,args.yscale)}return[outer,inner]};shape_object.prototype.circle=function circle(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];var corner=args.pos;if(args.corner!==undefined)corner=args.corner;if(args.radius===undefined)args.radius=.5;if(args.np===undefined)args.np=npdefault;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.thickness===undefined)args.thickness=0;if(args.angle1===undefined)args.angle1=0;if(args.angle2===undefined)args.angle2=2*Math.PI;if(args.rotate===undefined)args.rotate=0;var seg,nseg,dc,ds,x0,y0,c2,s2,c,s,i,cp;cp=[];if(args.thickness&gt;0){args.iradius=args.radius-args.radius*args.thickness;cp=this.circframe(args)}else{if(args.angle1!==0||args.angle2!==2*Math.PI){cp.push([corner[0],corner[1]])}seg=2*Math.PI/args.np;nseg=Math.floor(Math.abs((args.angle2-args.angle1)/seg+.5));seg=(args.angle2-args.angle1)/nseg;if(args.angle1!==0||args.angle2!==2*Math.PI){nseg+=1}c=args.radius*Math.cos(args.angle1);s=args.radius*Math.sin(args.angle1);dc=Math.cos(seg);ds=Math.sin(seg);x0=args.pos[0];y0=args.pos[1];cp.push([x0+c,y0+s]);for(i=0;i&lt;nseg-1;i++){c2=c*dc-s*ds;s2=s*dc+c*ds;cp.push([x0+c2,y0+s2]);c=c2;s=s2}cp.push(cp[0]);if(args.rotate!==0&amp;&amp;(args.angle1!==0||args.angle2!==2*Math.PI)){cp=this.rotatecp(cp,args.pos,args.rotate)}if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)cp=this.scale(cp,args.xscale,args.yscale)}return cp};shape_object.prototype.arc=function arc(args){args=args||{};if(args.path===undefined)args.path=false;if(args.pos===undefined)args.pos=[0,0];if(args.radius===undefined)args.radius=.5;if(args.np===undefined)args.np=npdefault;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.thickness===undefined)args.thickness=null;if(args.angle1===undefined)args.angle1=0;if(args.angle2===undefined)args.angle2=2*Math.PI;if(args.rotate===undefined)args.rotate=0;if(args.path===undefined)args.path=false;var cpi,nseg,seg,x,y,i,p,cp;if(args.thickness===null){args.thickness=.01*args.radius}cp=[];cpi=[];seg=2*Math.PI/args.np;nseg=Math.floor(Math.abs(args.angle2-args.angle1)/seg)+1;seg=(args.angle2-args.angle1)/nseg;for(i=0;i&lt;nseg+1;i++){x=Math.cos(args.angle1+i*seg);y=Math.sin(args.angle1+i*seg);cp.push([args.radius*x+args.pos[0],args.radius*y+args.pos[1]]);if(!args.path)cpi.push([(args.radius-args.thickness)*x+args.pos[0],(args.radius-args.thickness)*y+args.pos[1]])}if(!args.path){cpi.reverse();for(var i=0;i&lt;cpi.length;i++)cp.push(cpi[i]);cp.push(cp[0])}if(args.rotate!==0)cp=rotatecp(cp,args.pos,args.rotate);if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)this.scale(cp,args.xscale,args.yscale);return cp};shape_object.prototype.ellipse=function ellipse(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.width===undefined)args.width=1;if(args.height===undefined)args.height=null;if(args.np===undefined)args.np=npdefault;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.thickness===undefined)args.thickness=0;if(args.angle1===undefined)args.angle1=0;if(args.angle2===undefined)args.angle2=2*Math.PI;if(args.rotate===undefined)args.rotate=0;if(args.height===null){args.height=.5*args.width}args.yscale*=args.height/args.width;args.radius=args.width;return this.circle(args)};shape_object.prototype.line=function line(args){args=args||{};if(args.path===undefined)path=args.path;if(args.pos===undefined)args.pos=[0,0];if(args.np===undefined)args.np=2;if(args.rotate===undefined)args.rotate=0;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.thickness===undefined)args.thickness=null;if(args.start===undefined)args.start=[0,0];if(args.end===undefined)args.end=[0,1];var v,dv,dx,dy,cpi,vline,mline,x,y,i,p,cp;v=vec(args.end[0]-args.start[0],args.end[1]-args.start[1],0);if(args.thickness===null)args.thickness=.01*mag(v);dv=args.thickness*norm(cross(vec(0,0,1),v));dx=dv.x;dy=dv.y;cp=[];cpi=[];var vstart=vec(args.start[0],args.start[1],0);v=vec(args.end[0]-args.start[0],args.end[1]-args.start[1],0);vline=v.divide(Math.floor(args.np-1));for(i=0;i&lt;args.np;i++){x=args.start[0]+vline.multiply(i).x;y=args.start[1]+vline.multiply(i).y;cp.push([x+args.pos[0],y+args.pos[1]]);cpi.push([x+args.pos[0]+dx,y+args.pos[1]+dy])}cpi.reverse();for(var i=0;i&lt;cpi.length;i++)cp.push(cpi[i]);cp.push(cp[0]);if(args.rotate!==0)cp=this.rotatecp(cp,args.pos,args.rotate);if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)this.scale(cp,args.xscale,args.yscale);return cp};shape_object.prototype.nframe=function nframe(args){args=args||{};if(args.thickness===undefined)args.thickness=0;if(args.pos===undefined)args.pos=[0,0];if(args.length===undefined)args.length=1;if(args.np===undefined)args.np=3;if(args.thickness===undefined)args.thickness=null;if(args.rotate===undefined)args.rotate=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;var angle,length2,outer,inner;if(args.thickness===null){args.thickness=args.length*.1}else{args.thickness=args.length*args.thickness}outer=this.ngon({pos:args.pos,np:args.np,length:args.length});angle=Math.PI*(.5-1/args.np);length2=args.length-2*args.thickness/Math.tan(angle);inner=this.ngon({pos:args.pos,np:args.np,length:length2});if(args.rotate!==0){outer=this.rotatecp(outer,args.pos,args.rotate);inner=this.rotatecp(inner,args.pos,args.rotate)}if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1){outer=this.scale(outer,args.xscale,args.yscale);inner=this.scale(inner,args.xscale,args.yscale)}if(args.roundness&gt;0){outer=this.roundc(outer,{roundness:args.roundness,invert:args.invert});inner=this.roundc(inner,{roundness:args.roundness,invert:args.invert})}return[outer,inner]};shape_object.prototype.ngon=function ngon(args){args=args||{};if(args.thickness===undefined)args.thickness=0;if(args.pos===undefined)args.pos=[0,0];if(args.length===undefined)args.length=1;if(args.rotate===undefined)args.rotate=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.np===undefined)args.np=3;var seg,x,y,angle,radius,i,cp;cp=[];if(args.np&lt;3)throw Error(&quot;number of sides can not be less than 3&quot;);angle=2*Math.PI/args.np;radius=args.length/2/Math.sin(angle/2);if(args.thickness===0){seg=2*Math.PI/args.np;angle=0;for(i=0;i&lt;args.np;i++){x=radius*Math.cos(angle)+args.pos[0];y=radius*Math.sin(angle)+args.pos[1];cp.push([x,y]);angle+=seg}cp.push(cp[0]);if(args.rotate!==0)cp=this.rotatecp(cp,args.pos,args.rotate);if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)cp=this.scale(cp,args.xscale,args.yscale);if(args.roundness&gt;0)cp=this.roundc(cp,{roundness:args.roundness,invert:args.invert})}else{cp=this.nframe(args)}return cp};shape_object.prototype.triangle=function triangle(args){args=args||{};if(args.rotate===undefined)args.rotate=0;args.np=3;args.rotate=args.rotate-Math.PI/6;return this.ngon(args)};shape_object.prototype.pentagon=function pentagon(args){args=args||{};if(args.rotate===undefined)args.rotate=0;args.np=5;args.rotate=args.rotate+Math.PI/10;return this.ngon(args)};shape_object.prototype.hexagon=function hexagon(args){args=args||{};if(args.rotate===undefined)args.rotate=0;args.np=6;return this.ngon(args)};shape_object.prototype.octagon=function octagon(args){args=args||{};if(args.rotate===undefined)args.rotate=0;args.np=8;args.rotate=args.rotate+Math.PI/8;return this.ngon(args)};shape_object.prototype.sframe=function sframe(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.radius===undefined)args.radius=1;if(args.n===undefined)args.n=5;if(args.iradius===undefined)args.iradius=null;if(args.rotate===undefined)args.rotate=0;if(args.thickness===undefined)args.thickness=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;var outer,inner,cp;if(args.iradius===null){args.iradius=.5*args.radius}if(args.thickness===null){args.thickness=.2*args.radius}else{args.thickness=args.thickness*2*args.iradius}outer=this.star({pos:args.pos,n:args.n,radius:args.radius,iradius:args.iradius});inner=this.star({pos:args.pos,n:args.n,radius:args.radius-args.thickness,iradius:(args.radius-args.thickness)*args.iradius/args.radius});if(args.rotate!==0){outer=this.rotatecp(outer,args.pos,args.rotate);inner=this.rotatecp(inner,args.pos,args.rotate)}if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1){outer=this.scale(outer,args.xscale,args.yscale);inner=this.scale(inner,args.xscale,args.yscale)}if(args.roundness&gt;0){outer=this.roundc(outer,{roundness:args.roundness,invert:args.invert});inner=this.roundc(inner,{roundness:args.roundness,invert:args.invert})}return[outer,inner]};shape_object.prototype.star=function star(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.radius===undefined)args.radius=1;if(args.n===undefined)args.n=5;if(args.iradius===undefined)args.iradius=null;if(args.rotate===undefined)args.rotate=0;if(args.thickness===undefined)args.thickness=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;var dtheta,theta,i,cp;if(args.iradius===null)args.iradius=args.radius*.5;if(args.thickness===0){cp=[];dtheta=Math.PI/args.n;theta=0;for(i=0;i&lt;2*args.n+1;i++){if(i%2===0){cp.push([-args.radius*Math.sin(theta),args.radius*Math.cos(theta)])}else{cp.push([-args.iradius*Math.sin(theta),args.iradius*Math.cos(theta)])}theta+=dtheta}cp=this.addpos(args.pos,cp);cp[cp.length-1]=cp[0];if(args.rotate!==0)cp=this.rotatecp(cp,args.pos,args.rotate);if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)cp=this.scale(cp,args.xscale,args.yscale);if(args.roundness&gt;0)cp=this.roundc(cp,{roundness:args.roundness,invert:args.invert})}else{cp=this.sframe(args)}return cp};shape_object.prototype.points=function points(args){args=args||{};var path=false;if(args.pos===undefined)args.pos=[];if(args.rotate===undefined)args.rotate=0;if(args.roundness===undefined)args.roundness=0;if(args.invert===undefined)args.invert=false;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.path===undefined)path=args.path;var closed,cp;cp=args.pos;closed=cp[cp.length-1][0]===cp[0][0]&amp;&amp;cp[cp.length-1][1]===cp[0][1];if(!closed&amp;&amp;!path)cp.push(cp[0]);if(cp.length&amp;&amp;args.rotate!==0)cp=this.rotatecp(cp,cp[0],args.rotate);if(args.scale!==1)args.xscale=args.yscale=args.scale;if(args.xscale!==1||args.yscale!==1)cp=this.scale(cp,args.xscale,args.yscale);if(args.roundness&gt;0)cp=this.roundc(cp,{roundness:args.roundness,invert:args.invert});return cp};shape_object.prototype.ToothOutline=function ToothOutline(args){args=args||{};if(args.n===undefined)args.n=30;if(args.res===undefined)args.res=1;if(args.phi===undefined)args.phi=20;if(args.radius===undefined)args.radius=50;if(args.addendum===undefined)args.addendum=.4;if(args.dedendum===undefined)args.dedendum=.5;if(args.fradius===undefined)args.fradius=.1;if(args.bevel===undefined)args.bevel=.05;var TOOTHGEO,R,DiametralPitch,ToothThickness,CircularPitch,U1,U2,ThetaA1,ThetaA2,ThetaA3;var A,pts,normals,i,Aw,r,u,xp,yp,auxth,m,rA,xc,yc,P0,Ra,th,N,P,V;TOOTHGEO={PitchRadius:args.radius,TeethN:args.n,PressureAng:args.phi,Addendum:args.addendum,Dedendum:args.dedendum,Fillet:args.fradius,Bevel:args.bevel,Resolution:args.res};R={Bottom:TOOTHGEO[&quot;PitchRadius&quot;]-TOOTHGEO[&quot;Dedendum&quot;]-TOOTHGEO[&quot;Fillet&quot;],Ded:TOOTHGEO[&quot;PitchRadius&quot;]-TOOTHGEO[&quot;Dedendum&quot;],Base:TOOTHGEO[&quot;PitchRadius&quot;]*cos(TOOTHGEO[&quot;PressureAng&quot;]*Math.PI/180),Bevel:TOOTHGEO[&quot;PitchRadius&quot;]+TOOTHGEO[&quot;Addendum&quot;]-TOOTHGEO[&quot;Bevel&quot;],Add:TOOTHGEO[&quot;PitchRadius&quot;]+TOOTHGEO[&quot;Addendum&quot;]};DiametralPitch=TOOTHGEO[&quot;TeethN&quot;]/(2*TOOTHGEO[&quot;PitchRadius&quot;]);ToothThickness=Math.PI/2/DiametralPitch;CircularPitch=Math.PI/DiametralPitch;U1=sqrt((1-Math.cos(TOOTHGEO[&quot;PressureAng&quot;]*Math.PI/1800))/Math.cos(TOOTHGEO[&quot;PressureAng&quot;]*Math.PI/180));U2=sqrt(R[&quot;Bevel&quot;]*R[&quot;Bevel&quot;]/(R[&quot;Ded&quot;]*R[&quot;Ded&quot;])-1);ThetaA1=Math.atan((sin(U1)-U1*Math.cos(U1))/(Math.cos(U1)+U1*Math.sin(U1)));ThetaA2=Math.atan((sin(U2)-U2*Math.cos(U2))/(Math.cos(U2)+U2*Math.sin(U2)));ThetaA3=ThetaA1+ToothThickness/(TOOTHGEO[&quot;PitchRadius&quot;]*2);A={Theta0:CircularPitch/(TOOTHGEO[&quot;PitchRadius&quot;]*2),Theta1:ThetaA3+TOOTHGEO[&quot;Fillet&quot;]/R[&quot;Ded&quot;],Theta2:ThetaA3,Theta3:ThetaA3-ThetaA2,Theta4:ThetaA3-ThetaA2-TOOTHGEO[&quot;Bevel&quot;]/R[&quot;Add&quot;]};N=TOOTHGEO[&quot;Resolution&quot;];pts=[];normals=[];for(i=0;i&lt;2*N;i++){th=(A[&quot;Theta1&quot;]-A[&quot;Theta0&quot;])*i/(2*N-1)+A[&quot;Theta0&quot;];pts.push([R[&quot;Bottom&quot;]*Math.cos(th),R[&quot;Bottom&quot;]*Math.sin(th)]);normals.push([-Math.cos(th),-Math.sin(th)])}xc=R[&quot;Ded&quot;]*Math.cos(A[&quot;Theta1&quot;]);yc=R[&quot;Ded&quot;]*Math.sin(A[&quot;Theta1&quot;]);Aw=Math.PI/2+A[&quot;Theta2&quot;]-A[&quot;Theta1&quot;];for(i=0;i&lt;N;i++){th=Aw*(i+1)/N+Math.PI+A[&quot;Theta1&quot;];pts.push([xc+TOOTHGEO[&quot;Fillet&quot;]*Math.cos(th),yc+TOOTHGEO[&quot;Fillet&quot;]*Math.sin(th)]);normals.push([Math.cos(th),Math.sin(th)])}for(i=0;i&lt;N;i++){r=(R[&quot;Base&quot;]-R[&quot;Ded&quot;])*(i+1)/N+R[&quot;Ded&quot;];pts.push([r*Math.cos(A[&quot;Theta2&quot;]),r*Math.sin(A[&quot;Theta2&quot;])]);normals.push([Math.cos(A[&quot;Theta2&quot;]-Math.PI/2),Math.sin(A[&quot;Theta2&quot;]-Math.PI/2)])}for(i=0;i&lt;3*N;i++){r=(R[&quot;Bevel&quot;]-R[&quot;Base&quot;])*(i+1)/(3*N)+R[&quot;Base&quot;];u=Math.sqrt(r*r/(R[&quot;Base&quot;]*R[&quot;Base&quot;])-1);xp=R[&quot;Base&quot;]*(Math.cos(u)+u*Math.sin(u));yp=-R[&quot;Base&quot;]*(Math.sin(u)-u*Math.cos(u));pts.push([xp*Math.cos(A[&quot;Theta2&quot;])-yp*Math.sin(A[&quot;Theta2&quot;]),xp*Math.sin(A[&quot;Theta2&quot;])+yp*Math.cos(A[&quot;Theta2&quot;])]);normals.push([-Math.sin(u),-Math.cos(u)])}auxth=-u;auxth=auxth+ThetaA3+Math.PI/2;m=Math.tan(auxth);P0=pts[pts.length-1];rA=TOOTHGEO[&quot;Bevel&quot;]/(1-Math.cos(auxth-A[&quot;Theta4&quot;]));xc=P0[0]-rA*Math.cos(auxth);yc=P0[1]-rA*Math.sin(auxth);for(i=0;i&lt;N;i++){th=(A[&quot;Theta4&quot;]-auxth)*(i+1)/N+auxth;pts.push([xc+rA*Math.cos(th),yc+rA*Math.sin(th)]);normals.push([-Math.cos(th),-Math.sin(th)])}P0=pts[pts.length-1];A[&quot;Theta4&quot;]=Math.atan(P0[1]/P0[0]);Ra=Math.sqrt(P0[0]*P0[0]+P0[1]*P0[1]);for(i=0;i&lt;N;i++){th=-A[&quot;Theta4&quot;]*(i+1)/N+A[&quot;Theta4&quot;];pts.push([Ra*Math.cos(th),Ra*Math.sin(th)]);normals.push([-Math.cos(th),-Math.sin(th)])}N=pts.length;for(i=0;i&lt;N-1;i++){P=pts[N-2-i];pts.push([P[0],-P[1]]);V=normals[N-2-i];normals.push([V[0],-V[1]])}return pts};shape_object.prototype.RackOutline=function RackOutline(args){args=args||{};if(args.n===undefined)args.n=30;if(args.res===undefined)args.res=1;if(args.phi===undefined)args.phi=20;if(args.radius===undefined)args.radius=5;if(args.addendum===undefined)args.addendum=.4;if(args.dedendum===undefined)args.dedendum=.5;if(args.fradius===undefined)args.fradius=.1;if(args.bevel===undefined)args.bevel=.05;var TOOTHGEO,X,DiametralPitch,ToothThickness,CircularPitch,Pa,yA1,yA2,yA3,A;var pts,normals,ist,i,Aw,Xded,x,rA,xc,yc,th,y,N,P,V;TOOTHGEO={PitchRadius:args.radius,TeethN:args.n,PressureAng:args.phi,Addendum:args.addendum,Dedendum:args.dedendum,Fillet:args.fradius,Bevel:args.bevel,Resolution:args.res};X={Bottom:-TOOTHGEO[&quot;Dedendum&quot;]-TOOTHGEO[&quot;Fillet&quot;],Ded:-TOOTHGEO[&quot;Dedendum&quot;],Bevel:TOOTHGEO[&quot;Addendum&quot;]-TOOTHGEO[&quot;Bevel&quot;],Add:TOOTHGEO[&quot;Addendum&quot;]};DiametralPitch=TOOTHGEO[&quot;TeethN&quot;]/(2*TOOTHGEO[&quot;PitchRadius&quot;]);ToothThickness=Math.PI/2/DiametralPitch;CircularPitch=Math.PI/DiametralPitch;Pa=TOOTHGEO[&quot;PressureAng&quot;]*Math.PI/180;yA1=ToothThickness/2;yA2=(-X[&quot;Ded&quot;]+TOOTHGEO[&quot;Fillet&quot;]*Math.sin(Pa))*Math.tan(Pa);yA3=TOOTHGEO[&quot;Fillet&quot;]*Math.cos(Pa);A={y0:CircularPitch/2,y1:yA1+yA2+yA3,y2:yA1+yA2,y3:yA1-(X[&quot;Add&quot;]-TOOTHGEO[&quot;Bevel&quot;])*Math.tan(Pa),y4:yA1-(X[&quot;Add&quot;]-TOOTHGEO[&quot;Bevel&quot;])*Math.tan(Pa)-cos(Pa)/(1-Math.sin(Pa))*TOOTHGEO[&quot;Bevel&quot;]};N=TOOTHGEO[&quot;Resolution&quot;];pts=[];normals=[];ist=0;if(args.fradius){ist=1}for(i=ist;i&lt;2*N;i++){y=(A[&quot;y1&quot;]-A[&quot;y0&quot;])*i/(2*N-1)+A[&quot;y0&quot;];pts.push([X[&quot;Bottom&quot;],y]);normals.push([-1,-0])}xc=X[&quot;Ded&quot;];yc=A[&quot;y1&quot;];Aw=Math.PI/2-Pa;for(i=0;i&lt;N;i++){th=Aw*(i+1)/N+Math.PI;pts.push([xc+TOOTHGEO[&quot;Fillet&quot;]*Math.cos(th),yc+TOOTHGEO[&quot;Fillet&quot;]*Math.sin(th)]);normals.push([Math.cos(th),Math.sin(th)])}Xded=X[&quot;Ded&quot;]-TOOTHGEO[&quot;Fillet&quot;]*Math.sin(Pa);for(i=0;i&lt;4*N;i++){x=(X[&quot;Bevel&quot;]-Xded)*(i+1)/(4*N)+Xded;pts.push([x,yA1-Math.tan(Pa)*x]);normals.push([-Math.sin(Pa),-Math.cos(Pa)])}rA=TOOTHGEO[&quot;Bevel&quot;]/(1-Math.sin(Pa));xc=X[&quot;Add&quot;]-rA;yc=A[&quot;y4&quot;];for(i=0;i&lt;N;i++){th=(-Math.PI/2+Pa)*(i+1)/N+Math.PI/2-Pa;pts.push([xc+rA*Math.cos(th),yc+rA*Math.sin(th)]);normals.push([-Math.cos(th),-Math.sin(th)])}for(i=0;i&lt;N;i++){y=-A[&quot;y4&quot;]*(i+1)/N+A[&quot;y4&quot;];pts.push([X[&quot;Add&quot;],y]);normals.push([-1,0])}N=pts.length;for(i=0;i&lt;N-1;i++){P=pts[N-2-i];pts.push([P[0],-P[1]]);V=normals[N-2-i];normals.push([V[0],-V[1]])}return pts};shape_object.prototype.gear=function gear(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.n===undefined)args.n=20;if(args.radius===undefined)args.radius=1;if(args.phi===undefined)args.phi=20;if(args.addendum===undefined)args.addendum=.08*args.radius;if(args.dedendum===undefined)args.dedendum=.1*args.radius;if(args.fradius===undefined)args.fradius=.02*args.radius;if(args.rotate===undefined)args.rotate=0;if(args.scale===undefined)args.scale=1;if(args.res===undefined)args.res=1;var bevel=0;if(args.bevel!==undefined)bevel=args.bevel;var itooth,px,py,rad,driro,ir,ro,ix,iy,p,tooth,rotan,rtooth,rx,ry,x,y,i,gear,outer;var lastx=1e4,lasty=1e4;args.bevel=0;tooth=this.ToothOutline(args);args.bevel=bevel;gear=[];for(i=0;i&lt;args.n;i++){rotan=-i*2*Math.PI/args.n;rtooth=[];for(var j=0;j&lt;tooth.length;j++){p=tooth[j];x=p[0];y=p[1];rx=x*Math.cos(rotan)-y*Math.sin(rotan)+args.pos[0];ry=x*Math.sin(rotan)+y*Math.cos(rotan)+args.pos[1];rtooth.push([rx,ry])}gear=gear.concat(rtooth)}if(args.scale!==1)gear=this.scale(gear,args.scale,args.scale);if(args.rotate!==0)gear=this.rotatecp(gear,args.pos,args.rotate);var pts=[];var g1,g2,g3;for(var i=0;i&lt;gear.length;i++){g1=gear[i];pts.push(g1);if(i==gear.length-1)break;g2=gear[i+1];if(i&lt;gear.length-2){g3=gear[i+2];if(Math.abs(g3[0]-g1[0])&lt;.001*args.radius&amp;&amp;Math.abs(g3[1]-g1[1])&lt;.001*args.radius)i+=2;g2=gear[i];if(g1[0]===g2[0]&amp;&amp;g1[1]===g2[1])i++;continue}if(g1[0]===g2[0]&amp;&amp;g1[1]===g2[1]){i++;continue}}return pts};shape_object.prototype.rackgear=function rackgear(args){args=args||{};if(args.pos===undefined)args.pos=[0,0];if(args.n===undefined)args.n=30;if(args.radius===undefined)args.radius=5;if(args.phi===undefined)args.phi=20;if(args.addendum===undefined)args.addendum=.08*args.radius;if(args.dedendum===undefined)args.dedendum=.1*args.radius;if(args.fradius===undefined)args.fradius=.02*args.radius;if(args.rotate===undefined)args.rotate=0;if(args.scale===undefined)args.scale=1;if(args.length===undefined)args.length=10*Math.PI;if(args.res===undefined)args.res=1;if(args.bevel===undefined)args.bevel=.05;if(args.depth===undefined)args.depth=.4+.6+.1;var tooth,toothl,nt,flength,gear,ntooth,nx,ny,i;var x,y,left,right,bottom,top,g,center,dx,dy,gear2,p;var lastx=1e4,lasty=1e4;tooth=this.RackOutline(args);toothl=tooth[0][1]-tooth[tooth.length-1][1];nt=Math.floor(args.length/toothl);flength=nt*toothl;gear=[];for(i=0;i&lt;nt;i++){ntooth=[];for(var j=0;j&lt;tooth.length;j++){p=tooth[j];x=p[0];y=p[1];if(x==lastx||y==lasty)continue;nx=x+args.pos[0];ny=-i*toothl+y+args.pos[1];ntooth.push([nx,ny]);lastx=x;lasty=y}gear=gear.concat(ntooth)}gear.push([gear[gear.length-1][0]-args.depth,gear[gear.length-1][1]]);gear.push([gear[0][0]-args.depth,gear[0][1]]);gear.push(gear[0]);left=1e3;right=-1e3;bottom=1e3;top=-1e3;for(i=0;i&lt;gear.length;i++){g=gear[i];x=g[0];y=g[1];if(x&lt;left)left=x;if(x&gt;right)right=x;if(y&lt;bottom)bottom=y;if(y&gt;top)top=y}center=[(left+right)/2,(bottom+top)/2];dx=args.pos[0]-center[0];dy=args.pos[1]-center[1];gear2=[];for(i=0;i&lt;gear.length;i++){g=gear[i];gear2.push([g[0]+dx,g[1]+dy])}if(args.scale!==1)gear2=this.scale(gear2,args.scale,args.scale);if(args.rotate!==0)gear2=this.rotate(gear2,args.pos,args.rotate);return gear2};function path_object(){}path_object.prototype.convert=function convert(args){args=args||{};if(args.pos===undefined)args.pos=vec(0,0,0);if(args.up===undefined)args.up=vec(0,1,0);if(args.pts===undefined)args.pts=null;if(args.closed===undefined)args.closed=true;var up0,angle,reorient,axis,p,newpt,pt,i;args.up=norm(args.up);up0=vec(0,1,0);angle=Math.acos(args.up.dot(up0));reorient=angle&gt;0;axis=up0.cross(args.up);p=[];for(i=0;i&lt;args.pts.length;i++){pt=args.pts[i];newpt=vec(pt[0],0,0-pt[1]);if(reorient)newpt=newpt.rotate({angle:angle,axis:axis});p.push(args.pos.add(newpt))}if(closed&amp;&amp;!p[p.length-1].equals(p[0])){p.push(pts[0])}return p};path_object.prototype.setuppath=function setuppath(args){args.path=true;var pos;if(args.pos===undefined){pos=vec(0,0,0)}else{pos=args.pos;if(pos.x===undefined)throw new Error(&quot;The pos attribute of a path must be a vector.&quot;);delete args.pos}return pos};path_object.prototype.rectangle=function rectangle(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in a rectangular path&quot;);var pos=this.setuppath(args);var c=shapes.rectangle(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.cross=function cross(args){args=args||{};var pos=this.setuppath(args);var c=shapes.cross(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.trapezoid=function trapezoid(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in a trapezoid path&quot;);var pos=this.setuppath(args);var c=shapes.trapezoid(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.circle=function circle(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in a circle path&quot;);var pos=this.setuppath(args);var c=shapes.circle(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.line=function line(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in a line path&quot;);if(args.np===undefined)args.np=2;if(args.rotate===undefined)args.rotate=0;if(args.scale===undefined)args.scale=1;if(args.xscale===undefined)args.xscale=1;if(args.yscale===undefined)args.yscale=1;if(args.start===undefined)args.start=vec(0,0,0);if(args.end===undefined)args.end=vec(0,0,-.1);var v,vline,i;var cp=[args.start];v=args.end.sub(args.start);vline=v.divide(Math.floor(args.np-1));for(i=1;i&lt;args.np;i++){cp.push(args.start.add(vline));vline=vline.add(vline)}return cp};path_object.prototype.arc=function arc(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in an arc path&quot;);args.path=true;var pos=this.setuppath(args);var c=shapes.arc(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.ellipse=function ellipse(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in an ellipse path&quot;);var pos=this.setuppath(args);var c=shapes.ellipse(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.ngon=function ngon(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in an ngon path&quot;);var pos=this.setuppath(args);var c=shapes.ngon(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.triangle=function triangle(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in a pentagon path&quot;);</td>
      </tr>
      <tr>
        <td id="L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="LC12" class="blob-code blob-code-inner js-file-line">var pos=this.setuppath(args);var c=shapes.triangle(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.pentagon=function pentagon(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in a triangle path&quot;);var pos=this.setuppath(args);var c=shapes.pentagon(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.hexagon=function hexagon(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in a hexagon path&quot;);var pos=this.setuppath(args);var c=shapes.hexagon(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.octagon=function octagon(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in an octagon path&quot;);var pos=this.setuppath(args);var c=shapes.octagon(args);return this.convert({pos:pos,up:args.up,pts:c})};path_object.prototype.star=function star(args){args=args||{};if(args.thickness!==undefined)throw Error(&quot;Thickness is not allowed in a star path&quot;);var pos=this.setuppath(args);var c=shapes.star(args);return this.convert({pos:pos,up:args.up,pts:c})};var paths=new path_object;var shapes=new shape_object;var exports={paths:paths,shapes:shapes};Export(exports)})();(function(){&quot;use strict&quot;;function subclass(sub,base){sub.prototype=new base({visible:false,canvas:null});sub.prototype.constructor=sub}function id_to_falsecolor(N){var R=0,G=0,B=0;if(N&gt;=16777216){R=Math.floor(N/16777216);N-=R*16777216}if(N&gt;=65536){G=Math.floor(N/65536);N-=G*65536}if(N&gt;=256){B=Math.floor(N/256);N-=B*256}return[R/255,G/255,B/255,N/255]}function init(obj,args){if(window.__GSlang==&quot;vpython&quot;&amp;&amp;args.display!==undefined){args.canvas=args.display;delete args.display}if(args.canvas!==undefined){obj.canvas=args.canvas;delete args.canvas}else{obj.canvas=canvas.selected}if(obj.canvas){obj.canvas.__activate();obj.__model=obj.__get_model()}if(args.__obj){obj.__obj=args.__obj;delete args.__obj}if(args.radius!==undefined){obj.radius=args.radius;delete args.radius}if(args.size_units!==undefined){obj.size_units=args.size_units;delete args.size_units}if(args.axis!==undefined){obj.axis=args.axis;delete args.axis}if(args.size!==undefined){obj.size=args.size;delete args.size}if(args.color!==undefined){obj.color=args.color;delete args.color}obj.__interval=-1;if(obj.constructor!=curve&amp;&amp;obj.constructor!=points&amp;&amp;args.make_trail!==undefined){obj.__make_trail=args.make_trail;delete args.make_trail;obj.__trail_type=&quot;curve&quot;;if(args.trail_type!==undefined){if(args.trail_type!=&quot;curve&quot;&amp;&amp;args.trail_type!=&quot;points&quot;&amp;&amp;args.trail_type!=&quot;spheres&quot;)throw new Error(&quot;trail_type = &quot;+args.trail_type+&quot; but must be &#39;curve&#39; or &#39;points&#39; (or &#39;spheres&#39;).&quot;);obj.__trail_type=args.trail_type;delete args.trail_type}if(args.interval!==undefined){obj.__interval=args.interval;delete args.interval}else if(obj.__trail_type!=&quot;curve&quot;){obj.__interval=1}if(args.retain!==undefined){obj.__retain=args.retain;delete args.retain}else obj.__retain=-1;obj.__trail_color=color.white;if(obj.color!==undefined)obj.__trail_color=obj.color;if(args.trail_color!==undefined){obj.__trail_color=args.trail_color;delete args.trail_color}obj.__trail_radius=0;if(args.trail_radius!==undefined){obj.__trail_radius=args.trail_radius;delete args.trail_radius}else{if(obj.__trail_type==&quot;points&quot;)obj.__trail_radius=.1*obj.__size.y}obj.__pps=0;if(args.pps!==undefined){if(obj.__interval&gt;0){if(obj.__trail_type!=&quot;curve&quot;)throw new Error(&quot;pps cannot be used with a &quot;+obj.__trail_type+&quot;-type trail&quot;);else throw new Error(&quot;pps cannot be used with interval &gt; 0&quot;)}obj.__pps=args.pps;delete args.pps}obj.__trail_object=attach_trail(obj,{type:obj.__trail_type,color:obj.__trail_color,radius:obj.__trail_radius,pps:obj.__pps,retain:obj.__retain});if(args.pos!==undefined&amp;&amp;obj.__make_trail)obj.__trail_object.__trail.push(args.pos);if(!obj.__make_trail)obj.__trail_object.stop();obj.__ninterval=0}for(var id in args)obj[id]=args[id];if(args.visible===undefined&amp;&amp;obj.canvas!==null)obj.visible=true}function initObject(obj,constructor,args){if(!(obj instanceof constructor))return new constructor(args);args=args||{};obj.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:false,right:false,sides:false,flipx:false,flipy:false,turn:0,flags:0};if(constructor!=curve&amp;&amp;constructor!=points){if(args.pos===undefined)obj.pos=obj.pos}if(args.color===undefined)obj.color=obj.color;if(constructor==curve)obj.origin=obj.origin;if(constructor!=points){if(constructor==arrow){if(args.axis!==undefined)throw new Error(&quot;arrow does not have axis; replace with axis_and_length&quot;);else if(args.axis_and_length===undefined)obj.axis_and_length=obj.axis_and_length}else if(constructor==vp_arrow&amp;&amp;args.axis_and_length!==undefined){throw new Error(&quot;VPython arrow does not have axis_and_length; replace with axis&quot;)}else if(args.axis===undefined)obj.axis=obj.axis;if(args.up===undefined)obj.up=obj.up;if(args.size===undefined)obj.size=obj.size}if(args.opacity===undefined)obj.__opacity=1;if(args.make_trail===undefined)obj.__make_trail=false;obj.__opacity_change=true;init(obj,args)}var nextVisibleId=1;var textures={flower:&quot;:flower_texture.jpg&quot;,granite:&quot;:granite_texture.jpg&quot;,gravel:&quot;:gravel_texture.jpg&quot;,earth:&quot;:earth_texture.jpg&quot;,metal:&quot;:metal_texture.jpg&quot;,rock:&quot;:rock_texture.jpg&quot;,rough:&quot;:rough_texture.jpg&quot;,rug:&quot;:rug_texture.jpg&quot;,stones:&quot;:stones_texture.jpg&quot;,stucco:&quot;:stucco_texture.jpg&quot;,wood:&quot;:wood_texture.jpg&quot;,wood_old:&quot;:wood_old_texture.jpg&quot;};var bumpmaps={gravel:&quot;:gravel_bumpmap.jpg&quot;,rock:&quot;:rock_bumpmap.jpg&quot;,stones:&quot;:stones_bumpmap.jpg&quot;,stucco:&quot;:stucco_bumpmap.jpg&quot;,wood_old:&quot;:wood_old_bumpmap.jpg&quot;};function setup_texture(name,obj,isbump){if(name.slice(0,1)==&quot;:&quot;){var jv=window.Jupyter_VPython;if(jv!==undefined){name=jv+name.slice(1)}else{if(navigator.onLine)name=&quot;https://s3.amazonaws.com/glowscript/textures/&quot;+name.slice(1);else name=&quot;../lib/FilesInAWS/&quot;+name.slice(1)}}obj.canvas.__renderer.initTexture(name,obj,isbump)}function Primitive(){}property.declare(Primitive.prototype,{__id:null,__hasPosAtCenter:false,__deleted:false,__zx_camera:null,__zy_camera:null,__xmin:null,__ymin:null,__zmin:null,__xmax:null,__ymax:null,__zmax:null,pos:new attributeVectorPos(null,0,0,0),color:new attributeVector(null,1,1,1),up:new attributeVector(null,0,1,0),axis:new attributeVector(null,1,0,0),size:new attributeVector(null,1,1,1),opacity:{get:function(){return this.__opacity},set:function(value){if(value==this.__opacity)return;if(this.__opacity&lt;1&amp;&amp;value==1||this.__opacity==1&amp;&amp;value&lt;1){this.__opacity_change=true}this.__opacity=value;this.__change()}},x:{get:function(){throw new Error(&#39;&quot;object.x&quot; is not supported; perhaps you meant &quot;object.pos.x&quot;&#39;)},set:function(value){throw new Error(&#39;&quot;object.x&quot; is not supported; perhaps you meant &quot;object.pos.x&quot;&#39;)}},y:{get:function(){throw new Error(&#39;&quot;object.y&quot; is not supported; perhaps you meant &quot;object.pos.y&quot;&#39;)},set:function(value){throw new Error(&#39;&quot;object.y&quot; is not supported; perhaps you meant &quot;object.pos.y&quot;&#39;)}},z:{get:function(){throw new Error(&#39;&quot;object.z&quot; is not supported; perhaps you meant &quot;object.pos.z&quot;&#39;)},set:function(value){throw new Error(&#39;&quot;object.z&quot; is not supported; perhaps you meant &quot;object.pos.z&quot;&#39;)}},__opacity_change:false,__prev_opacity:null,shininess:{value:.6,onchanged:function(){this.__change()}},emissive:{value:false,onchanged:function(){this.__change()}},pickable:{value:true,onchanged:function(){this.__change()}},ready:{get:function(){return this.__tex.file===null||this.__tex.texture_ref.reference!==null&amp;&amp;this.__tex.bumpmap===null||this.__tex.bumpmap_ref.reference!==null}},make_trail:{get:function(){return this.__make_trail},set:function(value){if(this.__make_trail!==value){if(value){this.__trail_object.start();this.__trail_object.__trail.push(this.__pos)}else this.__trail_object.stop();this.__make_trail=value}}},retain:{get:function(){return this.__retain},set:function(value){this.__retain=value;if(this.__trail_object!==undefined)this.__trail_object.retain=value}},trail_type:{get:function(){if(this.__trail_type==&quot;curve&quot;)return&quot;curve&quot;;else if(this.__trail_type==&quot;spheres&quot;)return&quot;points&quot;;else return this.__trail_type},set:function(value){throw new Error(&#39;&quot;trail_type&quot; cannot be changed.&#39;)}},trail_color:{get:function(){return this.__color},set:function(value){this.__trail_color=value;if(this.__trail_object!==undefined)this.__trail_object.color=value}},trail_radius:{get:function(){return this.__radius},set:function(value){this.__trail_radius=value;if(this.__trail_object!==undefined)this.__trail_object.radius=value}},pps:{get:function(){return this.__pps},set:function(value){this.__pps=value;if(this.__trail_object!==undefined)this.__trail_object.pps=value}},clear_trail:function(){if(this.__trail_object!==undefined)this.__trail_object.clear()},__update_trail:function(v){if(!this.__trail_object.__run||!this.visible)return;if(this.__interval===-1)return;this.__ninterval++;var update=false;if(this.__ninterval&gt;=this.__interval){this.__ninterval=0;update=true}else if(this.__ninterval==1&amp;&amp;this.__trail_object.__trail.__points.length===0)update=true;if(update){if(this.__retain==-1)this.__trail_object.__trail.push({pos:v,color:this.__trail_color,radius:this.__trail_radius});else this.__trail_object.__trail.push({pos:v,color:this.__trail_color,radius:this.__trail_radius,retain:this.__retain})}},texture:{get:function(){return{file:this.__tex.file,bumpmap:this.__tex.bumpmap,left:this.__tex.left,right:this.__tex.right,sides:this.__tex.sides,flipx:this.__tex.flipx,flipy:this.__tex.flipy,turn:this.__tex.turn}},set:function(args){this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:false,right:false,sides:false,flipx:false,flipy:false,turn:0,flags:0};if(args===null){}else if(typeof args===&quot;string&quot;){this.__tex.left=this.__tex.right=this.__tex.sides=true;setup_texture(args,this,false)}else{if(args.file!==undefined&amp;&amp;typeof args.file===&quot;string&quot;){setup_texture(args.file,this,false)}else throw new Error(&quot;You must specify a file name for a texture.&quot;);if(args.bumpmap!==undefined){if(args.bumpmap!==null){if(typeof args.bumpmap!==&quot;string&quot;)throw new Error(&quot;You must specify a file name for a bumpmap.&quot;);setup_texture(args.bumpmap,this,true)}}if(args.flipx!==undefined)this.__tex.flipx=args.flipx;if(args.flipy!==undefined)this.__tex.flipy=args.flipy;if(args.turn!==undefined)this.__tex.turn=Math.round(args.turn);if(args.place!==undefined){if(typeof args.place===&quot;string&quot;)args.place=[args.place];for(var i=0;i&lt;args.place.length;i++){switch(args.place[i]){case&quot;left&quot;:this.__tex.left=true;break;case&quot;right&quot;:this.__tex.right=true;break;case&quot;sides&quot;:this.__tex.sides=true;break;case&quot;ends&quot;:this.__tex.left=this.__tex.right=true;break;case&quot;all&quot;:this.__tex.left=this.__tex.right=this.__tex.sides=true;break}}}else this.__tex.left=this.__tex.right=this.__tex.sides=true}this.__tex.flags=0;if(this.__tex.file!==null)this.__tex.flags+=1;if(this.__tex.bumpmap!==null)this.__tex.flags+=2;if(this.__tex.left)this.__tex.flags+=4;if(this.__tex.right)this.__tex.flags+=8;if(this.__tex.sides)this.__tex.flags+=16;if(this.__tex.flipx)this.__tex.flags+=32;if(this.__tex.flipy)this.__tex.flags+=64;var turns=this.__tex.turn%4;if(turns&lt;0)turns+=4;this.__tex.flags+=128*turns;this.__change()}},visible:{get:function(){if(this.__obj)return this.__obj.__id!=null;return this.__id!=null},set:function(value){if(this.__obj)return;if(value==(this.__id!=null))return;if(this.__deleted)return;if(this.__curve)this.__curve.visible=value;if(value){if(this.constructor==vp_arrow||this.constructor==arrow){if(!this.__components)this.__update();this.__id=nextVisibleId;var fc;nextVisibleId++;for(var i=0;i&lt;this.__components.length;i++){var c=this.__components[i];c.__id=nextVisibleId;if(i===0)fc=id_to_falsecolor(nextVisibleId);c.__falsecolor=fc;this.canvas.__visiblePrimitives[nextVisibleId]=c;this.canvas.__changed[nextVisibleId]=c;nextVisibleId++}}else{this.__id=nextVisibleId;this.__falsecolor=id_to_falsecolor(nextVisibleId);this.canvas.__visiblePrimitives[nextVisibleId]=this;this.canvas.__changed[nextVisibleId]=this;nextVisibleId++}if(this instanceof extrusion){this.__vis=value}}else{if(this.constructor==vp_arrow||this.constructor==arrow){for(var i=0;i&lt;this.__components.length;i++){var c=this.__components[i];delete this.canvas.__visiblePrimitives[c.__id];delete this.canvas.__changed[c.__id];if(c.__model)delete c.__model.id_object[c.__id]}}else{delete this.canvas.__visiblePrimitives[this.__id];delete this.canvas.__changed[this.__id];if(this.__model)delete this.__model.id_object[this.__id]}if(this instanceof extrusion){this.__vis=value}this.__id=null}}},clone:function(args){if(this instanceof triangle||this instanceof quad)throw new Error(&quot;Cannot clone a &quot;+this.constructor.name+&quot; object.&quot;);if(this instanceof curve){var newargs={origin:this.__origin,pos:this.pos,color:this.__color,radius:this.__radius,size:this.__size,axis:this.__axis,up:this.__up,shininess:this.__shininess,emissive:this.__emissive,visible:true,pickable:this.__pickable}}if(this instanceof helix){var newargs={pos:this.pos,color:this.__color,thickness:this.__thickness,coils:this.__coils,size:this.__size,axis:this.__axis,up:this.__up,shininess:this.__shininess,emissive:this.__emissive,visible:true,pickable:this.__pickable}}else{var newargs={pos:this.__pos,color:this.__color,opacity:this.__opacity,size:this.__size,axis:this.__axis,up:this.__up,__tex:this.__tex,shininess:this.__shininess,emissive:this.__emissive,visible:true,pickable:this.__pickable};if(this instanceof arrow||this instanceof vp_arrow){newargs.shaftwidth=this.__shaftwidth;newargs.headwidth=this.__headwidth;newargs.headlength=this.__headlength}}for(var attr in args){newargs[attr]=args[attr]}return new this.constructor(newargs)},__change:function(){if(this.__id)this.canvas.__changed[this.__id]=this},__get_extent:function(ext){Autoscale.find_extent(this,ext)},__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__update:function(){if(this.__id===null)return;var pos=this.__pos;var size=this.__size;var color=this.__color;var axis=this.__axis;var up=this.__up;var data=this.__data;if(!data)this.__data=data=new Float32Array(20);this.__model.id_object[this.__id]=this;data[0]=pos.__x;data[1]=pos.__y;data[2]=pos.__z;data[3]=this.__shininess;data[4]=axis.__x;data[5]=axis.__y;data[6]=axis.__z,data[7]=this.__emissive?1:0;data[8]=up.__x;data[9]=up.__y;data[10]=up.__z;data[11]=this.__tex.flags;data[12]=size.__x;data[13]=size.__y;data[14]=size.__z;data[16]=color.__x;data[17]=color.__y;data[18]=color.__z;data[19]=this.__opacity},rotate:function(args){if(args===undefined||args.angle===undefined){throw new Error(&quot;object.rotate() requires an angle.&quot;)}var angle=args.angle;var rotaxis,origin;if(args.axis===undefined){rotaxis=this.__axis}else rotaxis=args.axis.norm();if(args.origin===undefined){origin=this.__pos}else origin=args.origin;var isarrow=this.constructor==arrow;var iscurve=this.constructor==curve;var X=isarrow?this.__axis_and_length.norm():this.__axis.norm();var Y=this.__up.norm();var Z=X.cross(Y);if(Z.dot(Z)&lt;1e-10){Y=vec(1,0,0);Z=X.cross(Y);if(Z.dot(Z)&lt;1e-10)Y=vec(0,1,0)}if(iscurve)this.origin=origin.add(this.__origin.sub(origin).rotate({angle:angle,axis:rotaxis}));else this.pos=origin.add(this.__pos.sub(origin).rotate({angle:angle,axis:rotaxis}));if(isarrow)this.__axis_and_length=this.__axis_and_length.rotate({angle:angle,axis:rotaxis});else this.axis=this.__axis.rotate({angle:angle,axis:rotaxis});this.up=Y.rotate({angle:angle,axis:rotaxis})},getTransformedMesh:function(){var X=this.__axis.norm();var Y=this.__up.norm();var Z=X.cross(Y);if(Z.dot(Z)&lt;1e-10){Y=vec(1,0,0);Z=X.cross(Y);if(Z.dot(Z)&lt;1e-10)Y=vec(0,1,0);Z=X.cross(Y)}Z=Z.norm();Y=Z.cross(X).norm();var T=this.__pos;if(this instanceof ring||this instanceof vp_ring){var m=Mesh.makeRing_compound(this.__size);var matrix=[X.x,X.y,X.z,0,Y.x,Y.y,Y.z,0,Z.x,Z.y,Z.z,0,T.x,T.y,T.z,1];return m.transformed(matrix)}else{X=X.multiply(this.__size.x);Y=Y.multiply(this.__size.y);Z=Z.multiply(this.__size.z);var matrix=[X.x,X.y,X.z,0,Y.x,Y.y,Y.z,0,Z.x,Z.y,Z.z,0,T.x,T.y,T.z,1];return this.__model.mesh.transformed(matrix)}}});function box(args){return initObject(this,box,args)}subclass(box,Primitive);box.prototype.__hasPosAtCenter=true;function cylinder(args){return initObject(this,cylinder,args)}subclass(cylinder,Primitive);function cone(args){return initObject(this,cone,args)}subclass(cone,cylinder);function pyramid(args){return initObject(this,pyramid,args)}subclass(pyramid,box);function sphere(args){return initObject(this,sphere,args)}subclass(sphere,Primitive);sphere.prototype.__hasPosAtCenter=true;function vp_box(args){return initObject(this,vp_box,args)}subclass(vp_box,box);property.declare(vp_box.prototype,{axis:new attributeVectorAxis(null,1,0,0),size:new attributeVectorSize(null,1,1,1),length:{get:function(){return this.__size.__x},set:function(value){this.axis=this.__axis.norm().multiply(value);this.__change()}},height:{get:function(){return this.__size.__y},set:function(value){this.__size.__y=value;this.__change()}},width:{get:function(){return this.__size.__z},set:function(value){this.__size.__z=value;this.__change()}},red:{get:function(){return this.__color.__x},set:function(value){this.__color.__x=value;this.__change()}},green:{get:function(){return this.__color.__y},set:function(value){this.__color.__y=value;this.__change()}},blue:{get:function(){return this.__color.__z},set:function(value){this.__color.__z=value;this.__change()}}});function vp_pyramid(args){return initObject(this,vp_pyramid,args)}subclass(vp_pyramid,vp_box);function vp_sphere(args){return initObject(this,vp_sphere,args)}subclass(vp_sphere,vp_box);property.declare(vp_sphere.prototype,{axis:new attributeVector(null,1,0,0),size:new attributeVector(null,2,2,2),radius:{get:function(){return this.__size.__y/2},set:function(value){this.size=vec(2*value,2*value,2*value);this.__change()}}});function vp_ellipsoid(args){return initObject(this,vp_ellipsoid,args)}subclass(vp_ellipsoid,vp_box);property.declare(vp_ellipsoid.prototype,{radius:{get:function(){throw new Error(&quot;An ellipsoid does not have a radius attribute.&quot;)},set:function(value){throw new Error(&quot;An ellipsoid does not have a radius attribute.&quot;)}}});function vp_cylinder(args){return initObject(this,vp_cylinder,args)}subclass(vp_cylinder,vp_box);property.declare(vp_cylinder.prototype,{size:new attributeVectorSize(null,1,2,2),radius:{get:function(){return this.__size.__y/2},set:function(value){this.__size.__y=this.__size.__z=2*value;this.__change()}}});function vp_cone(args){return initObject(this,vp_cone,args)}subclass(vp_cone,vp_cylinder);function arrow_update(obj,vp){var pos=obj.__pos;var color=obj.__color;var axis;if(vp)axis=obj.__axis;else axis=obj.__axis_and_length;var size=obj.__size;var up=obj.__up;var L=size.__x;var A=axis.norm();var sw=obj.__shaftwidth||L*.1;var hw=obj.__headwidth||sw*2;var hl=obj.__headlength||sw*3;if(sw&lt;L*.02){var scale=L*.02/sw;if(!obj.__shaftwidth)sw*=scale;if(!obj.__headwidth)hw*=scale;if(!obj.__headlength)hl*=scale}if(hl&gt;L*.5){var scale=L*.5/hl;if(!obj.__shaftwidth)sw*=scale;if(!obj.__headwidth)hw*=scale;if(!obj.__headlength)hl*=scale}var components=obj.__components;if(!components){if(vp)components=obj.__components=[vp_box({canvas:obj.canvas,__obj:obj}),vp_pyramid({canvas:obj.canvas,__obj:obj})];else components=obj.__components=[box({canvas:obj.canvas,__obj:obj}),pyramid({canvas:obj.canvas,__obj:obj})]}var shaft=components[0];var tip=components[1];shaft.pos=pos.add(A.multiply(.5*(L-hl)));tip.pos=pos.add(A.multiply(L-hl));shaft.axis=tip.axis=axis;shaft.up=tip.up=up;shaft.size=vec(L-hl,sw,sw);tip.size=vec(hl,hw,hw);shaft.color=tip.color=obj.color;shaft.opacity=tip.opacity=obj.opacity;shaft.pickable=tip.pickable=obj.pickable;obj.size=vec(L,hw,hw);shaft.__update();tip.__update()}function arrow(args){if(!(this instanceof arrow))return new arrow(args);this.__shaftwidth=0;this.__headwidth=0;this.__headlength=0;return initObject(this,arrow,args)}subclass(arrow,box);property.declare(arrow.prototype,{__primitiveCount:2,shaftwidth:{get:function(){return this.__shaftwidth},set:function(value){this.__shaftwidth=value;this.__change()}},headwidth:{get:function(){return this.__headwidth},set:function(value){this.__headwidth=value;this.__change()}},headlength:{get:function(){return this.__headlength},set:function(value){this.__headlength=value;this.__change()}},axis_and_length:new attributeVectorAxis(null,1,0,0),axis:{get:function(){new Error(&quot;arrow has an axis_and_length attribute but no axis attribute&quot;)},set:function(value){new Error(&quot;arrow has an axis_and_length attribute but no axis attribute&quot;)}},__change:function(){if(this.__components){this.__components[0].__change();this.__components[1].__change()}},__update:function(){arrow_update(this,false)},__get_extent:function(ext){if(!this.__components)this.__update();Autoscale.find_extent(this.__components[0],ext);Autoscale.find_extent(this.__components[1],ext)}});function vp_arrow(args){if(!(this instanceof vp_arrow))return new vp_arrow(args);this.__shaftwidth=0;this.__headwidth=0;this.__headlength=0;return initObject(this,vp_arrow,args)}subclass(vp_arrow,arrow);property.declare(vp_arrow.prototype,{axis:new attributeVectorAxis(null,1,0,0),axis_and_length:{get:function(){new Error(&quot;arrow has an axis attribute but no axis_and_length attribute&quot;)},set:function(value){new Error(&quot;arrow has an axis attribute but no axis_and_length attribute&quot;)}},length:{get:function(){return mag(this.__axis)},set:function(val){this.axis=this.__axis.norm().multiply(val)}},__update:function(){arrow_update(this,true)}});function vertex(args){if(!(this instanceof vertex)){return new vertex(args)}args=args||{};if(args.canvas!==undefined){this.canvas=args.canvas}else if(args.display!==undefined){this.canvas=args.display}else{this.canvas=canvas.selected}for(var attr in args){if(attr==&quot;canvas&quot;||attr==&quot;display&quot;)continue;this[attr]=args[attr]}if(this.opacity===undefined)this.opacity=1;if(this.__texpos.z!==0)throw new Error(&quot;In a vertex the z component of texpos must be zero.&quot;);if(this.canvas.vertex_id&gt;=65536)throw new Error(&quot;Currently the number of vertices is limited to 65536.&quot;);var lengths={pos:3,normal:3,color:3,opacity:1,shininess:1,emissive:1,texpos:2,bumpaxis:3};this.__id=this.canvas.__vertices.available.pop();if(this.__id===undefined){this.__id=this.canvas.vertex_id;var c=this.canvas.__vertices;if(this.canvas.vertex_id%c.Nalloc===0){var temp;var L=this.canvas.vertex_id+c.Nalloc;for(var t in lengths){temp=new Float32Array(lengths[t]*L);temp.set(c[t],0);c[t]=temp}}this.canvas.vertex_id++}this.canvas.__vertices.object_info[this.__id]={};this.__change()}property.declare(vertex.prototype,{__id:null,__hasPosAtCenter:true,pos:new attributeVector(null,0,0,0),normal:new attributeVector(null,0,0,1),color:new attributeVector(null,1,1,1),opacity:{get:function(){return this.__opacity},set:function(value){if(value==this.__opacity)return;if(this.__opacity&lt;1&amp;&amp;value==1||this.__opacity==1&amp;&amp;value&lt;1){var users=this.canvas.__vertices.object_info[this.__id];for(var u in users){users[u].__change();users[u].__opacity_change=true}}this.__opacity=value;this.canvas.__vertex_changed[this.__id]=this}},texpos:new attributeVector(null,0,0,0),bumpaxis:new attributeVector(null,1,0,0),shininess:{value:.6,onchanged:function(){this.__change()}},emissive:{value:false,onchanged:function(){this.__change()}},__change:function(){if(this.__id){this.canvas.__vertex_changed[this.__id]=this;if(this.canvas.__autoscale){var users=this.canvas.__vertices.object_info[this.__id];for(var u in users)users[u].__change()}}},rotate:function(args){if(args.angle===undefined){throw new Error(&quot;vertex.rotate() requires angle:...&quot;)}var angle=args.angle;if(args.axis===undefined){throw new Error(&quot;vertex.rotate() requires axis:...&quot;)}var axis=args.axis.norm();var origin;if(args.origin===undefined){origin=vec(0,0,0)}else origin=args.origin;this.pos=origin.add(this.__pos.sub(origin).rotate({angle:angle,axis:axis}));this.__change()}});function tri_quad_error(object_type,attribute){throw new Error(&quot;A &quot;+object_type+&quot; has no &quot;+attribute+&quot; attribute.&quot;)}function triangle(args){if(!(this instanceof triangle))return new triangle(args);args=args||{};var vnames=[&quot;v0&quot;,&quot;v1&quot;,&quot;v2&quot;];if(args.vs===undefined){for(var i=0;i&lt;3;i++)if(args[vnames[i]]===undefined)throw new Error(&quot;A triangle must have a vertex &quot;+vnames[i]+&quot;.&quot;)}this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:false,right:false,sides:false,flipx:false,flipy:false,turn:0,flags:0};init(this,args);var vtemp=this.vs;for(var i=0;i&lt;3;i++)this.canvas.__vertices.object_info[vtemp[i].__id][this.__id]=this}subclass(triangle,box);property.declare(triangle.prototype,{v0:{get:function(){return this.__v0},set:function(value){if(!(value instanceof vertex))throw new Error(&quot;v0 must be a vertex object.&quot;);this.__v0=value;this.__change()}},v1:{get:function(){return this.__v1},set:function(value){if(!(value instanceof vertex))throw new Error(&quot;v1 must be a vertex object.&quot;);this.__v1=value;this.__change()}},v2:{get:function(){return this.__v2},set:function(value){if(!(value instanceof vertex))throw new Error(&quot;v2 must be a vertex object.&quot;);this.__v2=value;this.__change()}},vs:{get:function(){return[this.__v0,this.__v1,this.__v2]},set:function(value){if(toType(value)!=&quot;array&quot;||value.length!=3)throw new Error(&quot;triangle.vs must be a list of 3 vertex objects.&quot;);for(var i=0;i&lt;3;i++)if(!(value[i]instanceof vertex))throw new Error(&quot;triangle.vs must contain vertex objects.&quot;);this.__v0=value[0];this.__v1=value[1];this.__v2=value[2];this.__change()}},pos:{get:function(){tri_quad_error(&quot;triangle&quot;,&quot;pos&quot;)},set:function(value){tri_quad_error(&quot;triangle&quot;,&quot;pos&quot;)}},color:{get:function(){tri_quad_error(&quot;triangle&quot;,&quot;color&quot;)},set:function(value){tri_quad_error(&quot;triangle&quot;,&quot;color&quot;)}},size:{get:function(){tri_quad_error(&quot;triangle&quot;,&quot;size&quot;)},set:function(value){tri_quad_error(&quot;triangle&quot;,&quot;size&quot;)}},axis:{get:function(){tri_quad_error(&quot;triangle&quot;,&quot;axis&quot;)},set:function(value){tri_quad_error(&quot;triangle&quot;,&quot;axis&quot;)}},up:{get:function(){tri_quad_error(&quot;triangle&quot;,&quot;up&quot;)},set:function(value){tri_quad_error(&quot;triangle&quot;,&quot;up&quot;)}},opacity:{get:function(){tri_quad_error(&quot;triangle&quot;,&quot;opacity&quot;)},set:function(value){tri_quad_error(&quot;triangle&quot;,&quot;opacity&quot;)}},shininess:{get:function(){tri_quad_error(&quot;triangle&quot;,&quot;shininess&quot;)},set:function(value){tri_quad_error(&quot;triangle&quot;,&quot;shininess&quot;)}},emissive:{get:function(){tri_quad_error(&quot;triangle&quot;,&quot;emissive&quot;)},set:function(value){tri_quad_error(&quot;triangle&quot;,&quot;emissive&quot;)}},__prev_texture:null,__prev_bumpmap:null,__update:function(){this.__model.id_object[this.__id]=this},__get_extent:function(ext){var vnames=[&quot;__v0&quot;,&quot;__v1&quot;,&quot;__v2&quot;];for(var i=0;i&lt;3;i++)ext.point_extent(this,this[vnames[i]].pos)},rotate:function(args){throw new Error(&quot;A triangle has no rotate method; rotate the vertices instead.&quot;)}});function quad(args){if(!(this instanceof quad))return new quad(args);args=args||{};var vnames=[&quot;v0&quot;,&quot;v1&quot;,&quot;v2&quot;,&quot;v3&quot;];if(args.vs===undefined){for(var i=0;i&lt;4;i++)if(args[vnames[i]]===undefined)throw new Error(&quot;A quad must have a vertex &quot;+vnames[i]+&quot;.&quot;)}this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:false,right:false,sides:false,flipx:false,flipy:false,turn:0,flags:0};init(this,args);var vtemp=this.vs;for(var i=0;i&lt;4;i++)this.canvas.__vertices.object_info[vtemp[i].__id][this.__id]=this}subclass(quad,box);property.declare(quad.prototype,{v0:{get:function(){return this.__v0},set:function(value){if(!(value instanceof vertex))throw new Error(&quot;v0 must be a vertex object.&quot;);this.__v0=value;this.__change()}},v1:{get:function(){return this.__v1},set:function(value){if(!(value instanceof vertex))throw new Error(&quot;v1 must be a vertex object.&quot;);this.__v1=value;this.__change()}},v2:{get:function(){return this.__v2},set:function(value){if(!(value instanceof vertex))throw new Error(&quot;v2 must be a vertex object.&quot;);this.__v2=value;this.__change()}},v3:{get:function(){return this.__v3},set:function(value){if(!(value instanceof vertex))throw new Error(&quot;v3 must be a vertex object.&quot;);this.__v3=value;this.__change()}},vs:{get:function(){return[this.__v0,this.__v1,this.__v2,this.__v3]},set:function(value){if(toType(value)!=&quot;array&quot;||value.length!=4)throw new Error(&quot;quad.vs must be a list of 4 vertex objects.&quot;);for(var i=0;i&lt;4;i++)if(!(value[i]instanceof vertex))throw new Error(&quot;quad.vs must contain vertex objects.&quot;);this.__v0=value[0];this.__v1=value[1];this.__v2=value[2];this.__v3=value[3];this.__change()}},pos:{get:function(){tri_quad_error(&quot;quad&quot;,&quot;pos&quot;)},set:function(value){tri_quad_error(&quot;quad&quot;,&quot;pos&quot;)}},color:{get:function(){tri_quad_error(&quot;quad&quot;,&quot;color&quot;)},set:function(value){tri_quad_error(&quot;quad&quot;,&quot;color&quot;)}},size:{get:function(){tri_quad_error(&quot;quad&quot;,&quot;size&quot;)},set:function(value){tri_quad_error(&quot;quad&quot;,&quot;size&quot;)}},axis:{get:function(){tri_quad_error(&quot;quad&quot;,&quot;axis&quot;)},set:function(value){tri_quad_error(&quot;quad&quot;,&quot;axis&quot;)}},up:{get:function(){tri_quad_error(&quot;quad&quot;,&quot;up&quot;)},set:function(value){tri_quad_error(&quot;quad&quot;,&quot;up&quot;)}},opacity:{get:function(){tri_quad_error(&quot;quad&quot;,&quot;opacity&quot;)},set:function(value){tri_quad_error(&quot;quad&quot;,&quot;opacity&quot;)}},shininess:{get:function(){tri_quad_error(&quot;quad&quot;,&quot;shininess&quot;)},set:function(value){tri_quad_error(&quot;quad&quot;,&quot;shininess&quot;)}},__prev_texture:null,__prev_bumpmap:null,__update:function(){this.__model.id_object[this.__id]=this},__get_extent:function(ext){var vnames=[&quot;__v0&quot;,&quot;__v1&quot;,&quot;__v2&quot;,&quot;__v3&quot;];for(var i=0;i&lt;4;i++)ext.point_extent(this,this[vnames[i]].pos)},rotate:function(args){throw new Error(&quot;A quad has no rotate method; rotate the vertices instead.&quot;)}});var compound_id=0;function compound(objects,parameters){if(!(this instanceof compound))return new compound(objects,parameters);parameters=parameters||{};if(objects.length===undefined)throw new Error(&quot;compound takes a list of objects&quot;);initObject(this,compound,parameters);var cloning=false;if(parameters.__cloning){cloning=true;var mesh=parameters.__cloning;delete parameters.__cloning}var visible=true;if(parameters!==undefined){for(var attr in parameters)this[attr]=parameters[attr];visible=parameters.visible===undefined?true:parameters.visible}function update_extent(c,extent){if(extent.__xmin===null)return;for(var ext in extent){var value=extent[ext];if(ext.slice(-3)==&quot;min&quot;){if(c[ext]===null||value&lt;c[ext])c[ext]=value}else{if(c[ext]===null||value&gt;c[ext])c[ext]=value}}}if(!cloning){var mesh=new Mesh;for(var i=0;i&lt;objects.length;i++){var o=objects[i];if(o instanceof arrow)throw new Error(&quot;Currently cannot include an arrow in a compound.&quot;);else if(o instanceof curve)throw new Error(&quot;Currently cannot include a curve in a compound.&quot;);else if(o instanceof helix)throw new Error(&quot;Currently cannot include a helix in a compound.&quot;);else if(o instanceof label)throw new Error(&quot;Currently cannot include a label in a compound.&quot;);if(o.__tex.file!==null)throw new Error(&quot;Currently objects in a compound cannot have their own texture.&quot;);if(o.__tex.bumpmap!==null)throw new Error(&quot;Currently objects in a compound cannot have their own bumpmap.&quot;);o.visible=false;o.__deleted=true;if(o instanceof triangle||o instanceof quad){var q=o.vs;for(var k=0;k&lt;3;k++){update_extent(this,mesh.merge(q[k],q[k],0));if(this.canvas.__vertices.object_info[q[k].__id][o.__id]!==undefined)delete this.canvas.__vertices.object_info[q[k].__id][o.__id];if(this.canvas.__vertices.object_info[q[k].__id]==={})this.canvas.__vertices.available.push(q[k].__id)}if(o instanceof quad){update_extent(this,mesh.merge(o.v0,o.v0,-3));update_extent(this,mesh.merge(o.v2,o.v2,-1));update_extent(this,mesh.merge(o.v3,o.v3,0));this.canvas.__vertices.available.push(o.v3.__id);if(this.canvas.__vertices.object_info[o.v3.__id]==={})this.canvas.__vertices.available.push(o.v3.__id)}}else if(o instanceof extrusion){for(var n=0;n&lt;o.__quads.length;n++){var p=o.__quads[n];q=p.vs;q.visible=false;q.__deleted=true;for(var k=0;k&lt;3;k++){update_extent(this,mesh.merge(q[k],q[k],0));if(this.canvas.__vertices.object_info[q[k].__id][p.__id]!==undefined)delete this.canvas.__vertices.object_info[q[k].__id][p.__id];</td>
      </tr>
      <tr>
        <td id="L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="LC13" class="blob-code blob-code-inner js-file-line">if(this.canvas.__vertices.object_info[q[k].__id]==={})this.canvas.__vertices.available.push(q[k].__id)}update_extent(this,mesh.merge(p.v0,p.v0,-3));update_extent(this,mesh.merge(p.v2,p.v2,-1));update_extent(this,mesh.merge(p.v3,p.v3,0));if(this.canvas.__vertices.object_info[p.v3.__id]==={})this.canvas.__vertices.available.push(p.v3.__id)}this.__texture=o.texture}else{update_extent(this,mesh.merge(o.getTransformedMesh(),o,0))}}this.__center=vec((this.__xmin+this.__xmax)/2,(this.__ymin+this.__ymax)/2,(this.__zmin+this.__zmax)/2);this.__pseudosize=vec(this.__xmax-this.__xmin,this.__ymax-this.__ymin,this.__zmax-this.__zmin);if(this.__original_height!==undefined){this.__height=this.__original_height;this.__descender=this.__original_descender;this.__original_pseudosize=this.__pseudosize}compound_id++;mesh.__mesh_id=&quot;compound&quot;+compound_id;this.canvas.__renderer.add_model(mesh,false)}this.__mesh=mesh;this.__model=this.canvas.__renderer.models[mesh.__mesh_id];this.visible=visible}subclass(compound,box);property.declare(compound.prototype,{origin:{get:function(){return this.__pos},set:function(value){this.pos=value}},text:{get:function(){return this.__text},set:function(value){throw new Error(&quot;text is read-only&quot;)}},font:{get:function(){return this.__font},set:function(value){throw new Error(&quot;font is read-only&quot;)}},align:{get:function(){return this.__align},set:function(value){throw new Error(&quot;align is read-only&quot;)}},billboard:{get:function(){return this.__billboard},set:function(value){throw new Error(&quot;billboard is read-only&quot;)}},height:{get:function(){return this.__height},set:function(value){this.__height=value;var k=value/this.__original_height;this.size.y=k;this.__descender=k*this.__original_descender}},length:{get:function(){return this.__pseudosize.x},set:function(value){this.size.x=value/this.__original_pseudosize.x;this.__pseudosize.x=value}},depth:{get:function(){return this.size.z*this.__depth},set:function(value){this.size.z=value/this.__depth}},descender:{get:function(){return this.__descender},set:function(value){throw new Error(&quot;descender is read-only&quot;)}},start:{get:function(){return this.upper_left.sub(this.up.norm().multiply(this.height))},set:function(value){throw new Error(&quot;start is read-only&quot;)}},end:{get:function(){return this.upper_right.sub(this.up.norm().multiply(this.height))},set:function(value){throw new Error(&quot;end is read-only&quot;)}},show_start_face:{get:function(){return this.__show_start_face},set:function(value){throw new Error(&quot;show_start_face is read-only&quot;)}},show_end_face:{get:function(){return this.__show_end_face},set:function(value){throw new Error(&quot;show_end_face is read-only&quot;)}},start_face_color:{get:function(){return this.__start_face_color},set:function(value){throw new Error(&quot;start_face_color is read-only&quot;)}},end_face_color:{get:function(){return this.__end_face_color},set:function(value){throw new Error(&quot;end_face_color is read-only&quot;)}},vertical_spacing:{get:function(){return 1.5*this.height},set:function(value){throw new Error(&quot;vertical_spacing is read-only&quot;)}},upper_left:{get:function(){var dx=0;if(this.__align==&quot;right&quot;)dx=-this.length;else if(this.__align==&quot;center&quot;)dx=-this.length/2;return this.pos.add(this.up.norm().multiply(this.height)).add(this.axis.norm().multiply(dx))},set:function(value){throw new Error(&quot;upper_left is read-only&quot;)}},upper_right:{get:function(){return this.upper_left.add(this.axis.norm().multiply(this.length))},set:function(value){throw new Error(&quot;upper_right is read-only&quot;)}},lower_left:{get:function(){return this.upper_left.add(this.up.norm().multiply(-this.height-this.descender-1.5*this.height*(this.__lines-1)))},set:function(value){throw new Error(&quot;lower_left is read-only&quot;)}},lower_right:{get:function(){return this.lower_left.add(this.axis.norm().multiply(this.length))},set:function(value){throw new Error(&quot;lower_right is read-only&quot;)}},clone:function(args){var newargs={pos:this.__pos,color:this.__color,opacity:this.__opacity,size:this.__size,axis:this.__axis,up:this.__up,shininess:this.__shininess,emissive:this.__emissive,visible:true,pickable:this.__pickable,__center:this.__center,__pseudosize:this.__pseudosize};if(this.texture.file!==null)newargs.texture=this.texture;for(var attr in args){newargs[attr]=args[attr]}newargs.__cloning=this.__mesh;return new this.constructor([],newargs)},_world_zaxis:function(){var axis=this.__axis;var up=this.__up;var z_axis;if(Math.abs(axis.dot(up))/Math.sqrt(up.mag2*axis.mag2)&gt;.98){if(Math.abs(axis.norm().dot(vec(-1,0,0)))&gt;.98){z_axis=axis.cross(vec(0,0,1)).norm()}else{z_axis=axis.cross(vec(-1,0,0)).norm()}}else{z_axis=axis.cross(up).norm()}return z_axis},world_to_compound:function(v){var axis=this.__axis;var z_axis=this._world_zaxis();var y_axis=z_axis.cross(axis).norm();var x_axis=axis.norm();var v=v.sub(this.__pos);return vec(v.dot(x_axis),v.dot(y_axis),v.dot(z_axis))},compound_to_world:function(v){var axis=this.__axis;var z_axis=this._world_zaxis();var y_axis=z_axis.cross(axis).norm();var x_axis=axis.norm();var v=v.sub(this.__pos);return this.__pos.add(x_axis.multiply(v.x)).add(y_axis.multiply(v.y)).add(z_axis.multiply(v.z))},__get_model:function(){return this.__model},__get_extent:function(ext){var savepos=this.__pos;var savesize=this.__size;var v=vec(this.__size.x*this.__center.x,this.__size.y*this.__center.y,this.__size.z*this.__center.z);var tpos=v.add(this.__pos);var tsize=vec(this.__size.x*this.__pseudosize.x,this.__size.y*this.__pseudosize.y,this.__size.z*this.__pseudosize.z);this.__pos=tpos;this.__pos.__x=tpos.x;this.__pos.__y=tpos.y;this.__pos.__z=tpos.z;this.__size=tsize;this.__size.__x=tsize.x;this.__size.__y=tsize.y;this.__size.__z=tsize.z;Autoscale.find_extent(this,ext);this.__pos=savepos;this.__size=savesize}});var toType=function(obj){return{}.toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};function curve(args){if(!(this instanceof curve)){return new curve(arguments)}args=args||{};if(args.canvas!==null){var iargs=[];if(arguments.length!==undefined)for(var i=0;i&lt;args.length;i++)iargs.push(args[i]);else for(var i=0;i&lt;arguments.length;i++)iargs.push(arguments[i]);this.__color=vec(1,1,1);this.__radius=0;this.__retain=-1;this.pickable=true;this.__points=[];if(iargs.length==1&amp;&amp;toType(iargs[0])==&quot;object&quot;){var obj=iargs[0];if(obj[&quot;texture&quot;]!==undefined)throw new Error(&quot;Textures are not available for curve objects.&quot;);if(obj[&quot;opacity&quot;]!==undefined)throw new Error(&quot;Opacity is not available for curve objects.&quot;);var haspos=false;if(obj[&quot;pos&quot;]!==undefined){haspos=true;this.__pos=obj.pos;delete obj.pos}initObject(this,curve,obj);if(haspos)this.push(this.__pos)}else{initObject(this,curve,{});if(toType(iargs)==&quot;array&quot;&amp;&amp;toType(iargs[0])==&quot;array&quot;)this.push(iargs[0]);else this.push(iargs)}}}subclass(curve,Primitive);property.declare(curve.prototype,{origin:new attributeVectorPos(null,0,0,0),pos:{get:function(){throw new Error(&quot;Use methods to read curve or points pos attribute.&quot;)},set:function(value){throw new Error(&quot;Use methods to change curve or points pos attribute.&quot;)}},radius:{get:function(){return this.__radius},set:function(value){this.__radius=value;this.__change()}},retain:{get:function(){return this.__retain},set:function(value){this.__retain=value;this.__change()}},npoints:{get:function(){return this.__points.length},set:function(value){throw new Error(&quot;Cannot change curve or points npoints.&quot;)}},__no_autoscale:false,__get_extent:function(ext){if(this.__no_autoscale)return;var xmin=null,ymin=null,zmin=null,xmax=null,ymax=null,zmax=null;var length=this.__points.length;var pnt=this.__points;var p;for(var i=0;i&lt;length;i++){p=pnt[i].__pos;if(xmin===null||p.x&lt;xmin)xmin=p.x;if(ymin===null||p.y&lt;ymin)ymin=p.y;if(zmin===null||p.z&lt;zmin)zmin=p.z;if(xmax===null||p.x&gt;xmax)xmax=p.x;if(ymax===null||p.y&gt;ymax)ymax=p.y;if(zmax===null||p.z&gt;zmax)zmax=p.z}var center=vec((xmin+xmax)/2,(ymin+ymax)/2,(zmin+zmax)/2);var pseudosize=vec(xmax-xmin,ymax-ymin,zmax-zmin);var savepos=this.__pos,savesize=this.__size;var v=vec(this.__size.x*center.x,this.__size.y*center.y,this.__size.z*center.z);var tpos=v.add(this.__pos);var tsize=vec(this.__size.x*pseudosize.x,this.__size.y*pseudosize.y,this.__size.z*pseudosize.z);this.__pos=tpos;this.__pos.__x=tpos.x;this.__pos.__y=tpos.y;this.__pos.__z=tpos.z;this.__size=tsize;this.__size.__x=tsize.x;this.__size.__y=tsize.y;this.__size.__z=tsize.z;ext.xmin=xmin;ext.xmax=xmax;ext.ymin=ymin;ext.ymax=ymax;ext.zmin=zmin;ext.zmax=zmax;Autoscale.find_extent(this,ext);this.__pos=savepos;this.__size=savesize},push:function(pts){var args=[];var pos;if(pts.length!==undefined){if(pts.length==1)args=pts[0];else args=pts}else for(var i=0;i&lt;arguments.length;i++)args.push(arguments[i]);var pointarg={};var attrs=[&quot;color&quot;,&quot;radius&quot;,&quot;retain&quot;,&quot;visible&quot;];for(var a in attrs){var attr=attrs[a];if(attr==&quot;radius&quot;&amp;&amp;attr in args&amp;&amp;this.constructor==points)throw new Error(&quot;In a points object, you cannot specify the radius of an individual point.&quot;);if(attr in args)pointarg[attr]=args[attr]}var argtype=toType(args);var objects=false;if(args instanceof vec)args=[{pos:args}];else if(argtype==&quot;array&quot;){if(args[0]instanceof vec)args=[{pos:args}];else if(toType(args[0])==&quot;object&quot;)objects=true}else if(argtype==&quot;object&quot;)args=[args];for(var i=0;i&lt;args.length;i++){var obj=args[i];pos=obj;if(&quot;pos&quot;in obj){pos=obj.pos}if(toType(pos)!=&quot;array&quot;)pos=[pos];for(var j=0;j&lt;pos.length;j++){var p=pos[j];if(toType(p)==&quot;array&quot;)p=vec(p[0],p[1],p[2]);var setup;if(objects){setup=obj;setup.pos=p}else{setup={pos:p};for(var a in pointarg){setup[a]=pointarg[a]}}if(this.constructor==curve){var pt=point(setup);var retain=this.__retain;if(setup.retain!==undefined)retain=setup.retain;if(retain&gt;-1&amp;&amp;this.__points.length&gt;=retain){var N=this.__points.length-retain;for(var d=0;d&lt;N;d++){var first=this.__points.shift();first.visible=false}var prev=this.__points[this.__points.length-1];var pt=this.__points.shift();for(var a in setup)pt[a]=setup[a];this.__points.push(pt);var s=pt.__prevsegment=prev.__nextsegment=new Float32Array(16);s[11]=s[15]=1;prev.__change();pt.__change()}else{pt.__curve=this;pt.__id=nextVisibleId++;this.canvas.__visiblePrimitives[pt.__id]=pt;pt.__falsecolor=id_to_falsecolor(pt.__id);if(this.__points.length){var prev=this.__points[this.__points.length-1];var s=pt.__prevsegment=prev.__nextsegment=new Float32Array(16);s[11]=s[15]=1;prev.__change()}this.__points.push(pt);pt.__change()}}else{var retain=this.__retain;if(setup.retain!==undefined)retain=setup.retain;if(retain&gt;-1&amp;&amp;this.__points.length&gt;=retain){var N=this.__points.length-retain;for(var d=0;d&lt;N;d++){var first=this.__points.shift();first.visible=false}var prev=this.__points[this.__points.length-1];var pt=this.__points.shift();for(var a in setup)pt[a]=setup[a];this.__points.push(pt);pt.__change()}else{var D=2*this.__radius;var c=setup.color===undefined?this.__color:setup.color;if(this.__points.length&gt;0&amp;&amp;this.__last_range!=-1&amp;&amp;this.__last_range===this.canvas.__range){D=this.__points[0].__size.x}else{D=0;this.__last_range=-1}if(window.__GSlang==&quot;vpython&quot;){this.__points.push(vp_sphere({pos:setup.pos,size:vec(D,D,D),color:c,pickable:false}))}else{this.__points.push(sphere({pos:setup.pos,size:vec(D,D,D),color:c,pickable:false}))}}}}}this.__change()},append:function(pts){var args=[];if(pts.length!==undefined)args=pts;else for(var i=0;i&lt;arguments.length;i++)args.push(arguments[i]);this.push(args)},pop:function(){var p=this.__points.pop();p.visible=false;this.__change();return{pos:p.pos,color:p.color,radius:p.radius,visible:p.visible}},point:function(N){var p=this.__points.slice(N,N+1)[0];return{pos:p.pos,color:p.color,radius:p.radius,visible:p.visible}},clear:function(){this.splice(0,this.__points.length);this.__points=[];this.__change()},shift:function(){var p=this.__points.shift();p.visible=false;this.__change();return{pos:p.pos,color:p.color,radius:p.radius,visible:p.visible}},unshift:function(args){var pts=[];if(args.length!==undefined)pts=args;else for(var i=0;i&lt;arguments.length;i++)pts.push(arguments[i]);this.splice(0,0,pts);this.__change()},splice:function(args){var index=arguments[0];var howmany=arguments[1];var pts=[];for(var i=2;i&lt;arguments.length;i++)pts.push(arguments[i]);if(pts.length==1&amp;&amp;pts[0].length!==undefined)pts=pts[0];var s=this.__points.slice(index+howmany);var t=[];for(var i=0;i&lt;s.length;i++)t.push({pos:s[i].pos,color:s[i].color,radius:s[i].radius,visible:s[i].visible});for(var i=index;i&lt;this.__points.length;i++)this.__points[i].visible=false;this.__points.splice(index);this.push(pts);this.push(t);this.__change()},modify:function(N,args){if(N&lt;0)N+=this.__points.length;if(args instanceof vec)args={pos:args};for(var attr in args){if(attr==&quot;x&quot;)this.__points[N].pos.x=args[attr];else if(attr==&quot;y&quot;)this.__points[N].pos.y=args[attr];else if(attr==&quot;z&quot;)this.__points[N].pos.z=args[attr];else this.__points[N][attr]=args[attr]}this.__points[N].__change();this.__change()},slice:function(start,end){if(start&lt;0)start+=this.__points.length;if(end&lt;0)end+=this.__points.length;var s=this.__points.slice(start,end);var t=[];for(var i=0;i&lt;s.length;i++)t.push({pos:s[i].pos,color:s[i].color,radius:s[i].radius,visible:s[i].visible});return t},__update:function(){var origin=this.__origin;var size=this.__size;var color=this.__color;var axis=this.__axis;var up=this.__up;var data=this.__data;if(!data)this.__data=data=new Float32Array(20);this.__model.id_object[this.__id]=this;data[0]=origin.__x;data[1]=origin.__y;data[2]=origin.__z;data[3]=this.__shininess;data[4]=axis.__x;data[5]=axis.__y;data[6]=axis.__z,data[7]=this.__emissive?1:0;data[8]=up.__x;data[9]=up.__y;data[10]=up.__z;data[12]=size.__x;data[13]=size.__y;data[14]=size.__z;data[15]=this.__radius;data[16]=color.__x;data[17]=color.__y;data[18]=color.__z;data[19]=this.__opacity}});function point(args){if(!(this instanceof point))return new point(args);if(args instanceof vec)args={pos:args};for(var id in args)this[id]=args[id];if(this.pos===undefined)throw new Error(&quot;Must specify pos for a point on a curve&quot;)}property.declare(point.prototype,{__curve:null,pos:new attributeVector(null,0,0,0),color:new attributeVector(null,-1,-1,-1),pickable:{value:true,onchanged:function(){this.__change()}},visible:{value:true,onchanged:function(){this.__change()}},__change:function(){if(this.__id){this.__curve.canvas.__changed[this.__id]=this;this.__curve.canvas.__changed[this.__curve.__id]=this.__curve}},__update:function(){var pos=this.__pos;var radius=this.radius||-1;var color=this.color||vec(-1,-1,-1);var s=this.__prevsegment;if(s){s[4]=pos.x;s[5]=pos.y;s[6]=pos.z;s[7]=radius;s[12]=color.x;s[13]=color.y;s[14]=color.z}s=this.__nextsegment;if(s){s[0]=pos.x;s[1]=pos.y;s[2]=pos.z;s[3]=radius;s[8]=color.x;s[9]=color.y;s[10]=color.z}}});function points(iargs){if(!(this instanceof points)){return new points(arguments)}iargs=iargs||{};if(iargs.canvas!==null){if(iargs[&quot;texture&quot;]!==undefined)throw new Error(&quot;Textures are not available for points objects.&quot;);if(iargs[&quot;opacity&quot;]!==undefined)throw new Error(&quot;Opacity is not available for points objects.&quot;);var saveargs=[];if(arguments.length!==undefined)for(var i=0;i&lt;iargs.length;i++)saveargs.push(iargs[i]);else for(var i=0;i&lt;arguments.length;i++)saveargs.push(arguments[i]);this.__color=vec(1,1,1);this.__radius=0;this.__retain=-1;this.__pixels=true;this.__points=[];this.pickable=false;if(toType(saveargs)==&quot;array&quot;&amp;&amp;saveargs.length==1&amp;&amp;toType(saveargs[0])==&quot;object&quot;){var obj=saveargs[0];if(obj[&quot;texture&quot;]!==undefined)throw new Error(&quot;Textures are not available for points objects.&quot;);if(obj[&quot;opacity&quot;]!==undefined)throw new Error(&quot;Opacity is not available for points objects.&quot;);var haspos=false;if(obj[&quot;pos&quot;]!==undefined){haspos=true;this.__pos=obj.pos;delete obj.pos}if(obj.size_units!==undefined){if(obj.size_units==&quot;world&quot;)this.__pixels=false;delete obj.size_units}initObject(this,points,obj);if(haspos)this.push(this.__pos)}else{initObject(this,points,{});if(toType(saveargs)==&quot;array&quot;&amp;&amp;toType(saveargs[0])==&quot;array&quot;)this.push(saveargs[0]);else this.push(saveargs)}this.__last_range=-1;this.canvas.__points_objects.push(this)}}subclass(points,curve);property.declare(points.prototype,{origin:{get:function(){throw new Error(&quot;The points object has no origin attribute.&quot;)},set:function(value){throw new Error(&quot;The points object has no origin attribute.&quot;)}},axis:{get:function(){throw new Error(&quot;The points object has no axis attribute.&quot;)},set:function(value){throw new Error(&quot;The points object has no axis attribute.&quot;)}},up:{get:function(){throw new Error(&quot;The points object has no up attribute.&quot;)},set:function(value){throw new Error(&quot;The points object has no up attribute.&quot;)}},size:{get:function(){throw new Error(&quot;The points object has no size attribute.&quot;)},set:function(value){throw new Error(&quot;The points object has no size attribute.&quot;)}},size_units:{get:function(){return this.__pixels?&quot;pixels&quot;:&quot;world&quot;},set:function(value){if(value==&quot;pixels&quot;)this.__pixels=true;else if(value==&quot;world&quot;)this.__pixels=false;else throw new Error(&quot;The points object &quot;)}},shape:{get:function(){return&quot;round&quot;},set:function(value){if(value!=&quot;round&quot;)throw new Error(&#39;The points object only supports shape = &quot;round&quot;.&#39;)}},visible:{get:function(){return this.__visible},set:function(value){for(var p in this.__points){this.__points[p].visible=value}this.__visible=value}},__update:function(){}});function helix(args){return initObject(this,helix,args)}subclass(helix,cylinder);property.declare(helix.prototype,{__initialize:true,thickness:{value:0,onchanged:function(){this.__change()}},coils:{value:5,onchanged:function(){this.__initialize=true;this.__change()}},__update:function(){var NCHORDS=20;if(this.__initialize){if(this.__curve!==undefined){this.__curve.clear()}else{this.__curve=curve({canvas:this.canvas,__no_autoscale:true})}}var c=this.__curve;c.origin=this.__pos;c.axis=this.__axis;c.up=this.__up;c.size=this.__size;c.color=this.__color;c.radius=this.__thickness?this.__thickness/2:this.__size.y/40;if(!this.__initialize)return;var X=vec(1,0,0);var Y=vec(0,1,0);var Z=vec(0,0,1);var r=.5;var count=this.__coils*NCHORDS;var dx=1/count;var ds=Math.sin(2*Math.PI/NCHORDS),dc=Math.cos(2*Math.PI/NCHORDS);var x=0,y=0,z=r;var znew;for(var i=0;i&lt;count+1;i++){c.push(vec(x,y,z));x+=dx;znew=z*dc-y*ds;y=y*dc+z*ds;z=znew}this.__initialize=false}});function vp_helix(args){return initObject(this,vp_helix,args)}subclass(vp_helix,helix);property.declare(vp_helix.prototype,{axis:new attributeVectorAxis(null,1,0,0),size:new attributeVectorSize(null,1,2,2),radius:{get:function(){return this.__size.__y/2},set:function(value){this.__size.__y=this.__size.__z=2*value;this.__change()}},length:{get:function(){return this.__size.__x},set:function(value){this.__size.__x=value;this.__change()}},height:{get:function(){return this.__size.__y},set:function(value){this.__size.__y=value;this.__change()}},width:{get:function(){return this.__size.__z},set:function(value){this.__size.__z=value;this.__change()}}});function arrayequals(a,b){var La=a.length;var Lb=b.length;if(La!==Lb)return false;for(var i=0;i&lt;La;i++)if(a[i]!==b[i])return false;return true}function ring(args){return initObject(this,ring,args)}subclass(ring,box);property.declare(ring.prototype,{size:new attributeVector(null,.1,1,1)});function vp_ring(args){return initObject(this,vp_ring,args)}subclass(vp_ring,vp_box);property.declare(vp_ring.prototype,{axis:new attributeVector(null,1,0,0),size:new attributeVector(null,.2,2.2,2.2),thickness:{get:function(){return this.__size.__x/2},set:function(value){var R1=this.radius;this.__thickness=value;this.__size.x=2*value;this.__size.y=this.__size.z=2*(value+R1);this.__change()}},radius:{get:function(){return(this.__size.y-this.__size.x)/2},set:function(value){var R2=this.thickness;this.__radius=value;this.__size.y=this.__size.z=2*(value+R2);this.__change()}}});function distant_light(args){if(!(this instanceof distant_light))return new distant_light(args);if(args.direction===undefined)throw new Error(&quot;Must specify the distant_light, direction:..&quot;);init(this,args);this.canvas.lights.push(this)}property.declare(distant_light.prototype,{direction:new attributeVector(null,0,0,1),color:new attributeVector(null,1,1,1),__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__change:function(){}});function local_light(args){if(!(this instanceof local_light))return new local_light(args);if(args.pos===undefined)throw new Error(&quot;Must specify the local_light position, pos:..&quot;);init(this,args);this.canvas.lights.push(this)}property.declare(local_light.prototype,{pos:new attributeVector(null,0,0,0),color:new attributeVector(null,1,1,1),__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__change:function(){}});function draw(args){if(!(this instanceof draw))return new draw(args);args=args||{};this.points=[];init(this,args);this.canvas.__overlay_objects.objects.push(this)}property.declare(draw.prototype,{color:{value:null,type:property.nullable_attributeVector},fillcolor:{value:null,type:property.nullable_attributeVector},linewidth:{value:1,onchanged:function(){this.__change()}},opacity:{value:.66,onchanged:function(){this.__change()}},visible:{value:false,onchanged:function(){this.__change()}},__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__update:function(ctx,camera){var pts=this.points.length;if(pts&lt;2)return;if(this.fillcolor!=null){ctx.lineWidth=1;ctx.fillStyle=color.to_html_rgba(this.fillcolor,this.opacity);ctx.beginPath();for(var i=0;i&lt;pts;i++){if(i==0)ctx.moveTo(this.points[i].x,this.points[i].y);else ctx.lineTo(this.points[i].x,this.points[i].y)}ctx.fill()}if(this.color!=null){ctx.lineWidth=this.linewidth;ctx.strokeStyle=color.to_html_rgba(this.color,this.opacity);ctx.beginPath();for(var i=0;i&lt;pts;i++){if(i==0)ctx.moveTo(this.points[i].x,this.points[i].y);else if(i==pts-1&amp;&amp;this.points[i].equals(this.points[0]))ctx.closePath();else ctx.lineTo(this.points[i].x,this.points[i].y)}ctx.stroke()}},__change:function(){this.canvas.__overlay_objects.__changed=true}});function label(args){if(!(this instanceof label))return new label(args);args=args||{};this.pos=this.pos;this.color=this.color;init(this,args);this.canvas.__overlay_objects.objects.push(this)}property.declare(label.prototype,{pos:new attributeVector(null,0,0,0),color:{value:null,type:property.nullable_attributeVector},line:{value:true,onchanged:function(){this.__change()}},linecolor:{value:null,type:property.nullable_attributeVector},background:{value:null,type:property.nullable_attributeVector},opacity:{value:.66,onchanged:function(){this.__change()}},text:{value:&quot;&quot;,onchanged:function(){this.__change()}},font:{value:&quot;Arial&quot;,onchanged:function(){this.__change()}},height:{value:15,onchanged:function(){this.__change()}},visible:{value:false,onchanged:function(){this.__change()}},align:{value:null,onchanged:function(){this.__change()}},box:{value:true,onchanged:function(){this.__change()}},border:{value:5,onchanged:function(){this.__change()}},linewidth:{value:1,onchanged:function(){this.__change()}},xoffset:{value:0,onchanged:function(){this.__change()}},yoffset:{value:0,onchanged:function(){this.__change()}},space:{value:0,onchanged:function(){this.__change()}},pixel_pos:{value:false,onchanged:function(){this.__change()}},__get_model:function(){return null},__update:function(ctx,camera){var xoffset=this.__xoffset,yoffset=this.__yoffset;var posx,posy;if(this.__pixel_pos){posx=this.__pos.x;posy=this.canvas.__height-this.__pos.y;yoffset=-yoffset}else{if(this.canvas.__width&gt;=this.canvas.__height)var factor=2*this.canvas.__range/this.canvas.__height;else var factor=2*this.canvas.__range/this.canvas.__width;var viewMatrix=mat4.lookAt(camera.pos,camera.target,camera.up);var vnew=mat4.multiplyVec3(viewMatrix,vec3.create([this.pos.x,this.pos.y,this.pos.z]));if(vnew[2]&gt;-camera.zNear||vnew[2]&lt;-camera.zFar)return;var d=camera.distance;var k=-d/(vnew[2]*factor);posx=Math.round(k*vnew[0]+this.canvas.__width/2);posy=Math.round(-k*vnew[1]+this.canvas.__height/2)}var h=this.__height;var f=this.__font;if(this.__font==&quot;Verdana&quot;)h*=13/15;else if(this.__font==&quot;sans&quot;)f=&quot;Arial&quot;;else if(this.__font==&quot;serif&quot;)f=&quot;Georgia&quot;;ctx.font=h+&quot;px &quot;+f;ctx.textAlign=&quot;left&quot;;ctx.textBaseline=&quot;middle&quot;;ctx.lineWidth=this.__linewidth;var default_color=vec(1,1,1);if(this.canvas.__background.equals(vec(1,1,1)))default_color=vec(0,0,0);ctx.strokeStyle=color.to_html(this.__linecolor||this.__color||default_color);var lines,nlines;var dh=1.2*this.__height;var upperchar=.4*this.__height;if(typeof this.__text===&quot;string&quot;)lines=this.__text.split(&quot;\n&quot;);else lines=[print_to_string(this.__text)];nlines=lines.length;var height=this.__height+(nlines-1)*dh;var width=0;var linewidths=[];for(var nth=0;nth&lt;nlines;nth++){var w=Math.ceil(ctx.measureText(lines[nth]).width);linewidths.push(w);if(w&gt;width)width=w}var tstart=[];for(var nth=0;nth&lt;nlines;nth++){switch(this.__align){case null:if(xoffset===0&amp;&amp;yoffset===0)tstart.push((width-linewidths[nth])/2);else{if(Math.abs(yoffset)&gt;Math.abs(xoffset)){tstart.push((width-linewidths[nth])/2)}else{if(xoffset&gt;0){tstart.push(0)}else if(xoffset&lt;0){tstart.push(width-linewidths[nth])}}}break;case&quot;center&quot;:tstart.push((width-linewidths[nth])/2);break;case&quot;right&quot;:tstart.push(width-linewidths[nth]);break;case&quot;left&quot;:tstart.push(0);break;default:throw new Error(&#39;Label align must be &quot;center&quot; or &quot;left&quot; or &quot;right&quot;.&#39;)}}var xbase;var ybase;var border=this.__border;if(xoffset||yoffset){if(Math.abs(yoffset)&gt;Math.abs(xoffset)){if(yoffset&gt;0){xbase=posx+xoffset-width/2;ybase=posy-yoffset-height-border+upperchar}else{xbase=posx+xoffset-width/2;ybase=posy-yoffset+border+upperchar}}else if(Math.abs(xoffset)&gt;0){ybase=posy-yoffset-height/2+upperchar;if(xoffset&gt;0){xbase=posx+xoffset+border}else if(xoffset&lt;0){xbase=posx+xoffset-width-border}}}else{ybase=posy;switch(this.__align){case null:case&quot;center&quot;:xbase=posx-width/2;break;case&quot;right&quot;:xbase=posx-width;break;case&quot;left&quot;:xbase=posx;break}}var bcolor;if(this.__background==null)bcolor=this.canvas.__background;else bcolor=this.__background;ctx.fillStyle=color.to_html_rgba(bcolor,this.__opacity);ctx.fillRect(xbase-border,ybase-upperchar-border,width+2*border,height+2*border);if((xoffset||yoffset)&amp;&amp;this.__line){ctx.beginPath();if(this.space&gt;0){var v=vec(xoffset,-yoffset,0).norm().multiply(this.space);v=v.add(vec(posx,posy,0));ctx.moveTo(v.x,v.y)}else ctx.moveTo(posx,posy);ctx.lineTo(posx+xoffset,posy-yoffset);ctx.stroke()}if(this.__box){ctx.beginPath();ctx.moveTo(xbase-border,ybase-upperchar-border);ctx.lineTo(xbase+width+border,ybase-upperchar-border);ctx.lineTo(xbase+width+border,ybase-upperchar+height+border);ctx.lineTo(xbase-border,ybase-upperchar+height+border);ctx.closePath();ctx.stroke()}ctx.fillStyle=color.to_html(this.__color||default_color);for(var nth=0;nth&lt;nlines;nth++){var x=xbase+tstart[nth];var y=ybase+dh*nth;ctx.fillText(lines[nth],x,y)}},__change:function(){if(this.canvas!==undefined)this.canvas.__overlay_objects.__changed=true}});function attach_trail(objectOrFunction,options){if(!(this instanceof attach_trail))return new attach_trail(objectOrFunction,options);if(options===undefined)options={};this.__options={};this.__obj=objectOrFunction;if(options.canvas!==undefined)this.canvas=options.canvas;else this.canvas=canvas.selected;var radius=0;if(options.type===undefined){this.type=&quot;curve&quot;}else{switch(options.type){case&quot;curve&quot;:this.type=options.type;break;case&quot;spheres&quot;:case&quot;points&quot;:this.type=&quot;points&quot;;this.__options[&quot;size_units&quot;]=&quot;world&quot;;break;default:throw new Error(&quot;attach_trail type must be &#39;curve&#39; or &#39;points&#39; (or &#39;spheres&#39;)&quot;)}}if(typeof objectOrFunction!==&quot;function&quot;&amp;&amp;typeof objectOrFunction!==&quot;string&quot;){this.canvas=objectOrFunction.canvas;this.__options[&quot;color&quot;]=objectOrFunction.color;if(options.radius===undefined){if(this.type==&quot;points&quot;)radius=.1*objectOrFunction.size.y}else radius=options.radius}else{if(options.radius!==undefined)radius=options.radius}this.__options[&quot;radius&quot;]=this.__radius=radius;this.__options[&quot;canvas&quot;]=this.canvas;if(options.color!==undefined){this.__options[&quot;color&quot;]=options.color}this.__options[&quot;retain&quot;]=-1;if(options.retain!==undefined){this.__options[&quot;retain&quot;]=options.retain}this.pps=0;if(options.pps!==undefined){this.pps=options.pps}this.__options[&quot;pickable&quot;]=false;var send={};for(var a in this.__options)send[a]=this.__options[a];if(this.type==&quot;curve&quot;)this.__trail=curve(send);else this.__trail=points(send);this.__trails=[this.__trail];this.canvas.trails.push(this);this.__last_pos=null;this.__last_time=null;this.__run=true;this.__elements=0}property.declare(attach_trail.prototype,{color:{get:function(){return this.__options.color},set:function(value){this.__options.color=value}},radius:{get:function(){return this.__options.radius},set:function(value){this.__options.radius=value}},retain:{get:function(){return this.__options.retain},set:function(value){this.__options.retain=value}},start:function(){this.__run=true;var send={};for(var a in this.__options)send[a]=this.__options[a];if(this.type===&quot;curve&quot;)this.__trail=curve(send);else this.__trail=points(send);this.__trails.push(this.__trail)},stop:function(){this.__run=false},clear:function(){this.__last_pos=null;this.__last_time=null;this.__elements=0;for(var i=0;i&lt;this.__trails.length;i++)this.__trails[i].clear();if(typeof this.__obj!==&quot;function&quot;)this.__obj.__ninterval=0}});function attach_arrow(obj,attr,options){if(!(this instanceof attach_arrow))return new attach_arrow(obj,attr,options);if(options===undefined)options={};if(options.canvas===undefined)options.canvas=obj.canvas;this.obj=obj;this.attr=attr;this.scale=1;if(options.scale!==undefined){this.scale=options.scale;delete options.scale}if(options.color===undefined)options.color=obj.color;this.options=options;var thiscanvas=options.canvas;if(window.__GSlang==&quot;vpython&quot;)this.arrow=vp_arrow(this.options);else this.arrow=arrow(this.options);this.arrow.visible=false;this.arrow.pickable=false;this.last_pos=null;this.run=true;this.shaftwidth=this.arrow.shaftwidth;this.color=this.arrow.color;thiscanvas.arrows.push(this);this.start=function(){this.arrow.visible=this.run=true};this.stop=function(){this.arrow.visible=this.run=false}}function text(args){return text3D(args)}function rgb_to_css(c){var r=Math.floor(255*c.x).toString();var g=Math.floor(255*c.y).toString();var b=Math.floor(255*c.z).toString();return&quot;rgb(&quot;+r+&quot;,&quot;+g+&quot;,&quot;+b+&quot;)&quot;}var widgetid=0;function radio(args){if(!(this instanceof radio))return new radio(args);var cvs=canvas.get_selected();var attrs={pos:cvs.caption_anchor,checked:false,text:&quot;&quot;};if(args.bind!==undefined){attrs.bind=args.bind;delete args.bind}else throw new Error(&quot;A radio button must have a bind attribute.&quot;);for(a in attrs){if(args[a]!==undefined){attrs[a]=args[a];delete args[a]}}attrs.jradio=$(&#39;&lt;input type=&quot;radio&quot;/&gt;&#39;).css({width:&quot;16px&quot;,height:&quot;16px&quot;}).appendTo(attrs.pos).click(function(){attrs.checked=!attrs.checked;$(attrs.jradio).prop(&quot;checked&quot;,attrs.checked);attrs.bind(cradio)});widgetid++;attrs._id=widgetid.toString();$(&quot;&lt;span id=&quot;+attrs._id+&quot;&gt; &quot;+attrs.text+&quot;&lt;/span&gt;&quot;).appendTo(attrs.pos);var cradio={get checked(){return attrs.checked},set checked(value){attrs.checked=value;$(attrs.jradio).prop(&quot;checked&quot;,value)},get text(){return attrs.text},set text(value){attrs.text=value;$(&quot;#&quot;+attrs.id).text(&quot; &quot;+value)}};for(var a in args){cradio[a]=args[a]}cradio.checked=attrs.checked;return cradio}function checkbox(args){if(!(this instanceof checkbox))return new checkbox(args);var cvs=canvas.get_selected();var attrs={pos:cvs.caption_anchor,checked:false,text:&quot;&quot;};if(args.bind!==undefined){attrs.bind=args.bind;delete args.bind}else throw new Error(&quot;A checkbox must have a bind attribute.&quot;);for(a in attrs){if(args[a]!==undefined){attrs[a]=args[a];delete args[a]}}attrs.jcheckbox=$(&#39;&lt;input type=&quot;checkbox&quot;/&gt;&#39;).css({width:&quot;16px&quot;,height:&quot;16px&quot;}).appendTo(attrs.pos).click(function(){attrs.checked=!attrs.checked;$(attrs.jcheckbox).prop(&quot;checked&quot;,attrs.checked);attrs.bind(ccheckbox)});widgetid++;attrs._id=widgetid.toString();$(&quot;&lt;span id=&quot;+attrs._id+&quot;&gt; &quot;+attrs.text+&quot;&lt;/span&gt;&quot;).appendTo(attrs.pos);var ccheckbox={get checked(){return attrs.checked</td>
      </tr>
      <tr>
        <td id="L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="LC14" class="blob-code blob-code-inner js-file-line">},set checked(value){attrs.checked=value;$(attrs.jcheckbox).prop(&quot;checked&quot;,value)},get text(){return attrs.text},set text(value){attrs.text=value;$(&quot;#&quot;+attrs.id).text(&quot; &quot;+value)}};for(var a in args){ccheckbox[a]=args[a]}ccheckbox.checked=attrs.checked;return ccheckbox}function button(args){if(!(this instanceof button))return new button(args);var cvs=canvas.get_selected();var attrs={pos:cvs.caption_anchor,text:&quot; &quot;,textcolor:vec(0,0,0),background:vec(1,1,1),disabled:false};if(args.bind!==undefined){attrs.bind=args.bind;delete args.bind}else throw new Error(&quot;A button must have a bind attribute.&quot;);for(a in attrs){if(args[a]!==undefined){attrs[a]=args[a];delete args[a]}}attrs.jbutton=$(&quot;&lt;button/&gt;&quot;).html(attrs.text).appendTo(attrs.pos).css({color:rgb_to_css(attrs.textcolor),backgroundColor:rgb_to_css(attrs.background),&quot;font-size&quot;:&quot;15px&quot;}).click(function(){attrs.bind(cbutton)});$(attrs.pos).append(&quot; &quot;);var cbutton={get disabled(){return attrs.disabled},set disabled(value){if(value===0)value=false;else if(value==1)value=true;attrs.disabled=value;$(attrs.jbutton).attr(&quot;disabled&quot;,attrs.disabled);if(attrs.disabled)$(attrs.jbutton).css({color:rgb_to_css(vec(.7,.7,.7)),backgroundColor:rgb_to_css(vec(1,1,1))});else $(attrs.jbutton).css({color:rgb_to_css(attrs.textcolor),backgroundColor:rgb_to_css(attrs.background)})},get text(){return attrs.text},set text(value){attrs.text=value;$(attrs.jbutton).html(attrs.text)},get textcolor(){return attrs.textcolor},set textcolor(value){attrs.textcolor=value;$(attrs.jbutton).css({color:rgb_to_css(attrs.textcolor)})},get background(){return attrs.background},set background(value){attrs.background=value;$(attrs.jbutton).css({backgroundColor:rgb_to_css(attrs.background)})}};for(var a in args){cbutton[a]=args[a]}cbutton.disabled=attrs.disabled;return cbutton}var slider_id=0;function slider(args){if(!(this instanceof slider))return new slider(args);var cvs=canvas.get_selected();var attrs={pos:cvs.caption_anchor,length:400,width:10,vertical:false,min:0,max:1,align:&quot;left&quot;,left:0,right:0,top:0,bottom:0};if(args.bind!==undefined){attrs.bind=args.bind;delete args.bind}else throw new Error(&quot;A slider must have a bind attribute.&quot;);for(a in attrs){if(args[a]!==undefined){attrs[a]=args[a];delete args[a]}}attrs.step=.001*(attrs.max-attrs.min);if(args.step!==undefined){attrs.step=args.step;delete args.step}attrs.value=attrs.min;if(args.value!==undefined){attrs.value=args.value;delete args.value}attrs._id=&quot;s&quot;+slider_id;slider_id+=1;var m=attrs.top+&quot;px &quot;+attrs.right+&quot;px &quot;+attrs.bottom+&quot;px &quot;+attrs.left+&quot;px&quot;;var o=&quot;horizontal&quot;;var w=attrs.length;var h=attrs.width;if(attrs.vertical){o=&quot;vertical&quot;;w=attrs.width;h=attrs.length}$(&quot;&lt;span id=&quot;+attrs._id+&quot;&gt;&lt;/span&gt;&quot;).css({width:w,height:h,&quot;float&quot;:attrs.align,margin:m}).appendTo(attrs.pos);attrs.jslider=$(&quot;#&quot;+attrs._id).slider({orientation:o,range:&quot;min&quot;,min:attrs.min,max:attrs.max,value:attrs.value,step:attrs.step,change:function(evt){if(evt.originalEvent!==undefined)attrs.bind(cslider)},slide:function(evt){if(evt.originalEvent!==undefined)attrs.bind(cslider)}});var cslider={get min(){return attrs.min},set min(value){throw new Error(&quot;Cannot change the min of an existing slider.&quot;)},get max(){return attrs.max},set max(value){throw new Error(&quot;Cannot change the max of an existing slider.&quot;)},get value(){return $(attrs.jslider).slider(&quot;value&quot;)},set value(val){$(attrs.jslider).slider(&quot;value&quot;,val)},get width(){return attrs.width},set width(value){throw new Error(&quot;Cannot change the width of an existing slider.&quot;)},get length(){return attrs.length},set length(value){throw new Error(&quot;Cannot change the length of an existing slider.&quot;)}};for(var a in args){cslider[a]=args[a]}return cslider}function menu(args){if(!(this instanceof menu))return new menu(args);var cvs=canvas.get_selected();var attrs={pos:cvs.caption_anchor,selected:null};if(args.bind!==undefined){attrs.bind=args.bind;delete args.bind}else throw new Error(&quot;A menu must have a bind attribute.&quot;);if(args.pos!==undefined){attrs.pos=args.pos;delete args.pos}if(args.choices!==undefined){attrs.choices=args.choices;delete args.choices}else throw new Error(&quot;A menu must have a a list of choices.&quot;);if(args.selected!==undefined){attrs.selected=args.selected;delete args.selected}var s=&quot;&quot;;for(var i=0;i&lt;attrs.choices.length;i++){var cc=attrs.choices[i];if(cc===attrs.selected)s+=&#39;&lt;option selected=&quot;selected&quot;&gt;&#39;+cc+&quot;&lt;/option&gt;\n&quot;;else s+=&quot;&lt;option&gt;&quot;+cc+&quot;&lt;/option&gt;\n&quot;}attrs.jmenu=$(&quot;&lt;select&gt;&quot;+s+&quot;&lt;/select&gt;&quot;).css(&quot;font-size&quot;,&quot;15px&quot;).change(function(){attrs.bind(cmenu)}).appendTo(attrs.pos);$(attrs.pos).append(&quot; &quot;);var cmenu={get selected(){return $(attrs.jmenu).val()},set selected(value){$(attrs.jmenu).val(value)},get choices(){return attrs.choices},set choices(value){throw new Error(&quot;The list of choices cannot be changed after creating a menu.&quot;)},get index(){return attrs.choices.indexOf($(attrs.jmenu).val())},set index(value){$(attrs.jmenu).val(attrs.choices[value])}};for(var a in args){cmenu[a]=args[a]}return cmenu}eval(&quot;0&quot;);var exports={box:box,vp_box:vp_box,cylinder:cylinder,vp_cylinder:vp_cylinder,cone:cone,vp_cone:vp_cone,pyramid:pyramid,vp_pyramid:vp_pyramid,sphere:sphere,vp_sphere:vp_sphere,vp_ellipsoid:vp_ellipsoid,arrow:arrow,vp_arrow:vp_arrow,curve:curve,points:points,paths:paths,shapes:shapes,helix:helix,vp_helix:vp_helix,ring:ring,vp_ring:vp_ring,compound:compound,vertex:vertex,triangle:triangle,quad:quad,draw:draw,label:label,distant_light:distant_light,local_light:local_light,attach_trail:attach_trail,attach_arrow:attach_arrow,textures:textures,bumpmaps:bumpmaps,text:text,radio:radio,checkbox:checkbox,button:button,slider:slider,menu:menu};Export(exports)})();(function(){&quot;use strict&quot;;function get_library(URL,cb){var tries=0;if(cb===undefined)throw new Error(&quot;get_display(URL, wait) called without wait&quot;);var done=false;var t1=msclock();$.getScript(URL).done(function(script,textStatus){done=true}).fail(function(jqxhr,settings,exception){alert(&quot;Could not access the library\n  &quot;+URL);cb();return});function require_wait(){if(done){cb();return}var t2=msclock();if(t2-t1&gt;6e3){var yes=confirm(&quot;Timed out trying to access the library\n  &quot;+URL+&quot;\nTry again?&quot;);if(yes){t1=msclock()}else{cb();return}}sleep(.05,require_wait)}require_wait()}function read_local_file(place,cb){var info;if(arguments.length===0){throw new Error(&quot;read_local_file(place, wait) called with no arguments&quot;)}else if(arguments.length==1){cb=place;if(toType(cb)!==&quot;function&quot;)throw new Error(&quot;Should be &#39;read_local_file(wait)&#39;&quot;);place=$(&quot;body&quot;)}else{if(arguments.length&gt;2||toType(cb)!==&quot;function&quot;)throw new Error(&quot;Should be &#39;read_local_file(place, wait)&#39;&quot;)}place.append(&#39;&lt;input type=&quot;file&quot; id=&quot;read_local_file&quot;/&gt;&#39;);var contents=null;function readSingleFile(evt){var f,reader;f=evt.target.files[0];if(f){reader=new FileReader;reader.onload=function(e){contents=e.target.result;var moddate=f.lastModifiedDate?f.lastModifiedDate.toLocaleDateString():&quot;&quot;;info={name:f.name,text:contents,size:f.size,type:f.type,date:moddate};$(&quot;#read_local_file&quot;).remove()};return reader.readAsText(f)}else{alert(&quot;Failed to load file&quot;);return}}document.getElementById(&quot;read_local_file&quot;).addEventListener(&quot;change&quot;,readSingleFile,false);function read_file_wait(){if(contents!==null){cb(null,info);return}sleep(.05,read_file_wait)}read_file_wait()}function update(cb){sleep(0,cb)}function sleep(dt,cb){dt=1e3*dt;function wrapCB(){cb()}if(dt&gt;5)setTimeout(wrapCB,dt-5);else setTimeout(wrapCB,0)}function waitforfonts(cb){function wrapCB(){if(window.__font_sans!==undefined&amp;&amp;window.__font_serif!==undefined)cb();else setTimeout(wrapCB,15)}wrapCB()}function fontloading(){var fsans;if(navigator.onLine)fsans=&quot;https://s3.amazonaws.com/glowscript/fonts/Roboto-Medium.ttf&quot;;else fsans=&quot;../lib/FilesInAWS/Roboto-Medium.ttf&quot;;opentype_load(fsans,function(err,fontrefsans){if(err)throw new Error(&quot;Font &quot;+fsans+&quot; could not be loaded: &quot;+err);window.__font_sans=fontrefsans});var fserif;if(navigator.onLine)fserif=&quot;https://s3.amazonaws.com/glowscript/fonts/NimbusRomNo9L-Med.otf&quot;;else fserif=&quot;../lib/FilesInAWS/NimbusRomNo9L-Med.otf&quot;;opentype_load(fserif,function(err,fontrefserif){if(err)throw new Error(&quot;Font &quot;+fserif+&quot; could not be loaded: &quot;+err);window.__font_serif=fontrefserif})}var toType=function(obj){return{}.toString.call(obj).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};function convert(arg){if(arg instanceof vec){arg=arg.toString()}else if(arg===null){arg=&quot;null&quot;}else if(arg===undefined){arg=&quot;undefined&quot;}else if(toType(arg)==&quot;object&quot;){var s=&quot;{&quot;;for(var a in arg)s+=a+&quot;:&quot;+arg[a]+&quot;, &quot;;arg=s.slice(0,-2)+&quot;}&quot;}else if(toType(arg)==&quot;number&quot;){arg=arg.toPrecision(6);if(arg.match(/e/)){arg=arg.replace(/0*e/,&quot;e&quot;);arg=arg.replace(/\.e/,&quot;e&quot;)}else if(arg.match(/\./))arg=arg.replace(/0*$/,&quot;&quot;);arg=arg.replace(/\.$/,&quot;&quot;)}else arg=arg.toString();return arg}var printarea=null;var poptions={width:640,height:100,readonly:true,pos:&quot;bottom&quot;};function modify_printarea(){var w=poptions.width===undefined?640:poptions.width;var h=poptions.height===undefined?100:poptions.height;var readonly=poptions.readonly===undefined?true:poptions.readonly;if(poptions.pos==&quot;right&quot;)canvas.container.css({&quot;float&quot;:&quot;left&quot;});else if(poptions.pos==&quot;bottom&quot;)canvas.container.css({clear:&quot;both&quot;});printarea.css(&quot;width&quot;,w).css(&quot;height&quot;,h);if(readonly)printarea.attr(&quot;readonly&quot;,&quot;readonly&quot;);else printarea.attr(&quot;readonly&quot;,null)}function print_to_string(args){var s=&quot;&quot;;var L=arguments.length;for(var i=0;i&lt;L;i++){var arg=arguments[i];if(toType(arg)==&quot;array&quot;){arg=arg.toString()}else if(arg===null){arg=&quot;null&quot;}else{arg=convert(arg)}if(s.length===0)s+=arg;else s+=&quot; &quot;+arg}return s}var print_container=$(&quot;&lt;div/&gt;&quot;);function print(args){if(printarea===null){var container=print_container;container.appendTo($(&quot;body&quot;));window.__context.print_container=container;printarea=$(&#39;&lt;textarea id=print spellcheck=&quot;false&quot;/&gt;&#39;).appendTo(container).css(&quot;font-family&quot;,&quot;Verdana&quot;,&quot;Sans-Serif&quot;).css(&quot;font-size&quot;,&quot;100%&quot;);modify_printarea()}var sep=&quot; &quot;;var end=&quot;\n&quot;;var L=arguments.length;var arg=arguments[L-1];if(arg!=null&amp;&amp;arg!==undefined){var isobject=false;if(arg.sep!==undefined){sep=arg.sep;isobject=true}if(arg.end!==undefined){end=arg.end;isobject=true}if(isobject)L--}var s=&quot;&quot;;for(var i=0;i&lt;L;i++){var arg=arguments[i];if(toType(arg)==&quot;array&quot;){arg=arg.toString()}else if(arg===null){arg=&quot;null&quot;}else{arg=convert(arg)}if(s.length===0)s+=arg;else s+=sep+arg}s+=end;printarea.val(printarea.val()+s);printarea.scrollTop(printarea.scrollTop()+1e4)}function print_options(args){var contents=&quot;&quot;;for(var a in args){poptions[a]=args[a]}if(printarea!==null){if(args.clear!==undefined&amp;&amp;args.clear)printarea.val(&quot;&quot;);modify_printarea();if(args.contents!==undefined&amp;&amp;args.contents)contents=printarea.val();if(args.delete!==undefined&amp;&amp;args.delete){printarea.remove();printarea=null}}return contents}window.performance=window.performance||{};function msclock(){if(performance.now)return performance.now();else return(new Date).getTime()}function clock(){return.001*msclock()}function factorial(x){if(x&lt;=0){if(x===0)return 1;else throw new Error(&quot;Cannot take factorial of negative number &quot;+x)}var fact=1;var nn=2;while(nn&lt;=x){fact*=nn;nn++}if(nn!=x+1)throw new Error(&quot;Argument of factorial must be an integer, not &quot;+x);return fact}function combin(x,y){var z=x-y;var num=1;if(y&gt;z){var temp=y;y=z;z=temp}var nn=z+1;var ny=1;while(nn&lt;=x){num*=nn/ny;nn++;ny++}if(nn!=x+1)throw new Error(&quot;Illegal arguments (&quot;+x+&quot;,&quot;+y+&quot;) for combin function&quot;);return num}function pa(L){var s=&quot;[&quot;;for(var i=0;i&lt;L.length;i++){var a=L[i];if(a===undefined)s+=&quot;undefined, &quot;;else if(a===null)s+=&quot;null &quot;;else if(toType(a)==&quot;array&quot;)s+=pa(a);else if(toType(a)==&quot;string&quot;)s+=a+&quot;, &quot;;else s+=a.toString()+&quot;, &quot;}if(s.slice(-2)==&quot;, &quot;)s=s.slice(0,-2);return s+&quot;], &quot;}function parsearray(L){if(L===undefined)return&quot;undefined&quot;;if(L===null)return&quot;null&quot;;return pa(L).slice(0,-2)}Array.prototype.toString=function(){return parsearray(this)};String.prototype.format=function(args){function format_item(arg,op,first,second){function pad(s,first){var p=&quot;&quot;;for(var i=0;i&lt;first-s.length;i++)p+=&quot; &quot;;return p+s}var formats={b:function(){return pad(arg.toString(2),first)},c:function(){return pad(String.fromCharCode(arg),first)},d:function(){return pad(Math.floor(Math.round(arg)).toString(),first)},e:function(){var v=pad(arg.toExponential(second||6),first);var eloc=v.search(&quot;e&quot;);var exponent=v.slice(eloc);v=v.slice(0,eloc);if(exponent.length==3)exponent=exponent.slice(0,2)+&quot;0&quot;+exponent.slice(-1);return v+exponent},E:function(){return formats.e()},f:function(){if(second==0)second=6;else if(second==-1)second=0;return pad(arg.toFixed(second),first)},F:function(){return formats.f()},g:function(){if(arg==0)return&quot;0&quot;;if(second==0)second=6;var a=Math.abs(arg);var v;if(1e-4&lt;=a&amp;&amp;a&lt;Math.pow(10,second)){if(a&lt;.1){var etype=arg.toExponential(second);etype=etype.replace(&quot;.&quot;,&quot;&quot;);var eloc=etype.search(&quot;e&quot;);var exponent=etype.slice(eloc+2);var val=etype.slice(0,eloc);var length=val.length;if(arg&lt;0){length++;second++}if(length&gt;second)val=val.slice(0,second);var sign=&quot;&quot;;if(val.slice(0,1)==&quot;-&quot;){sign=&quot;-&quot;;val=val.slice(1)}v=val.slice(0,second);while(v.slice(-1)==&quot;0&quot;)v=v.slice(0,-1);if(exponent==2)return sign+&quot;0.0&quot;+v;else if(exponent==3)return sign+&quot;0.00&quot;+v;else return sign+&quot;0.000&quot;+v}else{if(a&gt;=1)second--;v=formats.e();var eloc=v.search(&quot;e&quot;);var exponent=Number(v.slice(eloc+1));var val=Number(v.slice(0,eloc));arg=val*pow(10,exponent);v=formats.f();while(v.slice(-1)==&quot;0&quot;)v=v.slice(0,-1);if(v.slice(-1)==&quot;.&quot;)v=v.slice(0,-1);return v}}else{second--;v=formats.e();var eloc=v.search(&quot;e&quot;);var exponent=v.slice(eloc);v=v.slice(0,eloc);while(v.slice(-1)==&quot;0&quot;)v=v.slice(0,-1);if(v.slice(-1)==&quot;.&quot;)v=v.slice(0,-1);return v+exponent}},G:function(){return formats.g().toUpperCase()},n:function(){return formats.g()},o:function(){return pad(arg.toString(8),first)},s:function(){var t=arg.slice(0,second);for(var i=0;i&lt;first-second;i++)t+=&quot; &quot;;return t},x:function(){return pad(arg.toString(16),first)},X:function(){return formats.x().toUpperCase()},&quot;%&quot;:function(){arg*=100;return formats.f()+&quot;%&quot;}};return formats[op]()}var s=this;var values=Array.prototype.slice.call(arguments);var substrings=[];var formats=[];var braces=/(\{[^\}]*\})/g;var start=0;while(true){var m=braces.exec(s);if(m===null){substrings.push(s.slice(start));break}var format=s.slice(m.index+1,braces.lastIndex-1);formats.push(format.replace(/\s*/g,&quot;&quot;));substrings.push(s.slice(start,m.index));start=braces.lastIndex}var t=&quot;&quot;;for(var i=0;i&lt;substrings.length;i++){t+=substrings[i];if(i&gt;=formats.length)break;var f=formats[i];var findex=i;var colon=f.search(&quot;:&quot;);if(colon&lt;0){if(f.length&gt;0&amp;&amp;f.slice(-1).match(/[a-z]/)!==null)throw new Error(&#39;Format error: missing &quot;:&quot; in &quot;{&#39;+f+&#39;}&quot;&#39;);if(f.match(/\./)!==null)throw new Error(&#39;Format error: should not have &quot;.&quot; in &quot;{&#39;+f+&#39;}&quot;&#39;);if(f.length&gt;0)findex=Number(f);t+=values[findex].toString()}else{var op=f.slice(-1);if(op.match(/[a-z]/)===null)throw new Error(&#39;Format error: final character in &quot;{&#39;+f+&#39;}&quot; must be a letter.&#39;);if(colon&gt;0)findex=Number(f.slice(0,colon));f=f.slice(colon+1);var period=f.search(/\./);var first,second;if(period&gt;=0){first=f.slice(0,period);if(first==&quot;&quot;)first=0;else first=Number(first);second=Number(f.slice(period+1,-1));if(second===0)second=-1}else{first=f.length&gt;=2?Number(f.slice(0,-1)):0;second=0}t+=format_item(values[findex],op,first,second)}}return t};var exports={sqrt:Math.sqrt,pi:Math.PI,abs:Math.abs,sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,atan2:Math.atan2,exp:Math.exp,log:Math.log,pow:Math.pow,ceil:Math.ceil,floor:Math.floor,max:Math.max,min:Math.min,random:Math.random,round:Math.round,factorial:factorial,combin:combin,radians:function radians(deg){return deg*Math.PI/180},degrees:function degrees(rad){return rad*180/Math.PI},sleep:sleep,waitforfonts:waitforfonts,fontloading:fontloading,update:update,print:print,GSprint:print,print_to_string:print_to_string,print_options:print_options,clock:clock,msclock:msclock,get_library:get_library,read_local_file:read_local_file};Export(exports)})();(function(){&quot;use strict&quot;;var font;var otf;var textobj;var originalpos;var Hheights={};var Hheight;var length;var smooth=.95;var meshes;function text3D(a){textobj={};if(a.text==&quot;&quot;||a.text==undefined)throw new Error(&quot;A text object needs non-empty text&quot;);textobj.text=a.text;textobj.canvas=a.canvas===undefined?canvas.selected:a.canvas;textobj.align=a.align===undefined?&quot;left&quot;:a.align;textobj.height=a.height===undefined?1:a.height;textobj.depth=a.depth===undefined?.2*textobj.height:a.depth;textobj.pos=a.pos===undefined?vec(0,0,0):a.pos;textobj.axis=a.axis===undefined?vec(1,0,0):a.axis;textobj.up=a.up===undefined?vec(0,1,0):a.up;textobj.size=a.size===undefined?vec(1,1,1):a.size;textobj.color=a.color===undefined?vec(1,1,1):a.color;textobj.font=a.font===undefined?&quot;sans&quot;:a.font;textobj.billboard=a.billboard===undefined?false:a.billboard;textobj.show_start_face=a.show_start_face===undefined?true:a.show_start_face;textobj.show_end_face=a.show_end_face===undefined?true:a.show_end_face;textobj.start_face_color=a.start_face_color===undefined?textobj.color:a.start_face_color;textobj.end_face_color=a.end_face_color===undefined?textobj.color:a.end_face_color;originalpos=vec(textobj.pos);meshes=[];otf=false;if(textobj.font==&quot;sans&quot;)font=window.__font_sans;else if(textobj.font==&quot;serif&quot;){otf=true;font=window.__font_serif}else throw new Error(&#39;The text font must be either &quot;sans&quot; or &quot;serif&quot;.&#39;);if(font===undefined)throw new Error(&quot;Font not available for text object.&quot;);var fullName=font.names.fullName.en;if(Hheights[fullName]===undefined){var h=processOneLine(&quot;h&quot;,0,true);var d=processOneLine(&quot;y&quot;,0,true);Hheights[fullName]=[h,h-d]}Hheight=Hheights[fullName][0];var descent=Hheights[fullName][1];var lines=textobj.text.split(&quot;\n&quot;);var liney=0;var maxlength=0;for(var i=0;i&lt;lines.length;i++){liney=-i*1.5*Hheight;processOneLine(lines[i],liney,false);if(length&gt;maxlength)maxlength=length}var comp=compound(meshes,{pos:originalpos,__original_height:textobj.height,__length:maxlength,__billboard:textobj.billboard,__original_descender:textobj.height*descent,visible:textobj.visible,axis:textobj.axis,up:textobj.up,size:textobj.size,__show_start_face:textobj.show_start_face,__show_end_face:textobj.show_end_face,__start_face_color:textobj.start_face_color,__end_face_color:textobj.end_face_color,__align:textobj.align,__text:textobj.text,__lines:lines.length,__font:textobj.font,__depth:textobj.depth});if(textobj.billboard){textobj.canvas.update_billboards=true;textobj.canvas.billboards.push(comp)}return comp}function processOneLine(line,liney,returnymax){length=0;var ymax=0;var textPath=font.getPath(line,0,-liney,1);var commands=textPath.commands;var set;if(otf)set=fontInspect(line);var contoursT=[];var contoursF=[];var contours=[];var contour=[];var CW=[];for(var i=0;i&lt;commands.length;i++){var cmd=commands[i];switch(cmd.type){case&quot;M&quot;:if(contour.length&gt;0){var c0=contour[0];var c=contour[contour.length-1];if(Point.equals(c0,c))contour.pop();contours.push(contour);CW.push(isCW(contour))}contour=[];case&quot;L&quot;:contour.push(new Point(cmd.x,cmd.y));if(cmd.x&gt;length)length=cmd.x;if(cmd.y&lt;ymax)ymax=cmd.y;break;case&quot;C&quot;:var points=[contour.pop()];points.push(new Point(cmd.x1,cmd.y1));if(cmd.x1&gt;length)length=cmd.x1;if(cmd.y1&lt;ymax)ymax=cmd.y1;if(otf){points.push(new Point(cmd.x2,cmd.y2));points.push(new Point(cmd.x,cmd.y));if(cmd.x&gt;length)length=cmd.x;if(cmd.y&lt;ymax)ymax=cmd.y}else{points.push(new Point(cmd.x,cmd.y));points.push(new Point(cmd.x2,cmd.y2));if(cmd.x2&gt;length)length=cmd.x2;if(cmd.y2&lt;ymax)ymax=cmd.y2}var Bpoints=addBezier(3,points,8);contour=contour.concat(Bpoints);break;case&quot;Q&quot;:var points=[contour.pop()];points.push(new Point(cmd.x1,cmd.y1));points.push(new Point(cmd.x,cmd.y));if(cmd.x&gt;length)length=cmd.x;if(cmd.x1&gt;length)length=cmd.x1;if(cmd.y&lt;ymax)ymax=cmd.y;if(cmd.y1&lt;ymax)ymax=cmd.y1;var Bpoints=addBezier(2,points,8);contour=contour.concat(Bpoints);break;case&quot;Z&quot;:var c0=contour[0];var c=contour[contour.length-1];if(Point.equals(c0,c))contour.pop();if(otf){if(isCW(contour)){contoursT.push(contour);CW.push(true)}else{contoursF.push(contour);CW.push(false)}}else{contours.push(contour);CW.push(isCW(contour))}contour=[];break}}if(returnymax)return-ymax;length*=textobj.height/Hheight;if(otf){var expConts=[];for(var ci=0;ci&lt;line.length;ci++){var c=line[ci];var clst=set[c];var sum=clst.reduce(function(a,b){return a+b},0);if(clst.length&gt;1&amp;&amp;sum/clst.length&lt;=.51){clst=clst.sort();clst=clst.reverse();expConts.push(clst)}else if(sum/clst.length&lt;.8){var ccharPath=font.getPath(c,100,300,288);var ccommands=ccharPath[&quot;commands&quot;];var ccontoursT=[];var ccontoursF=[];var ccontour=[];for(var cmdi=0;cmdi&lt;commands.length;cmdi++){var cmd=commands[cmdi];if(cmd.type==&quot;M&quot;){ccontour=[];ccontour.push(new Point(cmd.x,cmd.y))}else if(cmd.type===&quot;L&quot;||cmd.type===&quot;C&quot;||cmd.type===&quot;Q&quot;){ccontour.push(new Point(cmd.x,cmd.y))}else if(cmd.type===&quot;Z&quot;){ccontour.push(ccontour[0]);if(isCW(ccontour))ccontoursT.push(ccontour);else ccontoursF.push(ccontour)}}for(var i=0;i&lt;ccontoursT.length;i++){pp=[true];for(var j=0;j&lt;ccontoursF.length;j++){if(pinPoly(ccontoursT[i],ccontoursF[j][0]))pp.push(false)}expConts.push(pp)}}else if(sum==clst.length){for(var ppi=0;ppi&lt;clst.length;ppi++){var pp=clst[ppi];expConts.push([pp])}}}for(var i=0;i&lt;expConts.length;i++){var chContour=[];for(var j=0;j&lt;expConts[i].length;j++){if(expConts[i][j])chContour.push(contoursT.shift());else chContour.push(contoursF.shift())}contours.push(chContour)}return getContours(contours,CW,expConts)}else{return getContours(contours,CW,null)}function fontInspect(inputText){var set={};for(var i=0;i&lt;inputText.length;i++)set[inputText[i]]=true;var keys=Object.keys(set);for(var chari=0;chari&lt;keys.length;chari++){var char=keys[chari];var charPath=font.getPath(char,100,300,288);var commands=charPath[&quot;commands&quot;];set[char]=[];for(var cmdi=0;cmdi&lt;commands.length;cmdi++){var cmd=commands[cmdi];if(cmd.type==&quot;M&quot;){contour=[];contour.push(new Point(cmd.x,cmd.y))}else if(cmd.type===&quot;L&quot;||cmd.type===&quot;C&quot;||cmd.type===&quot;Q&quot;){contour.push(new Point(cmd.x,cmd.y))}else if(cmd.type===&quot;Z&quot;){contour.push(contour[0]);set[char].push(isCW(contour))}}}return set}}function Bezier2(t,w){var t2=t*t;var mt=1-t;var mt2=mt*mt;return new Point(w[0].x*mt2+w[1].x*2*mt*t+w[2].x*t2,w[0].y*mt2+w[1].y*2*mt*t+w[2].y*t2)}function Bezier3(t,w){var t2=t*t;var t3=t2*t;var mt=1-t;var mt2=mt*mt;var mt3=mt2*mt;return new Point(w[0].x*mt3+3*w[1].x*mt2*t+3*w[2].x*mt*t2+w[3].x*t3,w[0].y*mt3+3*w[1].y*mt2*t+3*w[2].y*mt*t2+w[3].y*t3)}function addBezier(nb,points,nt){var newpoints=[];for(var i=0;i&lt;nt+1;i++){var t=i/nt;if(nb==2)var np=Bezier2(t,points);else if(nb==3)var np=Bezier3(t,points);newpoints.push(np)}return newpoints}function isCW(contour){var area=0;var i=0;while(i&lt;contour.length){var j=(i+1)%contour.length;area+=contour[i].x*contour[j].y;area-=contour[j].x*contour[i].y;i+=1}return area&lt;0}function getContours(contours,CW,expConts){var dx=0;if(textobj.align==&quot;right&quot;)dx=-length;else if(textobj.align==&quot;center&quot;)dx=-length/2;var dz=textobj.depth;if(otf){for(var i=0;i&lt;contours.length;i++){var chContour=contours[i];if(Point.equals(chContour[0][0],chContour[0][chContour[0].length-1]))chContour[0].pop();if(dz!==0)meshes=meshes.concat(makeQuads(chContour[0],false,dx,dz));var swctx=new SweepContext(chContour[0]);for(j=1;j&lt;chContour.length;j++){if(!expConts[i][j]){if(dz!==0)meshes=meshes.concat(makeQuads(chContour[j],false,dx,dz));if(Point.equals(chContour[j][0],chContour[j][chContour[j].length-1]))chContour[j].pop();swctx.addHole(chContour[j])}}swctx.triangulate();var triangles=swctx.getTriangles();meshes=meshes.concat(makeTriangles(triangles,dx,dz))}}else{var conhole=[];var con=[];var i=0;while(i&lt;contours.length){var contour=contours[i];if(!isCW(contour)){if(con.length&gt;0)conhole.push(con);con=[i]}else{con.push(i)}i+=1}conhole.push(con);for(var i=0;i&lt;conhole.length;i++){var con=conhole[i];if(dz!==0)meshes=meshes.concat(makeQuads(contours[con[0]],false,dx,dz));var swctx=new SweepContext(contours[con[0]]);for(var j=1;j&lt;con.length;j++){swctx.addHole(contours[con[j]]);meshes=meshes.concat(makeQuads(contours[con[j]],CW[j],dx,dz))}swctx.triangulate();var triangles=swctx.getTriangles();meshes=meshes.concat(makeTriangles(triangles,dx,dz))}}}function f(p){var val=1e3;var ret=(Math.floor(p.x*val)/val).toString()+&quot;,&quot;+(Math.floor(p.y*val)/val).toString()+&quot;   &quot;;return ret}function getShapeInfo(slist,inner){var shapeinfo=[];if(!Point.equals(slist[slist.length-1],slist[0]))slist.push(slist[0]);var L=slist.length;var previous=Point.sub(slist[0],slist[L-2]);var v;for(var i=0;i&lt;L;i++){if(i==L-1)v=Point.sub(slist[1],slist[0]);else v=Point.sub(slist[i+1],slist[i]);var a=new Point(previous.y,-previous.x);var b=new Point(v.y,-v.x);a.normalize();b.normalize();previous.normalize();v.normalize();if(inner){a.negate();b.negate()}var c=Point.dot(v,previous);var v1=slist[i];if(c&lt;=smooth){if(i===0){shapeinfo.push({pos:vec(v1.x,v1.y,0),normal:vec(b.x,-b.y,0),smooth:false})}else{shapeinfo.push({pos:vec(v1.x,v1.y,0),normal:vec(a.x,-a.y,0),smooth:false});if(i!=L-1)shapeinfo.push({pos:vec(v1.x,v1.y,0),normal:vec(b.x,-b.y,0),smooth:false})}}else{var n=Point.add(a,b);n.normalize();shapeinfo.push({pos:vec(v1.x,v1.y,0),normal:vec(n.x,-n.y,0),smooth:true})}previous=v}if(Point.equals(slist[slist.length-1],slist[0]))slist.pop();var s=shapeinfo;return shapeinfo}function makeQuads(contour,inner,dx,dz){var shape=getShapeInfo(contour,inner);var K=textobj.height/Hheight;var p0,p1,p2,p3,v0,v1,v2,v3,N0,N2;var Qlist=[];var z1=0;var z2=dz;if(dz&lt;0){z1=dz;z2=0}var lastsmooth=false;for(var i=0;i&lt;shape.length;i++){var s=shape[i];if(!lastsmooth){textobj.pos=vec(K*s.pos.x+dx,-K*s.pos.y,z2);textobj.normal=s.normal;v0=vertex(textobj);textobj.pos.z=z1;v1=vertex(textobj);lastsmooth=true;continue}textobj.pos=vec(K*s.pos.x+dx,-K*s.pos.y,z1);textobj.normal=s.normal;v2=vertex(textobj);textobj.pos.z=z2;v3=vertex(textobj);var vs=[v0,v1,v2,v3];Qlist.push(quad({vs:[v0,v1,v2,v3]}));if(s.smooth){v0=v3;v1=v2;lastsmooth=true}else lastsmooth=false}return Qlist}function makeTriangles(tris,dx,dz){var K=textobj.height/Hheight;textobj.normal=vec(0,0,1);var Tlist=[];var z,t,p0,p1,p2,v0,v1,v2;var savecolor=textobj.color;for(var ti=0;ti&lt;tris.length;ti++){t=tris[ti];p0=t.getPoint(0);p1=t.getPoint(1);p2=t.getPoint(2);z=dz;if(dz&gt;0)z=0;if(textobj.show_start_face){if(dz&gt;=0)textobj.color=textobj.start_face_color;else textobj.color=textobj.end_face_color;textobj.pos=vec(K*p0.x+dx,-K*p0.y,z);v0=vertex(textobj);textobj.pos=vec(K*p1.x+dx,-K*p1.y,z);v1=vertex(textobj);textobj.pos=vec(K*p2.x+dx,-K*p2.y,z);v2=vertex(textobj);Tlist.push(triangle({vs:[v0,v1,v2]}))}if(dz!==0&amp;&amp;textobj.show_end_face){z=dz;if(dz&lt;0)z=0;if(dz&gt;=0)textobj.color=textobj.end_face_color;else textobj.color=textobj.start_face_color;textobj.pos=vec(K*p0.x+dx,-K*p0.y,z);var v0=vertex(textobj);textobj.pos=vec(K*p1.x+dx,-K*p1.y,z);var v1=vertex(textobj);textobj.pos=vec(K*p2.x+dx,-K*p2.y,z);var v2=vertex(textobj);Tlist.push(triangle({vs:[v0,v1,v2]}))}}textobj.color=savecolor;return Tlist}function pinPoly(contour,testp){var i=0;var j=0;var c=0;var nvert=contour.length;for(i=0,j=nvert-1;i&lt;nvert;j=i++){if(contour[i].y&gt;testp.y!=contour[j].y&gt;testp.y&amp;&amp;testp.x&lt;(contour[j].x-contour[i].x)*(testp.y-contour[i].y)/(contour[j].y-contour[i].y)+contour[i].x){c=!c}}return c}function extrusion(args){if(args.canvas!==undefined)args.canvas=args.canvas;else args.canvas=canvas.get_selected();args.origin=args.origin===undefined?vec(0,0,0):args.origin;if(args.pos===undefined)throw new Error(&quot;An extrusion object needs a pos attribute.&quot;);if(args.shape===undefined)throw new Error(&quot;An extrusion object needs a shape attribute.&quot;);args.axis=args.axis===undefined?vec(1,0,0):args.axis;args.size=args.size===undefined?vec(1,1,1):args.size;args.up=args.up===undefined?norm(args.canvas.up):norm(args.up);args.color=args.color===undefined?color.white:args.color;args.opacity=args.opacity===undefined?1:args.opacity;args.show_start_face=args.show_start_face===undefined?true:args.show_start_face;args.show_end_face=args.show_end_face===undefined?true:args.show_end_face;args.start_face_color=args.start_face_color===undefined?args.color:args.start_face_color;args.end_face_color=args.end_face_color===undefined?args.color:args.end_face_color;args.smooth=args.smooth===undefined?.95:args.smooth;var vertices=[];var shapeinfo=[];var quads=[];var path_closed=args.pos[args.pos.length-1].equals(args.pos[0]);var sharps=[];var smoothangle=Math.acos(args.smooth);var joints=[];var L=args.pos.length;var temp=[args.pos[0]];for(var i=1;i&lt;L;i++){if(args.pos[i].equals(temp[temp.length-1]))continue;else temp.push(args.pos[i])}var p=temp;L=args.pos.length;var x,y,ipath;var A1,A2,sharp,xaxis,yaxis,xaxis2,yaxis2;var ltex=0;var perp;var alpha;var theta;if(L&lt;2)throw new Error(&quot;An extrusion pos must contain more than one distinct point.&quot;);if(L==2){A1=norm(p[1].sub(p[0]));yaxis=args.up;xaxis=A1.cross(yaxis);if(xaxis.dot(xaxis)&lt;1e-10){xaxis=yaxis.cross(vec(1,0,0));if(xaxis.dot(xaxis)&lt;1e-10)xaxis=yaxis.cross(vec(0,1,0))}xaxis=norm(xaxis);yaxis=xaxis.cross(A1);joints.push([A1,A1,true,p[0],xaxis,yaxis,xaxis,yaxis,xaxis,yaxis,0]);joints.push([A1,A1,true,p[1],xaxis,yaxis,xaxis,yaxis,xaxis,yaxis,1])}else{for(ipath=0;ipath&lt;L;ipath++){if(ipath===0){A1=p[1].sub(p[0]);yaxis=args.up;xaxis=A1.cross(yaxis);if(xaxis.dot(xaxis)&lt;1e-10){xaxis=yaxis.cross(vec(1,0,0));if(xaxis.dot(xaxis)&lt;1e-10)xaxis=yaxis.cross(vec(0,1,0))}xaxis=norm(xaxis);yaxis=norm(xaxis.cross(A1));joints.push([A1,A1,true,p[ipath],xaxis,yaxis,xaxis,yaxis,xaxis,yaxis,0]);if(!path_closed)continue}else if(ipath==L-1){A1=p[ipath].sub(p[ipath-1]);ltex+=mag(A1);if(path_closed){theta=A1.diff_angle(joints[0][0]);sharp=theta&gt;=smoothangle;if(sharp)sharps.push(ipath);var jcopy=[];for(var j=0;j&lt;joints[0].length;j++)jcopy.push(joints[0][j]);joints.push(jcopy);joints[joints.length-1][10]=ltex}else{x=xaxis;if(!sharp)x=xaxis.rotate({angle:alpha,axis:yaxis});else sharps.push(ipath);joints.push([A1,A1,true,p[ipath],x,yaxis,xaxis,yaxis,xaxis,yaxis,ltex])}continue}if(ipath===0){A1=p[0].sub(p[L-2]);A2=p[1].sub(p[0])}else{A1=p[ipath].sub(p[ipath-1]);A2=p[ipath+1].sub(p[ipath])}theta=A2.diff_angle(A1);sharp=theta&gt;=smoothangle;if(ipath&gt;0)ltex+=mag(A1);y=norm(A1.cross(A2));perp=norm(norm(A1).add(norm(A2)));alpha=theta/2;x=norm(y.cross(perp));xaxis2=xaxis.rotate({angle:theta,axis:y});yaxis2=norm(xaxis2.cross(A2));if(ipath===0){var jnt=joints[0];jnt[0]=A1;jnt[1]=A2;jnt[2]=sharp;jnt[4]=x;jnt[5]=y;jnt[6]=xaxis.rotate({angle:-theta,axis:y});jnt[7]=yaxis;jnt[10]=0;continue}if(ipath==1&amp;&amp;!path_closed&amp;&amp;!sharp)joints[0][4]=joints[0][4].rotate({angle:-alpha,axis:joints[0][5]});joints.push([A1,A2,sharp,p[ipath],x,y,xaxis,yaxis,xaxis2,yaxis2,ltex]);if(sharp){sharps.push(joints.length-1);joints.push([A1,A2,sharp,p[ipath],x,y,xaxis,yaxis,xaxis2,yaxis2,ltex])}xaxis=xaxis2;yaxis=yaxis2}var i,j,starti,start,endi,end,L;if(sharps.length===0){if(path_closed){for(j=1;j&lt;joints.length;j++){if(Math.abs(joints[j][10]-ltex/2)&lt;.001*ltex)break;if(joints[j][10]&gt;ltex/2){j-=1;break}}end=joints[j][10];for(i=0;i&lt;=j;i++)joints[i][10]/=end;L=ltex-end;for(i=j+1;i&lt;joints.length;i++){joints[i][10]=1-(joints[i][10]-end)/L}}else{for(i=0;i&lt;joints.length;i++)joints[i][10]/=ltex}}else{j=0;start=0;starti=0;while(j&lt;sharps.length){endi=sharps[j];end=joints[endi][10];L=end-start;for(var k=starti;k&lt;=endi;k++)joints[k][10]=(joints[k][10]-start)/L;start=end;starti=endi+1;j++;if(j==sharps.length&amp;&amp;path_closed){L=joints[0][10]-start;for(var k=starti;k&lt;joints.length;k++)joints[k][10]=(joints[k][10]-start)/L}}}}var contours=args.shape;var n=level(contours);var xmin,xmax,ymin,ymax;if(n==1)bounding_box([contours]);else if(n==2)bounding_box([contours[0]]);else{var shs=[];for(var nn=0;nn&lt;contours.length;nn++)shs.push(contours[nn][0]);bounding_box(shs)}if(n==1){contours=[contours];make_quads(contours[0],true);endfaces(contours)}else if(n==2){for(var nc=0;nc&lt;contours.length;nc++){make_quads(contours[nc],nc===0)}endfaces(contours)}else{for(var nn=0;nn&lt;contours.length;nn++){var c=contours[nn];for(var nc=0;nc&lt;c.length;nc++){make_quads(c[nc],nc===0)}endfaces(c)</td>
      </tr>
      <tr>
        <td id="L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="LC15" class="blob-code blob-code-inner js-file-line">}}delete args.pos;delete args.shape;delete args.color;delete args.smooth;delete args.start_face_color;delete args.end_face_color;delete args.show_start_face;delete args.show_end_face;return compound(quads,args);function level(a){if(a.length===undefined)throw new Error(&quot;A shape must be a list of [x,y] elements.&quot;);if(typeof a[0]==&quot;number&quot;)throw new Error(&quot;A shape must be a list of [x,y] elements.&quot;);if(typeof a[0][0]==&quot;number&quot;)return 1;if(typeof a[0][0][0]==&quot;number&quot;)return 2;if(typeof a[0][0][0][0]==&quot;number&quot;)return 3;throw new Error(&quot;A shape must be a list of lists of [x,y] elements.&quot;)}function bounding_box(shs){for(var i=0;i&lt;shs.length;i++){var ystart=null;var shapemin=null;for(var j=0;j&lt;shs[i].length-1;j++){var p=shs[i][j];var x=p[0];var y=p[1];xmin=xmin===undefined?x:Math.min(x,xmin);xmax=xmax===undefined?x:Math.max(x,xmax);ymin=ymin===undefined?y:Math.min(y,ymin);ymax=ymax===undefined?y:Math.max(y,ymax)}}}function find_shape_info(contour,outside){var slist=[];for(var i=0;i&lt;contour.length;i++)slist.push(vec(contour[i][0],contour[i][1],0));var shape_closed=slist[slist.length-1].equals(slist[0]);if(!shape_closed)new Error(&quot;An extrusion shape must be a closed curve.&quot;);shapeinfo=[];var out=vec(0,0,1);var L=slist.length;var firstsharp=null;var totallength=0;var vs=[],lengths=[],i,v;var miny,minyi;for(i=0;i&lt;L-1;i++){v=slist[i+1].sub(slist[i]);if(miny===undefined||slist[i].y&lt;miny){miny=slist[i].y;minyi=i}var magv=mag(v);totallength+=magv;vs.push(v);lengths.push(magv)}var texval=[];for(i=0;i&lt;lengths.length;i++){lengths[i]/=totallength;texval.push(0)}var d=0;var np=0;for(i=0;i&lt;lengths.length;i++){var j=(minyi+i)%lengths.length;d+=lengths[j];if(d&gt;.5){d-=lengths[j];break}np+=1}var d2=0;for(i=0;i&lt;np;i++){var k=(minyi+i+1)%lengths.length;d2+=lengths[k];texval[k]=d2/d}d2=0;for(i=0;i&lt;lengths.length-np;i++){var k=(j+i+1)%lengths.length;d2+=lengths[k];texval[k]=1-d2/(1-d)}var previous=vs[vs.length-1];var second=false;for(i=0;i&lt;L-1;i++){v=vs[i];var len=lengths[i];var a=previous.cross(out).norm();var b=v.cross(out).norm();if(!outside){a=a.multiply(-1);b=b.multiply(-1)}var c=norm(v).dot(norm(previous));var v1=slist[i];if(c&lt;=args.smooth){if(i===0)firstsharp={pos:v1,normal:a,smooth:false,length:texval[i]};else shapeinfo.push({pos:v1,normal:a,smooth:false,length:texval[i]});shapeinfo.push({pos:v1,normal:b,smooth:false,length:texval[i]})}else{var n=norm(a.add(b));shapeinfo.push({pos:v1,normal:n,smooth:true,length:texval[i]})}previous=v}if(firstsharp!==null)shapeinfo.push(firstsharp)}function generate_vertices(p,x,y,nx,ny,nx2,ny2,sharp,makequads,ltex){for(i=0;i&lt;2;i++){if(i==1){nx=nx2;ny=ny2}var c1=dot(y,ny);var c2=dot(y,nx);var c3=dot(x,ny);var c4=dot(x,nx);var d=c1*c4-c2*c3;var info,v,n,N,a,b,aa,bb,xmin,xmax,ymin,ymax,y;var V=shapeinfo.length;for(var k=0;k&lt;V;k++){info=shapeinfo[k];a=info.pos.x;b=info.pos.y;aa=(a*c1-b*c2)/d;bb=(b*c4-a*c3)/d;v=p.add(x.multiply(aa).add(y.multiply(bb)));n=info.normal;N=norm(nx.multiply(n.x).add(ny.multiply(n.y)));if(i===0){vertices.push(vertex({pos:v,normal:N,color:args.color,texpos:vec(ltex,info.length,0)}))}else{vertices[vertices.length-V+k].normal=norm(vertices[vertices.length-V+k].normal.add(N))}}if(sharp)break}if(makequads){var start=vertices.length-2*V;for(var k=start;k&lt;start+V;k++){if(k==start+V-1){quads.push(quad({v0:vertices[k],v1:vertices[k+V],v2:vertices[start+V],v3:vertices[start]}))}else{quads.push(quad({v0:vertices[k],v1:vertices[k+V],v2:vertices[k+V+1],v3:vertices[k+1]}));if(!shapeinfo[k-start+1].smooth)k++}}}}function make_quads(contour,outside){if(outside||!path_closed){find_shape_info(contour,outside)}else return;var pp,pos;L=joints.length;for(ipath=0;ipath&lt;L;ipath++){pp=joints[ipath];A1=pp[0];A2=pp[1];sharp=pp[2];pos=pp[3];x=pp[4];y=pp[5];xaxis=pp[6];yaxis=pp[7];xaxis2=pp[8];yaxis2=pp[9];ltex=pp[10];if(ipath===0){if(sharp)generate_vertices(pos,x,y,xaxis2,yaxis2,xaxis2,yaxis2,sharp,false,0);else generate_vertices(pos,x,y,xaxis,yaxis,xaxis2,yaxis2,sharp,false,0)}else if(ipath==L-1){if(path_closed){pp=joints[0];sharp=pp[2];pos=pp[3];x=pp[4];y=pp[5];xaxis=pp[6];yaxis=pp[7];xaxis2=pp[8];yaxis2=pp[9];ltex=pp[10];generate_vertices(pos,x,y,xaxis,yaxis,xaxis2,yaxis2,sharp,true,ltex)}else generate_vertices(pos,x,y,xaxis,yaxis,xaxis2,yaxis2,sharp,true,ltex)}else if(sharp){if(ipath&gt;0)generate_vertices(pos,x,y,xaxis,yaxis,xaxis2,yaxis2,true,true,1);if(ipath&lt;L-1)generate_vertices(pos,x,y,xaxis2,yaxis2,xaxis2,yaxis2,true,false,0)}else{generate_vertices(pos,x,y,xaxis,yaxis,xaxis2,yaxis2,false,ipath&gt;0,ltex)}}}function tessellate(contours){var i,j;var c=contours[0];if(c[0][0]===c[c.length-1][0]&amp;&amp;c[0][1]===c[c.length-1][1])c.pop();var pts=[];for(i=0;i&lt;c.length;i++)pts.push(new Point(c[i][0],c[i][1]));var swctx=new SweepContext(pts);for(j=1;j&lt;contours.length;j++){c=contours[j];if(c[0][0]===c[c.length-1][0]&amp;&amp;c[0][1]===c[c.length-1][1])c.pop();pts=[];for(i=0;i&lt;contours[j].length;i++)pts.push(new Point(c[i][0],c[i][1]));swctx.addHole(pts)}function texpos(p){var x=p.x,y=p.y;return vec((x-xmin)/(xmax-xmin),(y-ymin)/(ymax-ymin),0)}swctx.triangulate();var tris=swctx.getTriangles();var p0,p1,p2,t;var N=vec(0,0,1);var tri_indices=[];for(i=0;i&lt;tris.length;i++){t=tris[i];p0=t.getPoint(0);p1=t.getPoint(1);p2=t.getPoint(2);vertices.push(vertex({pos:vec(p0.x,p0.y,0),normal:N,texpos:texpos(p0)}));vertices.push(vertex({pos:vec(p1.x,p1.y,0),normal:N,texpos:texpos(p1)}));vertices.push(vertex({pos:vec(p2.x,p2.y,0),normal:N,texpos:texpos(p2)}));tri_indices.push([3*i,3*i+1,3*i+2])}return tri_indices}function endfaces(contours){if(!path_closed&amp;&amp;(args.show_start_face||args.show_end_face)){var T,js,start=vertices.length;T=tessellate(contours);var faces=[];var L=vertices.length-start;if(args.show_start_face&amp;&amp;!path_closed){var jnt=joints[0];var p=jnt[3];var N=jnt[0];N=N.multiply(-1);var x=jnt[4];var y=jnt[5];for(var k=0;k&lt;L;k++){var vert=vertices[start+k];faces.push([vert.pos.x,vert.pos.y]);var v=p.add(x.multiply(vert.pos.x).add(y.multiply(vert.pos.y)));vertices[start+k].pos=v;vertices[start+k].normal=N;vertices[start+k].__color=args.start_face_color}for(var vi=0;vi&lt;T.length;vi++){var vs=T[vi];quads.push(triangle({vs:[vertices[start+vs[0]],vertices[start+vs[1]],vertices[start+vs[2]]]}))}}if(args.show_end_face&amp;&amp;!path_closed){var jnt=joints[joints.length-1];var p=jnt[3];var N=jnt[0];var x=jnt[4];var y=jnt[5];for(var k=0;k&lt;L;k++){if(!args.show_start_face){var vert=vertices[start+k];vert.color=args.end_face_color;var v=p.add(x.multiply(vert.pos.x).add(y.multiply(vert.pos.y)));vertices[start+k].pos=v;vertices[start+k].normal=N}else{var vert=faces[k];var v=p.add(x.multiply(vert[0]).add(y.multiply(vert[1])));vertices.push(vertex({pos:v,normal:N,color:args.end_face_color,texpos:vertices[start+k].texpos}))}}if(args.show_start_face)start+=L;for(var vi=0;vi&lt;T.length;vi++){var vs=T[vi];quads.push(triangle({vs:[vertices[start+vs[0]],vertices[start+vs[1]],vertices[start+vs[2]]]}))}}}}}var exports={text3D:text3D,extrusion:extrusion};Export(exports)})();Export({shaders:{curve_peel_depth_vertex:&#39;// Vertex shader for rendering curve segments, parameterized by\n// pos1, pos2, radius, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in a normal basis with x pointing along the segment and scaled by radius\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvec4 start;\nvec4 end;\n   \nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nmat3 getSegmentRotation() {\n  // Construct the segment rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(vec3(0,1,0)));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start.w or end.w inside the if statement fails\n    // if the curve radius is less than about 1e-7. After setting the value\n    // inside the if, it\&#39;s zero upon exit from the if. !!?!\n    float sw = 0.0;\n    if (segmentPosR(0).w &lt; 0.0) { // -1 means use the curve global radius\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w &lt; 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n    \n    // The position and radius of &quot;this&quot; end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n    \n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n    \n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    \n    gl_Position = projMatrix * pos4;\n}&#39;,curve_pick_vertex:&#39;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in an normal basis with x pointing along the segment and scaled by radius\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nvec4 start;\nvec4 end;\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nmat3 getSegmentRotation() {\n    // Construct the object rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    vec4 start_color = segmentColor(0);\n    vec4 end_color = segmentColor(1);\n    if (start_color.r &lt; 0.0) start_color.rgb = objectColor;\n    if (end_color.r &lt; 0.0) end_color.rgb = objectColor.rgb;\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start or end inside the if statement fails\n    // if the curve radius is less than about 1e-7 !!??\n    float sw = 0.0;\n    if (segmentPosR(0).w &lt; 0.0) {\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w &lt; 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n\n    // The position and radius of &quot;this&quot; end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n\n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    vcolor = start_color * (1.-pos.w) + end_color * pos.w;\n    gl_Position = projMatrix * pos4;\n}\n&#39;,curve_render_vertex:&#39;// Vertex shader for rendering curve segments, parameterized by\n// pos1, pos2, radius, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in a normal basis with x pointing along the segment and scaled by radius\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nvec4 start;\nvec4 end;\n   \nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nmat3 getSegmentRotation() {\n  // Construct the segment rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(vec3(0,1,0)));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    vec4 start_color = segmentColor(0);\n    vec4 end_color = segmentColor(1);\n    if (start_color.r &lt; 0.0) start_color.rgb = objectColor;\n    if (end_color.r &lt; 0.0) end_color.rgb = objectColor.rgb;\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start.w or end.w inside the if statement fails\n    // if the curve radius is less than about 1e-7. After setting the value\n    // inside the if, it\&#39;s zero upon exit from the if. !!?!\n    float sw = 0.0;\n    if (segmentPosR(0).w &lt; 0.0) { // -1 means use the curve global radius\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w &lt; 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n\n    // The position and radius of &quot;this&quot; end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n\n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot * (normal/objectScale), 0.0)).xyz;\n    \n    // no texture or bump map yet for curve object:\n    parameters = vec4(objectShininess, objectEmissive, 0.0, 0.0);\n    mat_pos = vec2(0.0, 0.0);\n    bumpX = vec3(1.0, 0.0, 0.0);\n    \n    vcolor = start_color * (1.-pos.w) + end_color * pos.w;\n    gl_Position = projMatrix * pos4;\n}&#39;,extent_vertex:&quot;// Vertex shader for rendering standard &#39;objects&#39; parameterized by\n// pos, axis, up, scale, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform vec3 center;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nvec3 encode_float(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return vec3(0.0, 0.0, 0.0);\n    float logk = log(k);\n    if (logk &lt; 0.0) {\n        logk = -logk + 128.0;\n    }\n    return vec3(\n        floor(logk)/255.0,\n        floor(256.0*fract(logk))/255.0,\n        floor(256.0*fract(256.0*logk))/255.0);\n}\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.  A waste to do this per vertex, but GPU &gt;&gt; CPU\n    vec3 X = normalize(objectAxis);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*position) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*(normal/objectScale), 0.0)).xyz;\n    //gl_Position = posp;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    float extent = abs(ws_pos.x-center.x);\n    extent = max(abs(ws_pos.y-center.y), extent);\n    extent = max(abs(ws_pos.z-center.z), extent);\n    mat_color = vec4(encode_float(extent), 1.0);\n    // Setting gl_Position.xy to (-1.0, -1.0) should store into pixel (0, 0), but doesn&#39;t work:\n    gl_Position = vec4(-1.0, -1.0, 1e-20*extent, 1.0);\n\n    parameters = vec4(objectShininess, objectEmissive, 0.0, 0.0);\n}\n&quot;,merge_fragment:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform sampler2D C0; // TEXTURE2 - opaque color map (minormode 4)\nuniform sampler2D C1; // TEXTURE4 - color map for transparency render 1 (minormode 6)\nuniform sampler2D C2; // TEXTURE6 - color map for transparency render 2 (minormode 8)\nuniform sampler2D C3; // TEXTURE8 - color map for transparency render 3 (minormode 10)\nuniform sampler2D C4; // TEXTURE10 - color map for transparency render 4 (minormode 12)\nuniform vec2 canvas_size;\n\nvoid main(void) {\n    // need to combine colors from C0, C1, C2, C3, C4\n    vec2 loc = vec2( gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    vec4 c0 = texture2D(C0, loc);\n    vec4 c1 = texture2D(C1, loc);\n    vec4 c2 = texture2D(C2, loc);\n    vec4 c3 = texture2D(C3, loc);\n    vec4 c4 = texture2D(C4, loc);\n    \n    vec3 mcolor = c1.rgb*c1.a + \n                 (1.0-c1.a)*(c2.rgb*c2.a +\n                 (1.0-c2.a)*(c3.rgb*c3.a +\n                 (1.0-c3.a)*(c4.rgb*c4.a + \n                 (1.0-c4.a)*c0.rgb)));\n    gl_FragColor = vec4 (mcolor, 1.0);\n}\n&quot;,merge_fragment2:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform sampler2D C0; // TEXTURE2 - opaque color map (minormode 4)\nuniform sampler2D C1; // TEXTURE4 - color map for transparency render 1 (minormode 6)\nuniform vec2 canvas_size;\n\nvoid main(void) {\n    // need to combine colors from C0 and C1\n    // This is used with mobile devices that have few texture image units.\n    vec2 loc = vec2( gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    vec4 c0 = texture2D(C0, loc);\n    vec4 c1 = texture2D(C1, loc);    \n    \n    vec3 mcolor = c1.rgb*c1.a + (1.0-c1.a)*c0.rgb;\n    gl_FragColor = vec4 (mcolor, 1.0);\n}\n&quot;,merge_vertex:&quot;// Vertex shader for rendering standard &#39;objects&#39; parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nvoid main(void) {\n    gl_Position = vec4(pos, 1.0);\n}\n&quot;,opaque_render_fragment:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess &gt; 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * lcolor * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d &gt; 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nvoid main(void) {\n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    gl_FragColor = vec4( color, 1.0 );\n}\n&quot;,peel_color_fragmentC1:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess &gt; 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d &gt; 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n\n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n	\n	if (zmin &lt; z) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n    	discard;\n    }\n}\n&quot;,peel_color_fragmentC2:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D1; // TEXTURE5 - depth map (minormode 7)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess &gt; 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d &gt; 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D1, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin &lt; z &amp;&amp; z &lt; zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n&quot;,peel_color_fragmentC3:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D2; // TEXTURE7 - depth map (minormode 9)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess &gt; 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d &gt; 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D2, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin &lt; z &amp;&amp; z &lt; zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n&quot;,peel_color_fragmentC4:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D3; // TEXTURE9 - depth map (minormode 11)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess &gt; 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d &gt; 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D3, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin &lt; z &amp;&amp; z &lt; zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n&quot;,peel_depth_fragmentD0:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nvoid main(void) {\n    // create depth map D0 (5)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n}&quot;,peel_depth_fragmentD1:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D1 (6)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    if (zmin &lt; z) {\n        gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}\n&quot;,peel_depth_fragmentD2:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D1; // TEXTURE5 - 1st transparency depth map (minormode 7)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D2 (7)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D1, loc));\n    if (zmin &lt; z &amp;&amp; z &lt; zmax) {\n    	gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}&quot;,peel_depth_fragmentD3:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D2; // TEXTURE7 - 2nd transparency depth map (minormode 9)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is &gt;= 0\n    if (k &lt;= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D3 (8)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D2, loc));\n    if (zmin &lt; z &amp;&amp; z &lt; zmax) {\n        gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}&quot;,peel_depth_vertex:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n}\n&quot;,pick_fragment:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nvarying vec4 vcolor;\n\nvoid main(void) {\n    gl_FragColor = vcolor;\n}\n&quot;,pick_vertex:&quot;// Vertex shader for picking standard &#39;objects&#39; parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectAxis objectData[1].xyz\n#define objectUp objectData[2].xyz\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nmat3 getObjectRotation() {\n  // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n    vcolor = objectColor;\n}\n&quot;,render_vertex:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*(normal/objectScale), 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color*objectColor.rgb, opacity*objectColor.a);\n    \n    float f = flags; // turn, flipy, flipx, sides, right, left, bumpmap, texture\n    float turn = floor(f/128.0);\n    f -= 128.0*turn;\n    float flipy = floor(f/64.0);\n    f -= 64.0*flipy;\n    float flipx = floor(f/32.0);\n    f -= 32.0*flipx;\n    float sides = floor(f/16.0);\n    f -= 16.0*sides;\n    float right = floor(f/8.0);\n    f -= 8.0*right;\n    float left = floor(f/4.0);\n    f -= 4.0*left;\n    float B = floor(f/2.0);\n    f -= 2.0*B;\n    float T = f;\n    if (T != 0.0) {\n        if (flipx != 0.0) {\n            mat_pos.x = 1.0 - mat_pos.x;\n        }\n        if (flipy != 0.0) {\n            mat_pos.y = 1.0 - mat_pos.y;\n        }\n        if (turn &gt; 0.0 &amp;&amp; turn &lt;= 3.0) {\n            if (turn == 1.0) {\n                mat_pos = vec2(mat_pos.y,1.0 - mat_pos.x);\n            } else if (turn == 2.0) {\n                mat_pos = vec2(1.0 - mat_pos.x,1.0 - mat_pos.y);\n            } else {\n                mat_pos = vec2(1.0 - mat_pos.y,mat_pos.x);\n            }\n        }\n        T = 0.0;\n        bool L = (normal.x == -1.0);\n        bool R = (normal.x == 1.0);\n        bool S = !L &amp;&amp; !R;\n        if (L &amp;&amp; left == 1.0) T = 1.0;\n        if (R &amp;&amp; right == 1.0) T = 1.0;\n        if (S &amp;&amp; sides == 1.0) T = 1.0;\n        if (T == 0.0) {\n            B = 0.0;\n        } else if (left == 0.0 || right == 0.0 || sides == 0.0) {\n            // don&#39;t mix texture and object color if texture doesn&#39;t cover entire object\n            vcolor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    }\n    float emit = 0.0;\n    if (objectEmissive != 0.0) emit = 1.0;\n    if (emissive != 0.0) emit = 1.0;\n    parameters = vec4(objectShininess * shininess, emit, T, B);\n}\n&quot;,ring_peel_depth_vertex:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n	mat3 rot = getObjectRotation();\n	// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;           // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(r/objectScale);     // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n}\n&quot;,ring_pick_vertex:&quot;// Vertex shader for picking standard &#39;objects&#39; parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectAxis objectData[1].xyz\n#define objectUp objectData[2].xyz\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n	mat3 rot = getObjectRotation();\n	// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;           // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(r/objectScale);     // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n    vcolor = objectColor;\n}\n&quot;,ring_render_vertex:&quot;#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) &lt; 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) &lt; 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n	mat3 rot = getObjectRotation();\n	// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;  // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(normal);   // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    vec3 N = adjpos - (r-0.5*objectScale.x*n);                              // normal in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*N, 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color*objectColor.rgb, opacity*objectColor.a);\n    \n    float f = flags; // turn, flipy, flipx, sides, right, left, bumpmap, texture\n    float turn = floor(f/128.0);\n    f -= 128.0*turn;\n    float flipy = floor(f/64.0);\n    f -= 64.0*flipy;\n    float flipx = floor(f/32.0);\n    f -= 32.0*flipx;\n    float sides = floor(f/16.0);\n    f -= 16.0*sides;\n    float right = floor(f/8.0);\n    f -= 8.0*right;\n    float left = floor(f/4.0);\n    f -= 4.0*left;\n    float B = floor(f/2.0);\n    f -= 2.0*B;\n    float T = f;\n    if (T != 0.0) {\n        if (flipx != 0.0) {\n            mat_pos.x = 1.0 - mat_pos.x;\n        }\n        if (flipy != 0.0) {\n            mat_pos.y = 1.0 - mat_pos.y;\n        }\n        if (turn &gt; 0.0 &amp;&amp; turn &lt;= 3.0) {\n            if (turn == 1.0) {\n                mat_pos = vec2(mat_pos.y,1.0 - mat_pos.x);\n            } else if (turn == 2.0) {\n                mat_pos = vec2(1.0 - mat_pos.x,1.0 - mat_pos.y);\n            } else {\n                mat_pos = vec2(1.0 - mat_pos.y,mat_pos.x);\n            }\n        }\n        T = 0.0;\n        bool L = (normal.x == -1.0);\n        bool R = (normal.x == 1.0);\n        bool S = !L &amp;&amp; !R;\n        if (L &amp;&amp; left == 1.0) T = 1.0;\n        if (R &amp;&amp; right == 1.0) T = 1.0;\n        if (S &amp;&amp; sides == 1.0) T = 1.0;\n        if (T == 0.0) {\n            B = 0.0;\n        } else if (left == 0.0 || right == 0.0 || sides == 0.0) {\n            // don&#39;t mix texture and object color if texture doesn&#39;t cover entire object\n            vcolor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    }\n    float emit = 0.0;\n    if (objectEmissive != 0.0) emit = 1.0;\n    if (emissive != 0.0) emit = 1.0;\n    parameters = vec4(objectShininess * shininess, emit, T, B);\n}\n&quot;,tri_peel_depth_vertex:&quot;// Vertex shader for rendering triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvoid main(void) {\n    gl_Position = projMatrix * viewMatrix * vec4( pos, 1.0);\n}\n&quot;,tri_pick_vertex:&quot;// Vertex shader for picking triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec4 color;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nvoid main(void) {\n    gl_Position = projMatrix * viewMatrix * vec4( pos, 1.0);\n    vcolor = color;\n}\n&quot;,tri_render_vertex:&quot;// Vertex shader for rendering triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform float T; // 1.0 if there is a texture, else 0.0\nuniform float B; // 1.0 if there is a bumpmap, else 0.0\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n\nvoid main(void) {\n    vec4 pos4 = viewMatrix * vec4( pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(normal, 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color, opacity);\n    parameters = vec4(shininess, emissive, T, B);\n}\n&quot;}});</td>
      </tr>
      <tr>
        <td id="L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="LC16" class="blob-code blob-code-inner js-file-line">if(!Object.create||!Object.defineProperty||!Object.defineProperties)alert(&quot;Example will fail because your browser does not support ECMAScript 5. Try with another browser!&quot;);var __filename=&quot;&quot;+window.location;window.Streamline={globals:{}};function srequire(str){if(str==&quot;streamline/lib/util/flows&quot;)return Streamline.flows;else if(str==&quot;streamline/lib/globals&quot;)return Streamline.globals;else if(str==&quot;streamline/lib/version&quot;)return Streamline.version;else if(str==&quot;streamline/lib/callbacks/runtime&quot;)return Streamline.runtime;else if(str==&quot;streamline/lib/callbacks/transform&quot;)return Streamline;else if(str==&quot;streamline/lib/callbacks/builtins&quot;)return Streamline.builtins;else if(str==&quot;streamline/lib/util/future&quot;)return Streamline.future;else if(str==&quot;streamline/lib/util/source-map&quot;)return Streamline.sourceMap.exports;else throw new Error(&quot;Cannot require &quot;+str)}(function(){var narcissus={options:{version:185},hostGlobal:this};Narcissus=narcissus})();Narcissus.definitions=function(){var tokens=[&quot;END&quot;,&quot;\n&quot;,&quot;;&quot;,&quot;,&quot;,&quot;=&quot;,&quot;?&quot;,&quot;:&quot;,&quot;CONDITIONAL&quot;,&quot;||&quot;,&quot;&amp;&amp;&quot;,&quot;|&quot;,&quot;^&quot;,&quot;&amp;&quot;,&quot;==&quot;,&quot;!=&quot;,&quot;===&quot;,&quot;!==&quot;,&quot;&lt;&quot;,&quot;&lt;=&quot;,&quot;&gt;=&quot;,&quot;&gt;&quot;,&quot;&lt;&lt;&quot;,&quot;&gt;&gt;&quot;,&quot;&gt;&gt;&gt;&quot;,&quot;+&quot;,&quot;-&quot;,&quot;*&quot;,&quot;/&quot;,&quot;%&quot;,&quot;!&quot;,&quot;~&quot;,&quot;UNARY_PLUS&quot;,&quot;UNARY_MINUS&quot;,&quot;++&quot;,&quot;--&quot;,&quot;.&quot;,&quot;[&quot;,&quot;]&quot;,&quot;{&quot;,&quot;}&quot;,&quot;(&quot;,&quot;)&quot;,&quot;SCRIPT&quot;,&quot;BLOCK&quot;,&quot;LABEL&quot;,&quot;FOR_IN&quot;,&quot;CALL&quot;,&quot;NEW_WITH_ARGS&quot;,&quot;INDEX&quot;,&quot;ARRAY_INIT&quot;,&quot;OBJECT_INIT&quot;,&quot;PROPERTY_INIT&quot;,&quot;GETTER&quot;,&quot;SETTER&quot;,&quot;GROUP&quot;,&quot;LIST&quot;,&quot;LET_BLOCK&quot;,&quot;ARRAY_COMP&quot;,&quot;GENERATOR&quot;,&quot;COMP_TAIL&quot;,&quot;IDENTIFIER&quot;,&quot;NUMBER&quot;,&quot;STRING&quot;,&quot;REGEXP&quot;,&quot;break&quot;,&quot;case&quot;,&quot;catch&quot;,&quot;const&quot;,&quot;continue&quot;,&quot;debugger&quot;,&quot;default&quot;,&quot;delete&quot;,&quot;do&quot;,&quot;else&quot;,&quot;false&quot;,&quot;finally&quot;,&quot;for&quot;,&quot;function&quot;,&quot;if&quot;,&quot;in&quot;,&quot;instanceof&quot;,&quot;let&quot;,&quot;new&quot;,&quot;null&quot;,&quot;return&quot;,&quot;switch&quot;,&quot;this&quot;,&quot;throw&quot;,&quot;true&quot;,&quot;try&quot;,&quot;typeof&quot;,&quot;var&quot;,&quot;void&quot;,&quot;yield&quot;,&quot;while&quot;,&quot;with&quot;];var statementStartTokens=[&quot;break&quot;,&quot;const&quot;,&quot;continue&quot;,&quot;debugger&quot;,&quot;do&quot;,&quot;for&quot;,&quot;if&quot;,&quot;return&quot;,&quot;switch&quot;,&quot;throw&quot;,&quot;try&quot;,&quot;var&quot;,&quot;yield&quot;,&quot;while&quot;,&quot;with&quot;];var opTypeNames={&quot;\n&quot;:&quot;NEWLINE&quot;,&quot;;&quot;:&quot;SEMICOLON&quot;,&quot;,&quot;:&quot;COMMA&quot;,&quot;?&quot;:&quot;HOOK&quot;,&quot;:&quot;:&quot;COLON&quot;,&quot;||&quot;:&quot;OR&quot;,&quot;&amp;&amp;&quot;:&quot;AND&quot;,&quot;|&quot;:&quot;BITWISE_OR&quot;,&quot;^&quot;:&quot;BITWISE_XOR&quot;,&quot;&amp;&quot;:&quot;BITWISE_AND&quot;,&quot;===&quot;:&quot;STRICT_EQ&quot;,&quot;==&quot;:&quot;EQ&quot;,&quot;=&quot;:&quot;ASSIGN&quot;,&quot;!==&quot;:&quot;STRICT_NE&quot;,&quot;!=&quot;:&quot;NE&quot;,&quot;&lt;&lt;&quot;:&quot;LSH&quot;,&quot;&lt;=&quot;:&quot;LE&quot;,&quot;&lt;&quot;:&quot;LT&quot;,&quot;&gt;&gt;&gt;&quot;:&quot;URSH&quot;,&quot;&gt;&gt;&quot;:&quot;RSH&quot;,&quot;&gt;=&quot;:&quot;GE&quot;,&quot;&gt;&quot;:&quot;GT&quot;,&quot;++&quot;:&quot;INCREMENT&quot;,&quot;--&quot;:&quot;DECREMENT&quot;,&quot;+&quot;:&quot;PLUS&quot;,&quot;-&quot;:&quot;MINUS&quot;,&quot;*&quot;:&quot;MUL&quot;,&quot;/&quot;:&quot;DIV&quot;,&quot;%&quot;:&quot;MOD&quot;,&quot;!&quot;:&quot;NOT&quot;,&quot;~&quot;:&quot;BITWISE_NOT&quot;,&quot;.&quot;:&quot;DOT&quot;,&quot;[&quot;:&quot;LEFT_BRACKET&quot;,&quot;]&quot;:&quot;RIGHT_BRACKET&quot;,&quot;{&quot;:&quot;LEFT_CURLY&quot;,&quot;}&quot;:&quot;RIGHT_CURLY&quot;,&quot;(&quot;:&quot;LEFT_PAREN&quot;,&quot;)&quot;:&quot;RIGHT_PAREN&quot;};var keywords={__proto__:null};var tokenIds={};var consts=&quot;var &quot;;for(var i=0,j=tokens.length;i&lt;j;i++){if(i&gt;0)consts+=&quot;, &quot;;var t=tokens[i];var name;if(/^[a-z]/.test(t)){name=t.toUpperCase();keywords[t]=i}else{name=/^\W/.test(t)?opTypeNames[t]:t}consts+=name+&quot; = &quot;+i;tokenIds[name]=i;tokens[t]=i}consts+=&quot;;&quot;;var isStatementStartCode={__proto__:null};for(i=0,j=statementStartTokens.length;i&lt;j;i++)isStatementStartCode[keywords[statementStartTokens[i]]]=true;var assignOps=[&quot;|&quot;,&quot;^&quot;,&quot;&amp;&quot;,&quot;&lt;&lt;&quot;,&quot;&gt;&gt;&quot;,&quot;&gt;&gt;&gt;&quot;,&quot;+&quot;,&quot;-&quot;,&quot;*&quot;,&quot;/&quot;,&quot;%&quot;];for(i=0,j=assignOps.length;i&lt;j;i++){t=assignOps[i];assignOps[t]=tokens[t]}function defineGetter(obj,prop,fn,dontDelete,dontEnum){Object.defineProperty(obj,prop,{get:fn,configurable:!dontDelete,enumerable:!dontEnum})}function defineProperty(obj,prop,val,dontDelete,readOnly,dontEnum){Object.defineProperty(obj,prop,{value:val,writable:!readOnly,configurable:!dontDelete,enumerable:!dontEnum})}function isNativeCode(fn){return typeof fn===&quot;function&quot;&amp;&amp;fn.toString().match(/\[native code\]/)}function getPropertyDescriptor(obj,name){while(obj){if({}.hasOwnProperty.call(obj,name))return Object.getOwnPropertyDescriptor(obj,name);obj=Object.getPrototypeOf(obj)}}function getOwnProperties(obj){var map={};for(var name in Object.getOwnPropertyNames(obj))map[name]=Object.getOwnPropertyDescriptor(obj,name);return map}function makePassthruHandler(obj){return{getOwnPropertyDescriptor:function(name){var desc=Object.getOwnPropertyDescriptor(obj,name);desc.configurable=true;return desc},getPropertyDescriptor:function(name){var desc=getPropertyDescriptor(obj,name);desc.configurable=true;return desc},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(obj)},defineProperty:function(name,desc){Object.defineProperty(obj,name,desc)},&quot;delete&quot;:function(name){return delete obj[name]},fix:function(){if(Object.isFrozen(obj)){return getOwnProperties(obj)}return undefined},has:function(name){return name in obj},hasOwn:function(name){return{}.hasOwnProperty.call(obj,name)},get:function(receiver,name){return obj[name]},set:function(receiver,name,val){obj[name]=val;return true},enumerate:function(){var result=[];for(name in obj){result.push(name)}return result},keys:function(){return Object.keys(obj)}}}function noPropFound(){return undefined}var hasOwnProperty={}.hasOwnProperty;function StringMap(){this.table=Object.create(null,{});this.size=0}StringMap.prototype={has:function(x){return hasOwnProperty.call(this.table,x)},set:function(x,v){if(!hasOwnProperty.call(this.table,x))this.size++;this.table[x]=v},get:function(x){return this.table[x]},getDef:function(x,thunk){if(!hasOwnProperty.call(this.table,x)){this.size++;this.table[x]=thunk()}return this.table[x]},forEach:function(f){var table=this.table;for(var key in table)f.call(this,key,table[key])},toString:function(){return&quot;[object StringMap]&quot;}};function Stack(elts){this.elts=elts||null}Stack.prototype={push:function(x){return new Stack({top:x,rest:this.elts})},top:function(){if(!this.elts)throw new Error(&quot;empty stack&quot;);return this.elts.top},isEmpty:function(){return this.top===null},find:function(test){for(var elts=this.elts;elts;elts=elts.rest){if(test(elts.top))return elts.top}return null},has:function(x){return Boolean(this.find(function(elt){return elt===x}))},forEach:function(f){for(var elts=this.elts;elts;elts=elts.rest){f(elts.top)}}};return{tokens:tokens,opTypeNames:opTypeNames,keywords:keywords,isStatementStartCode:isStatementStartCode,tokenIds:tokenIds,consts:consts,assignOps:assignOps,defineGetter:defineGetter,defineProperty:defineProperty,isNativeCode:isNativeCode,makePassthruHandler:makePassthruHandler,noPropFound:noPropFound,StringMap:StringMap,Stack:Stack}}();Narcissus.lexer=function(){var definitions=Narcissus.definitions;eval(definitions.consts);var opTokens={};for(var op in definitions.opTypeNames){if(op===&quot;\n&quot;||op===&quot;.&quot;)continue;var node=opTokens;for(var i=0;i&lt;op.length;i++){var ch=op[i];if(!(ch in node))node[ch]={};node=node[ch];node.op=op}}function Tokenizer(s,f,l){this.cursor=0;this.source=String(s);this.tokens=[];this.tokenIndex=0;this.lookahead=0;this.scanNewlines=false;this.unexpectedEOF=false;this.filename=f||&quot;&quot;;this.lineno=l||1}Tokenizer.prototype={get done(){return this.peek(true)===END},get token(){return this.tokens[this.tokenIndex]},match:function(tt,scanOperand){return this.get(scanOperand)===tt||this.unget()},mustMatch:function(tt){if(!this.match(tt)){throw this.newSyntaxError(&quot;Missing &quot;+definitions.tokens[tt].toLowerCase())}return this.token},forceIdentifier:function(){if(!this.match(IDENTIFIER)){if(this.get()&gt;=definitions.keywords[0]||this.unget){this.token.type=IDENTIFIER}else{throw this.newSyntaxError(&quot;Missing identifier&quot;)}}return this.token},peek:function(scanOperand){var tt,next;if(this.lookahead){next=this.tokens[this.tokenIndex+this.lookahead&amp;3];tt=this.scanNewlines&amp;&amp;next.lineno!==this.lineno?NEWLINE:next.type}else{tt=this.get(scanOperand);this.unget()}return tt},peekOnSameLine:function(scanOperand){this.scanNewlines=true;var tt=this.peek(scanOperand);this.scanNewlines=false;return tt},skip:function(){var input=this.source;for(;;){var ch=input[this.cursor++];var next=input[this.cursor];if(ch===&quot;\n&quot;&amp;&amp;!this.scanNewlines){this.lineno++}else if(ch===&quot;/&quot;&amp;&amp;next===&quot;*&quot;){this.cursor++;for(;;){ch=input[this.cursor++];if(ch===undefined)throw this.newSyntaxError(&quot;Unterminated comment&quot;);if(ch===&quot;*&quot;){next=input[this.cursor];if(next===&quot;/&quot;){this.cursor++;break}}else if(ch===&quot;\n&quot;){this.lineno++}}}else if(ch===&quot;/&quot;&amp;&amp;next===&quot;/&quot;){this.cursor++;for(;;){ch=input[this.cursor++];if(ch===undefined)return;if(ch===&quot;\n&quot;){this.lineno++;break}}}else if(ch!==&quot; &quot;&amp;&amp;ch!==&quot;	&quot;){this.cursor--;return}}},lexExponent:function(){var input=this.source;var next=input[this.cursor];if(next===&quot;e&quot;||next===&quot;E&quot;){this.cursor++;ch=input[this.cursor++];if(ch===&quot;+&quot;||ch===&quot;-&quot;)ch=input[this.cursor++];if(ch&lt;&quot;0&quot;||ch&gt;&quot;9&quot;)throw this.newSyntaxError(&quot;Missing exponent&quot;);do{ch=input[this.cursor++]}while(ch&gt;=&quot;0&quot;&amp;&amp;ch&lt;=&quot;9&quot;);this.cursor--;return true}return false},lexZeroNumber:function(ch){var token=this.token,input=this.source;token.type=NUMBER;ch=input[this.cursor++];if(ch===&quot;.&quot;){do{ch=input[this.cursor++]}while(ch&gt;=&quot;0&quot;&amp;&amp;ch&lt;=&quot;9&quot;);this.cursor--;this.lexExponent();token.value=parseFloat(input.substring(token.start,this.cursor))}else if(ch===&quot;x&quot;||ch===&quot;X&quot;){do{ch=input[this.cursor++]}while(ch&gt;=&quot;0&quot;&amp;&amp;ch&lt;=&quot;9&quot;||ch&gt;=&quot;a&quot;&amp;&amp;ch&lt;=&quot;f&quot;||ch&gt;=&quot;A&quot;&amp;&amp;ch&lt;=&quot;F&quot;);this.cursor--;token.value=parseInt(input.substring(token.start,this.cursor))}else if(ch&gt;=&quot;0&quot;&amp;&amp;ch&lt;=&quot;7&quot;){do{ch=input[this.cursor++]}while(ch&gt;=&quot;0&quot;&amp;&amp;ch&lt;=&quot;7&quot;);this.cursor--;token.value=parseInt(input.substring(token.start,this.cursor),8);token.value.isOctal=true}else{this.cursor--;this.lexExponent();token.value=0}},lexNumber:function(ch){var token=this.token,input=this.source;token.type=NUMBER;var floating=false;do{ch=input[this.cursor++];if(ch===&quot;.&quot;&amp;&amp;!floating){floating=true;ch=input[this.cursor++]}}while(ch&gt;=&quot;0&quot;&amp;&amp;ch&lt;=&quot;9&quot;);this.cursor--;var exponent=this.lexExponent();floating=floating||exponent;var str=input.substring(token.start,this.cursor);token.value=floating?parseFloat(str):parseInt(str)},lexDot:function(ch){var token=this.token,input=this.source;var next=input[this.cursor];if(next&gt;=&quot;0&quot;&amp;&amp;next&lt;=&quot;9&quot;){do{ch=input[this.cursor++]}while(ch&gt;=&quot;0&quot;&amp;&amp;ch&lt;=&quot;9&quot;);this.cursor--;this.lexExponent();token.type=NUMBER;token.value=parseFloat(input.substring(token.start,this.cursor))}else{token.type=DOT;token.assignOp=null;token.value=&quot;.&quot;}},lexString:function(ch){var token=this.token,input=this.source;token.type=STRING;var hasEscapes=false;var delim=ch;while((ch=input[this.cursor++])!==delim){if(this.cursor==input.length)throw this.newSyntaxError(&quot;Unterminated string literal&quot;);if(ch===&quot;\\&quot;){hasEscapes=true;if(input[this.cursor]===&quot;\n&quot;)this.lineno++;if(++this.cursor==input.length)throw this.newSyntaxError(&quot;Unterminated string literal&quot;)}}token.value=hasEscapes?eval(input.substring(token.start,this.cursor)):input.substring(token.start+1,this.cursor-1)},lexRegExp:function(ch){var token=this.token,input=this.source;token.type=REGEXP;do{ch=input[this.cursor++];if(ch===&quot;\\&quot;){this.cursor++}else if(ch===&quot;[&quot;){do{if(ch===undefined)throw this.newSyntaxError(&quot;Unterminated character class&quot;);if(ch===&quot;\\&quot;)this.cursor++;ch=input[this.cursor++]}while(ch!==&quot;]&quot;)}else if(ch===undefined){throw this.newSyntaxError(&quot;Unterminated regex&quot;)}}while(ch!==&quot;/&quot;);do{ch=input[this.cursor++]}while(ch&gt;=&quot;a&quot;&amp;&amp;ch&lt;=&quot;z&quot;);this.cursor--;token.value=eval(input.substring(token.start,this.cursor))},lexOp:function(ch){var token=this.token,input=this.source;var node=opTokens[ch];var next=input[this.cursor];if(next in node){node=node[next];this.cursor++;next=input[this.cursor];if(next in node){node=node[next];this.cursor++;next=input[this.cursor]}}var op=node.op;if(definitions.assignOps[op]&amp;&amp;input[this.cursor]===&quot;=&quot;){this.cursor++;token.type=ASSIGN;token.assignOp=definitions.tokenIds[definitions.opTypeNames[op]];op+=&quot;=&quot;}else{token.type=definitions.tokenIds[definitions.opTypeNames[op]];token.assignOp=null}token.value=op},lexIdent:function(ch){var token=this.token,input=this.source;do{ch=input[this.cursor++]}while(ch&gt;=&quot;a&quot;&amp;&amp;ch&lt;=&quot;z&quot;||ch&gt;=&quot;A&quot;&amp;&amp;ch&lt;=&quot;Z&quot;||ch&gt;=&quot;0&quot;&amp;&amp;ch&lt;=&quot;9&quot;||ch===&quot;$&quot;||ch===&quot;_&quot;);this.cursor--;var id=input.substring(token.start,this.cursor);token.type=definitions.keywords[id]||IDENTIFIER;token.value=id},get:function(scanOperand){var token;while(this.lookahead){--this.lookahead;this.tokenIndex=this.tokenIndex+1&amp;3;token=this.tokens[this.tokenIndex];if(token.type!==NEWLINE||this.scanNewlines)return token.type}this.skip();this.tokenIndex=this.tokenIndex+1&amp;3;token=this.tokens[this.tokenIndex];if(!token)this.tokens[this.tokenIndex]=token={};var input=this.source;if(this.cursor===input.length)return token.type=END;token.start=this.cursor;token.lineno=this.lineno;var ch=input[this.cursor++];if(ch&gt;=&quot;a&quot;&amp;&amp;ch&lt;=&quot;z&quot;||ch&gt;=&quot;A&quot;&amp;&amp;ch&lt;=&quot;Z&quot;||ch===&quot;$&quot;||ch===&quot;_&quot;){this.lexIdent(ch)}else if(scanOperand&amp;&amp;ch===&quot;/&quot;){this.lexRegExp(ch)}else if(ch in opTokens){this.lexOp(ch)}else if(ch===&quot;.&quot;){this.lexDot(ch)}else if(ch&gt;=&quot;1&quot;&amp;&amp;ch&lt;=&quot;9&quot;){this.lexNumber(ch)}else if(ch===&quot;0&quot;){this.lexZeroNumber(ch)}else if(ch===&#39;&quot;&#39;||ch===&quot;&#39;&quot;){this.lexString(ch)}else if(this.scanNewlines&amp;&amp;ch===&quot;\n&quot;){token.type=NEWLINE;token.value=&quot;\n&quot;;this.lineno++}else{throw this.newSyntaxError(&quot;Illegal token&quot;)}token.end=this.cursor;return token.type},unget:function(){if(++this.lookahead===4)throw&quot;PANIC: too much lookahead!&quot;;this.tokenIndex=this.tokenIndex-1&amp;3},newSyntaxError:function(m){var e=new SyntaxError(this.filename+&quot;:&quot;+this.lineno+&quot;:&quot;+m);e.source=this.source;e.cursor=this.lookahead?this.tokens[this.tokenIndex+this.lookahead&amp;3].start:this.cursor;return e}};return{Tokenizer:Tokenizer}}();Narcissus.parser=function(){var lexer=Narcissus.lexer;var definitions=Narcissus.definitions;const StringMap=definitions.StringMap;const Stack=definitions.Stack;eval(definitions.consts);function pushDestructuringVarDecls(n,s){for(var i in n){var sub=n[i];if(sub.type===IDENTIFIER){s.varDecls.push(sub)}else{pushDestructuringVarDecls(sub,s)}}}const NESTING_TOP=0,NESTING_SHALLOW=1,NESTING_DEEP=2;function StaticContext(parentScript,parentBlock,inFunction,inForLoopInit,nesting){this.parentScript=parentScript;this.parentBlock=parentBlock;this.inFunction=inFunction;this.inForLoopInit=inForLoopInit;this.nesting=nesting;this.allLabels=new Stack;this.currentLabels=new Stack;this.labeledTargets=new Stack;this.defaultTarget=null;Narcissus.options.ecma3OnlyMode&amp;&amp;(this.ecma3OnlyMode=true);Narcissus.options.parenFreeMode&amp;&amp;(this.parenFreeMode=true)}StaticContext.prototype={ecma3OnlyMode:false,parenFreeMode:false,update:function(ext){var desc={};for(var key in ext){desc[key]={value:ext[key],writable:true,enumerable:true,configurable:true}}return Object.create(this,desc)},pushLabel:function(label){return this.update({currentLabels:this.currentLabels.push(label),allLabels:this.allLabels.push(label)})},pushTarget:function(target){var isDefaultTarget=target.isLoop||target.type===SWITCH;if(isDefaultTarget)target.target=this.defaultTarget;if(this.currentLabels.isEmpty()){return isDefaultTarget?this.update({defaultTarget:target}):this}target.labels=new StringMap;this.currentLabels.forEach(function(label){target.labels.set(label,true)});return this.update({currentLabels:new Stack,labeledTargets:this.labeledTargets.push(target),defaultTarget:isDefaultTarget?target:this.defaultTarget})},nest:function(atLeast){var nesting=Math.max(this.nesting,atLeast);return nesting!==this.nesting?this.update({nesting:nesting}):this}};function Script(t,inFunction){var n=new Node(t,scriptInit());var x=new StaticContext(n,n,inFunction,false,NESTING_TOP);Statements(t,x,n);return n}definitions.defineProperty(Array.prototype,&quot;top&quot;,function(){return this.length&amp;&amp;this[this.length-1]},false,false,true);function Node(t,init){var token=t.token;if(token){this.type=token.type;this.value=token.value;this.lineno=token.lineno;this.start=token.start;this.end=token.end}else{this.lineno=t.lineno}this.tokenizer=t;this.children=[];for(var prop in init)this[prop]=init[prop]}var Np=Node.prototype={};Np.constructor=Node;Np.toSource=Object.prototype.toSource;Np.push=function(kid){if(kid!==null){if(kid.start&lt;this.start)this.start=kid.start;if(this.end&lt;kid.end)this.end=kid.end}return this.children.push(kid)};Node.indentLevel=0;function tokenString(tt){var t=definitions.tokens[tt];return/^\W/.test(t)?definitions.opTypeNames[t]:t.toUpperCase()}Np.toString=function(){var a=[];for(var i in this){if(this.hasOwnProperty(i)&amp;&amp;i!==&quot;type&quot;&amp;&amp;i!==&quot;target&quot;)a.push({id:i,value:this[i]})}a.sort(function(a,b){return a.id&lt;b.id?-1:1});const INDENTATION=&quot;    &quot;;var n=++Node.indentLevel;var s=&quot;{\n&quot;+INDENTATION.repeat(n)+&quot;type: &quot;+tokenString(this.type);for(i=0;i&lt;a.length;i++)s+=&quot;, &quot;+a[i].id+&quot;: &quot;+a[i].value;n=--Node.indentLevel;s+=&quot;\n&quot;+INDENTATION.repeat(n)+&quot;}&quot;;return s};Np.getSource=function(){return this.tokenizer.source.slice(this.start,this.end)};const LOOP_INIT={isLoop:true};function blockInit(){return{type:BLOCK,varDecls:[]}}function scriptInit(){return{type:SCRIPT,funDecls:[],varDecls:[],modDecls:[],impDecls:[],expDecls:[],loadDeps:[],hasEmptyReturn:false,hasReturnWithValue:false,isGenerator:false}}definitions.defineGetter(Np,&quot;filename&quot;,function(){return this.tokenizer.filename});definitions.defineGetter(Np,&quot;length&quot;,function(){throw new Error(&quot;Node.prototype.length is gone; &quot;+&quot;use n.children.length instead&quot;)});definitions.defineProperty(String.prototype,&quot;repeat&quot;,function(n){var s=&quot;&quot;,t=this+s;while(--n&gt;=0)s+=t;return s},false,false,true);function MaybeLeftParen(t,x){if(x.parenFreeMode)return t.match(LEFT_PAREN)?LEFT_PAREN:END;return t.mustMatch(LEFT_PAREN).type}function MaybeRightParen(t,p){if(p===LEFT_PAREN)t.mustMatch(RIGHT_PAREN)}function Statements(t,x,n){try{while(!t.done&amp;&amp;t.peek(true)!==RIGHT_CURLY)n.push(Statement(t,x))}catch(e){if(t.done)t.unexpectedEOF=true;throw e}}function Block(t,x){t.mustMatch(LEFT_CURLY);var n=new Node(t,blockInit());Statements(t,x.update({parentBlock:n}).pushTarget(n),n);t.mustMatch(RIGHT_CURLY);n.end=t.token.end;return n}const DECLARED_FORM=0,EXPRESSED_FORM=1,STATEMENT_FORM=2;function Statement(t,x){var i,label,n,n2,p,c,ss,tt=t.get(true),tt2,x2,x3;switch(tt){case FUNCTION:return FunctionDefinition(t,x,true,x.nesting!==NESTING_TOP?STATEMENT_FORM:DECLARED_FORM);case LEFT_CURLY:n=new Node(t,blockInit());Statements(t,x.update({parentBlock:n}).pushTarget(n).nest(NESTING_SHALLOW),n);t.mustMatch(RIGHT_CURLY);n.end=t.token.end;return n;case IF:n=new Node(t);n.condition=HeadExpression(t,x);x2=x.pushTarget(n).nest(NESTING_DEEP);n.thenPart=Statement(t,x2);n.elsePart=t.match(ELSE)?Statement(t,x2):null;return n;case SWITCH:n=new Node(t,{cases:[],defaultIndex:-1});n.discriminant=HeadExpression(t,x);x2=x.pushTarget(n).nest(NESTING_DEEP);t.mustMatch(LEFT_CURLY);while((tt=t.get())!==RIGHT_CURLY){switch(tt){case DEFAULT:if(n.defaultIndex&gt;=0)throw t.newSyntaxError(&quot;More than one switch default&quot;);case CASE:n2=new Node(t);if(tt===DEFAULT)n.defaultIndex=n.cases.length;else n2.caseLabel=Expression(t,x2,COLON);break;default:throw t.newSyntaxError(&quot;Invalid switch case&quot;)}t.mustMatch(COLON);n2.statements=new Node(t,blockInit());while((tt=t.peek(true))!==CASE&amp;&amp;tt!==DEFAULT&amp;&amp;tt!==RIGHT_CURLY)n2.statements.push(Statement(t,x2));n.cases.push(n2)}n.end=t.token.end;return n;case FOR:n=new Node(t,LOOP_INIT);if(t.match(IDENTIFIER)){if(t.token.value===&quot;each&quot;)n.isEach=true;else t.unget()}if(!x.parenFreeMode)t.mustMatch(LEFT_PAREN);x2=x.pushTarget(n).nest(NESTING_DEEP);x3=x.update({inForLoopInit:true});if((tt=t.peek())!==SEMICOLON){if(tt===VAR||tt===CONST){t.get();n2=Variables(t,x3)}else if(tt===LET){t.get();if(t.peek()===LEFT_PAREN){n2=LetBlock(t,x3,false)}else{x3.parentBlock=n;n.varDecls=[];n2=Variables(t,x3)}}else{n2=Expression(t,x3)}}if(n2&amp;&amp;t.match(IN)){n.type=FOR_IN;n.object=Expression(t,x3);if(n2.type===VAR||n2.type===LET){c=n2.children;if(c.length!==1&amp;&amp;n2.destructurings.length!==1){throw new SyntaxError(&quot;Invalid for..in left-hand side&quot;,t.filename,n2.lineno)}if(n2.destructurings.length&gt;0){n.iterator=n2.destructurings[0]}else{n.iterator=c[0]}n.varDecl=n2}else{if(n2.type===ARRAY_INIT||n2.type===OBJECT_INIT){n2.destructuredNames=checkDestructuring(t,x3,n2)}n.iterator=n2}}else{n.setup=n2;t.mustMatch(SEMICOLON);if(n.isEach)throw t.newSyntaxError(&quot;Invalid for each..in loop&quot;);n.condition=t.peek()===SEMICOLON?null:Expression(t,x3);t.mustMatch(SEMICOLON);tt2=t.peek();n.update=(x.parenFreeMode?tt2===LEFT_CURLY||definitions.isStatementStartCode[tt2]:tt2===RIGHT_PAREN)?null:Expression(t,x3)}if(!x.parenFreeMode)t.mustMatch(RIGHT_PAREN);n.body=Statement(t,x2);n.end=t.token.end;return n;case WHILE:n=new Node(t,{isLoop:true});n.condition=HeadExpression(t,x);n.body=Statement(t,x.pushTarget(n).nest(NESTING_DEEP));n.end=t.token.end;return n;case DO:n=new Node(t,{isLoop:true});n.body=Statement(t,x.pushTarget(n).nest(NESTING_DEEP));t.mustMatch(WHILE);n.condition=HeadExpression(t,x);if(!x.ecmaStrictMode){t.match(SEMICOLON);n.end=t.token.end;return n}break;case BREAK:case CONTINUE:n=new Node(t);x2=x.pushTarget(n);if(t.peekOnSameLine()===IDENTIFIER){t.get();n.label=t.token.value}n.target=n.label?x2.labeledTargets.find(function(target){return target.labels.has(n.label)}):x2.defaultTarget;if(!n.target)throw t.newSyntaxError(&quot;Invalid &quot;+(tt===BREAK?&quot;break&quot;:&quot;continue&quot;));if(tt===CONTINUE){for(var ttt=n.target;ttt&amp;&amp;!ttt.isLoop;ttt=ttt.target);if(!ttt)throw t.newSyntaxError(&quot;Invalid continue&quot;)}break;case TRY:n=new Node(t,{catchClauses:[]});n.tryBlock=Block(t,x);while(t.match(CATCH)){n2=new Node(t);p=MaybeLeftParen(t,x);switch(t.get()){case LEFT_BRACKET:case LEFT_CURLY:t.unget();n2.varName=DestructuringExpression(t,x,true);break;case IDENTIFIER:n2.varName=t.token.value;break;default:throw t.newSyntaxError(&quot;missing identifier in catch&quot;);break}if(t.match(IF)){if(x.ecma3OnlyMode)throw t.newSyntaxError(&quot;Illegal catch guard&quot;);if(n.catchClauses.length&amp;&amp;!n.catchClauses.top().guard)throw t.newSyntaxError(&quot;Guarded catch after unguarded&quot;);n2.guard=Expression(t,x)}MaybeRightParen(t,p);n2.block=Block(t,x);n.catchClauses.push(n2)}if(t.match(FINALLY))n.finallyBlock=Block(t,x);if(!n.catchClauses.length&amp;&amp;!n.finallyBlock)throw t.newSyntaxError(&quot;Invalid try statement&quot;);n.end=t.token.end;return n;case CATCH:case FINALLY:throw t.newSyntaxError(definitions.tokens[tt]+&quot; without preceding try&quot;);case THROW:n=new Node(t);n.exception=Expression(t,x);break;case RETURN:n=ReturnOrYield(t,x);break;case WITH:n=new Node(t);n.object=HeadExpression(t,x);n.body=Statement(t,x.pushTarget(n).nest(NESTING_DEEP));n.end=t.token.end;return n;case VAR:case CONST:n=Variables(t,x);n.eligibleForASI=true;break;case LET:if(t.peek()===LEFT_PAREN)n=LetBlock(t,x,true);else n=Variables(t,x);n.eligibleForASI=true;break;case DEBUGGER:n=new Node(t);break;case NEWLINE:case SEMICOLON:n=new Node(t,{type:SEMICOLON});n.expression=null;return n;default:if(tt===IDENTIFIER){tt=t.peek();if(tt===COLON){label=t.token.value;if(x.allLabels.has(label))throw t.newSyntaxError(&quot;Duplicate label&quot;);t.get();n=new Node(t,{type:LABEL,label:label});n.statement=Statement(t,x.pushLabel(label).nest(NESTING_SHALLOW));n.target=n.statement.type===LABEL?n.statement.target:n.statement;n.end=t.token.end;return n}}n=new Node(t,{type:SEMICOLON});t.unget();n.expression=Expression(t,x);n.end=n.expression.end;break}MagicalSemicolon(t);n.end=t.token.end;return n}function MagicalSemicolon(t){var tt;if(t.lineno===t.token.lineno){tt=t.peekOnSameLine();if(tt!==END&amp;&amp;tt!==NEWLINE&amp;&amp;tt!==SEMICOLON&amp;&amp;tt!==RIGHT_CURLY)throw t.newSyntaxError(&quot;missing ; before statement&quot;)}t.match(SEMICOLON)}function ReturnOrYield(t,x){var n,b,tt=t.token.type,tt2;var parentScript=x.parentScript;if(tt===RETURN){if(false&amp;&amp;!x.inFunction)throw t.newSyntaxError(&quot;Return not in function&quot;)}else{if(!x.inFunction)throw t.newSyntaxError(&quot;Yield not in function&quot;);parentScript.isGenerator=true}n=new Node(t,{value:undefined});tt2=t.peek(true);if(tt2!==END&amp;&amp;tt2!==NEWLINE&amp;&amp;tt2!==SEMICOLON&amp;&amp;tt2!==RIGHT_CURLY&amp;&amp;(tt!==YIELD||tt2!==tt&amp;&amp;tt2!==RIGHT_BRACKET&amp;&amp;tt2!==RIGHT_PAREN&amp;&amp;tt2!==COLON&amp;&amp;tt2!==COMMA)){if(tt===RETURN){n.value=Expression(t,x);parentScript.hasReturnWithValue=true}else{n.value=AssignExpression(t,x)}}else if(tt===RETURN){parentScript.hasEmptyReturn=true}if(parentScript.hasReturnWithValue&amp;&amp;parentScript.isGenerator)throw t.newSyntaxError(&quot;Generator returns a value&quot;);return n}function FunctionDefinition(t,x,requireName,functionForm){var tt;var f=new Node(t,{params:[]});if(f.type!==FUNCTION)f.type=f.value===&quot;get&quot;?GETTER:SETTER;if(t.match(IDENTIFIER))f.name=t.token.value;else if(requireName)throw t.newSyntaxError(&quot;missing function identifier&quot;);var x2=new StaticContext(null,null,true,false,NESTING_TOP);t.mustMatch(LEFT_PAREN);if(!t.match(RIGHT_PAREN)){do{switch(t.get()){case LEFT_BRACKET:case LEFT_CURLY:t.unget();f.params.push(DestructuringExpression(t,x2));break;case IDENTIFIER:f.params.push(t.token.value);break;default:throw t.newSyntaxError(&quot;missing formal parameter&quot;);break}}while(t.match(COMMA));t.mustMatch(RIGHT_PAREN)}tt=t.get();if(tt!==LEFT_CURLY)t.unget();if(tt!==LEFT_CURLY){f.body=AssignExpression(t,x2);if(f.body.isGenerator)throw t.newSyntaxError(&quot;Generator returns a value&quot;)}else{f.body=Script(t,true)}if(tt===LEFT_CURLY)t.mustMatch(RIGHT_CURLY);f.end=t.token.end;f.functionForm=functionForm;if(functionForm===DECLARED_FORM)x.parentScript.funDecls.push(f);return f}function Variables(t,x,letBlock){var n,n2,ss,i,s,tt;tt=t.token.type;switch(tt){case VAR:case CONST:s=x.parentScript;break;case LET:s=x.parentBlock;break;case LEFT_PAREN:tt=LET;s=letBlock;break}n=new Node(t,{type:tt,destructurings:[]});do{tt=t.get();if(tt===LEFT_BRACKET||tt===LEFT_CURLY){t.unget();var dexp=DestructuringExpression(t,x,true);n2=new Node(t,{type:IDENTIFIER,name:dexp,readOnly:n.type===CONST});n.push(n2);pushDestructuringVarDecls(n2.name.destructuredNames,s);n.destructurings.push({exp:dexp,decl:n2});if(x.inForLoopInit&amp;&amp;t.peek()===IN){continue}t.mustMatch(ASSIGN);if(t.token.assignOp)throw t.newSyntaxError(&quot;Invalid variable initialization&quot;);n2.initializer=AssignExpression(t,x);continue}if(tt!==IDENTIFIER)throw t.newSyntaxError(&quot;missing variable name&quot;);n2=new Node(t,{type:IDENTIFIER,name:t.token.value,readOnly:n.type===CONST});n.push(n2);s.varDecls.push(n2);if(t.match(ASSIGN)){if(t.token.assignOp)throw t.newSyntaxError(&quot;Invalid variable initialization&quot;);n2.initializer=AssignExpression(t,x)}}while(t.match(COMMA));n.end=t.token.end;return n}function LetBlock(t,x,isStatement){var n,n2;n=new Node(t,{type:LET_BLOCK,varDecls:[]});t.mustMatch(LEFT_PAREN);n.variables=Variables(t,x,n);t.mustMatch(RIGHT_PAREN);if(isStatement&amp;&amp;t.peek()!==LEFT_CURLY){n2=new Node(t,{type:SEMICOLON,expression:n});isStatement=false}if(isStatement)n.block=Block(t,x);else n.expression=AssignExpression(t,x);return n}function checkDestructuring(t,x,n,simpleNamesOnly){if(n.type===ARRAY_COMP)throw t.newSyntaxError(&quot;Invalid array comprehension left-hand side&quot;);if(n.type!==ARRAY_INIT&amp;&amp;n.type!==OBJECT_INIT)return;var lhss={};var nn,n2,idx,sub,cc,c=n.children;for(var i=0,j=c.length;i&lt;j;i++){if(!(nn=c[i]))continue;if(nn.type===PROPERTY_INIT){cc=nn.children;sub=cc[1];idx=cc[0].value}else if(n.type===OBJECT_INIT){sub=nn;idx=nn.value}else{sub=nn;idx=i}if(sub.type===ARRAY_INIT||sub.type===OBJECT_INIT){lhss[idx]=checkDestructuring(t,x,sub,simpleNamesOnly)}else{if(simpleNamesOnly&amp;&amp;sub.type!==IDENTIFIER){throw t.newSyntaxError(&quot;missing name in pattern&quot;)}lhss[idx]=sub}}return lhss}function DestructuringExpression(t,x,simpleNamesOnly){var n=PrimaryExpression(t,x);n.destructuredNames=checkDestructuring(t,x,n,simpleNamesOnly);return n}function GeneratorExpression(t,x,e){return new Node(t,{type:GENERATOR,expression:e,tail:ComprehensionTail(t,x)})}function ComprehensionTail(t,x){var body,n,n2,n3,p;body=new Node(t,{type:COMP_TAIL});do{n=new Node(t,{type:FOR_IN,isLoop:true});if(t.match(IDENTIFIER)){if(t.token.value===&quot;each&quot;)n.isEach=true;else t.unget()}p=MaybeLeftParen(t,x);switch(t.get()){case LEFT_BRACKET:case LEFT_CURLY:t.unget();n.iterator=DestructuringExpression(t,x);break;case IDENTIFIER:n.iterator=n3=new Node(t,{type:IDENTIFIER});n3.name=n3.value;n.varDecl=n2=new Node(t,{type:VAR});n2.push(n3);x.parentScript.varDecls.push(n3);break;default:throw t.newSyntaxError(&quot;missing identifier&quot;)}t.mustMatch(IN);n.object=Expression(t,x);MaybeRightParen(t,p);body.push(n)}while(t.match(FOR));if(t.match(IF))body.guard=HeadExpression(t,x);return body}function HeadExpression(t,x){var p=MaybeLeftParen(t,x);var n=ParenExpression(t,x);MaybeRightParen(t,p);if(p===END&amp;&amp;!n.parenthesized){var tt=t.peek();if(tt!==LEFT_CURLY&amp;&amp;!definitions.isStatementStartCode[tt])throw t.newSyntaxError(&quot;Unparenthesized head followed by unbraced body&quot;)}return n}function ParenExpression(t,x){var n=Expression(t,x.update({inForLoopInit:x.inForLoopInit&amp;&amp;t.token.type===LEFT_PAREN}));if(t.match(FOR)){if(n.type===YIELD&amp;&amp;!n.parenthesized)throw t.newSyntaxError(&quot;Yield expression must be parenthesized&quot;);if(n.type===COMMA&amp;&amp;!n.parenthesized)throw t.newSyntaxError(&quot;Generator expression must be parenthesized&quot;);n=GeneratorExpression(t,x,n)}return n}function Expression(t,x){var n,n2;n=AssignExpression(t,x);if(t.match(COMMA)){n2=new Node(t,{type:COMMA});n2.push(n);n=n2;do{n2=n.children[n.children.length-1];if(n2.type===YIELD&amp;&amp;!n2.parenthesized)throw t.newSyntaxError(&quot;Yield expression must be parenthesized&quot;);n.push(AssignExpression(t,x))}while(t.match(COMMA))}return n}function AssignExpression(t,x){var n,lhs;if(t.match(YIELD,true))return ReturnOrYield(t,x);n=new Node(t,{type:ASSIGN});lhs=ConditionalExpression(t,x);if(!t.match(ASSIGN)){return lhs}switch(lhs.type){case OBJECT_INIT:case ARRAY_INIT:lhs.destructuredNames=checkDestructuring(t,x,lhs);case IDENTIFIER:case DOT:case INDEX:case CALL:break;default:throw t.newSyntaxError(&quot;Bad left-hand side of assignment&quot;);break}n.assignOp=t.token.assignOp;n.push(lhs);n.push(AssignExpression(t,x));return n}function ConditionalExpression(t,x){var n,n2;n=OrExpression(t,x);if(t.match(HOOK)){n2=n;n=new Node(t,{type:HOOK});n.push(n2);n.push(AssignExpression(t,x.update({inForLoopInit:false})));if(!t.match(COLON))throw t.newSyntaxError(&quot;missing : after ?&quot;);n.push(AssignExpression(t,x))}return n}function OrExpression(t,x){var n,n2;n=AndExpression(t,x);while(t.match(OR)){n2=new Node(t);n2.push(n);n2.push(AndExpression(t,x));n=n2}return n}function AndExpression(t,x){var n,n2;n=BitwiseOrExpression(t,x);while(t.match(AND)){n2=new Node(t);n2.push(n);n2.push(BitwiseOrExpression(t,x));n=n2}return n}function BitwiseOrExpression(t,x){var n,n2;n=BitwiseXorExpression(t,x);while(t.match(BITWISE_OR)){n2=new Node(t);n2.push(n);n2.push(BitwiseXorExpression(t,x));n=n2}return n}function BitwiseXorExpression(t,x){var n,n2;n=BitwiseAndExpression(t,x);while(t.match(BITWISE_XOR)){n2=new Node(t);n2.push(n);n2.push(BitwiseAndExpression(t,x));n=n2}return n}function BitwiseAndExpression(t,x){var n,n2;n=EqualityExpression(t,x);while(t.match(BITWISE_AND)){n2=new Node(t);n2.push(n);n2.push(EqualityExpression(t,x));n=n2}return n}function EqualityExpression(t,x){var n,n2;n=RelationalExpression(t,x);while(t.match(EQ)||t.match(NE)||t.match(STRICT_EQ)||t.match(STRICT_NE)){n2=new Node(t);n2.push(n);n2.push(RelationalExpression(t,x));n=n2}return n}function RelationalExpression(t,x){var n,n2;var x2=x.update({inForLoopInit:false});n=ShiftExpression(t,x2);while(t.match(LT)||t.match(LE)||t.match(GE)||t.match(GT)||!x.inForLoopInit&amp;&amp;t.match(IN)||t.match(INSTANCEOF)){n2=new Node(t);n2.push(n);n2.push(ShiftExpression(t,x2));n=n2}return n}function ShiftExpression(t,x){var n,n2;n=AddExpression(t,x);while(t.match(LSH)||t.match(RSH)||t.match(URSH)){n2=new Node(t);n2.push(n);n2.push(AddExpression(t,x));n=n2}return n}function AddExpression(t,x){var n,n2;n=MultiplyExpression(t,x);while(t.match(PLUS)||t.match(MINUS)){n2=new Node(t);n2.push(n);n2.push(MultiplyExpression(t,x));n=n2}return n}function MultiplyExpression(t,x){var n,n2;n=UnaryExpression(t,x);while(t.match(MUL)||t.match(DIV)||t.match(MOD)){n2=new Node(t);n2.push(n);n2.push(UnaryExpression(t,x));n=n2}return n}function UnaryExpression(t,x){var n,n2,tt;switch(tt=t.get(true)){case DELETE:case VOID:case TYPEOF:case NOT:case BITWISE_NOT:case PLUS:case MINUS:if(tt===PLUS)n=new Node(t,{type:UNARY_PLUS});else if(tt===MINUS)n=new Node(t,{type:UNARY_MINUS});else n=new Node(t);n.push(UnaryExpression(t,x));break;case INCREMENT:case DECREMENT:n=new Node(t);n.push(MemberExpression(t,x,true));break;default:t.unget();n=MemberExpression(t,x,true);if(t.tokens[t.tokenIndex+t.lookahead-1&amp;3].lineno===t.lineno){if(t.match(INCREMENT)||t.match(DECREMENT)){n2=new Node(t,{postfix:true});n2.push(n);n=n2}}break}return n}function MemberExpression(t,x,allowCallSyntax){var n,n2,name,tt;if(t.match(NEW)){n=new Node(t);n.push(MemberExpression(t,x,false));</td>
      </tr>
      <tr>
        <td id="L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="LC17" class="blob-code blob-code-inner js-file-line">if(t.match(LEFT_PAREN)){n.type=NEW_WITH_ARGS;n.push(ArgumentList(t,x))}}else{n=PrimaryExpression(t,x)}while((tt=t.get())!==END){switch(tt){case DOT:n2=new Node(t);n2.push(n);t.forceIdentifier();n2.push(new Node(t));break;case LEFT_BRACKET:n2=new Node(t,{type:INDEX});n2.push(n);n2.push(Expression(t,x));t.mustMatch(RIGHT_BRACKET);n2.end=t.token.end;break;case LEFT_PAREN:if(allowCallSyntax){n2=new Node(t,{type:CALL});n2.push(n);n2.push(ArgumentList(t,x));break}default:t.unget();return n}n=n2}return n}function ArgumentList(t,x){var n,n2;n=new Node(t,{type:LIST});if(t.match(RIGHT_PAREN,true)){n.end=t.token.end;return n}do{n2=AssignExpression(t,x);if(n2.type===YIELD&amp;&amp;!n2.parenthesized&amp;&amp;t.peek()===COMMA)throw t.newSyntaxError(&quot;Yield expression must be parenthesized&quot;);if(t.match(FOR)){n2=GeneratorExpression(t,x,n2);if(n.children.length&gt;1||t.peek(true)===COMMA)throw t.newSyntaxError(&quot;Generator expression must be parenthesized&quot;)}n.push(n2)}while(t.match(COMMA));t.mustMatch(RIGHT_PAREN);n.end=t.token.end;return n}function PrimaryExpression(t,x){var n,n2,tt=t.get(true);switch(tt){case FUNCTION:n=FunctionDefinition(t,x,false,EXPRESSED_FORM);break;case LEFT_BRACKET:n=new Node(t,{type:ARRAY_INIT});while((tt=t.peek(true))!==RIGHT_BRACKET){if(tt===COMMA){t.get();n.push(null);continue}n.push(AssignExpression(t,x));if(tt!==COMMA&amp;&amp;!t.match(COMMA))break}if(n.children.length===1&amp;&amp;t.match(FOR)){n2=new Node(t,{type:ARRAY_COMP,expression:n.children[0],tail:ComprehensionTail(t,x)});n=n2}t.mustMatch(RIGHT_BRACKET);n.end=t.token.end;break;case LEFT_CURLY:var id,fd;n=new Node(t,{type:OBJECT_INIT});object_init:if(!t.match(RIGHT_CURLY)){do{tt=t.get();if((t.token.value===&quot;get&quot;||t.token.value===&quot;set&quot;)&amp;&amp;t.peek()===IDENTIFIER){if(x.ecma3OnlyMode)throw t.newSyntaxError(&quot;Illegal property accessor&quot;);n.push(FunctionDefinition(t,x,true,EXPRESSED_FORM))}else{switch(tt){case IDENTIFIER:case NUMBER:case STRING:id=new Node(t,{type:IDENTIFIER});break;case RIGHT_CURLY:if(x.ecma3OnlyMode)throw t.newSyntaxError(&quot;Illegal trailing ,&quot;);break object_init;default:if(t.token.value in definitions.keywords){id=new Node(t,{type:IDENTIFIER});break}throw t.newSyntaxError(&quot;Invalid property name&quot;)}if(t.match(COLON)){n2=new Node(t,{type:PROPERTY_INIT});n2.push(id);n2.push(AssignExpression(t,x));n.push(n2)}else{if(t.peek()!==COMMA&amp;&amp;t.peek()!==RIGHT_CURLY)throw t.newSyntaxError(&quot;missing : after property&quot;);n.push(id)}}}while(t.match(COMMA));t.mustMatch(RIGHT_CURLY)}n.end=t.token.end;break;case LEFT_PAREN:var start=t.token.start;n=ParenExpression(t,x);t.mustMatch(RIGHT_PAREN);n.start=start;n.end=t.token.end;n.parenthesized=true;break;case LET:n=LetBlock(t,x,false);break;case NULL:case THIS:case TRUE:case FALSE:case IDENTIFIER:case NUMBER:case STRING:case REGEXP:n=new Node(t);break;default:throw t.newSyntaxError(&quot;missing operand&quot;);break}return n}function parse(s,f,l){var t=new lexer.Tokenizer(s,f,l);var n=Script(t,false);if(!t.done)throw t.newSyntaxError(&quot;Syntax error&quot;);return n}function parseStdin(s,ln){for(;;){try{var t=new lexer.Tokenizer(s,&quot;stdin&quot;,ln.value);var n=Script(t,false);ln.value=t.lineno;return n}catch(e){if(!t.unexpectedEOF)throw e;var more=readline();if(!more)throw e;s+=&quot;\n&quot;+more}}}return{parse:parse,parseStdin:parseStdin,Node:Node,DECLARED_FORM:DECLARED_FORM,EXPRESSED_FORM:EXPRESSED_FORM,STATEMENT_FORM:STATEMENT_FORM,Tokenizer:lexer.Tokenizer,FunctionDefinition:FunctionDefinition}}();Narcissus.decompiler=function(){const parser=Narcissus.parser;const definitions=Narcissus.definitions;const tokens=definitions.tokens;eval(definitions.consts);function indent(n,s){var ss=&quot;&quot;,d=true;for(var i=0,j=s.length;i&lt;j;i++){if(d)for(var k=0;k&lt;n;k++)ss+=&quot; &quot;;ss+=s[i];d=s[i]===&quot;\n&quot;}return ss}function isBlock(n){return n&amp;&amp;n.type===BLOCK}function isNonEmptyBlock(n){return isBlock(n)&amp;&amp;n.children.length&gt;0}function nodeStr(n){return&#39;&quot;&#39;+n.value.replace(/\\/g,&quot;\\\\&quot;).replace(/&quot;/g,&#39;\\&quot;&#39;).replace(/\n/g,&quot;\\n&quot;).replace(/\r/g,&quot;\\r&quot;)+&#39;&quot;&#39;}function pp(n,d,inLetHead){var topScript=false;if(!n)return&quot;&quot;;if(!(n instanceof Object))return n;if(!d){topScript=true;d=1}var p=&quot;&quot;;if(n.parenthesized)p+=&quot;(&quot;;switch(n.type){case FUNCTION:case GETTER:case SETTER:if(n.type===FUNCTION)p+=&quot;function&quot;;else if(n.type===GETTER)p+=&quot;get&quot;;else p+=&quot;set&quot;;p+=(n.name?&quot; &quot;+n.name:&quot;&quot;)+&quot;(&quot;;for(var i=0,j=n.params.length;i&lt;j;i++)p+=(i&gt;0?&quot;, &quot;:&quot;&quot;)+pp(n.params[i],d);p+=&quot;) &quot;+pp(n.body,d);break;case SCRIPT:case BLOCK:var nc=n.children;if(topScript){for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p+=&quot;\n&quot;;p+=pp(nc[i],d);var eoc=p[p.length-1];if(eoc!=&quot;;&quot;)p+=&quot;;&quot;}break}p+=&quot;{&quot;;if(n.id!==undefined)p+=&quot; /* &quot;+n.id+&quot; */&quot;;p+=&quot;\n&quot;;for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p+=&quot;\n&quot;;p+=indent(4,pp(nc[i],d));var eoc=p[p.length-1];if(eoc!=&quot;;&quot;)p+=&quot;;&quot;}p+=&quot;\n}&quot;;break;case LET_BLOCK:p+=&quot;let (&quot;+pp(n.variables,d,true)+&quot;) &quot;;if(n.expression)p+=pp(n.expression,d);else p+=pp(n.block,d);break;case IF:p+=&quot;if (&quot;+pp(n.condition,d)+&quot;) &quot;;var tp=n.thenPart,ep=n.elsePart;var b=isBlock(tp)||isBlock(ep);if(!b)p+=&quot;{\n&quot;;p+=(b?pp(tp,d):indent(4,pp(tp,d)))+&quot;\n&quot;;if(ep){if(!b)p+=&quot;} else {\n&quot;;else p+=&quot; else &quot;;p+=(b?pp(ep,d):indent(4,pp(ep,d)))+&quot;\n&quot;}if(!b)p+=&quot;}&quot;;break;case SWITCH:p+=&quot;switch (&quot;+pp(n.discriminant,d)+&quot;) {\n&quot;;for(var i=0,j=n.cases.length;i&lt;j;i++){var ca=n.cases[i];if(ca.type===CASE)p+=&quot;  case &quot;+pp(ca.caseLabel,d)+&quot;:\n&quot;;else p+=&quot;  default:\n&quot;;ps=pp(ca.statements,d);p+=ps.slice(2,ps.length-2)+&quot;\n&quot;}p+=&quot;}&quot;;break;case FOR:p+=&quot;for (&quot;+pp(n.setup,d)+&quot;; &quot;+pp(n.condition,d)+&quot;; &quot;+pp(n.update,d)+&quot;) &quot;;var pb=pp(n.body,d);if(!isBlock(n.body))p+=&quot;{\n&quot;+indent(4,pb)+&quot;;\n}&quot;;else if(n.body)p+=pb;break;case WHILE:p+=&quot;while (&quot;+pp(n.condition,d)+&quot;) &quot;;var pb=pp(n.body,d);if(!isBlock(n.body))p+=&quot;{\n&quot;+indent(4,pb)+&quot;;\n}&quot;;else p+=pb;break;case FOR_IN:var u=n.varDecl;p+=n.isEach?&quot;for each (&quot;:&quot;for (&quot;;p+=(u?pp(u,d):pp(n.iterator,d))+&quot; in &quot;+pp(n.object,d)+&quot;) &quot;;var pb=pp(n.body,d);if(!isBlock(n.body))p+=&quot;{\n&quot;+indent(4,pb)+&quot;;\n}&quot;;else if(n.body)p+=pb;break;case DO:p+=&quot;do &quot;+pp(n.body,d);p+=&quot; while (&quot;+pp(n.condition,d)+&quot;);&quot;;break;case BREAK:p+=&quot;break&quot;+(n.label?&quot; &quot;+n.label:&quot;&quot;)+&quot;;&quot;;break;case CONTINUE:p+=&quot;continue&quot;+(n.label?&quot; &quot;+n.label:&quot;&quot;)+&quot;;&quot;;break;case TRY:p+=&quot;try &quot;;p+=pp(n.tryBlock,d);for(var i=0,j=n.catchClauses.length;i&lt;j;i++){var t=n.catchClauses[i];p+=&quot; catch (&quot;+pp(t.varName,d)+(t.guard?&quot; if &quot;+pp(t.guard,d):&quot;&quot;)+&quot;) &quot;;p+=pp(t.block,d)}if(n.finallyBlock){p+=&quot; finally &quot;;p+=pp(n.finallyBlock,d)}break;case THROW:p+=&quot;throw &quot;+pp(n.exception,d);break;case RETURN:p+=&quot;return&quot;;if(n.value)p+=&quot; &quot;+pp(n.value,d);break;case YIELD:p+=&quot;yield&quot;;if(n.value.type)p+=&quot; &quot;+pp(n.value,d);break;case GENERATOR:p+=pp(n.expression,d)+&quot; &quot;+pp(n.tail,d);break;case WITH:p+=&quot;with (&quot;+pp(n.object,d)+&quot;) &quot;;p+=pp(n.body,d);break;case LET:case VAR:case CONST:var nc=n.children;if(!inLetHead){p+=tokens[n.type]+&quot; &quot;}for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p+=&quot;, &quot;;var u=nc[i];p+=pp(u.name,d);if(u.initializer)p+=&quot; = &quot;+pp(u.initializer,d)}break;case DEBUGGER:p+=&quot;debugger\n&quot;;break;case SEMICOLON:if(n.expression){p+=pp(n.expression,d)+&quot;;&quot;}break;case LABEL:p+=n.label+&quot;:\n&quot;+pp(n.statement,d);break;case COMMA:case LIST:var nc=n.children;for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p+=&quot;, &quot;;p+=pp(nc[i],d)}break;case ASSIGN:var nc=n.children;var t=n.assignOp;p+=pp(nc[0],d)+&quot; &quot;+(t?tokens[t]:&quot;&quot;)+&quot;=&quot;+&quot; &quot;+pp(nc[1],d);break;case HOOK:var nc=n.children;p+=&quot;(&quot;+pp(nc[0],d)+&quot; ? &quot;+pp(nc[1],d)+&quot; : &quot;+pp(nc[2],d);p+=&quot;)&quot;;break;case OR:case AND:var nc=n.children;p+=&quot;(&quot;+pp(nc[0],d)+&quot; &quot;+tokens[n.type]+&quot; &quot;+pp(nc[1],d);p+=&quot;)&quot;;break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var nc=n.children;p+=&quot;(&quot;+pp(nc[0],d)+&quot; &quot;+tokens[n.type]+&quot; &quot;+pp(nc[1],d)+&quot;)&quot;;break;case DELETE:case VOID:case TYPEOF:p+=tokens[n.type]+&quot; &quot;+pp(n.children[0],d);break;case NOT:case BITWISE_NOT:p+=tokens[n.type]+pp(n.children[0],d);break;case UNARY_PLUS:p+=&quot;+&quot;+pp(n.children[0],d);break;case UNARY_MINUS:p+=&quot;-&quot;+pp(n.children[0],d);break;case INCREMENT:case DECREMENT:if(n.postfix){p+=pp(n.children[0],d)+tokens[n.type]}else{p+=tokens[n.type]+pp(n.children[0],d)}break;case DOT:var nc=n.children;p+=pp(nc[0],d)+&quot;.&quot;+pp(nc[1],d);break;case INDEX:var nc=n.children;p+=pp(nc[0],d)+&quot;[&quot;+pp(nc[1],d)+&quot;]&quot;;break;case CALL:var nc=n.children;p+=pp(nc[0],d)+&quot;(&quot;+pp(nc[1],d)+&quot;)&quot;;break;case NEW:case NEW_WITH_ARGS:var nc=n.children;p+=&quot;new &quot;+pp(nc[0],d);if(nc[1])p+=&quot;(&quot;+pp(nc[1],d)+&quot;)&quot;;break;case ARRAY_INIT:p+=&quot;[&quot;;var nc=n.children;for(var i=0,j=nc.length;i&lt;j;i++){if(nc[i])p+=pp(nc[i],d);p+=&quot;,&quot;}p+=&quot;]&quot;;break;case ARRAY_COMP:p+=&quot;[&quot;+pp(n.expression,d)+&quot; &quot;;p+=pp(n.tail,d);p+=&quot;]&quot;;break;case COMP_TAIL:var nc=n.children;for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p+=&quot; &quot;;p+=pp(nc[i],d)}if(n.guard)p+=&quot; if (&quot;+pp(n.guard,d)+&quot;)&quot;;break;case OBJECT_INIT:var nc=n.children;if(nc[0]&amp;&amp;nc[0].type===PROPERTY_INIT)p+=&quot;{\n&quot;;else p+=&quot;{&quot;;for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0){p+=&quot;,\n&quot;}var t=nc[i];if(t.type===PROPERTY_INIT){var tc=t.children;var l;if(typeof tc[0].value===&quot;string&quot;&amp;&amp;!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(tc[0].value)){l=nodeStr(tc[0])}else{l=pp(tc[0],d)}p+=indent(4,l)+&quot;: &quot;+indent(4,pp(tc[1],d)).substring(4)}else{p+=indent(4,pp(t,d))}}p+=&quot;\n}&quot;;break;case NULL:p+=&quot;null&quot;;break;case THIS:p+=&quot;this&quot;;break;case TRUE:p+=&quot;true&quot;;break;case FALSE:p+=&quot;false&quot;;break;case IDENTIFIER:case NUMBER:case REGEXP:if(n.value.isOctal)p+=&quot;0&quot;+n.value.toString(8);else p+=n.value;break;case STRING:p+=nodeStr(n);break;case GROUP:p+=&quot;(&quot;+pp(n.children[0],d)+&quot;)&quot;;break;default:throw&quot;PANIC: unknown operation &quot;+tokens[n.type]+&quot; &quot;+n.toSource()}if(n.parenthesized)p+=&quot;)&quot;;return p}return{pp:pp}}();&quot;use strict&quot;;(function(exports){exports.version=&quot;0.10.8&quot;})(typeof exports!==&quot;undefined&quot;?exports:Streamline.version=Streamline.version||{});&quot;use strict&quot;;(function(){var sourceMap;if(typeof exports!==&quot;undefined&quot;){var req=srequire;try{sourceMap=req(&quot;source-map&quot;)}catch(ex){}}if(!sourceMap){sourceMap={SourceNode:function(lineno,column,source,content){this.children=content?[content]:[]}};sourceMap.SourceNode.prototype.add=function(elt){if(Array.isArray(elt))this.children=this.children.concat(elt);else this.children.push(elt);return this};sourceMap.SourceNode.prototype.prepend=function(elt){if(Array.isArray(elt))this.children=elt.concat(this.children.concat);else this.children.unshift(elt);return this};sourceMap.SourceNode.prototype.toString=function(){var str=&quot;&quot;;this.walk(function(chunk){str+=chunk});return str};sourceMap.SourceNode.prototype.walk=function(f){this.children.forEach(function(n){if(n instanceof sourceMap.SourceNode)n.walk(f);else f(n)});return this}}(function(module){function SourceNode(){sourceMap.SourceNode.apply(this,arguments)}SourceNode.prototype=Object.create(sourceMap.SourceNode.prototype,{constructor:{value:SourceNode,enumerable:false,writable:true,configurable:true},length:{get:function(){var len=0;this.walk(function(str){len+=str.length});return len}}});SourceNode.prototype.stripPrefix=function(offset){var _len;while(this.children.length&gt;0&amp;&amp;offset&gt;0&amp;&amp;(_len=this.children[0].length)&lt;=offset){this.children.shift();offset-=_len}if(this.children.length==0||offset==0)return this;if(typeof this.children[0]==&quot;string&quot;){this.children[0]=this.children[0].substring(offset)}else{this.children[0].stripPrefix(offset)}return this};SourceNode.prototype.stripSuffix=function(offset){var _len,chlen;while((chlen=this.children.length)&gt;0&amp;&amp;offset&gt;0&amp;&amp;(_len=this.children[chlen-1].length)&lt;=offset){this.children.pop();offset-=_len}if(chlen==0||offset==0)return this;if(typeof this.children[chlen-1]==&quot;string&quot;){this.children[chlen-1]=this.children[0].slice(0,-offset)}else{this.children[chlen-1].stripSuffix(offset)}return this};SourceNode.prototype.map=function(f){this.children=this.children.map(function(chunk){if(chunk instanceof sourceMap.SourceNode){return chunk.map(f)}else{return f(chunk)}});return this};SourceNode.prototype.lastChar=function(){for(var i=this.children.length;i--;){var ret;if(typeof this.children[i]==&quot;string&quot;){ret=this.children[i].slice(-1)}else{ret=this.children[i].lastChar()}if(ret)return ret}return&quot;&quot;};module.exports=Object.create(sourceMap,{SourceNode:{value:SourceNode}})})(typeof exports!==&quot;undefined&quot;?module:Streamline.sourceMap=Streamline.sourceMap||{})})();if(typeof exports!==&quot;undefined&quot;){var Narcissus=srequire(&quot;streamline/deps/narcissus&quot;)}var sourceMap=srequire(&quot;streamline/lib/util/source-map&quot;);(function(exports){eval(Narcissus.definitions.consts);var tokens=Narcissus.definitions.tokens;exports.format=function(node,linesOpt){var result=&quot;&quot;;var ppOut=_pp(node);if(linesOpt==&quot;sourcemap&quot;){return ppOut.source}ppOut.source=ppOut.source.toString();if(linesOpt==&quot;ignore&quot;)return ppOut.source;var lineMap=ppOut.lineMap;var lines=ppOut.source.split(&quot;\n&quot;);if(linesOpt==&quot;preserve&quot;){var outputLineNo=1,bol=true;for(var i=0;i&lt;lines.length;i++){var sourceNodes=(lineMap[i]||[]).filter(function(n){return n._isSourceNode});if(sourceNodes.length&gt;0){var sourceLineNo=sourceNodes[0].lineno;while(outputLineNo&lt;sourceLineNo){result+=&quot;\n&quot;;outputLineNo+=1;bol=true}}result+=bol?lines[i]:lines[i].replace(/^\s+/,&quot; &quot;);bol=false}result+=&quot;\n&quot;}else if(linesOpt==&quot;mark&quot;){for(var i=0;i&lt;lines.length;i++){var line=lines[i];var sourceNodes=(lineMap[i]||[]).filter(function(n){return n._isSourceNode});var linePrefix=&quot;            &quot;;if(sourceNodes.length&gt;0){var sourceLineNo=&quot;&quot;+sourceNodes[0].lineno;linePrefix=&quot;/* &quot;;for(var j=sourceLineNo.length;j&lt;5;j++)linePrefix+=&quot; &quot;;linePrefix+=sourceLineNo+&quot; */ &quot;}result+=linePrefix+line+&quot;\n&quot;}}else throw new Error(&quot;bad --lines option: &quot;+linesOpt);return result};function _pp(node){var curLineNo=0;var lineNodeMap={};var src=pp(node);return{source:src,lineMap:lineNodeMap};function countNewline(s){curLineNo+=1;return s}function indent(n,s){var dent=new Array(n+1).join(&quot; &quot;);s.map(function(str){return str.replace(/\n/g,&quot;\n&quot;+dent)});s.prepend(new sourceMap.SourceNode(null,null,null,dent));return s}function isBlock(n){return n&amp;&amp;n.type===BLOCK}function isNonEmptyBlock(n){return isBlock(n)&amp;&amp;n.children.length&gt;0}var lines;function sourceNodeFromNode(n,content){var lineno,column,source=n.tokenizer&amp;&amp;n.tokenizer.filename;source=source||void 0;var start=n.start,end=n.end;var sourceString=n.tokenizer&amp;&amp;n.tokenizer.source;if(!source||!start||!end||!sourceString){return new sourceMap.SourceNode(void 0,void 0,void 0,content)}if(source&amp;&amp;!lines){lines=[];lines[-1]=0;var lineno=1;for(var index=sourceString.indexOf(&quot;\n&quot;);index&gt;=0;index=sourceString.indexOf(&quot;\n&quot;,index+1)){lines[index]=lineno;lineno++}}while(start&lt;end&amp;&amp;&quot; \n	;{}&quot;.indexOf(sourceString[start])&gt;=0)start++;if(start&lt;end){var fragment=sourceString.substring(start,end);var newline=sourceString.lastIndexOf(&quot;\n&quot;,start);lineno=lines[newline]+1;column=start-(newline+1)}else{source=void 0}return new sourceMap.SourceNode(lineno,column,source,content)}function nodeStr(n){return sourceNodeFromNode(n,&#39;&quot;&#39;+n.value.replace(/\\/g,&quot;\\\\&quot;).replace(/&quot;/g,&#39;\\&quot;&#39;).replace(/\n/g,&quot;\\n&quot;).replace(/\r/g,&quot;\\r&quot;)+&#39;&quot;&#39;)}function pp(n,d,inLetHead){var topScript=false;if(!n)return&quot;&quot;;if(!(n instanceof Object))return&quot;&quot;+n;if(!d){topScript=true;d=1}if(!lineNodeMap[curLineNo])lineNodeMap[curLineNo]=[];lineNodeMap[curLineNo].push(n);var p=sourceNodeFromNode(n);if(n.parenthesized)p.add(&quot;(&quot;);switch(n.type){case FUNCTION:case GETTER:case SETTER:if(n.type===FUNCTION)p.add(&quot;function&quot;);else if(n.type===GETTER)p.add(&quot;get&quot;);else p.add(&quot;set&quot;);if(n.name){p.add([&quot; &quot;,sourceNodeFromNode(n,n.name)])}p.add(&quot;(&quot;);for(var i=0,j=n.params.length;i&lt;j;i++){p.add([i&gt;0?&quot;, &quot;:&quot;&quot;,pp(n.params[i],d)])}p.add([&quot;) &quot;,pp(n.body,d)]);break;case SCRIPT:case BLOCK:var nc=n.children;if(topScript){for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p.add(countNewline(&quot;\n&quot;));p.add(pp(nc[i],d));if(p.lastChar()!=&quot;;&quot;)p.add(&quot;;&quot;)}break}p.add(&quot;{&quot;);if(n.id!==undefined)p.add(&quot; /* &quot;+n.id+&quot; */&quot;);p.add(countNewline(&quot;\n&quot;));for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p.add(countNewline(&quot;\n&quot;));p.add(indent(2,pp(nc[i],d)));if(p.lastChar()!=&quot;;&quot;)p.add(&quot;;&quot;)}p.add(countNewline(&quot;\n}&quot;));break;case LET_BLOCK:p.add([&quot;let (&quot;,pp(n.variables,d,true),&quot;) &quot;]);if(n.expression)p.add(pp(n.expression,d));else p.add(pp(n.block,d));break;case IF:p.add([&quot;if (&quot;,pp(n.condition,d),&quot;) &quot;]);var tp=n.thenPart,ep=n.elsePart;var b=isBlock(tp)||isBlock(ep);if(!b)p.add(countNewline(&quot;{\n&quot;));p.add(b?pp(tp,d):indent(2,pp(tp,d)));if(ep&amp;&amp;&quot;;}&quot;.indexOf(p.lastChar())&lt;0)p.add(&quot;;&quot;);p.add(countNewline(&quot;\n&quot;));if(ep){if(!b)p.add(countNewline(&quot;} else {\n&quot;));else p.add(&quot; else &quot;);p.add([b?pp(ep,d):indent(2,pp(ep,d)),countNewline(&quot;\n&quot;)])}if(!b)p.add(&quot;}&quot;);break;case SWITCH:p.add([&quot;switch (&quot;,pp(n.discriminant,d),countNewline(&quot;) {\n&quot;)]);for(var i=0,j=n.cases.length;i&lt;j;i++){var ca=n.cases[i];if(ca.type===CASE)p.add([&quot;case &quot;,pp(ca.caseLabel,d),countNewline(&quot;:\n&quot;)]);else p.add(countNewline(&quot;  default:\n&quot;));p.add([pp(ca.statements,d).stripPrefix(2).stripSuffix(2),countNewline(&quot;\n&quot;)]);curLineNo-=2}p.add(&quot;}&quot;);break;case FOR:p.add([&quot;for (&quot;,pp(n.setup,d),&quot;; &quot;,pp(n.condition,d),&quot;; &quot;,pp(n.update,d),&quot;) &quot;]);var pb=pp(n.body,d);if(!isBlock(n.body)){p.add([countNewline(&quot;{\n&quot;),indent(2,pb),countNewline(&quot;;\n}&quot;)])}else if(n.body)p.add(pb);break;case WHILE:p.add([&quot;while (&quot;,pp(n.condition,d),&quot;) &quot;]);var pb=pp(n.body,d);if(!isBlock(n.body)){p.add([countNewline(&quot;{\n&quot;),indent(2,pb),countNewline(&quot;;\n}&quot;)])}else p.add(pb);break;case FOR_IN:var u=n.varDecl;p.add([n.isEach?&quot;for each (&quot;:&quot;for (&quot;,u?pp(u,d):pp(n.iterator,d),&quot; in &quot;,pp(n.object,d),&quot;) &quot;]);var pb=pp(n.body,d);if(!isBlock(n.body)){p.add([countNewline(&quot;{\n&quot;),indent(2,pb),countNewline(&quot;;\n}&quot;)])}else if(n.body)p.add(pb);break;case DO:p.add([&quot;do &quot;,pp(n.body,d),&quot; while (&quot;,pp(n.condition,d),&quot;);&quot;]);break;case BREAK:p.add([&quot;break&quot;,n.label?&quot; &quot;+n.label:&quot;&quot;,&quot;;&quot;]);break;case CONTINUE:p.add([&quot;continue&quot;,n.label?&quot; &quot;+n.label:&quot;&quot;,&quot;;&quot;]);break;case TRY:p.add([&quot;try &quot;,pp(n.tryBlock,d)]);for(var i=0,j=n.catchClauses.length;i&lt;j;i++){var t=n.catchClauses[i];p.add([&quot; catch (&quot;,pp(t.varName,d),t.guard?&quot; if &quot;+pp(t.guard,d):&quot;&quot;,&quot;) &quot;,pp(t.block,d)])}if(n.finallyBlock){p.add([&quot; finally &quot;,pp(n.finallyBlock,d)])}break;case THROW:p.add([&quot;throw &quot;,pp(n.exception,d)]);break;case RETURN:p.add(&quot;return&quot;);if(n.value){p.add([&quot; &quot;,pp(n.value,d)])}break;case YIELD:p.add(&quot;yield&quot;);if(n.value.type){p.add([&quot; &quot;,pp(n.value,d)])}break;case GENERATOR:p.add([pp(n.expression,d),&quot; &quot;,pp(n.tail,d)]);break;case WITH:p.add([&quot;with (&quot;,pp(n.object,d),&quot;) &quot;,pp(n.body,d)]);break;case LET:case VAR:case CONST:var nc=n.children;if(!inLetHead){p.add([tokens[n.type],&quot; &quot;])}for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p.add(&quot;, &quot;);var u=nc[i];p.add(pp(u.name,d));if(u.initializer){p.add([&quot; = &quot;,pp(u.initializer,d)])}}break;case DEBUGGER:p.add(countNewline(&quot;debugger\n&quot;));break;case SEMICOLON:if(n.expression){p.add([pp(n.expression,d),&quot;;&quot;])}break;case LABEL:p.add([n.label,countNewline(&quot;:\n&quot;),pp(n.statement,d)]);break;case COMMA:case LIST:var nc=n.children;for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p.add(&quot;, &quot;);p.add(pp(nc[i],d))}break;case ASSIGN:var nc=n.children;var t=n.assignOp;p.add([pp(nc[0],d),&quot; &quot;,t?tokens[t]:&quot;&quot;,&quot;=&quot;,&quot; &quot;,pp(nc[1],d)]);break;case HOOK:var nc=n.children;p.add([&quot;(&quot;,pp(nc[0],d),&quot; ? &quot;,pp(nc[1],d),&quot; : &quot;,pp(nc[2],d),&quot;)&quot;]);break;case OR:case AND:var nc=n.children;p.add([&quot;(&quot;,pp(nc[0],d),&quot; &quot;,tokens[n.type],&quot; &quot;,pp(nc[1],d),&quot;)&quot;]);break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var nc=n.children;p.add([&quot;(&quot;,pp(nc[0],d),&quot; &quot;,tokens[n.type],&quot; &quot;,pp(nc[1],d),&quot;)&quot;]);break;case DELETE:case VOID:case TYPEOF:p.add([tokens[n.type],&quot; &quot;,pp(n.children[0],d)]);break;case NOT:case BITWISE_NOT:p.add([tokens[n.type],pp(n.children[0],d)]);break;case UNARY_PLUS:p.add([&quot;+&quot;,pp(n.children[0],d)]);break;case UNARY_MINUS:p.add([&quot;-&quot;,pp(n.children[0],d)]);break;case INCREMENT:case DECREMENT:if(n.postfix){p.add([pp(n.children[0],d),tokens[n.type]])}else{p.add([tokens[n.type],pp(n.children[0],d)])}break;case DOT:var nc=n.children;p.add([pp(nc[0],d),&quot;.&quot;,pp(nc[1],d)]);break;case INDEX:var nc=n.children;p.add([pp(nc[0],d),&quot;[&quot;,pp(nc[1],d),&quot;]&quot;]);break;case CALL:var nc=n.children;p.add([pp(nc[0],d),&quot;(&quot;,pp(nc[1],d),&quot;)&quot;]);break;case NEW:case NEW_WITH_ARGS:var nc=n.children;p.add(&quot;new &quot;);p.add(pp(nc[0],d));if(nc[1]){p.add([&quot;(&quot;,pp(nc[1],d),&quot;)&quot;])}break;case ARRAY_INIT:p.add(&quot;[&quot;);var nc=n.children;for(var i=0,j=nc.length;i&lt;j;i++){if(nc[i])p.add(pp(nc[i],d));p.add(&quot;,&quot;)}p.add(&quot;]&quot;);break;case ARRAY_COMP:p.add([&quot;[&quot;,pp(n.expression,d),&quot; &quot;,pp(n.tail,d),&quot;]&quot;]);break;case COMP_TAIL:var nc=n.children;for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0)p.add(&quot; &quot;);p.add(pp(nc[i],d))}if(n.guard){p.add([&quot; if (&quot;,pp(n.guard,d),&quot;)&quot;])}break;case OBJECT_INIT:var nc=n.children;if(nc[0]&amp;&amp;nc[0].type===PROPERTY_INIT)p.add(countNewline(&quot;{\n&quot;));else p.add(&quot;{&quot;);for(var i=0,j=nc.length;i&lt;j;i++){if(i&gt;0){p.add(countNewline(&quot;,\n&quot;))}var t=nc[i];if(t.type===PROPERTY_INIT){var tc=t.children;var l;if(typeof tc[0].value===&quot;string&quot;&amp;&amp;!/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(tc[0].value)){l=nodeStr(tc[0]);p.add(l)}else{l=pp(tc[0],d);p.add(indent(2,l))}p.add([&quot;: &quot;,indent(2,pp(tc[1],d)).stripPrefix(2)])}else{p.add(indent(2,pp(t,d)))}}p.add(countNewline(&quot;\n}&quot;));break;case NULL:p.add(&quot;null&quot;);break;case THIS:p.add(&quot;this&quot;);break;case TRUE:p.add(&quot;true&quot;);break;case FALSE:p.add(&quot;false&quot;);break;case IDENTIFIER:case NUMBER:case REGEXP:if(n.value.isOctal)p.add(&quot;0&quot;+n.value.toString(8));else p.add(&quot;&quot;+n.value);break;case STRING:p.add(nodeStr(n));break;case GROUP:p.add([&quot;(&quot;,pp(n.children[0],d),&quot;)&quot;]);break;default:throw&quot;PANIC: unknown operation &quot;+tokens[n.type]+&quot; &quot;+n.toSource()}if(n.parenthesized)p.add(&quot;)&quot;);return p}}})(typeof exports!==&quot;undefined&quot;?exports:window.Streamline=window.Streamline||{});if(typeof exports!==&quot;undefined&quot;){var Narcissus=srequire(&quot;../../deps/narcissus&quot;);var format=srequire(&quot;./format&quot;).format}else{var format=Streamline.format}(function(exports){exports.version=srequire(&quot;streamline/lib/version&quot;).version+&quot; (callbacks)&quot;;var parse=Narcissus.parser.parse;var pp=Narcissus.decompiler.pp;var definitions=Narcissus.definitions;eval(definitions.consts.replace(/const /g,&quot;var &quot;));function _assert(cond){if(!cond)throw new Error(&quot;Assertion failed!&quot;)}function _tag(node){if(!node||!node.type)return&quot;*NOT_A_NODE*&quot;;var t=definitions.tokens[node.type];return/^\W/.test(t)?definitions.opTypeNames[t]:t.toUpperCase()}function originalLine(options,line,col){if(!options.prevMap)return line;if(col==null)col=1e3;var r=options.prevMap.originalPositionFor({line:line,column:col}).line;return r==null?line:r}function originalCol(options,line,col){if(!options.prevMap)return col;return options.prevMap.originalPositionFor({line:line,column:col}).column||0}function _node(ref,type,children){return{_scope:ref&amp;&amp;ref._scope,_async:ref&amp;&amp;ref._async,type:type,children:children}}function _identifier(name,initializer){return{_scope:initializer&amp;&amp;initializer._scope,type:IDENTIFIER,name:name,value:name,initializer:initializer}}function _number(val){return{type:NUMBER,value:val}}function _string(val){return{type:STRING,value:val}}function _return(node){return{type:RETURN,_scope:node._scope,value:node}}function _semicolon(node){var stmt=_node(node,SEMICOLON);stmt.expression=node;return stmt}function _safeName(precious,name){if(name.substring(0,2)===&quot;__&quot;)while(precious[name])name+=&quot;A&quot;;return name}function _flatten(node){if(node.type==BLOCK||node.type==SCRIPT){do{var found=false;var children=[];node.children.forEach(function(child){if(child._isFunctionReference||child.type==SEMICOLON&amp;&amp;(child.expression==null||child.expression._isFunction))return;node._async|=child._async;if(child.type==BLOCK||child.type==SCRIPT){children=children.concat(child.children);found=true}else children.push(child)});node.children=children}while(found)}return node}function _propagate(node,fn,doAll,clone){var result=clone?clone:node;for(var prop in node){if(node.hasOwnProperty(prop)&amp;&amp;prop.indexOf(&quot;Decls&quot;)&lt;0&amp;&amp;(doAll||prop!=&quot;target&quot;)&amp;&amp;prop[0]!=&quot;_&quot;){var child=node[prop];if(child!=null){if(Array.isArray(child)){if(clone)result[prop]=child=[].concat(child);var undef=false;for(var i=0;i&lt;child.length;i++){if(doAll||child[i]&amp;&amp;child[i].type){child[i]=fn(child[i],node);undef|=typeof child[i]===&quot;undefined&quot;}}if(undef){result[prop]=child.filter(function(elt){return typeof elt!==&quot;undefined&quot;})}}else{if(doAll||child&amp;&amp;child.type)result[prop]=fn(child,node)}}}}return result}function _clone(node){var lastId=0;var clones={};function cloneOne(child){if(!child||!child.type)return child;var cloneId=child._cloneId;if(!cloneId)cloneId=child._cloneId=++lastId;var clone=clones[cloneId];if(clone)return clone;clones[cloneId]=clone={_cloneId:cloneId};return _propagate(child,cloneOne,true,clone)}return _propagate(node,cloneOne,true,{})}function Template(pass,str,isExpression,createScope){var _root=parse(&quot;function _t(){&quot;+str+&quot;}&quot;).children[0].body;if(_root.children.length==1)_root=_root.children[0];else _root=_node(_root.children[0],BLOCK,_root.children);this.generate=function(scopeNode,bindings){var scope=scopeNode._scope;_assert(scope!=null);bindings=bindings||{};var fn=null;function gen(node){if(node.type!=SCRIPT&amp;&amp;node.type!=BLOCK)node._pass=pass;if(node.type==FUNCTION&amp;&amp;createScope){_assert(fn==null);fn=node}if(!node||!node.type){if(node==&quot;_&quot;)return scope.options.callback;if(typeof node===&quot;string&quot;){if(node[0]===&quot;$&quot;)return bindings[node];return _safeName(scope.options.precious,node)}return node}node._scope=scope;var ident=node.type==SEMICOLON?node.expression:node;if(ident&amp;&amp;ident.type==IDENTIFIER&amp;&amp;ident.value[0]===&quot;$&quot;){var result=bindings[ident.value];if(ident.initializer){result.initializer=gen(ident.initializer);if(result.initializer._async)result._async=true}return result}else{node=_propagate(node,function(child){child=gen(child);if(child&amp;&amp;(child._async||child===scope.options.callback&amp;&amp;createScope)&amp;&amp;node.type!==FUNCTION)node._async=true;return child},true);node=_flatten(node);return node}}var result=gen(_clone(_root));if(fn){fn.parenthesized=true;var scope=new Scope(fn.body,fn._scope.options);scope.name=fn._scope.name;scope.line=fn._scope.line;scope.last=fn._scope.last;_assert(fn.params[0]===fn._scope.options.callback);scope.cbIndex=0;function _changeScope(node,parent){if(node.type==FUNCTION)return node;node._scope=scope;return _propagate(node,_changeScope)}_propagate(fn,_changeScope)}return isExpression?result.value:result};this.root=isExpression?_root.value:_root}function Scope(script,options){this.script=script;this.line=0;this.last=0;this.vars=[];this.functions=[];this.options=options;this.cbIndex=-1;this.isAsync=function(){return this.cbIndex&gt;=0}}function _genId(node){return _safeName(node._scope.options.precious,&quot;__&quot;+ ++node._scope.last)}function _removeFast(node,options){function _isMarker(node){return node.type===IDENTIFIER&amp;&amp;node.value===options.callback}function _isStar(node){return node.type===CALL&amp;&amp;_isMarker(node.children[0])&amp;&amp;node.children[1].children.length===2}if(node.type===BITWISE_NOT&amp;&amp;_isMarker(node.children[0])){options.needsTransform=true;return node.children[0]}if(node.type===ARRAY_INIT&amp;&amp;node.children.length===1&amp;&amp;_isMarker(node.children[0])){options.needsTransform=true;node.children[0]._returnArray=true;return node.children[0]}if(node.type===RSH&amp;&amp;_isMarker(node.children[0])){options.needsTransform=true;return node.children[1]}if(node.type===LSH&amp;&amp;_isMarker(node.children[0])){options.needsTransform=true;return node.children[1]}if(node.type===NOT&amp;&amp;_isMarker(node.children[0])){options.needsTransform=true;node.type=FALSE;node.children=[];return node}if(_isStar(node)){node._isStar=true;options.needsTransform=true;node.children[0].value=_safeName(options.precious,&quot;__rt&quot;)+&quot;.streamlinify&quot;;return node}return node}function _markSource(node,options){function _markOne(node){if(typeof node.value===&quot;string&quot;)options.precious[node.value]=true;node.params&amp;&amp;node.params.forEach(function(param){options.precious[param]=true});node._isSourceNode=true;_propagate(node,function(child){child=_removeFast(child,options);_markOne(child);return child})}_markOne(node)}function _isScriptAsync(script,options){var async=false;function _doIt(node,parent){switch(node.type){case FUNCTION:return node;case IDENTIFIER:if(node.value==options.callback){async=true}else{_propagate(node,_doIt)}return node;case CALL:var fn=node.children[0],args=node.children[1],ident;if(fn.type===DOT&amp;&amp;(ident=fn.children[1]).value===&quot;call&quot;&amp;&amp;(fn=fn.children[0]).type===FUNCTION&amp;&amp;fn.params.length===0&amp;&amp;!fn.name&amp;&amp;args.children.length===1&amp;&amp;args.children[0].type===THIS){_propagate(fn.body,_doIt);return node}default:if(!async){_propagate(node,_doIt)}return node}}_propagate(script,_doIt);if(async&amp;&amp;options.verbose)console.log(&quot;WARNING: async calls found at top level in &quot;+script.filename);return async}var _rootTemplate=new Template(&quot;root&quot;,&quot;(function main(_){ $script }).call(this, __trap);&quot;);function _canonTopLevelScript(script,options){script._scope=new Scope(script,options);if(_isScriptAsync(script,options))return _rootTemplate.generate(script,{$script:script});else return script}var _assignTemplate=new Template(&quot;canon&quot;,&quot;$lhs = $rhs;&quot;);function _guessName(node,parent){function _sanitize(name){name=name.replace(/[^A-Z0-9_$]/gi,&quot;_o_&quot;);return name&amp;&amp;!/^\d/.test(name)?name:&quot;_o_&quot;+name}var id=_genId(node),n,nn;if(parent.type===IDENTIFIER)return _sanitize(parent.value)+id;if(parent.type===ASSIGN){n=parent.children[0];var s=&quot;&quot;;while(n.type===DOT&amp;&amp;(nn=n.children[1]).type===IDENTIFIER||n.type===INDEX&amp;&amp;(nn=n.children[1]).type===STRING){s=s?nn.value+&quot;_&quot;+s:nn.value;n=n.children[0]}if(n.type===IDENTIFIER)s=s?n.value+&quot;_&quot;+s:n.value;if(s)return _sanitize(s)+id}else if(parent.type==PROPERTY_INIT){n=parent.children[0];if(n.type===IDENTIFIER||n.type===STRING)return _sanitize(n.value)+id}return id}function _canonScopes(node,options){function _doIt(node,parent){var scope=parent._scope;node._scope=scope;var async=scope.isAsync();if(!async&amp;&amp;node.type!==FUNCTION){if(node.type===IDENTIFIER&amp;&amp;node.value===options.callback&amp;&amp;!parent._isStar){throw new Error(node.filename+&quot;: Function contains async calls but does not have _ parameter: &quot;+node.name+&quot; at line &quot;+node.lineno)}return _propagate(node,_doIt)}if(node.type===TRY)node._async=true;switch(node.type){case FUNCTION:var result=node;var cbIndex=node.params.reduce(function(index,param,i){if(param!=options.callback)return index;if(index&lt;0)return i;else throw new Error(&quot;duplicate _ parameter&quot;)},-1);if(cbIndex&gt;=0){if(_isFatArrow(node))return node;options.needsTransform=true;if(!node.name)node.name=_guessName(node,parent)}if(async&amp;&amp;(parent.type===SCRIPT||parent.type===BLOCK)){scope.functions.push(node);result=undefined}var bodyScope=new Scope(node.body,options);node.body._scope=bodyScope;bodyScope.name=node.name;bodyScope.cbIndex=cbIndex;bodyScope.line=node.lineno;node.body=_propagate(node.body,_doIt);if(cbIndex&gt;=0)bodyScope.functions.push(_string(&quot;BEGIN_BODY&quot;));node.body.children=bodyScope.functions.concat(node.body.children);if(bodyScope.hasThis&amp;&amp;!node._inhibitThis){bodyScope.vars.push(_identifier(_safeName(options.precious,&quot;__this&quot;),_node(node,THIS)))}if(bodyScope.hasArguments&amp;&amp;!node._inhibitArguments){bodyScope.vars.push(_identifier(_safeName(options.precious,&quot;__arguments&quot;),_identifier(&quot;arguments&quot;)))}if(bodyScope.vars.length&gt;0){node.body.children.splice(0,0,_node(node,VAR,bodyScope.vars))}return result;case VAR:var children=node.children.map(function(child){if(!scope.vars.some(function(elt){return elt.value==child.value})){scope.vars.push(_identifier(child.value))}if(!child.initializer)return null;child=_assignTemplate.generate(parent,{$lhs:_identifier(child.value),$rhs:child.initializer});if(parent.type===FOR)child=child.expression;return child}).filter(function(child){return child!=null});if(children.length==0){return}var type=parent.type==BLOCK||parent.type===SCRIPT?BLOCK:COMMA;var result=_node(parent,type,children);result=_propagate(result,_doIt);parent._async|=result._async;return result;case THIS:scope.hasThis=true;return _identifier(_safeName(options.precious,&quot;__this&quot;));case IDENTIFIER:if(node.value===&quot;arguments&quot;){scope.hasArguments=true;return _identifier(_safeName(options.precious,&quot;__arguments&quot;))}node=_propagate(node,_doIt);</td>
      </tr>
      <tr>
        <td id="L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="LC18" class="blob-code blob-code-inner js-file-line">node._async|=node.value===options.callback;if(node._async&amp;&amp;!parent.isArgsList&amp;&amp;!(parent.type===PROPERTY_INIT&amp;&amp;node===parent.children[0])&amp;&amp;!(parent.type===DOT&amp;&amp;node===parent.children[1]))throw new Error(&quot;invalid usage of &#39;_&#39;&quot;);parent._async|=node._async;return node;case NEW_WITH_ARGS:var cbIndex=node.children[1].children.reduce(function(index,arg,i){if(arg.type!==IDENTIFIER||arg.value!==options.callback)return index;if(index&lt;0)return i;else throw new Error(&quot;duplicate _ argument&quot;)},-1);if(cbIndex&gt;=0){var constr=_node(node,CALL,[_identifier(_safeName(options.precious,&quot;__construct&quot;)),_node(node,LIST,[node.children[0],_number(cbIndex)])]);node=_node(node,CALL,[constr,node.children[1]])}node.children[1].isArgsList=true;node=_propagate(node,_doIt);parent._async|=node._async;return node;case CALL:node.children[1].isArgsList=true;_convertCoffeeScriptCalls(node,options);_convertApply(node,options);node.children[1].isArgsList=true;default:node=_propagate(node,_doIt);_setBreaks(node);parent._async|=node._async;return node}}return _propagate(node,_doIt)}function _convertCoffeeScriptCalls(node,options){var fn=node.children[0];var args=node.children[1];if(fn.type===FUNCTION&amp;&amp;fn.params.length===0&amp;&amp;!fn.name&amp;&amp;args.children.length==0){fn._noFuture=true;fn.name=&quot;___closure&quot;;fn.params=[options.callback];args.children=[_identifier(options.callback)]}else if(fn.type===DOT){var ident=fn.children[1];fn=fn.children[0];if(fn.type===FUNCTION&amp;&amp;fn.params.length===0&amp;&amp;!fn.name&amp;&amp;ident.type===IDENTIFIER){if(ident.value===&quot;call&quot;&amp;&amp;args.children.length===1&amp;&amp;args.children[0].type===THIS){node.children[0]=fn;fn._noFuture=true;fn.name=&quot;___closure&quot;;fn.params=[options.callback];args.children=[_identifier(options.callback)];node._scope.hasThis=true;fn._inhibitThis=true}else if(ident.value===&quot;apply&quot;&amp;&amp;args.children.length===2&amp;&amp;args.children[0].type===THIS&amp;&amp;args.children[1].type===IDENTIFIER&amp;&amp;args.children[1].value===&quot;arguments&quot;){node.children[0]=fn;fn._noFuture=true;fn.name=&quot;___closure&quot;;fn.params=[options.callback];args.children=[_identifier(options.callback)];node._scope.hasThis=true;node._scope.hasArguments=true;fn._inhibitThis=true;fn._inhibitArguments=true}}}}function _isFatArrow(node){if(node.body.children.length!==1)return false;var n=node.body.children[0];if(n.type!==RETURN||!n.value)return false;n=n.value;if(n.type!==CALL)return false;var args=n.children[1].children;var target=n.children[0];if(args.length!==2||args[0].value!==&quot;_this&quot;||args[1].value!==&quot;arguments&quot;)return false;if(target.type!==DOT||target.children[1].value!==&quot;apply&quot;)return false;target=target.children[0];if(target.type!==DOT||target.children[1].type!==IDENTIFIER)return false;target=target.children[0];if(target.type!==DOT||target.children[1].value!==&quot;prototype&quot;)return false;target=target.children[0];if(target.type!==IDENTIFIER)return false;node.params=[];return true}function _convertApply(node,options){var dot=node.children[0];var args=node.children[1];if(dot.type===DOT){var ident=dot.children[1];if(ident.type===IDENTIFIER&amp;&amp;ident.value===&quot;apply&quot;&amp;&amp;args.children.length===2&amp;&amp;args.children[0].type===THIS&amp;&amp;args.children[1].type===IDENTIFIER&amp;&amp;args.children[1].value===&quot;arguments&quot;){var f=dot.children[0];node.children[0]=_identifier(&quot;__apply&quot;);args.children=[_identifier(options.callback),f,_identifier(&quot;__this&quot;),_identifier(&quot;__arguments&quot;),_number(node._scope.cbIndex)];node._scope.hasThis=true;node._scope.hasArguments=true}}}var _switchVarTemplate=new Template(&quot;canon&quot;,&quot;{ var $v = true; }&quot;);var _switchIfTemplate=new Template(&quot;canon&quot;,&quot;if ($v) { $block; }&quot;);function _setBreaks(node){switch(node.type){case IF:node._breaks=node.thenPart._breaks&amp;&amp;node.elsePart&amp;&amp;node.elsePart._breaks;break;case SWITCH:for(var i=0;i&lt;node.cases.length;i++){var stmts=node.cases[i].statements;if(node._async&amp;&amp;stmts.children.length&gt;0&amp;&amp;!stmts._breaks){if(i==node.cases.length-2&amp;&amp;node.cases[i+1].type===DEFAULT&amp;&amp;node.cases[i+1].statements.children.length===1&amp;&amp;node.cases[i+1].statements.children[0].type===SEMICOLON&amp;&amp;node.cases[i+1].statements.children[0].expression==null){stmts.children.push(_node(node,BREAK));stmts._breaks=true}else if(i===node.cases.length-1){stmts.children.push(_node(node,BREAK));stmts._breaks=true}else{var v=_identifier(_genId(node));node.cases[i].statements=_switchVarTemplate.generate(node.cases[i],{$v:v});var ifStmt=_switchIfTemplate.generate(node.cases[i],{$v:v,$block:stmts});node.cases[i+1].statements.children.splice(0,0,ifStmt)}}}break;case TRY:node._breaks=node.tryBlock._breaks&amp;&amp;node.catchClauses[0]&amp;&amp;node.catchClauses[0].block._breaks;break;case BLOCK:case SCRIPT:node.children.forEach(function(child){node._breaks|=child._breaks});break;case RETURN:case THROW:case BREAK:node._breaks=true;break}}function _statementify(exp){if(!exp)return exp;var block=_node(exp,BLOCK,[]);function uncomma(node){if(node.type===COMMA){node.children.forEach(uncomma)}else{block.children.push(node.type==SEMICOLON?node:_semicolon(node))}}uncomma(exp);return block}function _blockify(node){if(!node||node.type==BLOCK)return node;if(node.type==COMMA)return _statementify(node);var block=_node(node,BLOCK,[node]);block._async=node._async;return block}var _flowsTemplates={WHILE:new Template(&quot;flows&quot;,&quot;{&quot;+&quot;	for (; $condition;) {&quot;+&quot;		$body;&quot;+&quot;	}&quot;+&quot;}&quot;),DO:new Template(&quot;flows&quot;,&quot;{&quot;+&quot;	var $firstTime = true;&quot;+&quot;	for (; $firstTime || $condition;) {&quot;+&quot;		$firstTime = false;&quot;+&quot;		$body;&quot;+&quot;	}&quot;+&quot;}&quot;),FOR:new Template(&quot;flows&quot;,&quot;{&quot;+&quot;	$setup;&quot;+&quot;	for (; $condition; $update) {&quot;+&quot;		$body;&quot;+&quot;	}&quot;+&quot;}&quot;),FOR_IN:new Template(&quot;flows&quot;,&quot;{&quot;+&quot;	var $array = __forIn($object);&quot;+&quot;	var $i = 0;&quot;+&quot;	for (; $i &lt; $array.length;) {&quot;+&quot;		$iter = $array[$i++];&quot;+&quot;		$body;&quot;+&quot;	}&quot;+&quot;}&quot;),TRY:new Template(&quot;flows&quot;,&quot;&quot;+&quot;try {&quot;+&quot;	try { $try; }&quot;+&quot;	catch ($ex) { $catch; }&quot;+&quot;}&quot;+&quot;finally { $finally; }&quot;),AND:new Template(&quot;flows&quot;,&quot;&quot;+&quot;return (function $name(_){&quot;+&quot;	var $v = $op1;&quot;+&quot;	if (!$v) {&quot;+&quot;		return $v;&quot;+&quot;	}&quot;+&quot;	return $op2;&quot;+&quot;})(_)&quot;,true,true),OR:new Template(&quot;flows&quot;,&quot;&quot;+&quot;return (function $name(_){&quot;+&quot;	var $v = $op1;&quot;+&quot;	if ($v) {&quot;+&quot;		return $v;&quot;+&quot;	}&quot;+&quot;	return $op2;&quot;+&quot;})(_)&quot;,true,true),HOOK:new Template(&quot;flows&quot;,&quot;&quot;+&quot;return (function $name(_){&quot;+&quot;	var $v = $condition;&quot;+&quot;	if ($v) {&quot;+&quot;		return $true;&quot;+&quot;	}&quot;+&quot;	return $false;&quot;+&quot;})(_);&quot;,true,true),COMMA:new Template(&quot;flows&quot;,&quot;&quot;+&quot;return (function $name(_){&quot;+&quot;	$body;&quot;+&quot;	return $result;&quot;+&quot;})(_);&quot;,true,true),CONDITION:new Template(&quot;flows&quot;,&quot;&quot;+&quot;return (function $name(_){&quot;+&quot;	return $condition;&quot;+&quot;})(_);&quot;,true,true),UPDATE:new Template(&quot;flows&quot;,&quot;&quot;+&quot;return (function $name(_){&quot;+&quot;	$update;&quot;+&quot;})(_);&quot;,true,true)};function _canonFlows(node,options){function _doIt(node,parent,force){var scope=node._scope;function _doAsyncFor(node){if(node.condition&amp;&amp;node.condition._async&amp;&amp;node.condition.type!==CALL)node.condition=_flowsTemplates.CONDITION.generate(node,{$name:&quot;__$&quot;+node._scope.name,$condition:_doIt(node.condition,node,true)});if(node.update&amp;&amp;node.update._async)node.update=_flowsTemplates.UPDATE.generate(node,{$name:&quot;__$&quot;+node._scope.name,$update:_statementify(node.update)})}if(node.type==FOR&amp;&amp;node._pass===&quot;flows&quot;)_doAsyncFor(node);if(!scope||!scope.isAsync()||!force&amp;&amp;node._pass===&quot;flows&quot;)return _propagate(node,_doIt);switch(node.type){case IF:node.thenPart=_blockify(node.thenPart);node.elsePart=_blockify(node.elsePart);break;case SWITCH:if(node._async){var def=node.cases.filter(function(n){return n.type==DEFAULT})[0];if(!def){def=_node(node,DEFAULT);def.statements=_node(node,BLOCK,[]);node.cases.push(def)}if(!def._breaks){def.statements.children.push(_node(node,BREAK))}}break;case WHILE:node.body=_blockify(node.body);if(node._async){node=_flowsTemplates.WHILE.generate(node,{$condition:node.condition,$body:node.body})}break;case DO:node.body=_blockify(node.body);if(node._async){node=_flowsTemplates.DO.generate(node,{$firstTime:_identifier(_genId(node)),$condition:node.condition,$body:node.body})}break;case FOR:node.condition=node.condition||_number(1);node.body=_blockify(node.body);if(node._async){if(node.setup){node=_flowsTemplates.FOR.generate(node,{$setup:_statementify(node.setup),$condition:node.condition,$update:node.update,$body:node.body})}else{if(node._pass!==&quot;flows&quot;){node._pass=&quot;flows&quot;;_doAsyncFor(node)}}}break;case FOR_IN:node.body=_blockify(node.body);if(node._async){if(node.iterator.type!=IDENTIFIER){throw new Error(&quot;unsupported &#39;for ... in&#39; syntax: type=&quot;+_tag(node.iterator))}node=_flowsTemplates.FOR_IN.generate(node,{$array:_identifier(_genId(node)),$i:_identifier(_genId(node)),$object:node.object,$iter:node.iterator,$body:node.body})}break;case TRY:if(node.tryBlock&amp;&amp;node.catchClauses[0]&amp;&amp;node.finallyBlock){node=_flowsTemplates.TRY.generate(node,{$try:node.tryBlock,$catch:node.catchClauses[0].block,$ex:node.catchClauses[0].varName,$finally:node.finallyBlock})}break;case AND:case OR:if(node._async){node=_flowsTemplates[_tag(node)].generate(node,{$name:&quot;__$&quot;+node._scope.name,$v:_identifier(_genId(node)),$op1:node.children[0],$op2:node.children[1]})}break;case HOOK:if(node._async){node=_flowsTemplates.HOOK.generate(node,{$name:&quot;__$&quot;+node._scope.name,$v:_identifier(_genId(node)),$condition:node.children[0],$true:node.children[1],$false:node.children[2]})}break;case COMMA:if(node._async){node=_flowsTemplates.COMMA.generate(node,{$name:&quot;__$&quot;+node._scope.name,$body:_node(node,BLOCK,node.children.slice(0,node.children.length-1).map(_semicolon)),$result:node.children[node.children.length-1]})}break}return _propagate(node,_doIt)}return _propagate(node,_doIt)}function _split(node,prop){var exp=node[prop];if(!exp||!exp._async)return node;var id=_genId(node);var v=_identifier(id,exp);node[prop]=_identifier(id);return _node(node,BLOCK,[_node(node,VAR,[v]),node])}function _disassemble(node,options){function _disassembleIt(node,parent,noResult){if(!node._async)return _propagate(node,_scanIt);node=_propagate(node,_disassembleIt);if(node.type===CALL){if(node.children[0].type===IDENTIFIER&amp;&amp;node.children[0].value.indexOf(&quot;__wrap&quot;)==0){node._isWrapper=true;return node}var args=node.children[1];if(args.children.some(function(arg){return arg.type===IDENTIFIER&amp;&amp;arg.value===options.callback||arg._isWrapper})){if(noResult){node._scope.disassembly.push(_statementify(node));return}else{if(parent.type==IDENTIFIER&amp;&amp;parent.value.indexOf(&quot;__&quot;)===0){node._skipDisassembly=true;return node}var id=_genId(node);var v=_identifier(id,node);node=_node(node,VAR,[v]);node._scope.disassembly.push(node);return _identifier(id)}}}return node}function _scanIt(node,parent){var scope=node._scope;if(!scope||!scope.isAsync()||!node._async)return _propagate(node,_scanIt);switch(node.type){case IF:node=_split(node,&quot;condition&quot;);break;case SWITCH:node=_split(node,&quot;discriminant&quot;);break;case FOR:break;case RETURN:node=_split(node,&quot;value&quot;);break;case THROW:node=_split(node,&quot;exception&quot;);break;case VAR:_assert(node.children.length===1);var ident=node.children[0];scope.disassembly=[];ident.initializer=_disassembleIt(ident.initializer,ident);node._async=ident.initializer._skipDisassembly;scope.disassembly.push(node);return _node(parent,BLOCK,scope.disassembly);case SEMICOLON:scope.disassembly=[];node.expression=_disassembleIt(node.expression,node,true);if(node.expression){node._async=false;scope.disassembly.push(node)}return _node(parent,BLOCK,scope.disassembly)}return _propagate(node,_scanIt)}return _propagate(node,_scanIt)}var _cbTemplates={FUNCTION:new Template(&quot;cb&quot;,&quot;{&quot;+&quot;	$decls;&quot;+&quot;	var __frame = { name: $fname, line: $line };&quot;+&quot;	return __func(_, this, arguments, $fn, $index, __frame, function $name(){&quot;+&quot;		$body;&quot;+&quot;		_();&quot;+&quot;	});&quot;+&quot;}&quot;),FUNCTION_INTERNAL:new Template(&quot;cb&quot;,&quot;{ $decls; $body; _(); }&quot;),RETURN:new Template(&quot;cb&quot;,&quot;return _(null, $value);&quot;),RETURN_UNDEFINED:new Template(&quot;cb&quot;,&quot;return _(null);&quot;),THROW:new Template(&quot;cb&quot;,&quot;return _($exception);&quot;),IF:new Template(&quot;cb&quot;,&quot;&quot;+&quot;return (function $name(__then){&quot;+&quot;	if ($condition) { $then; __then(); }&quot;+&quot;	else { $else; __then(); }&quot;+&quot;})(function $name(){ $tail; });&quot;),SWITCH:new Template(&quot;cb&quot;,&quot;&quot;+&quot;return (function $name(__break){&quot;+&quot;	$statement;&quot;+&quot;})(function $name(){ $tail; });&quot;),LABEL:new Template(&quot;cb&quot;,&quot;&quot;+&quot;$statement;&quot;+&quot;$tail;&quot;),BREAK:new Template(&quot;cb&quot;,&quot;return __break();&quot;),LABELLED_BREAK:new Template(&quot;cb&quot;,&quot;return $break();&quot;),CONTINUE:new Template(&quot;cb&quot;,&quot;&quot;+&quot;while (__more) { __loop(); } __more = true;&quot;+&quot;return;&quot;),LABELLED_CONTINUE:new Template(&quot;cb&quot;,&quot;&quot;+&quot;while ($more.get()) { $loop(); } $more.set(true);&quot;+&quot;return;&quot;),LOOP1:new Template(&quot;cb&quot;,&quot;&quot;+&quot;if ($v) {&quot;+&quot;	$body;&quot;+&quot;	while (__more) { __loop(); } __more = true;&quot;+&quot;}&quot;+&quot;else { __break(); }&quot;),LOOP2:new Template(&quot;temp&quot;,&quot;var $v = $condition; $loop1;&quot;),LOOP2_UPDATE:new Template(&quot;temp&quot;,&quot;&quot;+&quot;if ($beenHere) { $update; } else { $beenHere = true; }&quot;+&quot;var $v = $condition; $loop1;&quot;),FOR:new Template(&quot;cb&quot;,&quot;&quot;+&quot;return (function ___(__break){&quot;+&quot;	var __more;&quot;+&quot;	var __loop = __cb(_, __frame, 0, 0, function $name(){&quot;+&quot;		__more = false;&quot;+&quot;		$loop2&quot;+&quot;	});&quot;+&quot;	do { __loop(); } while (__more); __more = true;&quot;+&quot;})(function $name(){ $tail;});&quot;),LABELLED_FOR:new Template(&quot;cb&quot;,&quot;&quot;+&quot;return (function ___(__break){&quot;+&quot;	var __more, $more = { get: function() { return __more; }, set: function(v) { __more = v; }};&quot;+&quot;	var __loop = __cb(_, __frame, 0, 0, function $name(){&quot;+&quot;		var $break = __break, $loop = __loop;&quot;+&quot;		__more = false;&quot;+&quot;		$loop2&quot;+&quot;	});&quot;+&quot;	do { __loop(); } while (__more); __more = true;&quot;+&quot;})(function $name(){ $tail;});&quot;),FOR_UPDATE:new Template(&quot;cb&quot;,&quot;&quot;+&quot;var $beenHere = false;&quot;+&quot;return (function ___(__break){&quot;+&quot;	var __more;&quot;+&quot;	var __loop = __cb(_, __frame, 0, 0, function $name(){&quot;+&quot;		__more = false;&quot;+&quot;		$loop2&quot;+&quot;	});&quot;+&quot;	do { __loop(); } while (__more); __more = true;&quot;+&quot;})(function $name(){ $tail; });&quot;),LABELLED_FOR_UPDATE:new Template(&quot;cb&quot;,&quot;&quot;+&quot;var $beenHere = false;&quot;+&quot;return (function ___(__break){&quot;+&quot;	var __more, $more = { get: function() { return __more; }, set: function(v) { __more = v; }};&quot;+&quot;	var __loop = __cb(_, __frame, 0, 0, function $name(){&quot;+&quot;		var $break = __break, $loop = __loop;&quot;+&quot;		__more = false;&quot;+&quot;		$loop2&quot;+&quot;	});&quot;+&quot;	do { __loop(); } while (__more); __more = true;&quot;+&quot;})(function $name(){ $tail; });&quot;),CATCH:new Template(&quot;cb&quot;,&quot;&quot;+&quot;return (function ___(__then){&quot;+&quot;	(function ___(_){&quot;+&quot;		__tryCatch(_, function $name(){ $try; __then(); });&quot;+&quot;	})(function ___($ex, __result){&quot;+&quot;		__catch(function $name(){&quot;+&quot;			if ($ex) { $catch; __then(); }&quot;+&quot;			else { _(null, __result); }&quot;+&quot;		});&quot;+&quot;	});&quot;+&quot;})(function ___(){&quot;+&quot;	__tryCatch(_, function $name(){ $tail; });&quot;+&quot;});&quot;),FINALLY:new Template(&quot;cb&quot;,&quot;&quot;+&quot;return (function ___(__then){&quot;+&quot;	(function ___(_){&quot;+&quot;		__tryCatch(_, function $name(){ $try; _(null, null, true); });&quot;+&quot;	})(function ___(__e, __r, __cont){&quot;+&quot;		(function ___(__then){&quot;+&quot;			__tryCatch(_, function $name(){ $finally; __then(); });&quot;+&quot;		})(function ___(){&quot;+&quot;			__tryCatch(_, function ___(){&quot;+&quot;				if (__cont) __then(); else _(__e, __r);&quot;+&quot;			});&quot;+&quot;		})&quot;+&quot;	});&quot;+&quot;})(function ___(){&quot;+&quot;	__tryCatch(_, function $name(){ $tail; });&quot;+&quot;});&quot;),CALL_VOID:new Template(&quot;cb&quot;,&quot;return __cb(_, __frame, $offset, $col, function $name(){ $tail; }, true, $returnArray)&quot;,true),CALL_TMP:new Template(&quot;cb&quot;,&quot;return __cb(_, __frame, $offset, $col, function ___(__0, $result){ $tail }, true, $returnArray)&quot;,true),CALL_RESULT:new Template(&quot;cb&quot;,&quot;&quot;+&quot;return __cb(_, __frame, $offset, $col, function $name(__0, $v){&quot;+&quot;	var $result = $v;&quot;+&quot;	$tail&quot;+&quot;}, true, $returnArray)&quot;,true)};function _callbackify(node,options){var label;function _scanIt(node,parent){node=_flatten(node);if(!node._scope||!node._scope.isAsync()||node._pass===&quot;cb&quot;)return _propagate(node,_scanIt);switch(node.type){case SCRIPT:if(parent._pass!==&quot;cb&quot;){var decls;for(var cut=0;cut&lt;node.children.length;cut++){var child=node.children[cut];if(child.type===STRING&amp;&amp;child.value===&quot;BEGIN_BODY&quot;){decls=node.children.splice(0,cut);node.children.splice(0,1);break}}var template=parent._noFuture||parent._pass===&quot;flows&quot;?_cbTemplates.FUNCTION_INTERNAL:_cbTemplates.FUNCTION;node=template.generate(node,{$fn:parent.name,$name:&quot;__$&quot;+node._scope.name,$fname:_string(parent.name),$line:_number(originalLine(options,node._scope.line)),$index:_number(node._scope.cbIndex),$decls:_node(node,BLOCK,decls||[]),$body:node})}node.type=SCRIPT;case BLOCK:for(var i=0;i&lt;node.children.length;i++){node.children[i]=_restructureIt(node,i)}return node}return _propagate(node,_scanIt)}function _extractTail(parent,i){return _node(parent,BLOCK,parent.children.splice(i+1,parent.children.length-i-1))}function _restructureIt(parent,i){var node=parent.children[i];if(node._pass===&quot;cb&quot;)return _propagate(node,_scanIt);switch(node.type){case RETURN:_extractTail(parent,i);var template=node.value?_cbTemplates.RETURN:_cbTemplates.RETURN_UNDEFINED;node=template.generate(node,{$value:node.value});break;case THROW:_extractTail(parent,i);node=_cbTemplates.THROW.generate(node,{$exception:node.exception});break;case BREAK:if(node.target&amp;&amp;!node.target._async){break}_extractTail(parent,i);if(node.label){node=_cbTemplates.LABELLED_BREAK.generate(node,{$break:_safeName(options.precious,&quot;__break__&quot;+node.label)})}else{node=_cbTemplates.BREAK.generate(node,{})}break;case CONTINUE:if(node.target&amp;&amp;!node.target._async){break}_extractTail(parent,i);if(node.label){node=_cbTemplates.LABELLED_CONTINUE.generate(node,{$loop:_safeName(options.precious,&quot;__loop__&quot;+node.label),$more:_safeName(options.precious,&quot;__more__&quot;+node.label)})}else{node=_cbTemplates.CONTINUE.generate(node,{})}break;case TRY:var tail=_extractTail(parent,i);if(node.catchClauses[0]){node=_cbTemplates.CATCH.generate(node,{$name:&quot;__$&quot;+node._scope.name,$try:node.tryBlock,$catch:node.catchClauses[0].block,$ex:node.catchClauses[0].varName,$tail:tail})}else{node=_cbTemplates.FINALLY.generate(node,{$name:&quot;__$&quot;+node._scope.name,$try:node.tryBlock,$finally:node.finallyBlock,$tail:tail})}break;default:if(node._async){var tail=_extractTail(parent,i);switch(node.type){case IF:node=_cbTemplates.IF.generate(node,{$name:&quot;__$&quot;+node._scope.name,$condition:node.condition,$then:node.thenPart,$else:node.elsePart||_node(node,BLOCK,[]),$tail:tail});break;case SWITCH:node._pass=&quot;cb&quot;;node=_cbTemplates.SWITCH.generate(node,{$name:&quot;__$&quot;+node._scope.name,$statement:node,$tail:tail});break;case LABEL:var l=label;label=node.label;node=_cbTemplates.LABEL.generate(node,{$name:&quot;__$&quot;+node._scope.name,$statement:node.statement,$tail:tail});node=_scanIt(node,parent);label=l;return node;case FOR:var v=_identifier(_genId(node));var loop1=_cbTemplates.LOOP1.generate(node,{$v:v,$body:node.body});var update=node.update;var beenHere=update&amp;&amp;_identifier(_genId(node));var loop2=(update?_cbTemplates.LOOP2_UPDATE:_cbTemplates.LOOP2).generate(node,{$v:v,$condition:node.condition,$beenHere:beenHere,$update:_statementify(update),$loop1:loop1});node=(update?label?_cbTemplates.LABELLED_FOR_UPDATE:_cbTemplates.FOR_UPDATE:label?_cbTemplates.LABELLED_FOR:_cbTemplates.FOR).generate(node,{$name:&quot;__$&quot;+node._scope.name,$loop:_identifier(_safeName(options.precious,&quot;__loop__&quot;+label)),$break:_identifier(_safeName(options.precious,&quot;__break__&quot;+label)),$more:_identifier(_safeName(options.precious,&quot;__more__&quot;+label)),$beenHere:beenHere,$loop2:loop2,$tail:tail});break;case VAR:_assert(node.children.length==1);var ident=node.children[0];_assert(ident.type===IDENTIFIER);var call=ident.initializer;delete ident.initializer;_assert(call&amp;&amp;call.type===CALL);return _restructureCall(call,tail,ident.value);case SEMICOLON:var call=node.expression;_assert(call.type===CALL);return _restructureCall(call,tail);default:throw new Error(&quot;internal error: bad node type: &quot;+_tag(node)+&quot;: &quot;+pp(node))}}}return _scanIt(node,parent);function _restructureCall(node,tail,result){var args=node.children[1];function _cbIndex(args){return args.children.reduce(function(index,arg,i){if(arg.type==IDENTIFIER&amp;&amp;arg.value===options.callback||arg._isWrapper)return i;else return index},-1)}var i=_cbIndex(args);_assert(i&gt;=0);var returnArray=args.children[i]._returnArray;if(args.children[i]._isWrapper){args=args.children[i].children[1];i=_cbIndex(args)}var identifier=node.children[0];while(identifier.type==DOT){identifier=identifier.children[1]}var bol=options.source.lastIndexOf(&quot;\n&quot;,identifier.start)+1;var col=identifier.start-bol;args.children[i]=(result?result.indexOf(&quot;__&quot;)===0?_cbTemplates.CALL_TMP:_cbTemplates.CALL_RESULT:_cbTemplates.CALL_VOID).generate(node,{$v:_genId(node),$frameName:_string(node._scope.name),$offset:_number(originalLine(options,identifier.lineno,col)-originalLine(options,node._scope.line)),$col:_number(originalCol(options,identifier.lineno,col)),$name:&quot;__$&quot;+node._scope.name,$returnArray:returnArray,$result:result,$tail:tail});node=_propagate(node,_scanIt);var stmt=_node(node,RETURN,[]);stmt.value=node;stmt._pass=&quot;cb&quot;;return stmt}}return _propagate(node,_scanIt)}function _checkUsed(val,used){if(typeof val===&quot;string&quot;&amp;&amp;val.substring(0,2)===&quot;__&quot;)used[val]=true}var _optims={function__0$fn:new Template(&quot;simplify&quot;,&quot;return function ___(__0) { $fn(); }&quot;,true).root,function$return:new Template(&quot;simplify&quot;,&quot;return function $fn1() { return $fn2(); }&quot;,true).root,function__0$arg1return_null$arg2:new Template(&quot;simplify&quot;,&quot;return function ___(__0, $arg1) { return _(null, $arg2); }&quot;,true).root,__cb__:new Template(&quot;simplify&quot;,&quot;return __cb(_, $frameVar, $line, $col, _)&quot;,true).root,__cbt__:new Template(&quot;simplify&quot;,&quot;return __cb(_, $frameVar, $line, $col, _, true)&quot;,true).root,function$fn:new Template(&quot;simplify&quot;,&quot;return function $fn1() { $fn2(); }&quot;,true).root,closure:new Template(&quot;simplify&quot;,&quot;return (function ___closure(_){ $body; })(__cb(_,$frameVar,$line,$col,function $fnName(){_();},true))&quot;,true).root,safeParam:new Template(&quot;simplify&quot;,&quot;return (function $fnName($param){ $body; })(function $fnName(){_();})&quot;,true).root};function _simplify(node,options,used){if(node._simplified)return node;node._simplified=true;_propagate(node,function(child){return _simplify(child,options,used)});_checkUsed(node.value,used);function _match(prop,v1,v2,result){var ignored=[&quot;parenthesized&quot;,&quot;lineno&quot;,&quot;start&quot;,&quot;end&quot;,&quot;tokenizer&quot;,&quot;hasReturnWithValue&quot;];if(prop.indexOf(&quot;_&quot;)==0||ignored.indexOf(prop)&gt;=0)return true;if(v1==v2)return true;if(v1==null||v2==null){if(prop==&quot;children&quot;&amp;&amp;v1&amp;&amp;v1.length===0)return true;return false}if(Array.isArray(v1)){if(v1.length!=v2.length)return false;for(var i=0;i&lt;v1.length;i++){if(!_match(prop,v1[i],v2[i],result))return false}return true}if(v1.type===IDENTIFIER&amp;&amp;v1.value[0]===&quot;$&quot;&amp;&amp;v2.type===NUMBER){result[v1.value]=v2.value;return true}if(typeof v1==&quot;string&quot;&amp;&amp;v1[0]==&quot;$&quot;&amp;&amp;typeof v2==&quot;string&quot;){result[v1]=v2;return true}if(v1.type){var exp;if(v1.type==SCRIPT&amp;&amp;v1.children[0]&amp;&amp;(exp=v1.children[0].expression)&amp;&amp;typeof exp.value==&quot;string&quot;&amp;&amp;exp.value[0]==&quot;$&quot;){result[exp.value]=v2;return true}if(v1.type!=v2.type)return false;if(v1.type==IDENTIFIER&amp;&amp;v1.value==&quot;$&quot;){result[v1.value]=v2.value;return true}for(var prop in v1){if(v1.hasOwnProperty(prop)&amp;&amp;prop.indexOf(&quot;Decls&quot;)&lt;0&amp;&amp;prop!=&quot;target&quot;){if(!_match(prop,v1[prop],v2[prop],result))return false}}return true}return false}var result={};if(_match(&quot;&quot;,_optims.function__0$fn,node,result))return _identifier(result.$fn);if(_match(&quot;&quot;,_optims.function$return,node,result)&amp;&amp;(result.$fn1===&quot;___&quot;||result.$fn1.indexOf(&quot;__$&quot;)===0)&amp;&amp;result.$fn2===&quot;__break&quot;)return _identifier(result.$fn2);if(_match(&quot;&quot;,_optims.function__0$arg1return_null$arg2,node,result)&amp;&amp;result.$arg1==result.$arg2)return _identifier(&quot;_&quot;);if(options.optimize&amp;&amp;_match(&quot;&quot;,_optims.__cb__,node,result))return _identifier(&quot;_&quot;);if(options.optimize&amp;&amp;_match(&quot;&quot;,_optims.__cbt__,node,result))return _identifier(&quot;_&quot;);if(_match(&quot;&quot;,_optims.function$fn,node,result)&amp;&amp;(result.$fn1===&quot;___&quot;||result.$fn1.indexOf(&quot;__$&quot;)===0)&amp;&amp;(result.$fn2===&quot;__then&quot;||result.$fn2===&quot;__loop&quot;))return _identifier(result.$fn2);if(_match(&quot;&quot;,_optims.closure,node,result))node.children[1]=_identifier(&quot;_&quot;);if(_match(&quot;&quot;,_optims.safeParam,node,result)&amp;&amp;(result.$param===&quot;__then&quot;||result.$param===&quot;__break&quot;))node.children[1]=_identifier(&quot;_&quot;);_flatten(node);return node}function _extend(obj,other){for(var i in other){obj[i]=other[i]}return obj}function _cl(obj){return _extend({},obj)}exports.transform=function(source,options){try{source=source.replace(/\r\n/g,&quot;\n&quot;);options=options?_extend({},options):{};var sourceOptions=/streamline\.options\s*=\s*(\{.*\})/.exec(source);if(sourceOptions){_extend(options,JSON.parse(sourceOptions[1]))}options.source=source;options.callback=options.callback||&quot;_&quot;;options.lines=options.lines||&quot;preserve&quot;;options.precious={};var node=parse(source+&quot;\n&quot;,options.sourceName);var strict=node.children[0]&amp;&amp;node.children[0].expression&amp;&amp;node.children[0].expression.value==&quot;use strict&quot;;strict&amp;&amp;node.children.splice(0,1);_markSource(node,options);node=_canonTopLevelScript(node,options);node=_canonScopes(node,options);if(!options.needsTransform)return source;node=_canonFlows(node,options);node=_disassemble(node,options);node=_callbackify(node,options);var used={};node=_simplify(node,options,used);var result=format(node,options.lines);if(!options.noHelpers){var s=exports.helpersSource(options,used,strict);if(options.lines==&quot;sourcemap&quot;){result.prepend(s)}else{result=s+result}}return result}catch(err){var message=&quot;error streamlining &quot;+(options.sourceName||&quot;source&quot;)+&quot;: &quot;+err.message;if(err.source&amp;&amp;err.cursor){var line=1;for(var i=0;i&lt;err.cursor;i++){if(err.source[i]===&quot;\n&quot;)line+=1}message+=&quot; on line &quot;+line}else if(err.stack){message+=&quot;\nSTACK:\n&quot;+err.stack}throw new Error(message)}};exports.transform.version=exports.version;function _trim(fn){return fn.toString().replace(/\s+/g,&quot; &quot;)}function include(mod,modules){var source=modules+&quot;[&#39;&quot;+mod+&quot;&#39;]=(mod={exports:{}});&quot;;source+=&quot;(function(module, exports){&quot;;var req=srequire;source+=req(&quot;fs&quot;).readFileSync(__dirname+&quot;/../&quot;+mod+&quot;.js&quot;,&quot;utf8&quot;).replace(/(\/\/[^&quot;\n]*\n|\/\*[\s\S]*?\*\/|\n)[ \t]*/g,&quot;&quot;);source+=&quot;})(mod, mod.exports);&quot;;return source}function requireRuntime(options){if(!options.standalone)return&quot;srequire(&#39;streamline/lib/callbacks/runtime&#39;).runtime(__filename, &quot;+!!options.oldStyleFutures+&quot;)&quot;;var modules=_safeName(options.precious,&quot;__modules&quot;);var s=&quot;(function(){var &quot;+modules+&quot;={},mod;&quot;;s+=&quot;function srequire(p){var m=&quot;+modules+&quot;[p.substring(15)]; return m &amp;&amp; m.exports};&quot;;s+=include(&quot;globals&quot;,modules);s+=include(&quot;util/future&quot;,modules);s+=include(&quot;callbacks/runtime&quot;,modules);if([&quot;funnel&quot;,&quot;forEach_&quot;,&quot;map_&quot;,&quot;filter_&quot;,&quot;every_&quot;,&quot;some_&quot;,&quot;reduce_&quot;,&quot;reduceRight_&quot;,&quot;sort_&quot;,&quot;apply_&quot;].some(function(name){return options.precious[name]}))s+=include(&quot;callbacks/builtins&quot;,modules);s+=&quot;return &quot;+modules+&quot;[&#39;callbacks/runtime&#39;].exports.runtime(&#39;&quot;+options.sourceName+&quot;&#39;, &quot;+!!options.oldStyleFutures+&quot;);&quot;;s+=&quot;})()&quot;;return s}exports.helpersSource=function(options,used,strict){var srcName=&quot;&quot;+options.sourceName;var i=srcName.indexOf(&quot;node_modules/&quot;);if(i==-1&amp;&amp;typeof process===&quot;object&quot;&amp;&amp;typeof process.cwd===&quot;function&quot;)i=process.cwd().length;srcName=i&gt;=0?srcName.substring(i+13):srcName;var sep=options.lines==&quot;preserve&quot;?&quot; &quot;:&quot;\n&quot;;strict=strict?&#39;&quot;use strict&quot;;&#39;+sep:&quot;&quot;;var s=sep+strict;var keys=[&quot;__g&quot;,&quot;__func&quot;,&quot;__cb&quot;,&quot;__future&quot;,&quot;__propagate&quot;,&quot;__trap&quot;,&quot;__catch&quot;,&quot;__tryCatch&quot;,&quot;__forIn&quot;,&quot;__apply&quot;,&quot;__construct&quot;,&quot;__setEF&quot;];var __rt=_safeName(options.precious,&quot;__rt&quot;);s+=&quot;var &quot;+__rt+&quot;=&quot;+requireRuntime(options);keys.forEach(function(key){var k=_safeName(options.precious,key);if(used[k])s+=&quot;,&quot;+k+&quot;=&quot;+__rt+&quot;.&quot;+key});s+=&quot;;&quot;+sep;return s}})(typeof exports!==&quot;undefined&quot;?exports:window.Streamline=window.Streamline||{});(function(exports){exports.future=function(fn,args,i){var err,result,done,q=[],self=this;args=Array.prototype.slice.call(args);args[i]=function(e,r){err=e,result=r,done=true;q&amp;&amp;q.forEach(function(f){f.call(self,e,r)});q=null};fn.apply(this,args);return function F(cb){if(typeof cb!==&quot;function&quot;){if(cb!==false&amp;&amp;!srequire(&quot;streamline/lib/globals&quot;).oldStyleFutures)throw new Error(&quot;no callback given (argument #0). If you&#39;re a Streamline user, more info: https://github.com/Sage/streamlinejs/blob/master/FAQ.md#no-callback-given-error&quot;);return F}if(done)cb.call(self,err,result);else q.push(cb)}};exports.streamlinify=function(fn,idx){return function(){if(!arguments[idx])return exports.future.call(this,fn,arguments,idx);else return fn.apply(this,arguments)}}})(typeof exports!==&quot;undefined&quot;?exports:Streamline.future=Streamline.future||{});(function(exports){var __g=srequire(&quot;streamline/lib/globals&quot;);__g.runtime=&quot;callbacks&quot;;var __fut=srequire(&quot;streamline/lib/util/future&quot;);__g.context=__g.context||{};__g.depth=__g.depth||0;__g.trampoline=function(){var q=[];return{queue:function(fn){q.push(fn)},flush:function(){__g.depth++;try{var fn;while(fn=q.shift())fn()}finally{__g.depth--}}}}();exports.runtime=function(filename,oldStyleFutures){__g.oldStyleFutures=oldStyleFutures;function __func(_,__this,__arguments,fn,index,frame,body){if(typeof _!==&quot;function&quot;){if(_!==false&amp;&amp;!__g.oldStyleFutures)throw new Error(&quot;no callback given (argument #&quot;+index+&quot;). If you&#39;re a Streamline user, more info: https://github.com/Sage/streamlinejs/blob/master/FAQ.md#no-callback-given-error&quot;);return __fut.future.call(__this,fn,__arguments,index)}frame.file=filename;frame.prev=__g.frame;__g.frame=frame;__g.depth===0&amp;&amp;__g.emitter&amp;&amp;__g.emitter.emit(&quot;resume&quot;);__g.depth++;try{frame.active=true;body()}catch(e){__propagate(_,e)}finally{frame.active=false;__g.frame=frame.prev;if(--__g.depth===0&amp;&amp;__g.trampoline)__g.trampoline.flush();__g.depth===0&amp;&amp;__g.emitter&amp;&amp;__g.emitter.emit(&quot;yield&quot;)}}return{__g:__g,__func:__func,__cb:__cb,__future:__fut.future,__propagate:__propagate,__trap:__trap,__tryCatch:__tryCatch,__catch:__catch,__forIn:__forIn,__apply:__apply,__construct:__construct,__setEF:__setEF,streamlinify:__fut.streamlinify}};function __cb(_,frame,offset,col,fn,trampo,returnArray){frame.offset=offset;frame.col=col;var ctx=__g.context;return function ___(err,result){if(returnArray)result=Array.prototype.slice.call(arguments,1);returnArray=false;var oldFrame=__g.frame;__g.frame=frame;__g.context=ctx;__g.depth===0&amp;&amp;__g.emitter&amp;&amp;__g.emitter.emit(&quot;resume&quot;);__g.depth++;try{if(trampo&amp;&amp;frame.active&amp;&amp;__g.trampoline){__g.trampoline.queue(function(){return ___(err,result)})}else{___.dispatched=true;if(err){__setEF(err,frame);return _(err)}frame.active=true;return fn(null,result)}}catch(ex){return __propagate(_,ex)}finally{frame.active=false;__g.frame=oldFrame;if(--__g.depth===0&amp;&amp;__g.trampoline)__g.trampoline.flush();__g.depth===0&amp;&amp;__g.emitter&amp;&amp;__g.emitter.emit(&quot;yield&quot;)}}}function __propagate(_,err){try{_(err)}catch(ex){__trap(ex)}}function __trap(err){if(err){if(__g.context&amp;&amp;__g.context.errorHandler)__g.context.errorHandler(err);else process.nextTick(function(){throw err})}}function __tryCatch(_,fn){try{fn()}catch(e){try{_(e)}catch(ex){__trap(ex)}}}function __catch(fn){var frame=__g.frame,context=__g.context;__g.trampoline.queue(function(){var oldFrame=__g.frame,oldContext=__g.context;__g.frame=frame;__g.context=context;try{fn()}finally{__g.frame=oldFrame;__g.context=oldContext}})}function __forIn(object){var array=[];for(var obj in object){array.push(obj)}return array}function __apply(cb,fn,thisObj,args,index){if(cb==null)return __fut.future(__apply,arguments,0);args=Array.prototype.slice.call(args,0);args[index!=null?index:args.length]=cb;return fn.apply(thisObj,args)}function __construct(constructor,i){var key=&quot;__async&quot;+i,f;return constructor[key]||(constructor[key]=function(){var args=arguments;function F(){var self=this;var cb=args[i];args[i]=function(e,r){cb(e,self)};return constructor.apply(self,args)}F.prototype=constructor.prototype;return new F})}function __setEF(e,f){function formatStack(e,raw){var ff=typeof navigator===&quot;object&quot;&amp;&amp;navigator.userAgent.toLowerCase().indexOf(&quot;firefox&quot;)&gt;-1;if(ff)raw=&quot;Error: &quot;+e.message+&quot;\n&quot;+raw;var s=raw,f,skip;if(s){var lines=s.split(&quot;\n&quot;);s=lines[0]+&quot;\n    &lt;&lt;&lt; async stack &gt;&gt;&gt;\n&quot;+lines.slice(1).map(function(l){var ffOffset=typeof navigator===&quot;object&quot;&amp;&amp;typeof srequire===&quot;function&quot;&amp;&amp;srequire.async?11:0;var m=/([^@]*)\@(.*?)\:(\d+)(?:\:(\d+))?$/.exec(l);l=m?&quot;    at &quot;+m[1]+&quot; (&quot;+m[2]+&quot;:&quot;+(parseInt(m[3])-ffOffset)+&quot;:&quot;+(m[4]||&quot;0&quot;)+&quot;)&quot;:l;var i=l.indexOf(&quot;__$&quot;);if(i&gt;=0&amp;&amp;!skip){skip=true;return l.substring(0,i)+l.substring(i+3)}return skip?&quot;&quot;:l}).filter(function(l){return l}).join(&quot;\n&quot;);for(var f=e.__frame;f;f=f.prev){if(f.offset&gt;=0)s+=&quot;\n    at &quot;+f.name+&quot; (&quot;+f.file+&quot;:&quot;+(f.line+f.offset)+&quot;:&quot;+(f.col+1)+&quot;)&quot;}}var nl=raw.indexOf(&quot;\n&quot;);</td>
      </tr>
      <tr>
        <td id="L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="LC19" class="blob-code blob-code-inner js-file-line">s+=&quot;\n    &lt;&lt;&lt; raw stack &gt;&gt;&gt;&quot;+(nl&gt;=0?raw.substring(nl):raw);return s}e.__frame=e.__frame||f;if(exports.stackTraceEnabled&amp;&amp;e.__lookupGetter__&amp;&amp;e.__lookupGetter__(&quot;rawStack&quot;)==null){var getter=e.__lookupGetter__(&quot;stack&quot;);if(!getter){var raw=e.stack||&quot;raw stack unavailable&quot;;getter=function(){return raw}}e.__defineGetter__(&quot;rawStack&quot;,getter);e.__defineGetter__(&quot;stack&quot;,function(){return formatStack(e,getter())})}}exports.stackTraceEnabled=true})(typeof exports!==&quot;undefined&quot;?exports:Streamline.runtime=Streamline.runtime||{});srequire&amp;&amp;srequire(&quot;streamline/lib/callbacks/builtins&quot;);var __rt=srequire(&quot;streamline/lib/callbacks/runtime&quot;).runtime(__filename,false),__func=__rt.__func,__cb=__rt.__cb;(function(exports){&quot;use strict&quot;;var VERSION=3;var future=function(fn,args,i){var err,result,done,q=[],self=this;args=Array.prototype.slice.call(args);args[i]=function(e,r){err=e,result=r,done=true;q&amp;&amp;q.forEach(function(f){f.call(self,e,r)});q=null};fn.apply(this,args);return function F(cb){if(!cb){return F}if(done){cb.call(self,err,result)}else{q.push(cb)}}};exports.funnel=function(max){max=max==null?-1:max;if(max===0){max=funnel.defaultSize}if(typeof max!==&quot;number&quot;){throw new Error(&quot;bad max number: &quot;+max)}var queue=[],active=0,closed=false;var funCb=function(callback,fn){if(callback==null){return future(funCb,arguments,0)}if(max&lt;0||max==Infinity){return fn(callback)}queue.push({fn:fn,cb:callback});function _doOne(){var current=queue.splice(0,1)[0];if(!current.cb){return current.fn()}active++;current.fn(function(err,result){active--;if(!closed){current.cb(err,result);while(active&lt;max&amp;&amp;queue.length&gt;0){_doOne()}}})}while(active&lt;max&amp;&amp;queue.length&gt;0){_doOne()}};var fun=__rt.streamlinify(funCb,0);fun.close=function(){queue=[],closed=true};return fun};var funnel=exports.funnel;funnel.defaultSize=4;function _parallel(options){if(typeof options===&quot;number&quot;){return options}if(typeof options.parallel===&quot;number&quot;){return options.parallel}return options.parallel?-1:1}if(Array.prototype.forEach_&amp;&amp;Array.prototype.forEach_.version_&gt;=VERSION){return}try{Object.defineProperty({},&quot;x&quot;,{})}catch(e){return}var has=Object.prototype.hasOwnProperty;delete Array.prototype.forEach_;Object.defineProperty(Array.prototype,&quot;forEach_&quot;,{configurable:true,writable:true,enumerable:false,value:function value__1(_,options,fn,thisObj){var par,len,i,__this=this;var __frame={name:&quot;value__1&quot;,line:124};return __func(_,this,arguments,value__1,0,__frame,function __$value__1(){if(typeof options===&quot;function&quot;){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;return function __$value__1(__then){if(par===1||len&lt;=1){i=0;var __2=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__1(){__more=false;if(__2){i++}else{__2=true}var __1=i&lt;len;if(__1){return function __$value__1(__then){if(has.call(__this,i)){return fn.call(thisObj,__cb(_,__frame,7,31,__then,true),__this[i],i)}else{__then()}}(function __$value__1(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{return __this.map_(__cb(_,__frame,10,9,__then,true),par,fn,thisObj)}}(function __$value__1(){return _(null,__this)})})}});Array.prototype.forEach_.version_=VERSION;delete Array.prototype.map_;Object.defineProperty(Array.prototype,&quot;map_&quot;,{configurable:true,writable:true,enumerable:false,value:function value__2(_,options,fn,thisObj){var par,len,result,i,fun,__this=this;var __frame={name:&quot;value__2&quot;,line:147};return __func(_,this,arguments,value__2,0,__frame,function __$value__2(){if(typeof options===&quot;function&quot;){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;return function __$value__2(__then){if(par===1||len&lt;=1){result=new Array(len);i=0;var __4=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__2(){__more=false;if(__4){i++}else{__4=true}var __3=i&lt;len;if(__3){return function __$value__2(__then){if(has.call(__this,i)){return fn.call(thisObj,__cb(_,__frame,9,43,function ___(__0,__1){result[i]=__1;__then()},true),__this[i],i)}else{__then()}}(function __$value__2(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{fun=funnel(par);result=__this.map(function(elt,i){return fun(false,function __1(_){var __frame={name:&quot;__1&quot;,line:161};return __func(_,this,arguments,__1,0,__frame,function __$__1(){return fn.call(thisObj,__cb(_,__frame,1,16,_,true),elt,i)})})});i=0;var __7=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__2(){__more=false;if(__7){i++}else{__7=true}var __6=i&lt;len;if(__6){return function __$value__2(__then){if(has.call(__this,i)){return result[i](__cb(_,__frame,19,40,function ___(__0,__2){result[i]=__2;__then()},true))}else{__then()}}(function __$value__2(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}}(function __$value__2(){return _(null,result)})})}});delete Array.prototype.filter_;Object.defineProperty(Array.prototype,&quot;filter_&quot;,{configurable:true,writable:true,enumerable:false,value:function value__3(_,options,fn,thisObj){var par,result,len,i,elt,__this=this;var __frame={name:&quot;value__3&quot;,line:179};return __func(_,this,arguments,value__3,0,__frame,function __$value__3(){if(typeof options===&quot;function&quot;){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;result=[];len=__this.length;return function __$value__3(__then){if(par===1||len&lt;=1){i=0;var __4=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__3(){__more=false;if(__4){i++}else{__4=true}var __3=i&lt;len;if(__3){return function __$value__3(__then){if(has.call(__this,i)){elt=__this[i];return fn.call(thisObj,__cb(_,__frame,10,13,function ___(__0,__2){return function __$value__3(__then){if(__2){result.push(elt);__then()}else{__then()}}(__then)},true),elt)}else{__then()}}(function __$value__3(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{return __this.map_(__cb(_,__frame,14,9,__then,true),par,function __1(_,elt){var __frame={name:&quot;__1&quot;,line:193};return __func(_,this,arguments,__1,0,__frame,function __$__1(){return fn.call(thisObj,__cb(_,__frame,1,12,function ___(__0,__1){return function __$__1(__then){if(__1){result.push(elt);__then()}else{__then()}}(_)},true),elt)})},thisObj)}}(function __$value__3(){return _(null,result)})})}});delete Array.prototype.every_;Object.defineProperty(Array.prototype,&quot;every_&quot;,{configurable:true,writable:true,enumerable:false,value:function value__4(_,options,fn,thisObj){var par,len,i,fun,futures,__this=this;var __frame={name:&quot;value__4&quot;,line:207};return __func(_,this,arguments,value__4,0,__frame,function __$value__4(){if(typeof options===&quot;function&quot;){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;return function __$value__4(__then){if(par===1||len&lt;=1){i=0;var __6=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__4(){__more=false;if(__6){i++}else{__6=true}var __5=i&lt;len;if(__5){return function __$value__4(_){var __1=has.call(__this,i);if(!__1){return _(null,__1)}return fn.call(thisObj,__cb(_,__frame,8,34,function ___(__0,__3){var __2=!__3;return _(null,__2)},true),__this[i])}(__cb(_,__frame,-206,17,function ___(__0,__3){return function __$value__4(__then){if(__3){return _(null,false)}else{__then()}}(function __$value__4(){while(__more){__loop()}__more=true})},true))}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{fun=funnel(par);futures=__this.map(function(elt){return fun(false,function __1(_){var __frame={name:&quot;__1&quot;,line:220};return __func(_,this,arguments,__1,0,__frame,function __$__1(){return fn.call(thisObj,__cb(_,__frame,1,16,_,true),elt)})})});i=0;var __9=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__4(){__more=false;if(__9){i++}else{__9=true}var __8=i&lt;len;if(__8){return function __$value__4(_){var __2=has.call(__this,i);if(!__2){return _(null,__2)}return futures[i](__cb(_,__frame,18,31,function ___(__0,__4){var __3=!__4;return _(null,__3)},true))}(__cb(_,__frame,-206,17,function ___(__0,__4){return function __$value__4(__then){if(__4){fun.close();return _(null,false)}else{__then()}}(function __$value__4(){while(__more){__loop()}__more=true})},true))}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}}(function __$value__4(){return _(null,true)})})}});delete Array.prototype.some_;Object.defineProperty(Array.prototype,&quot;some_&quot;,{configurable:true,writable:true,enumerable:false,value:function value__5(_,options,fn,thisObj){var par,len,i,fun,futures,__this=this;var __frame={name:&quot;value__5&quot;,line:241};return __func(_,this,arguments,value__5,0,__frame,function __$value__5(){if(typeof options===&quot;function&quot;){thisObj=fn,fn=options,options=1}par=_parallel(options);thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;return function __$value__5(__then){if(par===1||len&lt;=1){i=0;var __6=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__5(){__more=false;if(__6){i++}else{__6=true}var __5=i&lt;len;if(__5){return function __$value__5(_){var __1=has.call(__this,i);if(!__1){return _(null,__1)}return fn.call(thisObj,__cb(_,__frame,7,33,_,true),__this[i])}(__cb(_,__frame,-240,17,function ___(__0,__3){return function __$value__5(__then){if(__3){return _(null,true)}else{__then()}}(function __$value__5(){while(__more){__loop()}__more=true})},true))}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}else{fun=funnel(par);futures=__this.map(function(elt){return fun(false,function __1(_){var __frame={name:&quot;__1&quot;,line:253};return __func(_,this,arguments,__1,0,__frame,function __$__1(){return fn.call(thisObj,__cb(_,__frame,1,16,_,true),elt)})})});i=0;var __9=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__5(){__more=false;if(__9){i++}else{__9=true}var __8=i&lt;len;if(__8){return function __$value__5(_){var __2=has.call(__this,i);if(!__2){return _(null,__2)}return futures[i](__cb(_,__frame,17,30,_,true))}(__cb(_,__frame,-240,17,function ___(__0,__4){return function __$value__5(__then){if(__4){fun.close();return _(null,true)}else{__then()}}(function __$value__5(){while(__more){__loop()}__more=true})},true))}else{__break()}});do{__loop()}while(__more);__more=true}(__then)}}(function __$value__5(){return _(null,false)})})}});delete Array.prototype.reduce_;Object.defineProperty(Array.prototype,&quot;reduce_&quot;,{configurable:true,writable:true,enumerable:false,value:function value__6(_,fn,v,thisObj){var len,i,__this=this;var __frame={name:&quot;value__6&quot;,line:274};return __func(_,this,arguments,value__6,0,__frame,function __$value__6(){thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;i=0;var __3=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__6(){__more=false;if(__3){i++}else{__3=true}var __2=i&lt;len;if(__2){return function __$value__6(__then){if(has.call(__this,i)){return fn.call(thisObj,__cb(_,__frame,4,34,function ___(__0,__1){v=__1;__then()},true),v,__this[i],i,__this)}else{__then()}}(function __$value__6(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(function __$value__6(){return _(null,v)})})}});delete Array.prototype.reduceRight_;Object.defineProperty(Array.prototype,&quot;reduceRight_&quot;,{configurable:true,writable:true,enumerable:false,value:function value__7(_,fn,v,thisObj){var len,i,__this=this;var __frame={name:&quot;value__7&quot;,line:290};return __func(_,this,arguments,value__7,0,__frame,function __$value__7(){thisObj=thisObj!==undefined?thisObj:__this;len=__this.length;i=len-1;var __3=false;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$value__7(){__more=false;if(__3){i--}else{__3=true}var __2=i&gt;=0;if(__2){return function __$value__7(__then){if(has.call(__this,i)){return fn.call(thisObj,__cb(_,__frame,4,34,function ___(__0,__1){v=__1;__then()},true),v,__this[i],i,__this)}else{__then()}}(function __$value__7(){while(__more){__loop()}__more=true})}else{__break()}});do{__loop()}while(__more);__more=true}(function __$value__7(){return _(null,v)})})}});delete Array.prototype.sort_;Object.defineProperty(Array.prototype,&quot;sort_&quot;,{configurable:true,writable:true,enumerable:false,value:function value__8(_,compare,beg,end){var array,__this=this;function _qsort(_,beg,end){var tmp,mid,o,nbeg,nend;var __frame={name:&quot;_qsort&quot;,line:313};return __func(_,this,arguments,_qsort,0,__frame,function __$_qsort(){if(beg&gt;=end){return _(null)}return function __$_qsort(__then){if(end==beg+1){return compare(__cb(_,__frame,4,9,function ___(__0,__4){var __3=__4&gt;0;return function __$_qsort(__then){if(__3){tmp=array[beg];array[beg]=array[end];array[end]=tmp;__then()}else{__then()}}(function __$_qsort(){return _(null)})},true),array[beg],array[end])}else{__then()}}(function __$_qsort(){mid=Math.floor((beg+end)/2);o=array[mid];nbeg=beg;nend=end;return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$_qsort(){__more=false;var __6=nbeg&lt;=nend;if(__6){return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$_qsort(){__more=false;return function __$_qsort(_){return function __$_qsort(_){var __1=nbeg&lt;end;if(!__1){return _(null,__1)}return compare(__cb(_,__frame,18,26,function ___(__0,__3){var __2=__3&lt;0;return _(null,__2)},true),array[nbeg],o)}(__cb(_,__frame,-312,17,_,true))}(__cb(_,__frame,-312,17,function ___(__0,__7){if(__7){nbeg++;while(__more){__loop()}__more=true}else{__break()}},true))});do{__loop()}while(__more);__more=true}(function __$_qsort(){return function ___(__break){var __more;var __loop=__cb(_,__frame,0,0,function __$_qsort(){__more=false;return function __$_qsort(_){return function __$_qsort(_){var __2=beg&lt;nend;if(!__2){return _(null,__2)}return compare(__cb(_,__frame,19,26,function ___(__0,__4){var __3=__4&lt;0;return _(null,__3)},true),o,array[nend])}(__cb(_,__frame,-312,17,_,true))}(__cb(_,__frame,-312,17,function ___(__0,__9){if(__9){nend--;while(__more){__loop()}__more=true}else{__break()}},true))});do{__loop()}while(__more);__more=true}(function __$_qsort(){if(nbeg&lt;=nend){tmp=array[nbeg];array[nbeg]=array[nend];array[nend]=tmp;nbeg++;nend--}while(__more){__loop()}__more=true})})}else{__break()}});do{__loop()}while(__more);__more=true}(function __$_qsort(){return function __$_qsort(__then){if(nbeg&lt;end){return _qsort(__cb(_,__frame,30,20,__then,true),nbeg,end)}else{__then()}}(function __$_qsort(){return function __$_qsort(__then){if(beg&lt;nend){return _qsort(__cb(_,__frame,31,20,__then,true),beg,nend)}else{__then()}}(_)})})})})}var __frame={name:&quot;value__8&quot;,line:308};return __func(_,this,arguments,value__8,0,__frame,function __$value__8(){array=__this;beg=beg||0;end=end==null?array.length-1:end;return _qsort(__cb(_,__frame,38,3,function __$value__8(){return _(null,array)},true),beg,end)})}});delete Function.prototype.apply_;Object.defineProperty(Function.prototype,&quot;apply_&quot;,{configurable:true,writable:true,enumerable:false,value:function(callback,thisObj,args,index){args=Array.prototype.slice.call(args,0);args.splice(index!=null&amp;&amp;index&gt;=0?index:args.length,0,callback);return this.apply(thisObj,args)}})})(typeof exports!==&quot;undefined&quot;?exports:Streamline.builtins=Streamline.builtins||{});/*This is a combined, compressed file.  Look at https://github.com/BruceSherwood/glowscript for source code and copyright information.*/</td>
      </tr>
      <tr>
        <td id="L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="LC20" class="blob-code blob-code-inner js-file-line">;(function(){})();</td>
      </tr>
</table>

  <div class="BlobToolbar position-absolute js-file-line-actions dropdown js-menu-container js-select-menu d-none" aria-hidden="true">
    <button class="btn-octicon ml-0 px-2 p-0 bg-white border border-gray-dark rounded-1 dropdown-toggle js-menu-target" id="js-file-line-action-button" type="button" aria-expanded="false" aria-haspopup="true" aria-label="Inline file action toolbar" aria-controls="inline-file-actions">
      <svg aria-hidden="true" class="octicon octicon-kebab-horizontal" height="16" version="1.1" viewBox="0 0 13 16" width="13"><path fill-rule="evenodd" d="M1.5 9a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/></svg>
    </button>
    <div class="dropdown-menu-content js-menu-content" id="inline-file-actions">
      <ul class="BlobToolbar-dropdown dropdown-menu dropdown-menu-se mt-2">
        <li><a class="js-zeroclipboard dropdown-item" style="cursor:pointer;" id="js-copy-lines" data-original-text="Copy lines">Copy lines</a></li>
        <li><a class="js-zeroclipboard dropdown-item" id= "js-copy-permalink" style="cursor:pointer;" data-original-text="Copy permalink">Copy permalink</a></li>
        <li><a href="/BruceSherwood/glowscript/blame/0bce813f5293d664eaecf51e9db0ad861681471b/package/glow.2.1.min.js" class="dropdown-item js-update-url-with-hash" id="js-view-git-blame">View git blame</a></li>
          <li><a href="/BruceSherwood/glowscript/issues/new" class="dropdown-item" id="js-new-issue">Open new issue</a></li>
      </ul>
    </div>
  </div>

  </div>

  </div>

  <button type="button" data-facebox="#jump-to-line" data-facebox-class="linejump" data-hotkey="l" class="d-none">Jump to Line</button>
  <div id="jump-to-line" style="display:none">
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form accept-charset="UTF-8" action="" class="js-jump-to-line-form" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
      <input class="form-control linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" aria-label="Jump to line" autofocus>
      <button type="submit" class="btn">Go</button>
</form>  </div>

  </div>
  <div class="modal-backdrop js-touch-events"></div>
</div>

    </div>
  </div>

  </div>

      
<div class="footer container-lg px-3" role="contentinfo">
  <div class="position-relative d-flex flex-justify-between py-6 mt-6 f6 text-gray border-top border-gray-light ">
    <ul class="list-style-none d-flex flex-wrap ">
      <li class="mr-3">&copy; 2017 <span title="0.21070s from unicorn-1713501843-gz2nl">GitHub</span>, Inc.</li>
        <li class="mr-3"><a href="https://github.com/site/terms" data-ga-click="Footer, go to terms, text:terms">Terms</a></li>
        <li class="mr-3"><a href="https://github.com/site/privacy" data-ga-click="Footer, go to privacy, text:privacy">Privacy</a></li>
        <li class="mr-3"><a href="https://github.com/security" data-ga-click="Footer, go to security, text:security">Security</a></li>
        <li class="mr-3"><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
        <li><a href="https://help.github.com" data-ga-click="Footer, go to help, text:help">Help</a></li>
    </ul>

    <a href="https://github.com" aria-label="Homepage" class="footer-octicon" title="GitHub">
      <svg aria-hidden="true" class="octicon octicon-mark-github" height="24" version="1.1" viewBox="0 0 16 16" width="24"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
</a>
    <ul class="list-style-none d-flex flex-wrap ">
        <li class="mr-3"><a href="https://github.com/contact" data-ga-click="Footer, go to contact, text:contact">Contact GitHub</a></li>
      <li class="mr-3"><a href="https://developer.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li class="mr-3"><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
      <li class="mr-3"><a href="https://shop.github.com" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
        <li class="mr-3"><a href="https://github.com/blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
        <li><a href="https://github.com/about" data-ga-click="Footer, go to about, text:about">About</a></li>

    </ul>
  </div>
</div>



  <div id="ajax-error-message" class="ajax-error-message flash flash-error">
    <svg aria-hidden="true" class="octicon octicon-alert" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"/></svg>
    <button type="button" class="flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
      <svg aria-hidden="true" class="octicon octicon-x" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"/></svg>
    </button>
    You can't perform that action at this time.
  </div>


    
    <script crossorigin="anonymous" integrity="sha256-R7c3eUp64zkx0aUKgHD8RyBMQTxCRYqXgUMLHeA4450=" src="https://assets-cdn.github.com/assets/frameworks-47b737794a7ae33931d1a50a8070fc47204c413c42458a9781430b1de038e39d.js"></script>
    
    <script async="async" crossorigin="anonymous" integrity="sha256-Qkc87DGR10XKre61lV2syUoYE2acFhpZ4zg4WtwcvJA=" src="https://assets-cdn.github.com/assets/github-42473cec3191d745caadeeb5955dacc94a1813669c161a59e338385adc1cbc90.js"></script>
    
    
    
    
  <div class="js-stale-session-flash stale-session-flash flash flash-warn flash-banner d-none">
    <svg aria-hidden="true" class="octicon octicon-alert" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M8.865 1.52c-.18-.31-.51-.5-.87-.5s-.69.19-.87.5L.275 13.5c-.18.31-.18.69 0 1 .19.31.52.5.87.5h13.7c.36 0 .69-.19.86-.5.17-.31.18-.69.01-1L8.865 1.52zM8.995 13h-2v-2h2v2zm0-3h-2V6h2v4z"/></svg>
    <span class="signed-in-tab-flash">You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
    <span class="signed-out-tab-flash">You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
  </div>
  <div class="facebox" id="facebox" style="display:none;">
  <div class="facebox-popup">
    <div class="facebox-content" role="dialog" aria-labelledby="facebox-header" aria-describedby="facebox-description">
    </div>
    <button type="button" class="facebox-close js-facebox-close" aria-label="Close modal">
      <svg aria-hidden="true" class="octicon octicon-x" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"/></svg>
    </button>
  </div>
</div>


  </body>
</html>

